import{_ as le,f as p,g as F,w as se,i as _,o as s,k as ae,d as v,a as t,t as E,b as y,D as M,c,r as O,F as D,O as X,aP as me,v as ce,as as fe,p as ie,e as re,aJ as ve,aK as _e,a5 as ye,h as ke,A as ge,B as oe,j as ee,C as he,u as be,a9 as we,am as Be,a7 as Le}from"./index-9_XIwmWN.js";import{B as b}from"./bankResourceHelper-pbiR2aQY.js";import{t as ne,r as Ne,d as Ee}from"./bankResource-CZ5l-OHY.js";const Re=w=>(ie("data-v-8cab347e"),w=w(),re(),w),Ce={class:"form-header"},xe=Re(()=>t("div",{class:"el-upload__text"},[t("em",null,"拖拽文件至此处"),M("或"),t("em",null,"点击"),M("进行上传 ")],-1)),Ie={class:"dialog-footer"},Te={__name:"uploadDialog",props:{type:{type:String,default:"model"},subType:{type:String,default:"DEM"},bankEnName:{type:String,default:"Mzs"}},setup(w,{expose:q}){const k=w,$=p(null),o=p(!1),R=F(()=>({model:{DEM:"地形数据",Hydrodynamic:"预算工况数据",Boundary:"岸段边界数据",Config:"配置数据"}})[k.type][k.subType]+"上传"),h=F(()=>k.bankEnName),j=F(()=>({model:{DEM:"tiff",Hydrodynamic:"Hydrodynamic",Boundary:"shapefile",Config:"json"}})[k.type][k.subType]),C=F(()=>k.subType),U=p({model:[{label:"文件名",enName:"name",value:""},{label:"年份",enName:"year",value:"2023"},{label:"月份",enName:"month",value:"04"},{label:"工况集",enName:"set",value:"standard"},{label:"备注",enName:"description",value:""}]}),A=p(null),J=p([]),S=p(!1);let z=null;se(S,r=>{r?z=me.service({target:".dialog-class",text:"正在上传中...",lock:!0,background:"rgba(255, 255, 255, 0.715)",parent:$.value}):z.close()});const m=r=>{console.log("preview! ",r)},P=(r,n)=>{console.log("remove! ",r,n),console.log("Cancel the transfer! ",r.name)};let g=null;const B=r=>{const n=K(U.value[k.type]);console.log("fileInfo!!",n),g=new FormData,g.append("file",r.file),g.append("info",JSON.stringify(n)),console.log("formData!!",g)},G=()=>{o.value=!1},H=r=>{console.log("confirmUploadHandler!!",g),g&&g.has("file")&&g.has("info")?(S.value=!0,ce.post("/model/data/bankResource/up/modelServer/resource/file",g).then(n=>{console.log("上传成功！",n),o.value=!1,S.value=!1}).catch(n=>{console.error("上传失败！",n)})):fe.error("请选择文件后上传")};q({dialogFormVisible:o});const K=r=>{const n={};return r.forEach(T=>{n[T.enName]=T.value}),n.segment=h.value,n.fileType=j.value,n.category=C.value,n};return(r,n)=>{const T=_("el-input"),Q=_("el-form-item"),W=_("el-form"),e=_("upload-filled"),a=_("el-icon"),i=_("el-upload"),f=_("el-button"),L=_("el-dialog");return k.type==="model"?(s(),ae(L,{key:0,modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=u=>o.value=u),width:"18vw","show-close":!1,ref_key:"dialogRef",ref:$,"custom-class":"dialog-class"},{header:v(({titleId:u,titleClass:d})=>[t("div",Ce,E(R.value),1)]),footer:v(()=>[t("div",Ie,[y(f,{onClick:G},{default:v(()=>[M("取消")]),_:1}),y(f,{type:"primary",onClick:H},{default:v(()=>[M(" 确认 ")]),_:1})])]),default:v(()=>[y(W,{model:U.value[k.type]},{default:v(()=>[(s(!0),c(D,null,O(U.value[k.type],(u,d)=>(s(),ae(Q,{key:d,label:u.label},{default:v(()=>[y(T,{modelValue:u.value,"onUpdate:modelValue":V=>u.value=V,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1},8,["model"]),y(i,{style:{height:"fit-content"},drag:"",action:"#",multiple:!1,"show-file-list":!0,ref_key:"uploadRef",ref:A,"auto-upload":!1,"file-list":J.value,"on-preview":m,"on-remove":P,"http-request":B},{default:v(()=>[y(a,{class:"el-icon--upload"},{default:v(()=>[y(e)]),_:1}),xe]),_:1},8,["file-list"])]),_:1},8,["modelValue"])):X("",!0)}}},Ve=le(Te,[["__scopeId","data-v-8cab347e"]]),te=w=>(ie("data-v-82a94cdd"),w=w(),re(),w),Se={class:"bank-resouce-create-container"},De=te(()=>t("div",{class:"main-title"},"岸段管理 ",-1)),Me={class:"desc-box-container"},je=te(()=>t("div",{class:"title-container"},"岸段基本信息",-1)),Ue={class:"detail-content-container"},He={class:"bank-name"},Fe=te(()=>t("div",{class:"bankName-key"},"岸段名称",-1)),Oe={key:0,class:"bankName-val"},$e={key:1,class:"bankName-val"},ze={class:"detail-key"},Pe={key:0,class:"detail-val"},Ge={key:1,class:"detail-val"},Xe={class:"detail-val-row"},qe={class:"detail-val-row"},Ae={key:2,class:"detail-val"},Je={class:"change-button-container"},Ke={class:"resource-box-container"},Qe={class:"title-container"},We={class:"resource-content-container"},Ye={class:"resource-title"},Ze=["onClick"],ea={class:"resource-content"},aa={style:{display:"flex","align-items":"center","justify-content":"center"}},ta={__name:"BankResourcePreview",emits:["update-bank-basic-info"],setup(w,{emit:q}){const k=ve();_e(async(e,a)=>{const i=e.params.id;T(i)});const $=q,o=ye({name:"",bankEnName:""}),R=p(),h=p(!1);let j=null,C={name:"",bankEnName:""};const U=()=>{console.log("进入修改状态"),h.value=!0,j=R.value.map(e=>({...e})),C.name=o.name,C.bankEnName=o.bankEnName},A=()=>{console.log("退出修改状态"),h.value=!1,R.value=j,o.name=C.name,o.bankEnName=C.bankEnName},J=()=>{console.log("提交修改"),Be.confirm("确认修改岸段信息？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}).then(async()=>{const e=L=>{const u=L.slice(1,-1).split(","),d=parseFloat(u[0]),V=parseFloat(u[1]);return[d,V]};let a=R.value,i={bank:o.bankEnName,name:o.name,riskLevel:a[0].val,center:e(a[1].val),introduction:a[2].val,management:{department:a[3].val,contact:a[4].val}};const f=(await b.updateBankBasicInfo(o.bankEnName,i)).data;$("update-bank-basic-info",!0),Le.success({title:f,offset:120}),h.value=!1}).catch(e=>{console.log("取消修改"),R.value=j,o.name=C.name,o.bankEnName=C.bankEnName,h.value=!1})},S=p([]),z=e=>{S.value.push(e)},m=p(0);se(m,(e,a)=>{const i={0:"translateX(0%)",1:"translateX(-100%)",2:"translateX(-200%)"};S.value.forEach(f=>{f.style.transform=i[e]})});const P=p(0),g=e=>{if(e){if(m.value===-1+Object.keys(B.value).length)return;m.value=(m.value+1)%Object.keys(B.value).length}else{if(m.value===0)return;m.value=(m.value-1+Object.keys(B.value).length)%Object.keys(B.value).length}},B=p({}),G=p(null),H=F(()=>({type:ne[m.value],subType:Ne[ne[m.value]][P.value],bankEnName:o.bankEnName})),K=e=>{P.value=e,G.value.dialogFormVisible=!0},r=Ee,n=p(!1);ke(async()=>{const e=k.params.id;await T(e),console.log(o.name)});const T=async e=>{n.value=!0;const a=e,i=(await b.getOneBankBasicInfo(a)).data;console.log(i);const f=(await b.getBankCalculateResourceList("DEM",a)).data,L=(await b.getBankCalculateResourceList("Hydrodynamic",a)).data,u=(await b.getBankCalculateResourceList("Boundary",a)).data,d=(await b.getBankCalculateResourceList("Config",a)).data,V=[{key:"岸段地形资源",resourceList:b.DEMResourcetoList(f)},{key:"水动力预算工况",resourceList:b.HydrodynamicResourcetoList(L)},{key:"岸段边界资源",resourceList:b.BoundaryResourcetoList(u)},{key:"岸段配置资源",resourceList:b.ConfigResourcetoList(d)}],l=(await b.getBankVisualResourceList("DEM",e)).data;l.map(N=>N.fileType="地形切片");const x=[{key:"栅格可视化资源",resourceList:l},{key:"矢量可视化资源",resourceList:[{name:"示例矢量资源",fileType:"geojson"}]},{key:"其他",resourceList:[{name:"示例资源",fileType:"config.json",uploadTime:"2024-09-01"}]}];let I=[];if(e==="Mzs"){const N=(await ce.get("/api/data/monitorInfo")).data,{_GNSS:Y,_Incline:Z,_Stress:ue,_Menometer:de,_Vedio:pe}=W(N);I=[{key:"GNSS设备",resourceList:Y},{key:"孔隙水压力计设备",resourceList:de},{key:"应力桩设备",resourceList:ue},{key:"测斜仪设备",resourceList:Z},{key:"监控摄像设备",resourceList:pe}]}else I=[{key:"GNSS设备",resourceList:[]},{key:"孔隙水压力计设备",resourceList:[]},{key:"应力桩设备",resourceList:[]},{key:"测斜仪设备",resourceList:[]},{key:"监控摄像设备",resourceList:[]}];o.name=i.name,o.bankEnName=a,R.value=Q(i),B.value={模型资源管理:V,可视化资源管理:x,设备资源管理:I},n.value=!1},Q=e=>[{key:"预警级别",val:e.riskLevel,type:["half","left"]},{key:"中心坐标",val:e.center,type:["half","right"],splitter:" "},{key:"情况介绍",val:e.introduction,type:["single","long-text"]},{key:"管理单位",val:e.management.department,type:["half","left"]},{key:"管理单位联系方式",val:e.management.contact,type:["half","right"]}],W=e=>{const a=[],i=[],f=[],L=[],u=[];return e.forEach(d=>{switch(d.type){case"1":a.push(d);break;case"2":f.push(d);break;case"3":L.push(d);break;case"4":i.push(d);break;case"6":u.push(d);break}}),{_GNSS:a,_Incline:i,_Stress:f,_Menometer:L,_Vedio:u}};return(e,a)=>{const i=_("el-input"),f=_("el-tag"),L=_("el-table-column"),u=_("el-table"),d=_("el-scrollbar"),V=ge("loading");return s(),c(D,null,[oe((s(),c("div",Se,[De,t("div",Me,[je,t("div",Ue,[t("div",He,[Fe,h.value?(s(),c("div",Oe,[y(i,{modelValue:o.name,"onUpdate:modelValue":a[0]||(a[0]=l=>o.name=l),style:{width:"100%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"},placeholder:"请输入",type:"text",autosize:{minRows:4,maxRows:6}},null,8,["modelValue"])])):(s(),c("div",$e,E(o.name),1))]),(s(!0),c(D,null,O(R.value,(l,x)=>(s(),c("div",{class:ee(["detail-box-item",l.type]),key:x},[t("div",ze,E(l.key),1),h.value?(s(),c("div",Pe,[y(i,{modelValue:l.val,"onUpdate:modelValue":I=>l.val=I,style:{width:"100%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"},placeholder:"Please input",type:l.type.includes("long-text")?"textarea":"text",autosize:{minRows:4,maxRows:6}},null,8,["modelValue","onUpdate:modelValue","type"])])):l.type.includes("two-row")?(s(),c("div",Ge,[t("div",Xe,E(l.val.split(l.splitter)[0]),1),t("div",qe,E(l.val.split(l.splitter)[1]),1)])):(s(),c("div",Ae,E(l.val),1)),t("div",Je,[h.value?X("",!0):(s(),c("div",{key:0,class:"change-button",onClick:U}," 修改 ")),h.value?(s(),c("div",{key:1,class:"change-button modify",onClick:J}," 提交 ")):X("",!0),h.value?(s(),c("div",{key:2,class:"cancel-button",onClick:A}," 取消 ")):X("",!0)])],2))),128))])]),t("div",Ke,[(s(!0),c(D,null,O(Object.keys(B.value),l=>(s(),c("div",{class:"one-type-resource-container",ref_for:!0,ref:z},[t("div",Qe,[t("span",{onClick:a[1]||(a[1]=x=>g(0)),class:ee(["page left",{ban:m.value===0}])},"上一页",2),t("span",null,E(l),1),t("span",{onClick:a[2]||(a[2]=x=>g(1)),class:ee(["page right",{ban:m.value===Object.keys(B.value).length-1}])},"下一页",2)]),t("div",We,[y(d,{height:"75vh"},{default:v(()=>[(s(!0),c(D,null,O(B.value[l],(x,I)=>(s(),c("div",{class:"resource-box-item",key:I},[t("div",Ye,[M(E(x.key)+" ",1),oe(t("div",{class:"resource-upload-btn",onClick:N=>K(I)},"上传 ",8,Ze),[[he,l==="模型资源管理"]])]),t("div",ea,[y(u,{data:x.resourceList,style:{width:"95%","margin-left":"2.5%"},"max-height":"25vh"},{default:v(()=>[(s(!0),c(D,null,O(be(r)[l],(N,Y)=>(s(),ae(L,{key:Y,prop:N.prop,label:N.label,"min-width":N["min-width"],align:"center"},we({_:2},[N.asTag?{name:"default",fn:v(Z=>[t("div",aa,[y(f,null,{default:v(()=>[M(E(Z.row.fileType),1)]),_:2},1024)])]),key:"0"}:void 0]),1032,["prop","label","min-width"]))),128))]),_:2},1032,["data"])])]))),128))]),_:2},1024)])]))),256))])])),[[V,n.value]]),y(Ve,{ref_key:"uploadDialogRef",ref:G,type:H.value.type,"sub-type":H.value.subType,"bank-en-name":H.value.bankEnName},null,8,["type","sub-type","bank-en-name"])],64)}}},sa=le(ta,[["__scopeId","data-v-82a94cdd"]]);export{sa as default};
