import{_ as G,x as H,e as g,h as K,ab as Q,A as W,i as h,o as v,c as w,b as _,w as u,a as c,P,j as Y,t as x,O as Z,C as ee,D as te,F as oe,r as ae,k as re,au as L,p as ne,d as ie}from"./index-DHCVlJMm.js";import{M as le}from"./mapbox-gl-draw-az4CMnhI.js";/* empty css                       */const M=d=>(ne("data-v-e2ffb41a"),d=d(),ie(),d),se=M(()=>c("div",{id:"map",class:"map-container"},null,-1)),ce=M(()=>c("span",null,"确认使用此断面进行计算",-1)),de={class:"dialog-footer"},ue={class:"current-param-container section"},me=M(()=>c("div",{class:"current-year-title"},"当前绘制断面",-1)),ye={key:0,class:"current-year-content two-line"},pe={class:"section-selectior-item"},fe={style:{"text-align":"center"}},ge={__name:"sectionDraw",props:{demResources:{type:Array,default:[]},demListShow:{type:Boolean,default:!0}},emits:["sectionDraw","demSelect"],setup(d,{expose:k,emit:A}){const V=H(),j=g(),m=g(!1),y=g(""),b=g(""),z=g(""),I=()=>{},N=()=>{f.trash(),m.value=!1},T=()=>{X(p)?(L.success({message:"有效断面",offset:180}),B("sectionDraw",p)):f.trash(),m.value=!1},R=d;let p=null,l=null;const B=A,f=new le({displayControlsDefault:!1,controls:{line_string:!0,trash:!0},styles:[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["==","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#d18800","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":3,"circle-color":"#d49100"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000000","line-width":3}}]}),E=()=>{setTimeout(()=>{l&&(console.log("map resize"),l.resize(),D(l))},1)},U=()=>p?{type:"FeatureCollection",features:[p]}:(console.warn("No feature found"),null),$=e=>{B("demSelect",e)},S="http://119.45.198.54:80/api";K(async()=>{l=await Q({id:"map"}),l.resize(),V.setMap(l),D(l),q(l);function e(o){if(o.features.length>0&&o.features[0].geometry.type==="LineString"){var r=o.features[0].geometry.coordinates;r.length>2&&(o.features[0].geometry.coordinates=r.slice(0,2),f.add(o.features[0]))}m.value=!0;let t=o.features[0];y.value=t.geometry.coordinates[0][0].toFixed(6)+","+t.geometry.coordinates[0][1].toFixed(6),b.value=t.geometry.coordinates[1][0].toFixed(6)+","+t.geometry.coordinates[1][1].toFixed(6),C(t.geometry.coordinates[0]),C(t.geometry.coordinates[1]),p=t}l.on("draw.create",e),l.on("draw.modechange",function(o){o.active==="draw_line_string"?l.on("click",function(r){var t=f.getAll(),n=t.features.filter(function(a){return a.geometry.type==="LineString"});n.length>0&&n[0].geometry.coordinates.length>=2&&l.off("click")}):l.off("click")}),l.resize()}),W(()=>{}),k({resizeMap:E,getSection:U});const q=e=>{e.addSource("mzsDemBoundArea",{type:"geojson",data:{type:"FeatureCollection",name:"demBound",features:[{type:"Feature",properties:{id:0},geometry:{type:"MultiPolygon",coordinates:[[[[120.46131975216994,32.08296173459822],[120.58935916574885,32.08281147793378],[120.58935916574885,31.987198228623438],[120.46131975216994,31.987198228623438],[120.46131975216994,32.08296173459822]]]]}}]}}),e.addSource("mzsDemBoundLine",{type:"geojson",data:{type:"FeatureCollection",name:"demBoundLine",features:[{type:"Feature",properties:{id:0},geometry:{type:"MultiLineString",coordinates:[[[120.46131975216994,32.08296173459822],[120.58935916574885,32.08281147793378],[120.58935916574885,31.987198228623438],[120.46131975216994,31.987198228623438],[120.46131975216994,32.08296173459822]]]}}]}}),e.addSource("mzsPlaceLabelSource",{type:"vector",tiles:[S+"/tile/vector/mzsPlaceLabel/{x}/{y}/{z}"]}),e.addSource("mzsPlaceLineSource",{type:"vector",tiles:[S+"/tile/vector/mzsPlaceLine/{x}/{y}/{z}"]}),e.addSource("riverBeachSource",{type:"vector",tiles:[S+"/tile/vector/riverBeach/{x}/{y}/{z}"]}),e.addLayer({id:"riverBeachArea",type:"fill",source:"riverBeachSource","source-layer":"default",paint:{"fill-color":"rgba(210,244,247, 1)"}}),e.addLayer({id:"mzsLine",type:"line",source:"mzsPlaceLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgba(26, 87, 138, 0.6)","line-width":2}}),e.addLayer({id:"mzsLabel",type:"symbol",source:"mzsPlaceLabelSource","source-layer":"default",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"left"},paint:{"text-color":"rgba(31, 14, 126, 0.75)"}}),e.addLayer({id:"mzsDemBoundLayerArea",type:"fill",source:"mzsDemBoundArea",paint:{"fill-color":"rgb(16, 27, 148)","fill-opacity":.1}}),e.addLayer({id:"mzsDemBoundLayerLine",type:"line",source:"mzsDemBoundLine",paint:{"line-color":"rgba(16, 27, 148, 1.0)","line-dasharray":[2,2],"line-width":1}}),e.addControl(f)},D=e=>{e&&e.fitBounds([[120.47987922676836,32.03001616423072],[120.59589640208264,32.048171362618625]],{pitch:0,duration:1500})},C=e=>{var o=Math.PI/180,r=6378137,t=20037508342789244e-9,n=Math.abs(e[0])<=180?e[0]:e[0]-Math.sign(e[0])*360,a=[r*n*o,r*Math.log(Math.tan(Math.PI*.25+.5*e[1]*o))];return a[0]>t&&(a[0]=t),a[0]<-t&&(a[0]=-t),a[1]>t&&(a[1]=t),a[1]<-t&&(a[1]=-t),a};function O(e,o,r,t){const n={x:o[0]-e[0],y:o[1]-e[1]},a={x:t[0]-r[0],y:t[1]-r[1]},i=n.x*a.x+n.y*a.y,s=Math.sqrt(n.x*n.x+n.y*n.y),F=Math.sqrt(a.x*a.x+a.y*a.y),J=i/(s*F);return Math.acos(J)*(180/Math.PI)}const X=e=>{let o=!0;const r={type:"Feature",properties:{},geometry:{coordinates:[[120.51995208023294,32.036127085249746],[120.51398616801038,32.01372735087271]],type:"LineString"}},t=[120.46131975216994,31.987198228623438,120.58935916574885,32.08296173459822];let n=r.geometry.coordinates[0],a=r.geometry.coordinates[1],i=e.geometry.coordinates[0],s=e.geometry.coordinates[1];return O(n,a,i,s)>50?(o=!1,L.error({message:"请绘制自民主沙右缘往南的有效断面",offset:180})):(Math.min(i[0],s[0])<=t[0]||Math.max(i[0],s[0])>=t[2]||Math.min(i[1],s[1])<=t[1]||Math.max(i[1],s[1])>=t[3])&&(o=!1,L.error({message:"请绘制在地形范围的有效断面",offset:180})),o};return(e,o)=>{const r=h("el-button"),t=h("el-dialog"),n=h("el-option"),a=h("el-select");return v(),w("div",{class:"section-choose-content",ref_key:"containerDom",ref:j,id:"section-draw-container"},[se,_(t,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=i=>m.value=i),title:"绘制断面确认",width:"40vh","before-close":I},{footer:u(()=>[c("div",de,[_(r,{onClick:N},{default:u(()=>[P("取消")]),_:1}),_(r,{type:"primary",onClick:T},{default:u(()=>[P(" 确认 ")]),_:1})])]),default:u(()=>[ce]),_:1},8,["modelValue"]),c("div",ue,[me,c("div",{class:Y(["current-year-content",{"two-line":y.value!=""}])},x(y.value==""?"暂未绘制":"起点："+y.value),3),y.value!=""?(v(),w("div",ye,x("终点："+b.value),1)):Z("",!0)]),ee(c("div",pe,[_(a,{modelValue:z.value,"onUpdate:modelValue":o[1]||(o[1]=i=>z.value=i),placeholder:"选择地形",style:{width:"10vw",height:"3.5vh"},onChange:$},{default:u(()=>[(v(!0),w(oe,null,ae(R.demResources,(i,s)=>(v(),re(n,{key:s,label:i.name+"地形",value:i.path},{default:u(()=>[c("div",fe,x(i.name+"地形"),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])],512),[[te,d.demListShow]])],512)}}},xe=G(ge,[["__scopeId","data-v-e2ffb41a"]]);export{xe as s};
