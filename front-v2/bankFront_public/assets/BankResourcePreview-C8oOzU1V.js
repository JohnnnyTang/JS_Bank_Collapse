import{_ as _e,e as k,f as de,i as p,o as t,k as w,w as s,a as d,t as M,b as N,P as U,c as g,r as P,F as j,O as Y,a5 as i,au as G,p as we,d as Ie,g as pe,aR as Re,ay as Ne,az as Ce,a8 as Ee,h as Le,B as Te,C as ke,ao as he,aa as Se,j as ve,D as De,u as xe,ac as Ue,N as be,an as Fe}from"./index-DHCVlJMm.js";import{u as ye}from"./resourceStore-CPl2Rzk6.js";import{r as Me,a as Ve,f as Oe,d as $e,g as je,t as ee,b as me,c as ze,e as He}from"./bankResource-IHSSRSxs.js";const Ae=S=>(we("data-v-d4ad12d2"),S=S(),Ie(),S),Ye={class:"form-header"},Pe=Ae(()=>d("div",{class:"el-upload__text"},[d("em",null,"拖拽文件至此处"),U("或"),d("em",null,"点击"),U("进行上传 ")],-1)),Je={class:"dialog-footer"},qe={__name:"uploadDialog",props:{type:{type:String,default:"model"},subType:{type:String,default:"DEM"},bankEnName:{type:String,default:"Mzs"}},setup(S,{expose:ae}){const e=S,W=k(null),X=ye(),C=k(!1),v=de(()=>Ve[e.type][e.subType]+"上传"),B=k(Me),R=k(null),J=k([]),u=k(!1),I=()=>{u.value=!0,G.info({message:"文件正在上传中,请稍后...",offset:100}),C.value=!1},te=r=>{console.log("preview! ",r)},le=(r,a)=>{console.log("remove! ",r,a),console.log("Cancel the transfer! ",r.name)};let L=null,K=null;const c=r=>{console.log("file change!")},T=r=>{if(console.log("handleFileUpload!!",r,J.value),e.type==="device"){I();const a=new FileReader;a.onload=b=>{try{let n=JSON.parse(b.target.result);console.log(n),K=Object.assign({},n),K&&i.uploadBankDevice(K,e.bankEnName).then(E=>{setTimeout(()=>{Q(E)},3e3)}).catch(E=>{$(E)})}catch(n){console.log(n),$(n),G.error({message:"请上传正确的设备配置文件！",offset:100})}},a.readAsText(r.file)}else if(e.type==="model"){u.value=!0,I();const a=Z(B.value[e.type][e.subType]);if(!a){u.value=!1;return}const[b,n]=z(r.file.name);a.name=b,e.subType==="DEM"&&(a.fileType=n==="txt"?n:"tiff"),L=new FormData,L.append("file",r.file),L.append("info",JSON.stringify(a)),i.uploadBankCalculateResourceFile(L).then(E=>{Q(E)}).catch(E=>{$(E)})}else if(e.type==="visual"){u.value=!0,I();const a={};B.value[e.type][e.subType].forEach(n=>{n.enName.includes("file")||(a[n.enName]=n.value)}),a.segment=e.bankEnName,a.fields===""&&delete a.fields,L=new FormData,L.append("file",r.file),L.append("info",JSON.stringify(a)),i.uploadBankVisualResourceFile(L,e.bankEnName).then(n=>{Q(n)}).catch(n=>{$(n)})}},O=()=>{C.value=!1},V=r=>{R.value&&R.value[0].submit()};ae({dialogFormVisible:C});const Z=r=>{let a;if(e.subType==="Hydrodynamic")try{a=X.resourceInfo.模型资源管理[2].resourceList[0].path}catch{return G.error("请先上传岸段边界矢量文件!"),!1}const b={};return r.forEach(n=>{n.enName.includes("file")||(b[n.enName]=n.value)}),b.segment=e.bankEnName,b.fileType=Oe[e.type][e.subType],b.category=e.subType,b.temp=!1,b.boundary=a,b},z=r=>{const a=r.split(".");return[a[0],a[1]]},Q=r=>{G.success({message:"上传成功！",offset:100}),console.log("SUCCESS::",r.data),C.value=!1,i.refreshBankVisualResource(X.resourceInfo,e.bankEnName,e.type,e.subType),u.value=!1},$=r=>{console.error("上传失败！",r),G.error({message:"上传失败！",offset:100}),i.refreshBankVisualResource(X.resourceInfo,e.bankEnName,e.type,e.subType),u.value=!1};return(r,a)=>{const b=p("el-input"),n=p("el-radio"),E=p("el-radio-group"),fe=p("upload-filled"),oe=p("el-icon"),ce=p("el-upload"),l=p("el-form-item"),o=p("el-form"),m=p("el-button"),D=p("el-dialog");return t(),w(D,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=_=>C.value=_),width:"18vw","show-close":!1,ref_key:"dialogRef",ref:W,"custom-class":"dialog-class","destroy-on-close":!0},{header:s(({titleId:_,titleClass:y})=>[d("div",Ye,M(v.value),1)]),footer:s(()=>[d("div",Je,[N(m,{onClick:O},{default:s(()=>[U("取消")]),_:1}),N(m,{type:"primary",onClick:V},{default:s(()=>[U(" 确认 ")]),_:1})])]),default:s(()=>[N(o,{model:B.value[e.type][e.subType],"label-position":"top"},{default:s(()=>[(t(!0),g(j,null,P(B.value[e.type][e.subType],(_,y)=>(t(),w(l,{key:y,label:_.label},{default:s(()=>[_.type==="input"?(t(),w(b,{key:0,modelValue:_.value,"onUpdate:modelValue":F=>_.value=F,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])):_.type==="radios"?(t(),w(E,{key:1,modelValue:_.value,"onUpdate:modelValue":F=>_.value=F},{default:s(()=>[(t(!0),g(j,null,P(_.radioLabelArray,(F,H)=>(t(),w(n,{value:_.radioValueArray[H]},{default:s(()=>[U(M(_.radioLabelArray[H]),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])):_.type==="file"?(t(),w(ce,{key:2,style:{height:"fit-content"},drag:"",action:"#",multiple:!1,"show-file-list":!0,ref_for:!0,ref_key:"uploadRef",ref:R,"auto-upload":!1,"file-list":J.value,"on-preview":te,"on-remove":le,"on-change":c,"http-request":T},{default:s(()=>[N(oe,{class:"el-icon--upload"},{default:s(()=>[N(fe)]),_:1}),Pe]),_:1},8,["file-list"])):Y("",!0)]),_:2},1032,["label"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},Ge=_e(qe,[["__scopeId","data-v-d4ad12d2"]]),Xe={class:"form-header"},Ke={class:"dialog-footer"},Qe={__name:"UpdateDialog",props:{type:{type:String,default:"model"},subType:{type:String,default:"DEM"},bankEnName:{type:String,default:"Mzs"},resourceItemInfo:{type:Object,default:{}}},setup(S,{expose:ae}){const e=S,W=k(null),X=ye(),C=k(!1);let v=null;pe(C,c=>{c?v=Re.service({target:".dialog-class",text:"正在上传中...",lock:!0,background:"rgba(255, 255, 255, 0.715)",parent:W.value}):v.close()});const B=k(!1),R=de(()=>Ve[e.type][e.subType]+"更新"),J=e.resourceItemInfo._rawValue,u=k(J);pe(e.resourceItemInfo,(c,T)=>{const O=Object.assign({},c);u.value=O});const I=k($e),te=()=>{B.value=!1},le=c=>{if(e.type==="device"){console.log("dialogValues",u.value);const T={aspect:u.value.sectionId,deviceId:u.value.machineId,deviceName:u.value.name,type:u.value.type,longitude:u.value.longitude,latitude:u.value.latitude,elevation:u.value.elevation},O=u.value.code;C.value=!0,i.updateBankDevice(T,e.bankEnName,O).then(V=>{L(V)}).catch(V=>{K(V)})}else(e.type==="model"||e.type==="visual")&&console.log("no update")};ae({dialogFormVisible:B});const L=c=>{G.success({message:"更新成功！",offset:100}),console.log("SUCCESS::",c.data),B.value=!1,i.refreshBankVisualResource(X.resourceInfo,e.bankEnName,e.type,e.subType),C.value=!1},K=c=>{console.error("更新失败！",c),G.error({message:"更新失败！",offset:100}),C.value=!1};return(c,T)=>{const O=p("el-input"),V=p("el-radio"),Z=p("el-radio-group"),z=p("el-form-item"),Q=p("el-form"),$=p("el-button"),r=p("el-dialog");return t(),w(r,{modelValue:B.value,"onUpdate:modelValue":T[0]||(T[0]=a=>B.value=a),width:"18vw","show-close":!1,ref_key:"dialogRef",ref:W,"custom-class":"dialog-class","destroy-on-close":!0},{header:s(({titleId:a,titleClass:b})=>[d("div",Xe,M(R.value),1)]),footer:s(()=>[d("div",Ke,[N($,{onClick:te},{default:s(()=>[U("取消")]),_:1}),N($,{type:"primary",onClick:le},{default:s(()=>[U(" 确认 ")]),_:1})])]),default:s(()=>[e.type==="device"?(t(),w(Q,{key:0,model:I.value},{default:s(()=>[(t(!0),g(j,null,P(Object.keys(I.value),(a,b)=>(t(),w(z,{key:b,label:I.value[a].label},{default:s(()=>[I.value[a].type==="input"?(t(),w(O,{key:0,modelValue:u.value[I.value[a].mappedMonitorInfoField],"onUpdate:modelValue":n=>u.value[I.value[a].mappedMonitorInfoField]=n,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])):I.value[a].type==="radios"?(t(),w(Z,{key:1,modelValue:u.value[I.value[a].mappedMonitorInfoField],"onUpdate:modelValue":n=>u.value[I.value[a].mappedMonitorInfoField]=n},{default:s(()=>[(t(!0),g(j,null,P(I.value[a].radioLabelArray,(n,E)=>(t(),w(V,{value:I.value[a].radioValueArray[E]},{default:s(()=>[U(M(I.value[a].radioLabelArray[E]),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])):Y("",!0)]),_:2},1032,["label"]))),128))]),_:1},8,["model"])):Y("",!0)]),_:1},8,["modelValue"])}}},We=_e(Qe,[["__scopeId","data-v-59e32e8a"]]),ge=S=>(we("data-v-af197ff8"),S=S(),Ie(),S),Ze={class:"bank-resouce-create-container"},ea=ge(()=>d("div",{class:"main-title"},"岸段管理",-1)),aa={class:"desc-box-container"},ta=ge(()=>d("div",{class:"title-container"},"岸段基本信息",-1)),la={class:"change-button-container"},oa={class:"detail-content-container"},na={class:"bank-name"},sa=ge(()=>d("div",{class:"bankName-key"},"岸段名称",-1)),ua={key:0,class:"bankName-val"},ca={key:1,class:"bankName-val"},ra={class:"detail-key"},ia={key:0,class:"detail-val"},da={style:{width:"100%","text-align":"center"}},pa={key:1,class:"detail-val"},fa={class:"resource-box-container"},va={class:"title-container"},ma={class:"resource-content-container"},_a={class:"resource-title"},ya=["onClick"],ga={class:"resource-content"},ka={style:{display:"flex","align-items":"center","justify-content":"center"}},ha={__name:"BankResourcePreview",emits:["refresh-bank-list"],setup(S,{emit:ae}){const e=["I 级预警岸段","Ⅱ 级预警岸段","Ⅲ 级预警岸段"],W=Ne();Ce(async(l,o)=>{const m=l.params.id;ce(m)});const X=ae,C=ye(),v=Ee({name:"",bankEnName:""}),B=k(),R=k(!1);let J=null,u={name:"",bankEnName:""};const I=()=>{console.log("进入修改状态"),R.value=!0,J=B.value.map(l=>({...l})),u.name=v.name,u.bankEnName=v.bankEnName},te=()=>{console.log("退出修改状态"),R.value=!1,B.value=J,v.name=u.name,v.bankEnName=u.bankEnName},le=()=>{console.log("提交修改"),he.confirm("确认修改岸段信息？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}).then(async()=>{const l=_=>{const y=_.slice(1,-1).split(","),F=parseFloat(y[0]),H=parseFloat(y[1]);return[F,H]};let o=B.value,m={bank:v.bankEnName,name:v.name,riskLevel:o[0].val,center:l(o[1].val),monitorLength:o[2].val,monitorStartTime:o[3].val.toISOString(),introduction:o[4].val,management:{department:o[5].val,contact:o[6].val}};const D=(await i.updateBankBasicInfo(v.bankEnName,m)).data;X("refresh-bank-list",!0),Se.success({title:D,offset:120}),R.value=!1}).catch(l=>{console.log("取消修改"),B.value=J,v.name=u.name,v.bankEnName=u.bankEnName,R.value=!1})},L=k([]),K=l=>{L.value.push(l)},c=k(0);pe(c,(l,o)=>{const m={0:"translateX(0%)",1:"translateX(-100%)",2:"translateX(-200%)"};L.value.forEach(D=>{D.style.transform=m[l]})});const T=k(0),O=l=>{if(l){if(c.value===-1+Object.keys(V.value).length)return;c.value=(c.value+1)%Object.keys(V.value).length}else{if(c.value===0)return;c.value=(c.value-1+Object.keys(V.value).length)%Object.keys(V.value).length}},V=k({}),Z=k(null),z=de(()=>({type:ee[c.value],subType:me[ee[c.value]][T.value],bankEnName:v.bankEnName})),Q=l=>{T.value=l,console.log(z.value),Z.value.dialogFormVisible=!0},$=k(null),r=k({aspect:"",deviceId:"",deviceName:"",type:"",longitude:"",latitude:"",elevation:""}),a=de(()=>({type:ee[c.value],subType:me[ee[c.value]][T.value],bankEnName:v.bankEnName,itemInfo:r})),b=()=>{$.value.dialogFormVisible=!0},n=ze,E=(l,o,m)=>{r.value=m,console.log("operatingItem",m),he.confirm("确认删除该条资源？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{if(console.log("确认删除"),V.value[He[c.value]][o].resourceList.splice(l,1),v.bankEnName!="Mzs")switch(ee[c.value]){case"model":let _=me[ee[c.value]][T.value];console.log("subType",_),i.deleteBankCalculateResourceFile(_,v.bankEnName,m.name).then(y=>{console.log(y)}).catch(y=>{console.warn(y)});break;case"visual":i.deleteBankVisualResourceFile(m.tileName,v.bankEnName).then(y=>{console.log(y)}).catch(y=>{console.warn(y)});break;case"device":i.deleteBankDevice(m.code).then(y=>{console.log(y)}).catch(y=>{console.warn(y)});break}G.success({offset:100,message:"删除成功！"})}).catch(D=>{console.log("取消删除",D)})},fe=(l,o,m)=>{T.value=o,r.value=m,b()},oe=k(!1);Le(async()=>{const l=W.params.id;await ce(l),pe(()=>C.resourceInfo,(o,m)=>{V.value=Fe(o)})});const ce=async l=>{oe.value=!0;const o=l,m=(await i.getOneBankBasicInfo(o)).data,D=(await i.getBankCalculateResourceList("DEM",o)).data,_=(await i.getBankCalculateResourceList("Hydrodynamic",o)).data,y=(await i.getBankCalculateResourceList("Boundary",o)).data,F=(await i.getBankCalculateResourceList("Config",o)).data,H=[{key:"岸段地形资源",upload:!0,update:!1,delete:!0,resourceList:i.DEMResourcetoList(D)},{key:"模型参数文件",upload:!0,update:!1,delete:!0,resourceList:i.ConfigResourcetoList(F)},{key:"岸段边界矢量",upload:!0,update:!1,delete:!0,resourceList:i.BoundaryResourcetoList(y)},{key:"水动力预算工况",upload:!0,update:!1,delete:!0,resourceList:i.HydrodynamicResourcetoList(_)}],ne=(await i.getBankVisualResourceList("DEM",l)).data;ne.map(A=>A.fileType="地形切片");const se=(await i.getBankVisualResourceList("vector",l)).data;se.map(A=>{A.fileType="矢量切片",A.name=A.tileName});const re=[{key:"栅格可视化资源",upload:!1,update:!1,delete:!1,resourceList:ne},{key:"矢量可视化资源",upload:!0,update:!1,delete:!0,resourceList:se}];let ue=[];const f=(await i.getBankDeviceResourceList("GNSS",l)).data,ie=(await i.getBankDeviceResourceList("INCLINE",l)).data,h=(await i.getBankDeviceResourceList("STRESS",l)).data,q=(await i.getBankDeviceResourceList("MENOMETER",l)).data,x=(await i.getBankDeviceResourceList("VEDIO",l)).data;ue=[{key:"GNSS设备",upload:!0,update:!0,delete:!0,resourceList:f},{key:"孔隙水压力计设备",upload:!0,update:!0,delete:!0,resourceList:q},{key:"应力桩设备",upload:!0,update:!0,delete:!0,resourceList:h},{key:"测斜仪设备",upload:!0,update:!0,delete:!0,resourceList:ie},{key:"监控摄像设备",upload:!0,update:!0,delete:!0,resourceList:x}],v.name=m.name,v.bankEnName=o,B.value=je(m),V.value={模型资源管理:H,可视化资源管理:re,设备资源管理:ue},C.resourceInfo={模型资源管理:H,可视化资源管理:re,设备资源管理:ue},oe.value=!1};return(l,o)=>{const m=p("el-input"),D=p("el-option"),_=p("el-select"),y=p("el-date-picker"),F=p("el-scrollbar"),H=p("el-tag"),ne=p("el-table-column"),se=p("el-button"),re=p("el-table"),ue=Te("loading");return t(),g(j,null,[ke((t(),g("div",Ze,[ea,d("div",aa,[ta,d("div",la,[R.value?Y("",!0):(t(),g("div",{key:0,class:"change-button",onClick:I}," 修改 ")),R.value?(t(),g("div",{key:1,class:"change-button modify",onClick:le}," 提交 ")):Y("",!0),R.value?(t(),g("div",{key:2,class:"cancel-button",onClick:te}," 取消 ")):Y("",!0)]),N(F,{height:"77vh"},{default:s(()=>[d("div",oa,[d("div",na,[sa,R.value?(t(),g("div",ua,[N(m,{modelValue:v.name,"onUpdate:modelValue":o[0]||(o[0]=f=>v.name=f),style:{width:"100%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"},placeholder:"请输入",type:"text",autosize:{minRows:4,maxRows:6}},null,8,["modelValue"])])):(t(),g("div",ca,M(v.name),1))]),(t(!0),g(j,null,P(B.value,(f,ie)=>(t(),g("div",{class:ve(["detail-box-item",f.type]),key:ie},[d("div",ra,M(f.key),1),R.value?(t(),g("div",ia,[f.key==="预警级别"?(t(),w(_,{key:0,modelValue:f.val,"onUpdate:modelValue":h=>f.val=h,placeholder:"请选择预警级别",style:{width:"100%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"}},{default:s(()=>[(t(),g(j,null,P(e,(h,q)=>N(D,{key:q,value:h},{default:s(()=>[d("span",da,M(h),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):f.key==="监测起始时间"?(t(),w(y,{key:1,modelValue:f.val,"onUpdate:modelValue":h=>f.val=h,type:"date",placeholder:"请选择监测起始时间",format:"YYYY-MM-DD","date-format":"MMM DD, YYYY"},null,8,["modelValue","onUpdate:modelValue"])):(t(),w(m,{key:2,modelValue:f.val,"onUpdate:modelValue":h=>f.val=h,style:{width:"100%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"},placeholder:f.key==="中心坐标"?"请输入坐标: [经度,维度]":"请输入"+f.key,type:f.type.includes("long-text")?"textarea":"text",autosize:{minRows:4,maxRows:6}},null,8,["modelValue","onUpdate:modelValue","placeholder","type"]))])):(t(),g("div",pa,M(f.key==="监测起始时间"&&f.val?f.val.slice(0,10):f.val),1))],2))),128))])]),_:1})]),d("div",fa,[(t(!0),g(j,null,P(Object.keys(V.value),(f,ie)=>(t(),g("div",{class:"one-type-resource-container",ref_for:!0,ref:K},[d("div",va,[d("span",{onClick:o[1]||(o[1]=h=>O(0)),class:ve(["page left",{ban:c.value===0}])},"上一页",2),d("span",null,M(f),1),d("span",{onClick:o[2]||(o[2]=h=>O(1)),class:ve(["page right",{ban:c.value===Object.keys(V.value).length-1}])},"下一页",2)]),d("div",ma,[N(F,{height:"75vh"},{default:s(()=>[(t(!0),g(j,null,P(V.value[f],(h,q)=>(t(),g("div",{class:"resource-box-item",key:q},[d("div",_a,[U(M(h.key)+" ",1),ke(d("div",{class:"resource-upload-btn",onClick:x=>Q(q)},"上传 ",8,ya),[[De,h.upload]])]),d("div",ga,[N(re,{data:h.resourceList,style:{width:"95%","margin-left":"2.5%"},"max-height":"25vh"},{default:s(()=>[(t(!0),g(j,null,P(xe(n)[f],(x,A)=>(t(),w(ne,{key:A,prop:x.prop,label:x.label,"min-width":x["min-width"],align:"center"},Ue({_:2},[x.asTag?{name:"default",fn:s(Be=>[d("div",ka,[N(H,null,{default:s(()=>[U(M(Be.row.fileType),1)]),_:2},1024)])]),key:"0"}:void 0]),1032,["prop","label","min-width"]))),128)),h.delete||h.update?(t(),w(ne,{key:0,fixed:"right",label:"操作","min-width":"20%",align:"center"},{default:s(x=>[h.delete?(t(),w(se,{key:0,link:"",type:"danger",size:"small",onClick:be(A=>E(x.$index,q,x.row),["prevent"])},{default:s(()=>[U(" 删除 ")]),_:2},1032,["onClick"])):Y("",!0),h.update?(t(),w(se,{key:1,link:"",type:"warning",size:"small",onClick:be(A=>fe(x.$index,q,x.row),["prevent"])},{default:s(()=>[U(" 更新 ")]),_:2},1032,["onClick"])):Y("",!0)]),_:2},1024)):Y("",!0)]),_:2},1032,["data"])])]))),128))]),_:2},1024)])]))),256))])])),[[ue,oe.value]]),N(Ge,{ref_key:"uploadDialogRef",ref:Z,type:z.value.type,"sub-type":z.value.subType,"bank-en-name":z.value.bankEnName},null,8,["type","sub-type","bank-en-name"]),N(We,{ref_key:"updateDialogRef",ref:$,type:a.value.type,"sub-type":z.value.subType,"bank-en-name":a.value.bankEnName,"resource-item-info":a.value.itemInfo},null,8,["type","sub-type","bank-en-name","resource-item-info"])],64)}}},Va=_e(ha,[["__scopeId","data-v-af197ff8"]]);export{Va as default};
