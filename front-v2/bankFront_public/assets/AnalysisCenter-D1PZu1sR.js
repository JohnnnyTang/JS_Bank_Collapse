import{M as ke}from"./ModelTitle-BWwbr8w2.js";import{v as Re,_ as Z,ad as K,e as p,h as q,ae as pe,af as Te,i as L,B as Ne,C as te,o as h,c as V,a as o,k as j,b as y,w as k,t as J,P as O,ag as Ee,F as ve,r as he,D as de,f as G,O as M,ah as se,p as ue,d as ce,a4 as $e,ai as Ce,n as Me,j as le,aj as Pe,Z as De,J as me,ak as je,a5 as Je}from"./index-6YJPzaKF.js";import{M as _e}from"./mapbox-gl-draw-BFMadJRs.js";/* empty css                       */const ne=Re.create({baseURL:"/model",timeout:2e5});ne.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.token=`${t}`),e},e=>Promise.reject(e));const z=(e,t,T)=>ne.get(e,{headers:{debounce:"true"},params:T}),H=(e,t,T)=>ne.post(e,T,{headers:{debounce:"true"}}),fe=(e,t)=>ne.delete(e,{headers:{debounce:"true"}}),be=(e,t,T)=>ne.patch(e,T,{headers:{debounce:"true"}});class oe{static async addDataList(t){return await H("/dataList/addDataList",!0,t)}static async fuzzyQueryDataList(t){return await H("/dataList/fuzzyQuery",!0,t)}static async findFiles(t){return await z(`/dataList/findFiles/${t}`)}static async updateDataList(t){return await be("/dataList/updateDataList",!0,t)}static async deleteDataList(t){return await fe(`/dataList/deleteDataList/${t}`)}static async getCoordinates(t){return await z(`/visual/getCoordinates/${t}`)}static async getAnalysisGeoJson(t){return await z(`/visual/getAnalysisGeoJson/${t}`)}static async getContent(t){return await z(`/visual/getContent/${t}`)}static async getSection(t){return await z(`/visual/getSection/${t}`)}static async getSectionContrast(t){return await z(`/visual/getSectionContrast/${t}`)}static async getSectionFlush(t){return await z(`/visual/getSectionFlush/${t}`)}static async getDataGroup(t,T){return await z(`/browseHistory/getDataGroup/${t}/${T}`)}static async getWaterLevelByStationAndTime(t,T,n,s){return await z(`/waterway/getWaterLevelByStationAndTime/${t}/${T}/${n}/${s}`)}static async addAnalysisData(t){return await H("/analysis/addData",!0,t)}static async addAnalysisList(t){return await H("/analysis/addAnalysis",!0,t)}static async getData(t){return await z(`/analysis/getData/${t}`)}static async delData(t,T,n){return await fe(`/analysis/delData/${t}/${T}/${n}`)}static async addDraw(t){return await H("/analysis/addDraw",!0,t)}static async delAnalysisResult(t){return await fe(`/analysis/delAnalysisResult/${t}`)}static async calculateSectionView(t){return await H("/taskNode/start/riverbedEvolution/calculateSectionView",!0,t)}static async calculateSectionContrast(t){return await H("/taskNode/start/riverbedEvolution/calculateSectionContrast",!0,t)}static async calculateRegionFlush(t){return await H("taskNode/start/riverbedEvolution/calculateRegionFlush",!0,t)}static async calculateRegionContour(t){return await H("taskNode/start/riverbedEvolution/calculateRegionContour",!0,t)}static async calculateRiverVolume(t){return await H("taskNode/start/riverbedEvolution/calculateRiverVolume",!0,t)}static async rename(t){return await be("/analysis/rename",!0,t)}static async updateLayer(t,T){return await H(`/analysis/updateLayer/${t}`,!0,T)}static async getLayersInfo(t){return await z(`/analysis/getLayersInfo/${t}`)}static async findParameterByType(t){return await z(`/analysis/findParameterByType/${t}`)}static async checkStatus(t){return await z(`/taskNode/status/id?taskId=${t}`)}static async checkResult(t){return await z(`taskNode/result/id?taskId=${t}`)}static async getResultData(t,T,n){return await z(`/data/bankResource/down/modelServer/result/file/${t}?caseId=${T}&name=${n}`)}static async getDataList(t,T){return await z(`/data/bankResource/bank/dataType?dataType=${t}&bank=${T}`)}static async getAllSection(t){return await z(`/monitorVisual/getAllSection/${t}`)}static async getSectionElevation(t){return await z(`/monitorVisual/getSectionElevation/${t}`)}}const Oe=[{label:"地形数据",children:[{label:"DEM"}]}],{fuzzyQueryDataList:ee,findFiles:Ue}=oe,ze=K({emits:["returnData"],setup(e,t){const T={children:"children",label:"label"},n=Oe,s=p(),C=p(""),g=p(""),m=p(0),d=p(1),_=p(!0),c=p([]),l=p({id:"",name:"",avatar:""}),u=p([]),$=p([]),R=p(!0),I=p(!1),F=p(""),A=(a,i)=>a===""?"":`/model/visual/getAvatar/${a}`,N=a=>{c.value=[],a.forEach(i=>{c.value.push({id:i.id,name:i.name,avatar:i.avatar})})},E=a=>{u.value=[],a.forEach(i=>{if(i.visualType!=""){u.value.push({id:i.id,name:i.fileName,visualType:i.visualType,time:i.time,location:i.location,size:i.size,flag:!1,visualId:i.visualId});let D=!1;for(let B=0;B<$.value.length;B++)if(i.id===$.value[B].fileId){D=!0;break}u.value[u.value.length-1].flag=D}})},w=async a=>{const i={page:a-1,size:8,titleKeyword:g.value,property:"update_time",flag:!1,type:F.value},D=await ee(i);D!=null&&D.code===0&&(N(D.data.list),m.value=D.data.total,C.value=g.value)},P=async a=>{const i=await Ue(c.value[a].id);i!=null&&i.code===0&&(E(i.data),l.value=c.value[a],_.value=!1)},f=a=>{if(a.flag)$.value.push({fileId:a.id,fileName:a.name,dataListId:l.value.id,dataListName:l.value.name,visualType:a.visualType,visualId:a.visualId});else for(let i=0;i<$.value.length;i++)if(a.id===$.value[i].fileId){$.value.splice(i,1);return}},b=()=>{t.emit("returnData",$.value)},v=async a=>{if(a.children===void 0){a.label!=F.value?F.value=a.label:(s.value.setCurrentKey(null),F.value="");const i={page:0,size:8,titleKeyword:g.value,property:"update_time",flag:!1,type:F.value};I.value=!0;const D=await ee(i);D!=null&&D.code===0&&(N(D.data.list),m.value=D.data.total,d.value=1),I.value=!1}else if(s.value.setCurrentKey(null),F.value!=""){F.value="";const i={page:0,size:8,titleKeyword:g.value,property:"update_time",flag:!1,type:F.value};I.value=!0;const D=await ee(i);D!=null&&D.code===0&&(N(D.data.list),m.value=D.data.total,d.value=1),I.value=!1}},r=async()=>{g.value=C.value;const a={page:0,size:8,titleKeyword:g.value,property:"update_time",flag:!1,type:F.value};I.value=!0;const i=await ee(a);i!=null&&i.code===0&&(N(i.data.list),m.value=i.data.total,d.value=1),I.value=!1};return q(async()=>{R.value=!0;const a={page:0,size:8,titleKeyword:g.value,property:"update_time",flag:!1,type:"DEM"},i=await ee(a);i!=null&&i.code===0&&(N(i.data.list),m.value=i.data.total,R.value=!1)}),{defaultProps:T,treeData:n,search:C,dataList:c,Search:pe,total:m,getAvatar:A,currentPage:d,pageChange:w,dataListShow:_,ArrowLeft:Te,selectDataList:l,cardClick:P,tableData:u,checkboxChange:f,commit:b,skeletonFlag:R,tree:s,nodeClick:v,fileList:$,selectData:F,enterHandle:r,loading:I}}}),Be={class:"add-data"},He={key:1,class:"add-data-dialog"},Ge={class:"tree"},Ke={key:0,class:"custom"},Ze={key:1,class:"custom"},Ye={class:"add-data-card"},qe={class:"head"},Qe={class:"right"},We={style:{color:"#409eff"}},Xe={class:"search"},xe=["onClick"],ea={class:"img"},aa=["src"],ta={class:"name"},la={key:1},sa={class:"page"},na={class:"content"},oa={class:"table"},ia={class:"btn"};function ra(e,t,T,n,s,C){const g=L("el-skeleton"),m=L("el-tree"),d=L("el-input"),_=L("el-col"),c=L("el-row"),l=L("el-empty"),u=L("el-pagination"),$=L("el-page-header"),R=L("el-checkbox"),I=L("el-table-column"),F=L("el-table"),A=L("el-button"),N=Ne("loading");return te((h(),V("div",Be,[te(o("div",null,[e.skeletonFlag?(h(),j(g,{key:0,rows:5,animated:""})):(h(),V("div",He,[o("div",Ge,[y(m,{data:e.treeData,props:e.defaultProps,accordion:"","highlight-current":"","node-key":"label",ref:"tree",onNodeClick:e.nodeClick},{default:k(({node:E,data:w})=>[w.children!=null?(h(),V("strong",Ke,J(E.label),1)):(h(),V("span",Ze,J(E.label),1))]),_:1},8,["data","props","onNodeClick"])]),o("div",Ye,[o("div",qe,[o("div",null,[O(" 筛选类别："),o("strong",null,J(e.selectData===""?"默认所有":e.selectData),1)]),o("div",Qe,[O(" 已选择 "),o("strong",We,J(e.fileList.length),1),O(" 条数据 ")])]),o("div",Xe,[y(d,{modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=E=>e.search=E),"suffix-icon":e.Search,placeholder:"条目名",onKeydown:Ee(e.enterHandle,["enter"])},null,8,["modelValue","suffix-icon","onKeydown"])]),e.dataList.length!=0?(h(),j(c,{key:0},{default:k(()=>[(h(!0),V(ve,null,he(e.dataList,(E,w)=>(h(),j(_,{span:6,key:w},{default:k(()=>[o("div",{class:"card",onClick:P=>e.cardClick(w)},[o("div",ea,[o("img",{src:e.getAvatar(E.avatar,E.name)},null,8,aa)]),o("div",ta,[o("strong",null,J(E.name),1)])],8,xe)]),_:2},1024))),128))]),_:1})):(h(),V("div",la,[y(l,{description:"暂无数据"})]))])])),o("div",sa,[y(u,{small:"",background:"",layout:"total, jumper, prev, pager, next","pager-count":5,total:e.total,"hide-on-single-page":!0,"current-page":e.currentPage,"onUpdate:currentPage":t[1]||(t[1]=E=>e.currentPage=E),onCurrentChange:e.pageChange},null,8,["total","current-page","onCurrentChange"])])],512),[[de,e.dataListShow]]),te(o("div",null,[y($,{icon:e.ArrowLeft,onBack:t[2]||(t[2]=E=>e.dataListShow=!0)},{content:k(()=>[o("span",null,J(e.selectDataList.name),1)]),_:1},8,["icon"]),o("div",na,[o("div",oa,[y(F,{data:e.tableData,stripe:""},{default:k(()=>[y(I,{width:"55"},{header:k(()=>[O(" 选择 ")]),default:k(E=>[y(R,{modelValue:E.row.flag,"onUpdate:modelValue":w=>E.row.flag=w,size:"large",onChange:w=>e.checkboxChange(E.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),y(I,{prop:"name",label:"文件名称",width:"300"}),y(I,{prop:"size",label:"文件大小",width:"100"}),y(I,{prop:"time",label:"时间",width:"150"}),y(I,{prop:"location",label:"位置"})]),_:1},8,["data"])])])],512),[[de,!e.dataListShow]]),o("div",ia,[y(A,{type:"primary",plain:"",onClick:e.commit},{default:k(()=>[O("确定")]),_:1},8,["onClick"])])])),[[N,e.loading]])}const da=Z(ze,[["render",ra],["__scopeId","data-v-e5c22a5a"]]),{notice:Y}=se,ua=K({props:{analyseType:{type:String},analyticDataList:{type:Object},demDataList:{type:Object}},emits:["back","returnParameter"],setup(e,t){const T={children:"children",label:"label"},n=G(()=>{if(e.analyseType==="section")return"断面形态";if(e.analyseType==="sectionFlush")return"断面冲淤";if(e.analyseType==="regionFlush")return"区域冲淤";if(e.analyseType==="flushContour")return"冲淤等深线";if(e.analyseType==="volume")return"河道容积"}),s=G(()=>e.analyseType==="section"||e.analyseType==="sectionFlush"?"选择断面":"选择区域"),C=G(()=>!((e.analyseType==="regionFlush"||e.analyseType==="flushContour")&&N.value==="global")),g=G(()=>e.analyticDataList),m=p([]),d=p([]),_=p([]),c=p(!0),l=p(""),u=p([]),$=p();p([]);const R=p(),I=p(),F=p(5),A=p(""),N=p("global"),E=()=>{t.emit("back")},w=(b,v)=>{e.analyseType==="section"||e.analyseType==="volume"?m.value.forEach(r=>{r.children.forEach(a=>{a.id!=b.id?a.checkFlag=!1:a.checkFlag?$.value={fileId:a.id,fileName:a.label,dataListId:r.id,dataListName:r.label,visualType:a.visualType}:$.value=void 0})}):(e.analyseType==="sectionFlush"||e.analyseType==="regionFlush"||e.analyseType==="flushContour")&&(v==="benchmark"?d.value.forEach(r=>{r.children.forEach(a=>{a.id!=b.id?a.checkFlag=!1:a.checkFlag?R.value={fileId:a.id,fileName:a.label,dataListId:r.id,dataListName:r.label,visualType:a.visualType}:R.value=void 0})}):v==="refer"&&_.value.forEach(r=>{r.children.forEach(a=>{a.id!=b.id?a.checkFlag=!1:a.checkFlag?I.value={fileId:a.id,fileName:a.label,dataListId:r.id,dataListName:r.label,visualType:a.visualType}:I.value=void 0})}))},P=()=>{if(e.analyseType==="section")if(l.value!=""&&$.value!=null&&A.value!="")t.emit("returnParameter",{section:l.value,dem:$.value,fileName:A.value});else{let b="";l.value===""?b="断面":$.value===void 0?b="DEM":b="输出文件名",Y("warning","警告",b+"不得为空")}else if(e.analyseType==="volume")if(l.value!=""&&$.value!=null&&A.value!="")t.emit("returnParameter",{region:l.value,dem:$.value,deep:F.value,fileName:A.value});else{let b="";l.value==""?b="区域不得为空":$.value==null?b="DEM不得为空":b="输入文件名不得为空",Y("warning","警告",b)}else if(e.analyseType==="sectionFlush"||e.analyseType==="regionFlush"||e.analyseType==="flushContour")if(R.value!=null&&I.value!=null&&A.value!="")if(I.value.fileId===R.value.fileId)Y("warning","警告","基准DEM数据不能与参考DEM数据相同");else{if((e.analyseType==="sectionFlush"||N.value==="region")&&l.value===""){e.analyseType==="sectionFlush"?Y("warning","警告","请选择断面"):e.analyseType==="regionFlush"&&Y("warning","警告","请选择区域");return}e.analyseType==="sectionFlush"?t.emit("returnParameter",{section:l.value,benchmarkDem:R.value,referDem:I.value,fileName:A.value}):t.emit("returnParameter",{region:l.value,benchmarkDem:R.value,referDem:I.value,fileName:A.value,global:N.value==="global"})}else A.value==""?Y("warning","警告","输出文件名不得为空"):R.value===void 0?Y("warning","警告","基准DEM数据不得为空"):Y("warning","警告","参考DEM数据不得为空")},f=b=>{const v=e.demDataList;for(let r=0;r<v.length;r++){let a=!0;for(let i=0;i<m.value.length;i++)if(m.value[i].id===v[r].dataListId){m.value[i].children.push({id:v[r].fileId,label:v[r].fileName,flag:!1,children:[],checkFlag:!1,visualType:v[r].visualType}),a=!1;break}a&&(m.value.push({id:v[r].dataListId,label:v[r].dataListName,flag:!0,children:[]}),m.value[m.value.length-1].children.push({id:v[r].fileId,label:v[r].fileName,flag:!1,checkFlag:!1,children:[],visualType:v[r].visualType}))}(b==="sectionFlush"||b==="regionFlush"||b==="flushContour")&&(d.value=JSON.parse(JSON.stringify(m.value)),_.value=JSON.parse(JSON.stringify(m.value))),b==="section"||b==="sectionFlush"?(u.value=[],g.value.forEach(r=>{r.visualType==="geoJsonLine"&&u.value.push({id:r.id,name:r.label})})):(u.value=[],g.value.forEach(r=>{r.visualType==="geoJsonPolygon"&&u.value.push({id:r.id,name:r.label})}))};return q(async()=>{c.value=!0,f(e.analyseType),c.value=!1}),{ArrowLeft:Te,title:n,analyticDataList:g,backClick:E,sectionValue:l,options:u,treeData:m,benchmarkTreeData:d,referTreeData:_,defaultProps:T,changeClick:w,btnClick:P,skeletonFlag:c,placeholder:s,selectFlag:C,deep:F,inputValue:A,flushType:N}}}),ie=e=>(ue("data-v-6e1247e1"),e=e(),ce(),e),ca={class:"analyse"},fa={class:"introduce"},ya={key:0},pa={key:1},va={key:2},ha={key:3},ga={key:4},ma={key:0,class:"flushType"},_a=ie(()=>o("div",{class:"text"},"选择冲淤类型:",-1)),ba={key:2,class:"deep"},wa=ie(()=>o("span",null,[o("strong",null,"水面距岸高度：")],-1)),La={key:3},ka={key:0,class:"text"},Ta={key:2,class:"dem"},$a={class:"custom"},Ca={key:0,class:"icon"},Da={key:1,class:"text"},Ia={key:0},Va={key:4,class:"section-flush"},Sa={class:"left"},Aa=ie(()=>o("div",{class:"text"},"选择基准面",-1)),Fa={key:1,class:"dem"},Ra={class:"custom"},Na={key:0,class:"icon"},Ea={key:1,class:"text"},Ma={key:0},Pa={class:"right"},ja=ie(()=>o("div",{class:"text"},"选择参考面",-1)),Ja={key:1,class:"dem"},Oa={class:"custom"},Ua={key:0,class:"icon"},za={key:1,class:"text"},Ba={key:0},Ha={class:"file-name"},Ga=ie(()=>o("div",null,"输出文件名:",-1)),Ka={class:"btn"};function Za(e,t,T,n,s,C){const g=L("el-page-header"),m=L("el-radio"),d=L("el-radio-group"),_=L("el-option"),c=L("el-select"),l=L("el-input-number"),u=L("el-skeleton"),$=L("FolderOpened"),R=L("el-icon"),I=L("el-checkbox"),F=L("el-tree"),A=L("el-scrollbar"),N=L("el-input"),E=L("el-button");return h(),V("div",null,[y(g,{icon:e.ArrowLeft,onBack:e.backClick},{content:k(()=>[o("span",null,J(e.title),1)]),_:1},8,["icon","onBack"]),o("div",ca,[o("div",fa,[e.analyseType==="section"?(h(),V("strong",ya,"断面形态是指随着断面起点距的变化河道高程的变化趋势，选择相应的河道DEM与断面数据，计算该断面形态")):M("",!0),e.analyseType==="sectionFlush"?(h(),V("strong",pa,"断面冲於是通过当前年数据和参考年数据，对这个时间段内河道的冲刷和淤泥进行比较分析")):M("",!0),e.analyseType==="regionFlush"?(h(),V("strong",va,"区域冲於是通过当前年数据和参考年数据，对这个时间段内河床区域的冲刷和淤泥进行比较分析")):M("",!0),e.analyseType==="flushContour"?(h(),V("strong",ha,"针对整个长江南京以下河段，选择参数生成冲淤等深线")):M("",!0),e.analyseType==="volume"?(h(),V("strong",ga,"选择河床参数与区域，设置最大深度计算河道容积")):M("",!0)]),e.analyseType==="regionFlush"||e.analyseType==="flushContour"?(h(),V("div",ma,[_a,y(d,{modelValue:e.flushType,"onUpdate:modelValue":t[0]||(t[0]=w=>e.flushType=w)},{default:k(()=>[y(m,{label:"global"},{default:k(()=>[O("全江冲淤")]),_:1}),y(m,{label:"region"},{default:k(()=>[O("区域冲淤")]),_:1})]),_:1},8,["modelValue"])])):M("",!0),e.selectFlag?(h(),j(c,{key:1,modelValue:e.sectionValue,"onUpdate:modelValue":t[1]||(t[1]=w=>e.sectionValue=w),placeholder:e.placeholder},{default:k(()=>[(h(!0),V(ve,null,he(e.options,(w,P)=>(h(),j(_,{key:P,label:w.name,value:w.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])):M("",!0),e.analyseType==="volume"?(h(),V("div",ba,[wa,y(l,{modelValue:e.deep,"onUpdate:modelValue":t[2]||(t[2]=w=>e.deep=w),min:1,max:30,"controls-position":"right",precision:1,step:.1},null,8,["modelValue"])])):M("",!0),e.analyseType==="section"||e.analyseType==="volume"?(h(),V("div",La,[e.analyseType==="section"||e.analyseType==="volume"?(h(),V("div",ka," 选择DEM数据，DEM将默认添加至数据与图层中 ")):M("",!0),e.skeletonFlag?(h(),j(u,{key:1,rows:5,animated:""})):(h(),V("div",Ta,[y(A,null,{default:k(()=>[y(F,{data:e.treeData,props:e.defaultProps,"default-expand-all":""},{default:k(({data:w})=>[o("div",$a,[w.flag?(h(),V("div",Ca,[y(R,null,{default:k(()=>[y($)]),_:1})])):M("",!0),w.flag?(h(),V("div",Da,[w.flag?(h(),V("strong",Ia,J(w.label),1)):M("",!0)])):(h(),j(I,{key:2,modelValue:w.checkFlag,"onUpdate:modelValue":P=>w.checkFlag=P,size:"large",onChange:P=>e.changeClick(w)},{default:k(()=>[O(J(w.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]))])]),_:1},8,["data","props"])]),_:1})]))])):M("",!0),e.analyseType==="sectionFlush"||e.analyseType==="regionFlush"||e.analyseType==="flushContour"?(h(),V("div",Va,[o("div",Sa,[Aa,e.skeletonFlag?(h(),j(u,{key:0,rows:5,animated:""})):(h(),V("div",Fa,[y(A,null,{default:k(()=>[y(F,{data:e.benchmarkTreeData,props:e.defaultProps,"default-expand-all":""},{default:k(({data:w})=>[o("div",Ra,[w.flag?(h(),V("div",Na,[y(R,null,{default:k(()=>[y($)]),_:1})])):M("",!0),w.flag?(h(),V("div",Ea,[w.flag?(h(),V("strong",Ma,J(w.label),1)):M("",!0)])):(h(),j(I,{key:2,modelValue:w.checkFlag,"onUpdate:modelValue":P=>w.checkFlag=P,size:"large",onChange:P=>e.changeClick(w,"benchmark")},{default:k(()=>[O(J(w.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]))])]),_:1},8,["data","props"])]),_:1})]))]),o("div",Pa,[ja,e.skeletonFlag?(h(),j(u,{key:0,rows:5,animated:""})):(h(),V("div",Ja,[y(A,null,{default:k(()=>[y(F,{data:e.referTreeData,props:e.defaultProps,"default-expand-all":""},{default:k(({data:w})=>[o("div",Oa,[w.flag?(h(),V("div",Ua,[y(R,null,{default:k(()=>[y($)]),_:1})])):M("",!0),w.flag?(h(),V("div",za,[w.flag?(h(),V("strong",Ba,J(w.label),1)):M("",!0)])):(h(),j(I,{key:2,modelValue:w.checkFlag,"onUpdate:modelValue":P=>w.checkFlag=P,size:"large",onChange:P=>e.changeClick(w,"refer")},{default:k(()=>[O(J(w.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]))])]),_:1},8,["data","props"])]),_:1})]))])])):M("",!0),o("div",Ha,[Ga,y(N,{modelValue:e.inputValue,"onUpdate:modelValue":t[3]||(t[3]=w=>e.inputValue=w)},null,8,["modelValue"])]),o("div",Ka,[y(E,{type:"primary",plain:"",onClick:e.btnClick},{default:k(()=>[O("确定")]),_:1},8,["onClick"])])])])}const Ya=Z(ua,[["render",Za],["__scopeId","data-v-6e1247e1"]]),qa=K({components:{AnalyseInterface:Ya},emits:["analyse"],props:{dataList:{type:Array}},setup(e,t){const T=p(!0),n=p(""),s=p([]),C=p([]),g=[{name:"断面形态",src:"/analyse/duanmianXT.png",value:"section"},{name:"断面冲淤",src:"/analyse/duanmianCY.png",value:"sectionFlush"},{name:"区域冲淤",src:"/analyse/quyuCY.png",value:"regionFlush"},{name:"冲淤等深线",src:"/analyse/chongyuDSX.png",value:"flushContour"},{name:"河道容积",src:"/analyse/hedaoRJ.png",value:"volume"}],m=c=>{T.value=!1,n.value=c},d=c=>{t.emit("analyse",{type:n.value,value:c})},_=()=>{let c;e.dataList.length!=0&&e.dataList[e.dataList.length-1].id===""?c=e.dataList.slice(0,-1):c=e.dataList;let l=[];return c.forEach(u=>{u.children.forEach($=>{$.visualType==="rasterTile"&&l.push({dataListId:u.id,dataListName:u.label,fileId:$.id,fileName:$.label,visualType:"rasterTile"})})}),l};return q(()=>{console.log(e.dataList),e.dataList.length!=0&&e.dataList[e.dataList.length-1].id===""?s.value=e.dataList[e.dataList.length-1].children:s.value=[],C.value=_()}),{flag:T,list:g,cardClick:m,analyseType:n,analyticDataList:s,demDataList:C,returnParameter:d}}}),Qa={class:"analyse-dialog"},Wa=["onClick"],Xa={class:"picture"},xa=["src"],et={class:"text"};function at(e,t,T,n,s,C){const g=L("el-tag"),m=L("el-col"),d=L("el-row"),_=L("analyse-interface");return h(),V("div",Qa,[te(y(d,{gutter:10},{default:k(()=>[(h(!0),V(ve,null,he(e.list,(c,l)=>(h(),j(m,{span:8,key:l},{default:k(()=>[o("div",{class:"card",onClick:u=>e.cardClick(c.value)},[o("div",Xa,[o("img",{src:c.src},null,8,xa)]),o("div",et,[y(g,{effect:"dark"},{default:k(()=>[O(J(c.name),1)]),_:2},1024)])],8,Wa)]),_:2},1024))),128))]),_:1},512),[[de,e.flag]]),e.flag?M("",!0):(h(),j(_,{key:0,analyseType:e.analyseType,analyticDataList:e.analyticDataList,demDataList:e.demDataList,onBack:t[0]||(t[0]=c=>e.flag=!0),onReturnParameter:e.returnParameter},null,8,["analyseType","analyticDataList","demDataList","onReturnParameter"]))])}const tt=Z(qa,[["render",at],["__scopeId","data-v-29212a17"]]),{uuid:we}=se,lt=K({components:{AddDataDialog:da,AnalyseDialog:tt},emits:["returnFileList","operateDraw","analyse","uploadHandle"],props:{dataList:{type:Array}},setup(e,t){const T=$e();e.dataList;const n=p(!1),s=p(!1),C=p(0),g=p(),m=p();return{state:C,dialogAddData:n,returnData:I=>{n.value=!1,t.emit("returnFileList",I)},sectionClick:()=>{C.value===1?C.value=0:C.value=1,t.emit("operateDraw",C.value)},regionClick:()=>{C.value===2?C.value=0:C.value=2,t.emit("operateDraw",C.value)},dialogAnalyse:s,analyse:I=>{t.emit("analyse",I),s.value=!1},backToStability:()=>{T.push("/modelStore/stabilityAnalysis")},uploadSectionRef:g,uploadSection:I=>{const F=new FileReader;F.onload=A=>{try{const N=JSON.parse(A.target.result);t.emit("uploadHandle",{id:we(),geoJson:N,visualType:"geoJsonLine",fileName:I.name}),g.value.clearFiles()}catch(N){console.error("Error parsing GeoJSON:",N)}},F.readAsText(I.raw,"UTF-8")},uploadRegion:I=>{const F=new FileReader;F.onload=A=>{try{const N=JSON.parse(A.target.result);t.emit("uploadHandle",{id:we(),geoJson:N,visualType:"geoJsonPolygon",fileName:I.name}),m.value.clearFiles()}catch(N){console.error("Error parsing GeoJSON:",N)}},F.readAsText(I.raw,"UTF-8")}}}}),Ie=e=>(ue("data-v-f9f84fb7"),e=e(),ce(),e),st={class:"top-tool"},nt={class:"buttons"},ot=Ie(()=>o("div",{class:"button btn-draw"},"添加断面",-1)),it=Ie(()=>o("div",{class:"button btn-draw"},"添加区域",-1));function rt(e,t,T,n,s,C){const g=L("el-dropdown-item"),m=L("el-upload"),d=L("el-dropdown-menu"),_=L("el-dropdown"),c=L("add-data-dialog"),l=L("el-dialog"),u=L("analyse-dialog");return h(),V("div",st,[o("div",nt,[o("div",{class:"button",onClick:t[0]||(t[0]=$=>e.dialogAnalyse=!0)},"模型计算"),y(_,{"popper-class":"draw-popper"},{dropdown:k(()=>[y(d,null,{default:k(()=>[y(g,{onClick:e.sectionClick},{default:k(()=>[O("绘制")]),_:1},8,["onClick"]),y(g,null,{default:k(()=>[y(m,{ref:"uploadSectionRef",limit:1,"show-file-list":!1,"on-change":e.uploadSection,accept:".json,.geojson",action:"","auto-upload":!1},{default:k(()=>[O("上传")]),_:1},8,["on-change"])]),_:1})]),_:1})]),default:k(()=>[ot]),_:1}),y(_,{"popper-class":"draw-popper"},{dropdown:k(()=>[y(d,null,{default:k(()=>[y(g,{onClick:e.regionClick},{default:k(()=>[O("绘制")]),_:1},8,["onClick"]),y(g,null,{default:k(()=>[y(m,{ref:"uploadRegionRef",limit:1,"show-file-list":!1,"on-change":e.uploadRegion,accept:".json,.geojson",action:"","auto-upload":!1},{default:k(()=>[O("上传")]),_:1},8,["on-change"])]),_:1})]),_:1})]),default:k(()=>[it]),_:1})]),y(l,{modelValue:e.dialogAddData,"onUpdate:modelValue":t[1]||(t[1]=$=>e.dialogAddData=$),width:"1000px",title:"添加数据"},{default:k(()=>[e.dialogAddData?(h(),j(c,{key:0,onReturnData:e.returnData},null,8,["onReturnData"])):M("",!0)]),_:1},8,["modelValue"]),y(l,{modelValue:e.dialogAnalyse,"onUpdate:modelValue":t[2]||(t[2]=$=>e.dialogAnalyse=$),width:"580px",title:"模型计算"},{default:k(()=>[e.dialogAnalyse?(h(),j(u,{key:0,onAnalyse:e.analyse,dataList:e.dataList},null,8,["onAnalyse","dataList"])):M("",!0)]),_:1},8,["modelValue"])])}const Ve=Z(lt,[["render",rt],["__scopeId","data-v-f9f84fb7"]]);var dt={VITE_MAP_TILE_SERVER:"http://119.45.198.54:80/api",VITE_MAP_TILE_SERVER2:"http://119.45.198.54:80/model/",VITE_APP_BACK_ADDRESS:"http://119.45.198.54:80/model/",VITE_LOGIN:"NOT",VITE_BANK_MANAGEMENT:"YES",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{addAnalysisData:ut,getData:jl,delData:Jl,getAnalysisResult:Ol,addDraw:Ul,delAnalysisResult:zl,getResultData:ye,calculateSectionView:ct,calculateSectionContrast:ft,calculateRegionFlush:yt,calculateRegionContour:pt,calculateRiverVolume:vt,rename:ht,checkStatus:gt,checkResult:Le}=oe,{notice:ae}=se,mt=K({emits:["operateLayer","addCurrentModel","updateCurrentModel"],props:{dataList:{type:Array}},setup(e,t){let T;const n={children:"children",label:"label"};let s=e.dataList;const C=p(!1),g=p(!0),m=p(),d=p(),_=p(""),c=p(!1),l=p(""),u=async f=>{const b={caseId:dt.VITE_APP_ROUTER_ID,list:[]};f.forEach(v=>{let r=!0;for(let a=0;a<s.length;a++)if(s[a].id===v.dataListId){let i=!0;for(let D=0;D<s[a].children.length;D++)if(s[a].children[D].id===v.fileId){i=!1;break}i&&(s[a].children.push({id:v.fileId,label:v.fileName,flag:!1,children:[],visualType:v.visualType}),b.list.push({fileId:v.fileId,dataListId:v.dataListId})),r=!1;break}r&&(s.length>0&&s[s.length-1].id===""?(s.splice(s.length-1,0,{id:v.dataListId,label:v.dataListName,flag:!0,children:[]}),s[s.length-2].children.push({id:v.fileId,label:v.fileName,flag:!1,children:[],visualType:v.visualType})):(s.push({id:v.dataListId,label:v.dataListName,flag:!0,children:[]}),s[s.length-1].children.push({id:v.fileId,label:v.fileName,flag:!1,children:[],visualType:v.visualType})),b.list.push({fileId:v.fileId,dataListId:v.dataListId}))}),b.list.length>0&&await ut(b)},$=async f=>{console.log(f);let b={id:f.id,name:"",label:f.fileName,flag:!1,children:[],visualType:f.visualType,params:{geojson:f.geoJson}};return s.length!=0&&s[s.length-1].id===""||s.push({id:"",label:"分析结果集",flag:!0,children:[]}),s[s.length-1].children.push(b),b},R=f=>s.length!=0&&s[s.length-1].id===""&&f!=""?s[s.length-1].children.find(v=>v.id===f).params.geojson:null,I=async f=>{if(console.log(f),f.type==="section"){let b=R(f.value.section);if(b==null)return;t.emit("addCurrentModel","断面形态");const v=await ct({"dem-id":f.value.dem.fileId,"section-geometry":b});let r=await A(v.data,"断面形态");r!=null&&(s[s.length-1].id!==""&&s.push({id:"",label:"分析结果集",children:[],flag:!0}),s[s.length-1].children.push({id:r.data["case-id"],name:r.data["raw-json"],label:f.value.fileName,flag:!1,children:[],visualType:"section",params:{interval:parseFloat(r.data.interval)}}))}else if(f.type==="sectionFlush"||f.type==="regionFlush"||f.type==="flushContour")if(f.type==="sectionFlush"){let b=R(f.value.section);if(b==null)return;t.emit("addCurrentModel","断面冲淤");const v=await ft({"bench-id":f.value.benchmarkDem.fileId,"ref-id":f.value.referDem.fileId,"section-geometry":b});let r=await A(v.data,"断面冲淤");r!=null&&(s[s.length-1].id!==""&&s.push({id:"",label:"分析结果集",children:[],flag:!0}),s[s.length-1].children.push({id:r.data["case-id"],name:r.data["raw-txt"],label:f.value.fileName,flag:!1,children:[],visualType:"sectionFlush",params:{interval:parseFloat(r.data.interval)}}))}else if(f.type==="regionFlush"){let b=R(f.value.region);t.emit("addCurrentModel","区域冲淤");const v=await yt({"bench-id":f.value.benchmarkDem.fileId,"ref-id":f.value.referDem.fileId,"region-geometry":f.value.global==!0?"NONE":{type:"FeatureCollection",features:[b]}});let r=await A(v.data,"区域冲淤");if(r!=null){const i=(await ye("json",r.data["case-id"],r.data["extent-json"])).data,D=[i.ul,i.ur,i.lr,i.ll];s[s.length-1].id!==""&&s.push({id:"",label:"分析结果集",children:[],flag:!0}),s[s.length-1].children.push({id:r.data["case-id"],name:r.data["visualization-png"],label:f.value.fileName,flag:!1,children:[],visualType:"regionFlush",params:{extent:D}}),console.log(s)}}else{let b=R(f.value.region);t.emit("addCurrentModel","冲淤等深线");const v=await pt({"bench-id":f.value.benchmarkDem.fileId,"ref-id":f.value.referDem.fileId,"region-geometry":f.value.global==!0?"NONE":{type:"FeatureCollection",features:[b]}});let r=await A(v.data,"冲淤等深线");r!=null&&(s[s.length-1].id!==""&&s.push({id:"",label:"分析结果集",children:[],flag:!0}),s[s.length-1].children.push({id:r.data["case-id"],name:r.data["visualization-geojson"],label:f.value.fileName,flag:!1,children:[],visualType:"flushContour",params:null}))}else if(f.type==="volume"){let b=R(f.value.region);t.emit("addCurrentModel","河道容积");const v=await vt({"dem-id":f.value.dem.fileId,"region-geometry":{type:"FeatureCollection",features:[b]},"water-depth":f.value.deep});let r=await A(v.data,"河道容积");if(r!=null){const a=await ye("txt",r.data["case-id"],r.data["volume-summary-txt"]),D=(await ye("json",r.data["case-id"],r.data["extent-json"])).data,B=[D.ul,D.ur,D.lr,D.ll];s[s.length-1].id!==""&&s.push({id:"",label:"分析结果集",children:[],flag:!0}),s[s.length-1].children.push({id:r.data["case-id"],name:r.data["visualization-png"],label:f.value.fileName,flag:!1,children:[],visualType:"volume",params:{volume:parseFloat(a.data),extent:B}})}}},F=async(f,b)=>{if(d.value?.visualType=="rasterTile"){ae("error","错误","无法添加该图层！");return}if(b)if(f!="rename"&&f!="download"&&t.emit("operateLayer",{content:{id:d.value?.id,name:d.value?.name,label:d.value?.label,visualType:d.value?.visualType,params:d.value?.params},type:f}),f==="del"){for(let v=0;v<s.length;v++)if(s[v].id===_.value){if(s[v].children.length===0||s[v].children.length===1){s.splice(v,1),ae("success","成功","数据删除成功!");return}else for(let r=0;r<s[v].children.length;r++)if(s[v].children[r].id===d.value?.id){s[v].children.splice(r,1),ae("success","成功","数据删除成功!");return}}}else f==="rename"?(c.value=!0,l.value=d.value?.label):f==="download"&&(window.location.href=`/monitor/analysis/downloadAnalysisResult/${d.value?.id}`)},A=async(f,b)=>{const r=(await gt(f)).data;if(r=="ERROR"){const a=await Le(f);return console.error(a.data),t.emit("updateCurrentModel",b,-1),ae("error","错误",b+"计算失败！"),null}else if(r=="COMPLETE"){const a=await Le(f);return t.emit("updateCurrentModel",b,0),ae("success","成功",b+"计算成功！"),a}else return t.emit("updateCurrentModel",b,1),new Promise(a=>{setTimeout(async()=>{const i=await A(f,b);a(i)},2e3)})},N=(f,b,v,r)=>{function a(){C.value=!1,document.removeEventListener("click",a)}!b.flag&&m.value&&(C.value=!1,C.value=!0,d.value=b,_.value=v.parent.data.id,m.value.style.left=f.clientX-15+"px",m.value.style.top=f.clientY-125+"px",document.addEventListener("click",a))},E=G(()=>d.value?.visualType==="polygonVectorTile3D"||d.value?.visualType==="pointVectorTile3D"||d.value?.visualType==="pointVectorTile"||d.value?.visualType==="lineVectorTile3D"||d.value?.visualType==="polygonVectorTile"||d.value?.visualType==="lineVectorTile"||d.value?.visualType==="png"||d.value?.visualType==="movePng"||d.value?.visualType==="rasterTile"||d.value?.visualType==="geoJsonLine"||d.value?.visualType==="geoJsonPolygon"||d.value?.visualType==="regionFlush"||d.value?.visualType==="elevationFlush"||d.value?.visualType==="flushContour"||d.value?.visualType==="slope"||d.value?.visualType==="volume"),w=G(()=>_.value===""),P=async()=>{c.value=!1,t.emit("operateLayer",{content:{id:d.value?.id,name:l.value,visualType:d.value?.visualType},type:"rename"});for(let f=0;f<s[s.length-1].children.length;f++)if(s[s.length-1].children[f].id===d.value?.id){s[s.length-1].children[f].label=l.value;break}await ht({id:d.value?.id,name:l.value})};return Ce(()=>{window.sessionStorage.setItem("dataList",JSON.stringify(s)),clearTimeout(T)}),{Search:pe,addData:u,skeletonFlag:g,operateLayer:F,defaultProps:n,rightClick:N,showRightMenu:C,menu:m,isLayerVisual:E,addDrawData:$,addAnalyse:I,downloadAble:w,dialogRename:c,input:l,btnClick:P}}}),re=e=>(ue("data-v-69b40afe"),e=e(),ce(),e),_t={class:"data-manage"},bt={class:"data-panel"},wt=re(()=>o("div",{class:"title"},[o("div",{class:"title-icon dpicon"}),o("div",{class:"title-text"},"数据面板")],-1)),Lt={class:"dp-content",style:{height:"27vh"}},kt={class:"scroll"},Tt={class:"custom-tree-node",style:{width:"100%"}},$t={class:"text"},Ct={key:1},Dt={class:"right-menu",ref:"menu"},It=re(()=>o("span",null,"添加至图层",-1)),Vt=[It],St=re(()=>o("span",null,"可视化",-1)),At=[St],Ft=re(()=>o("span",null,"重命名",-1)),Rt=[Ft],Nt=re(()=>o("span",null,"删除",-1)),Et=[Nt],Mt={class:"btn"};function Pt(e,t,T,n,s,C){const g=L("el-tree"),m=L("el-scrollbar"),d=L("el-input"),_=L("el-button"),c=L("el-dialog");return h(),V("div",_t,[o("div",bt,[wt,o("div",Lt,[o("div",kt,[y(m,null,{default:k(()=>[y(g,{style:{overflow:"auto"},data:e.dataList,props:e.defaultProps,onNodeContextmenu:e.rightClick,"default-expand-all":""},{default:k(({data:l})=>[o("div",Tt,[o("div",$t,[l.flag?(h(),V("span",{key:0,style:Me(l.label=="分析结果集"?"font-weight:bold":"")},J(l.label),5)):(h(),V("span",Ct,J(l.label),1))])])]),_:1},8,["data","props","onNodeContextmenu"])]),_:1})])])]),te(o("div",null,[o("ul",Dt,[o("li",{class:le(e.isLayerVisual?"menu-item":"menu-item disabled"),onClick:t[0]||(t[0]=l=>e.operateLayer("add",e.isLayerVisual))},Vt,2),o("li",{class:le(e.isLayerVisual?"menu-item disabled":"menu-item"),onClick:t[1]||(t[1]=l=>e.operateLayer("chart",!e.isLayerVisual))},At,2),o("li",{class:"menu-item",onClick:t[2]||(t[2]=l=>e.operateLayer("rename",!0))},Rt),o("li",{class:"menu-item",onClick:t[3]||(t[3]=l=>e.operateLayer("del",!0))},Et)],512)],512),[[de,e.showRightMenu]]),y(c,{modelValue:e.dialogRename,"onUpdate:modelValue":t[5]||(t[5]=l=>e.dialogRename=l),width:"350px","show-close":!1},{default:k(()=>[y(d,{modelValue:e.input,"onUpdate:modelValue":t[4]||(t[4]=l=>e.input=l)},null,8,["modelValue"]),o("div",Mt,[y(_,{type:"primary",plain:"",size:"small",onClick:e.btnClick},{default:k(()=>[O("确定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue"])])}const Se=Z(mt,[["render",Pt],["__scopeId","data-v-69b40afe"]]),jt=K({props:{layerList:{type:Array}},emits:["closeLayer","hideLayer","moveLayer"],setup(e,t){const T={children:"children",label:"label"},n=p([]),s=async l=>{for(let u=0;u<n.value.length;u++)if(n.value[u].id===l.id)return;n.value.unshift({id:l.id,label:l.label,visualType:l.visualType,children:[],flag:!0,params:l.params})},C=async l=>{for(let u=0;u<n.value.length;u++)if(n.value[u].id===l){n.value.splice(u,1),t.emit("closeLayer",l);return}},g=async l=>{for(let u=0;u<n.value.length;u++)if(n.value[u].id===l){n.value.splice(u,1);return}},m=l=>{t.emit("hideLayer",{flag:l.flag,id:l.id})},d=(l,u,$)=>{if(l.level===u.level){if(l.parent.id===u.parent.id)return $==="prev"||$==="next"}else return!1},_=async(l,u,$,R)=>{let I="";if($==="before"){for(let A=0;A<n.value.length;A++)if(n.value[A].id===l.data.id){A!=0&&(I=n.value[A+1].id);break}}else I=u.data.id;t.emit("moveLayer",{drop:l.data.id,target:I});const F=[];n.value.forEach(A=>{F.push(A.id)})},c=()=>n.value.length;return q(()=>{e.layerList?.forEach(l=>{n.value.push({id:l.id,label:l.fileName,visualType:l.visualType,flag:!0,children:[]})})}),{Search:pe,treeData:n,defaultProps:T,addLayer:s,Delete:Pe,closeClick:C,changeClick:m,delLayer:g,dragHandle:_,allowDrop:d,getLayers:c}}}),Jt=e=>(ue("data-v-0cef31a4"),e=e(),ce(),e),Ot={class:"layer-manage"},Ut={class:"layer-panel"},zt=Jt(()=>o("div",{class:"title"},[o("div",{class:"title-icon lpicon"}),o("div",{class:"title-text"},"图层面板")],-1)),Bt={class:"lp-content"},Ht={class:"scroll"},Gt={class:"custom",style:{width:"100%"}},Kt=["onClick"];function Zt(e,t,T,n,s,C){const g=L("el-checkbox"),m=L("CircleClose"),d=L("el-icon"),_=L("el-tree"),c=L("el-scrollbar");return h(),V("div",Ot,[o("div",Ut,[zt,o("div",Bt,[o("div",Ht,[y(c,null,{default:k(()=>[o("div",null,[y(_,{data:e.treeData,"node-key":"id",props:e.defaultProps,draggable:"","allow-drop":e.allowDrop,onNodeDrop:e.dragHandle},{default:k(({data:l})=>[o("div",Gt,[y(g,{modelValue:l.flag,"onUpdate:modelValue":u=>l.flag=u,size:"large",onChange:u=>e.changeClick(l)},{default:k(()=>[O(J(l.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),o("div",{class:"close",onClick:u=>e.closeClick(l.id)},[y(d,null,{default:k(()=>[y(m)]),_:1})],8,Kt)])]),_:1},8,["data","props","allow-drop","onNodeDrop"])])]),_:1})])])])])}const Ae=Z(jt,[["render",Zt],["__scopeId","data-v-0cef31a4"]]),{getResultData:Yt}=oe,qt=K({props:{chartInfo:{type:Object}},setup(e){const t=p();let T,n={};const s=async()=>{const g=(await Yt("json",e.chartInfo.id,e.chartInfo.name)).data,m=e.chartInfo.params.interval;if(g!=null){let d=[],_=[],c=[];g.points.forEach((l,u)=>{d.push(l[2]),_.push(u*m)}),g.Sa_h.forEach((l,u)=>{c.push(u*m)}),n={title:[{text:"地形剖面图",left:"5%"},{text:"坡比图",left:"5%",bottom:"50%"}],tooltip:{trigger:"axis"},toolbox:{right:"50px",feature:{dataZoom:{yAxisIndex:"none",brushStyle:{color:"#869d9d",opacity:.4}},restore:{},saveAsImage:{pixelRatio:2}}},grid:[{show:!0,borderColor:"#867e76",bottom:"55%"},{show:!0,borderColor:"#867e76",top:"55%"}],xAxis:[{type:"category",name:"米",axisLine:{onZero:!1},data:_,axisLabel:{formatter:function(l){return Math.round(parseFloat(l))}}},{type:"category",name:"米",gridIndex:1,data:c,axisLabel:{formatter:function(l){return Math.round(parseFloat(l))}}}],yAxis:[{type:"value",name:"高程(m)",splitLine:{show:!1},interval:5},{type:"value",name:"坡比",splitLine:{show:!1},gridIndex:1}],series:[{data:d,type:"line",connectNulls:!0,symbol:"none",animation:!1,smooth:!0,emphasis:{disabled:!0},markLine:{symbol:["none","none"],animation:!1,lineStyle:{color:"#21373d",width:1,type:"dotted"},label:{show:!1},data:[{yAxis:0,label:{formatter:"海平面",show:!0,position:"insideEndTop"},lineStyle:{type:"solid",width:.7}},{yAxis:-5},{yAxis:-10},{yAxis:-15},{yAxis:-20},{yAxis:-25},{yAxis:-30},{yAxis:-35}],silent:!0},markArea:{silent:!0,data:[[{yAxis:0,itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#b0d5df"},{offset:1,color:"#11659a"}]}}},{yAxis:-40}]]},lineStyle:{color:"#867e76",width:1},areaStyle:{origin:"start",opacity:1,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#e4dfd7"},{offset:1,color:"#bbb5ac"}]}}},{xAxisIndex:1,yAxisIndex:1,data:g.Sa_h,type:"line",connectNulls:!0,symbol:"none",animation:!1,smooth:!0,silent:!0,lineStyle:{color:"#0D7509"},markLine:{symbol:["none","none"],animation:!1,lineStyle:{color:"#21373d",width:1,type:"dotted"},label:{show:!1}}}]}}};return q(async()=>{await s(),T=De(t.value),T.setOption(n)}),{section:t}}}),Qt={class:"section",ref:"section"};function Wt(e,t,T,n,s,C){return h(),V("div",Qt,null,512)}const Xt=Z(qt,[["render",Wt],["__scopeId","data-v-339accf2"]]),{getResultData:xt}=oe,el=K({props:{chartInfo:{type:Object}},setup(e){const t=p();let T,n={};const s=async()=>{try{const d=(await xt("txt",e.chartInfo.id,e.chartInfo.name)).data.split(`
`);let _=[];const c=[];return d.forEach(l=>{l.trim()===""?_.length>0&&(c.push(_),_=[]):_.push(l.trim()==="-3.4028235e+38"||l.trim()==="-9999.0"?"0":l.trim())}),_.length>0&&c.push(_),{code:0,data:{benchmark:c[0],refer:c[1],flush:c[2]}}}catch(g){console.error("Error fetching file:",g)}},C=async()=>{const g=await s(e.chartInfo?.id),m=e.chartInfo.params.interval;if(g!=null){const d=g.data.benchmark,_=g.data.refer,c=g.data.flush,l=[];c.forEach((u,$)=>{l.push($*m)}),n={title:{text:"地形剖面对比图",left:"5%"},tooltip:{trigger:"axis"},toolbox:{right:"50px",feature:{right:"50px",dataZoom:{yAxisIndex:"none",brushStyle:{color:"#869d9d",opacity:.4}},restore:{},saveAsImage:{pixelRatio:2}}},grid:[{show:!0,borderColor:"#867e76",bottom:"55%"},{top:"55%",show:!0,borderColor:"#867e76"}],xAxis:[{data:l,type:"category",axisLine:{onZero:!1},axisLabel:{formatter:function(u){return Math.round(parseFloat(u))}}},{data:l,type:"category",gridIndex:1,axisLabel:{formatter:function(u){return Math.round(parseFloat(u))}}}],yAxis:[{type:"value",name:"高程(m)",splitLine:{show:!1},interval:5},{type:"value",name:"高程(m)",splitLine:{show:!1},interval:2,gridIndex:1}],visualMap:{top:"2%",left:"60%",orient:"horizontal",pieces:[{gt:0,lte:99,color:"#3f51b5",label:"冲"},{gt:-99,lte:0,color:"#f44336",label:"淤"}]},series:[{name:"1",data:d,type:"line",connectNulls:!0,symbol:"none",animation:!1,smooth:!0,lineStyle:{color:"#f44336"},areaStyle:{color:"#f44336",opacity:.3}},{name:"2",data:_,type:"line",connectNulls:!0,symbol:"none",animation:!1,smooth:!0,lineStyle:{color:"#3f51b5"},areaStyle:{color:"#3f51b5",opacity:.3},markLine:{symbol:["none","none"],animation:!1,lineStyle:{color:"#21373d",width:1,type:"dotted"},label:{show:!1},data:[{yAxis:0,lineStyle:{type:"solid",width:.7}},{yAxis:-5},{yAxis:-10},{yAxis:-15},{yAxis:-20},{yAxis:-25},{yAxis:-30}],silent:!0}},{xAxisIndex:1,yAxisIndex:1,data:c,type:"line",connectNulls:!0,symbol:"none",animation:!1,smooth:!0,silent:!0,markLine:{symbol:["none","none"],animation:!1,lineStyle:{color:"#21373d",width:1,type:"dotted"},label:{show:!1},data:[{yAxis:10},{yAxis:8},{yAxis:6},{yAxis:4},{yAxis:2},{yAxis:0,lineStyle:{type:"solid"}},{yAxis:-10},{yAxis:-8},{yAxis:-6},{yAxis:-4},{yAxis:-2}]},areaStyle:{origin:0}}]}}};return q(async()=>{await C(),T=De(t.value),T.setOption(n)}),{sectionFlush:t}}}),al={class:"section-flush",ref:"sectionFlush"};function tl(e,t,T,n,s,C){return h(),V("div",al,null,512)}const ll=Z(el,[["render",tl],["__scopeId","data-v-ad13ef59"]]),sl=K({components:{SectionVisual:Xt,SectionFlush:ll},props:{chartVisualInfo:{type:Object}},setup(e){return{chartInfo:G(()=>e.chartVisualInfo)}}}),nl={class:"chart-visual"};function ol(e,t,T,n,s,C){const g=L("section-visual"),m=L("section-flush");return h(),V("div",nl,[e.chartInfo.visualType==="section"?(h(),j(g,{key:0,chartInfo:e.chartInfo},null,8,["chartInfo"])):M("",!0),e.chartInfo.visualType==="sectionFlush"?(h(),j(m,{key:1,chartInfo:e.chartInfo},null,8,["chartInfo"])):M("",!0)])}const il=Z(sl,[["render",ol]]),{uuid:rl}=se,{getResultData:dl,getCoordinates:Bl,getAnalysisGeoJson:Hl,getContent:Gl}=oe,ul=K({components:{ChartVisual:il},props:{layerList:{type:Array}},emits:["drawHandle"],setup(e,t){const T=p();let n;const s=p(!1),C=p(),g=p(!1),m=p(""),d=p(""),_=p([]);let c;const l=a=>{if(!n)return;let i={民主沙右缘:[[120.45997922676835,32.00001616423072],[120.60909640208264,32.084171362618626]]};i[a]&&n.fitBounds(i[a],{duration:1500})},u=new _e({controls:{combine_features:!1,uncombine_features:!1,trash:!1,point:!1,polygon:!1}}),$=new _e({controls:{combine_features:!1,uncombine_features:!1,trash:!1,point:!1,line_string:!1}}),R=a=>{a===0?(n.hasControl(u)&&n.removeControl(u),n.hasControl($)&&n.removeControl($)):a===1?(n.hasControl($)&&n.removeControl($),n.hasControl(u)||n.addControl(u,"top-left")):a===2&&(n.hasControl(u)&&n.removeControl(u),n.hasControl($)||n.addControl($,"top-left"))},I=a=>{n.hasControl(u)&&(d.value="geoJsonLine",c=a.features[0],g.value=!0,u.deleteAll()),n.hasControl($)&&(d.value="geoJsonPolygon",c=a.features[0],g.value=!0,$.deleteAll())},F=()=>{t.emit("drawHandle",{id:rl(),geoJson:c,visualType:d.value,fileName:m.value}),g.value=!1},A=(a,i,D,B)=>a>D[0][0]&&a<D[2][0]&&i>D[2][1]&&i<D[0][1]&&n.getLayoutProperty(B,"visibility")!="none",N=()=>{n=new me.Map({container:T.value,accessToken:"pk.eyJ1Ijoiam9obm55dCIsImEiOiJja2xxNXplNjYwNnhzMm5uYTJtdHVlbTByIn0.f1GfZbFLWjiEayI6hb_Qvg",style:je(),center:[121.18,31.723],zoom:8,transformRequest:(a,i)=>{if(a.startsWith("http://119.45.198.54:80/model/"))return{url:a,headers:{token:localStorage.getItem("token")}}}}),n.on("load",async()=>{await E()}),n.doubleClickZoom.disable(),n.on("dblclick",a=>{for(let i=0;i<_.value.length;i++)A(a.lngLat.lng,a.lngLat.lat,_.value[i].coordinates,_.value[i].id)&&new me.Popup().setLngLat([(_.value[i].coordinates[0][0]+_.value[i].coordinates[2][0])/2,(_.value[i].coordinates[0][1]+_.value[i].coordinates[2][1])/2]).setHTML(_.value[i].description).addTo(n)})},E=async()=>{for(let a=e.layerList.length-1;a>=0;a--)await w(e.layerList[a]);n.on("draw.create",I)},w=async a=>{if(n.getLayer(a.id)===void 0){let i;if(a.visualType==="lineVectorTile3D"||a.visualType==="lineVectorTile"||a.visualType==="flushContour"?i="line":a.visualType==="pointVectorTile"||a.visualType==="pointVectorTile3D"?i="circle":(a.visualType==="polygonVectorTile"||a.visualType==="polygonVectorTile3D")&&(i="fill"),a.visualType==="lineVectorTile3D"||a.visualType==="lineVectorTile"||a.visualType==="pointVectorTile"||a.visualType==="pointVectorTile3D"||a.visualType==="polygonVectorTile"||a.visualType==="polygonVectorTile3D"||a.visualType==="flushContour"){const D=await dl("json",a.id,a.name);console.log(D),n.addSource(a.id,{type:"geojson",data:D.data}),n.addLayer({id:a.id,source:a.id,type:i})}else if(a.visualType==="rasterTile"||a.visualType==="elevationFlush"||a.visualType==="slope")n.addSource(a.id,{type:"raster",tiles:[`http://119.45.198.54:80/model//visual/getRaster/${a.visualId}/{x}/{y}/{z}`]}),n.addLayer({id:a.id,type:"raster",source:a.id});else if(a.visualType==="png"||a.visualType==="movePng"||a.visualType==="regionFlush")n.addSource(a.id,{type:"image",url:`http://119.45.198.54:80/model/data/bankResource/down/modelServer/result/file/image?caseId=${a.id}&name=${a.name}`,coordinates:a.params.extent}),n.addLayer({id:a.id,type:"raster",source:a.id});else if(a.visualType==="volume"){n.addSource(a.id,{type:"image",url:`http://119.45.198.54:80/model//data/bankResource/down/modelServer/result/file/image?caseId=${a.id}&name=${a.name}`,coordinates:a.params.extent}),n.addLayer({id:a.id,type:"raster",source:a.id});const D=`容积：${a.params.volume}m³`;_.value.push({id:a.id,coordinates:a.params.extent,description:D})}else if(a.visualType==="geoJsonLine"||a.visualType==="geoJsonPoint"||a.visualType==="geoJsonPolygon"){let D="line";a.visualType==="geoJsonPoint"?D="circle":a.visualType==="geoJsonPolygon"&&(D="fill");const B=a.params.geojson;B!=null&&(n.addSource(a.id,{type:"geojson",data:B}),D==="fill"?n.addLayer({id:a.id,type:D,source:a.id,paint:{"fill-opacity":.5,"fill-color":"#f24545"}}):n.addLayer({id:a.id,type:D,source:a.id}))}}},P=async a=>{C.value=a,s.value=!0},f=a=>{if(n.getLayer(a)!=null){n.removeLayer(a),n.removeSource(a);for(let i=0;i<_.value.length;i++)if(a===_.value[i].id){_.value.splice(i,1);return}}},b=a=>{a.target===""?n.moveLayer(a.drop):n.moveLayer(a.drop,a.target)},v=a=>{n.getLayer(a.id)!=null&&(a.flag?n.setLayoutProperty(a.id,"visibility","visible"):n.setLayoutProperty(a.id,"visibility","none"))},r=()=>{n.resize()};return q(()=>{N()}),{container:T,mapResize:r,addMapLayer:w,removeLayer:f,changeLayerState:v,operateDraw:R,addChart:P,chartVisual:s,chartVisualInfo:C,moveLayer:b,dialogVisible:g,inputValue:m,visualType:d,clickHandle:F,mapFlyToRiver:l}}}),cl={class:"right-visual"},fl={class:"main"},yl={class:"map-container"},pl={ref:"container",class:"container",id:"map"},vl={class:"name"},hl={class:"btn"};function gl(e,t,T,n,s,C){const g=L("chart-visual"),m=L("el-dialog"),d=L("el-input"),_=L("el-button");return h(),V("div",cl,[o("div",fl,[o("div",yl,[o("div",pl,null,512)])]),e.chartVisual?(h(),j(m,{key:0,modelValue:e.chartVisual,"onUpdate:modelValue":t[0]||(t[0]=c=>e.chartVisual=c),width:"900px",id:"chart",title:"可视化结果"},{default:k(()=>[y(g,{chartVisualInfo:e.chartVisualInfo},null,8,["chartVisualInfo"])]),_:1},8,["modelValue"])):M("",!0),y(m,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=c=>e.dialogVisible=c),width:300,title:e.visualType=="geoJsonLine"?"断面名称：":"区域名称："},{default:k(()=>[o("div",vl,[y(d,{modelValue:e.inputValue,"onUpdate:modelValue":t[1]||(t[1]=c=>e.inputValue=c)},null,8,["modelValue"]),o("div",hl,[y(_,{type:"primary",plain:"",size:"small",onClick:e.clickHandle},{default:k(()=>[O("确定")]),_:1},8,["onClick"])])])]),_:1},8,["modelValue","title"])])}const Fe=Z(ul,[["render",gl],["__scopeId","data-v-ff29bcaa"]]),ml={class:"all"},_l={class:"model-content-container"},bl={class:"model-item-container"},wl={class:"model-choice"},Ll={class:"basemap-radio-container"},kl={class:"main-page"},Tl={class:"user-react"},$l=o("div",{class:"title"},[o("div",{class:"title-icon uricon"}),o("div",{class:"title-text"},"模型配置")],-1),Cl={key:0,class:"model-status-main"},Dl={class:"model-status-title"},Il={class:"current-model-name"},Vl={class:"pagination"},Sl={class:"page-num"},Al={class:"model-progress"},Fl={key:1,class:"model-status-empty"},Rl=K({components:{ModelTitleVue:ke,TopTool:Ve,RightVisual:Fe,DataManage:Se,LayerManage:Ae}}),Kl=Object.assign(Rl,{__name:"AnalysisCenter",setup(e){const{notice:t}=se,T=p("");p(!0);const n=p([]),s=p([]),C=p(),g=p(),m=p();p(!1),p(!0);const d=$e(),_=p(3),c=p({}),l=p(0),u=p(!1),$=S=>{console.log(S=="1");const U={1:"/modelStore/stabilityAnalysis",2:"/modelStore/stabilityCalc",3:"/modelStore/analysisCenter"};U[S]&&d.push(U[S])},R=async S=>{console.log(S),C.value.mapFlyToRiver(S.name);const U=(await Je.getBankCalculateResourceList("DEM",S.bankEnName)).data;console.log(U);const W=U.map(X=>({id:X.year,label:`${X.year}年长江南京以下DEM`,flag:!0,children:X.sets.flatMap(x=>x.list.map(ge=>({id:ge.path,label:ge.name,flag:!1,children:[],visualType:"rasterTile"})))}));let Q=g.value.dataList;Q.length!=0&&Q[Q.length-1].id===""&&W.push(Q[Q.length-1]),n.value=W,T.value=S.name,t("success","选择岸段",`已选择岸段——${S.name},模型计算将默认采用${S.name}相关资源`,180)},I=S=>{g.value.addData(S)},F=S=>{S.type==="add"?(m.value.addLayer(S.content),C.value.addMapLayer(S.content)):S.type==="del"?(m.value.delLayer(S.content.id),C.value.removeLayer(S.content.id)):S.type==="chart"&&C.value.addChart(S.content)},A=S=>{C.value.removeLayer(S)},N=S=>{C.value.changeLayerState(S)},E=S=>{C.value.moveLayer(S)},w=S=>{C.value.operateDraw(S)},P=async S=>{const U=await g.value.addDrawData(S);m.value.addLayer(U),C.value.addMapLayer(U)},f=async S=>{await g.value.addAnalyse(S)},b=S=>{if(c.value[S]!==void 0){t("info","错误","当前模型正在运行中，请等待其运行完毕。");return}c.value[S]=0,u.value=!0},v=(S,U)=>{U==0?(c.value[S]=100,setTimeout(async()=>{delete c.value[S],l.value>0&&l.value--},1e3)):U==-1?(delete c.value[S],l.value>0&&l.value--):U==1&&c.value[S]<90&&(c.value[S]+=Math.floor(Math.random()*6)+5)},r=G(()=>Object.keys(c.value)),a=G(()=>r.value[l.value]);G(()=>c.value[a.value]);const i=G(()=>r.value.length),D=()=>{l.value>0&&l.value--},B=()=>{l.value<i.value-1&&l.value++};return q(async()=>{}),Ce(()=>{window.sessionStorage.setItem("layerList",JSON.stringify(s.value))}),(S,U)=>{const W=L("el-radio-button"),Q=L("el-radio-group"),X=L("el-progress");return h(),V("div",ml,[y(ke,{onConfirmBank:R,ModelName:"近岸演变分析模型"}),o("div",_l,[o("div",bl,[o("div",wl,[o("div",Ll,[y(Q,{modelValue:_.value,"onUpdate:modelValue":U[0]||(U[0]=x=>_.value=x),onChange:U[1]||(U[1]=x=>$(_.value))},{default:k(()=>[y(W,{label:"近岸动力评估",value:"1"}),y(W,{label:"近岸动力计算",value:"2"}),y(W,{label:"近岸演变分析",value:"3"})]),_:1},8,["modelValue"])])]),o("div",kl,[o("div",Tl,[$l,(h(),j(Ve,{onReturnFileList:I,onOperateDraw:w,onAnalyse:f,onUploadHandle:P,dataList:n.value,key:T.value},null,8,["dataList"]))]),(h(),j(Se,{class:"top",ref_key:"dataManage",ref:g,dataList:n.value,key:T.value,onOperateLayer:F,onAddCurrentModel:b,onUpdateCurrentModel:v},null,8,["dataList"])),y(Ae,{class:"bottom",ref_key:"layerManage",ref:m,layerList:s.value,onCloseLayer:A,onHideLayer:N,onMoveLayer:E},null,8,["layerList"])])]),y(Fe,{layerList:s.value,ref_key:"rightMap",ref:C,onDrawHandle:P},null,8,["layerList"]),o("div",{class:le(["model-status",{"model-status-hide":!u.value}])},[o("div",{class:"show-model-status",onClick:U[2]||(U[2]=x=>u.value=!u.value)}," 模型运行 "),i.value!=0?(h(),V("div",Cl,[o("div",Dl,[O(" 正在运行："),o("span",Il,J(a.value),1),o("div",Vl,[o("span",{class:le(["page-change",{"page-change-disabled":l.value===0}]),onClick:D}," < ",2),o("span",Sl,J(l.value+1)+"/"+J(i.value),1),o("span",{class:le(["page-change",{"page-change-disabled":l.value===i.value-1}]),onClick:B}," > ",2)])]),o("div",Al,[y(X,{percentage:c.value[a.value],"stroke-width":15,duration:5,"striped-flow":"",striped:""},null,8,["percentage"])])])):(h(),V("div",Fl,"当前没有正在运行的模型！"))],2)])])}}});export{Kl as default};
