import{_ as Ee,e as h,f as he,i as m,o as t,k as I,w as v,a as d,t as x,b as B,P as M,c as f,r as Y,F as O,O as z,a5 as c,au as S,p as Ie,d as Te,ay as De,a4 as xe,az as Se,a8 as we,g as Be,h as Me,B as Ue,C as ye,D as Re,ao as _e,aa as Fe,j as ke,u as ze,ac as Oe,N as Ne,an as $e}from"./index-6YJPzaKF.js";import{u as Ce}from"./resourceStore-B7A3xz-y.js";import{r as je,a as He,f as Ye,g as Ve,t as q,b as ge,d as qe,c as Ae}from"./bankResource-SRx4z6Q0.js";const Je=C=>(Ie("data-v-dcc3ea42"),C=C(),Te(),C),Pe={class:"form-header"},Ge=Je(()=>d("div",{class:"el-upload__text"},[d("em",null,"拖拽文件至此处"),M("或"),d("em",null,"点击"),M("进行上传 ")],-1)),Xe={class:"dialog-footer"},Ke={__name:"uploadDialog",props:{type:{type:String,default:"model"},subType:{type:String,default:"DEM"},bankEnName:{type:String,default:"Mzs"}},setup(C,{expose:ne}){const l=C,se=h(null),A=Ce(),D=h(!1),W=he(()=>He[l.type][l.subType]+"上传"),o=h(je),V=h(null),R=h([]),y=h(!1),$=()=>{y.value=!0,S.info({message:"文件正在上传中,请稍后...",offset:100}),D.value=!1},U=n=>{console.log("preview! ",n)},ce=(n,u)=>{console.log("remove! ",n,u),console.log("Cancel the transfer! ",n.name)};let L=null,J=null;const ue=n=>{console.log("file change!")},Z=n=>{if(console.log("handleFileUpload!!",n,R.value),l.type==="device"){$();const u=new FileReader;u.onload=k=>{try{let s=JSON.parse(k.target.result);console.log(s),J=Object.assign({},s),J&&c.uploadBankDevice(J,l.bankEnName).then(E=>{setTimeout(()=>{N(E)},3e3)}).catch(E=>{H(E)})}catch(s){console.log(s),H(s),S.error({message:"请上传正确的设备配置文件！",offset:100})}},u.readAsText(n.file)}else if(l.type==="model"){y.value=!0,$();const u=j(o.value[l.type][l.subType]);if(!u){y.value=!1;return}const[k,s]=ee(n.file.name);u.name=k,l.subType==="DEM"&&(u.fileType=s==="txt"?s:"tiff"),L=new FormData,L.append("file",n.file),L.append("info",JSON.stringify(u)),c.uploadBankCalculateResourceFile(L).then(E=>{N(E)}).catch(E=>{H(E)})}else if(l.type==="visual"){y.value=!0,$();const u={};o.value[l.type][l.subType].forEach(s=>{s.enName.includes("file")||(u[s.enName]=s.value)}),u.segment=l.bankEnName,u.fields===""&&delete u.fields,L=new FormData,L.append("file",n.file),L.append("info",JSON.stringify(u)),c.uploadBankVisualResourceFile(L,l.bankEnName).then(s=>{N(s)}).catch(s=>{H(s)})}},re=()=>{D.value=!1},_=n=>{V.value&&V.value[0].submit()};ne({dialogFormVisible:D});const j=n=>{let u;if(l.subType==="Hydrodynamic")try{u=A.resourceInfo.模型资源管理[2].resourceList[0].path}catch{return S.error("请先上传岸段边界矢量文件!"),!1}const k={};return n.forEach(s=>{s.enName.includes("file")||(k[s.enName]=s.value)}),k.segment=l.bankEnName,k.fileType=Ye[l.type][l.subType],k.category=l.subType,k.temp=!1,k.boundary=u,k},ee=n=>{const u=n.split(".");return[u[0],u[1]]},N=n=>{S.success({message:"上传成功！",offset:100}),console.log("SUCCESS::",n.data),D.value=!1,c.refreshBankResource(A.resourceInfo,l.bankEnName,l.type,l.subType),y.value=!1},H=n=>{console.error("上传失败！",n),S.error({message:"上传失败！",offset:100}),c.refreshBankResource(A.resourceInfo,l.bankEnName,l.type,l.subType),y.value=!1};return(n,u)=>{const k=m("el-input"),s=m("el-radio"),E=m("el-radio-group"),ie=m("upload-filled"),de=m("el-icon"),pe=m("el-upload"),fe=m("el-form-item"),P=m("el-form"),G=m("el-button"),a=m("el-dialog");return t(),I(a,{modelValue:D.value,"onUpdate:modelValue":u[0]||(u[0]=e=>D.value=e),width:"18vw","show-close":!1,ref_key:"dialogRef",ref:se,"custom-class":"dialog-class","destroy-on-close":!0},{header:v(({titleId:e,titleClass:i})=>[d("div",Pe,x(W.value),1)]),footer:v(()=>[d("div",Xe,[B(G,{onClick:re},{default:v(()=>[M("取消")]),_:1}),B(G,{type:"primary",onClick:_},{default:v(()=>[M(" 确认 ")]),_:1})])]),default:v(()=>[B(P,{model:o.value[l.type][l.subType],"label-position":"top"},{default:v(()=>[(t(!0),f(O,null,Y(o.value[l.type][l.subType],(e,i)=>(t(),I(fe,{key:i,label:e.label,required:e.required},{default:v(()=>[e.type==="input"?(t(),I(k,{key:0,modelValue:e.value,"onUpdate:modelValue":b=>e.value=b,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])):e.type==="radios"?(t(),I(E,{key:1,modelValue:e.value,"onUpdate:modelValue":b=>e.value=b},{default:v(()=>[(t(!0),f(O,null,Y(e.radioLabelArray,(b,T)=>(t(),I(s,{value:e.radioValueArray[T]},{default:v(()=>[M(x(e.radioLabelArray[T]),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.type==="file"?(t(),I(pe,{key:2,style:{height:"fit-content"},drag:"",action:"#",multiple:!1,"show-file-list":!0,ref_for:!0,ref_key:"uploadRef",ref:V,"auto-upload":!1,"file-list":R.value,"on-preview":U,"on-remove":ce,"on-change":ue,"http-request":Z},{default:v(()=>[B(de,{class:"el-icon--upload"},{default:v(()=>[B(ie)]),_:1}),Ge]),_:1},8,["file-list"])):z("",!0)]),_:2},1032,["label","required"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},Qe=Ee(Ke,[["__scopeId","data-v-dcc3ea42"]]),be=C=>(Ie("data-v-6c2e90e3"),C=C(),Te(),C),We={class:"bank-resouce-create-container"},Ze=be(()=>d("div",{class:"main-title"},"岸段管理",-1)),ea={class:"desc-box-container"},aa={class:"change-button-container delete"},ta=be(()=>d("div",{class:"title-container"},"岸段基本信息",-1)),la={class:"change-button-container"},oa={class:"detail-content-container"},na={class:"bank-name"},sa=be(()=>d("div",{class:"bankName-key"},"岸段名称",-1)),ca={key:0,class:"bankName-val"},ua={key:1,class:"bankName-val"},ra={class:"detail-key"},ia={key:0,class:"detail-val"},da={style:{width:"100%","text-align":"center"}},pa={key:2,class:"full"},fa={key:1,class:"detail-val"},va={class:"resource-box-container"},ma={class:"title-container"},ya={class:"resource-content-container"},_a={class:"resource-title"},ka=["onClick"],ga={class:"resource-content"},ha={style:{display:"flex","align-items":"center","justify-content":"center"}},ba={__name:"BankResourcePreview",emits:["refresh-bank-list"],setup(C,{emit:ne}){const l=["I 级预警岸段","Ⅱ 级预警岸段","Ⅲ 级预警岸段"],se=De(),A=xe();Se(async(a,e)=>{const i=a.params.id;y.value=!1,G(i)});const D=ne,W=Ce(),o=we({name:"",bankEnName:""}),V=we({lng:"",lat:""}),R=h(),y=h(!1);let $=null,U={name:"",bankEnName:""};const ce=()=>{let a=typeof R.value[1].val=="string"?JSON.parse(R.value[1].val):R.value[1].val;V.lng=a[0],V.lat=a[1],console.log("lnglat",V),y.value=!0,$=R.value.map(e=>({...e})),U.name=o.name,U.bankEnName=o.bankEnName},L=()=>{y.value=!1,R.value=$,o.name=U.name,o.bankEnName=U.bankEnName},J=()=>{_e.confirm("确认删除该岸段？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{c.deleteBank(o.bankEnName).then(a=>{const e=a.data;S.success({offset:100,message:e}),D("refresh-bank-list",!0),A.push("/bankManage/preview/Mzs")}).catch(a=>{console.log(a),S.error({offset:100,message:"删除失败"})})}).catch(a=>{S.info({offset:100,message:"取消删除"})})},ue=()=>{_e.confirm("确认修改岸段信息？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}).then(async()=>{let a=R.value,e=[parseFloat(V.lng),parseFloat(V.lat)],i={bank:o.bankEnName,name:o.name,riskLevel:a[0].val,center:e,monitorLength:a[2].val,monitorStartTime:a[3].val,introduction:a[4].val,management:{department:a[5].val,contact:a[6].val}};const b=(await c.updateBankBasicInfo(o.bankEnName,i)).data;D("refresh-bank-list",!0),Fe.success({title:b,offset:120});const T=(await c.getOneBankBasicInfo(o.bankEnName)).data;console.log("true!!"),o.name=T.name,R.value=Ve(T),y.value=!1}).catch(a=>{console.log("取消修改",a),R.value=$,o.name=U.name,o.bankEnName=U.bankEnName,y.value=!1})},Z=h([]),re=a=>{Z.value.push(a)},_=h(0);Be(_,(a,e)=>{const i={0:"translateX(0%)",1:"translateX(-100%)",2:"translateX(-200%)"};Z.value.forEach(b=>{b.style.transform=i[a]})});const j=h(0),ee=a=>{if(a){if(_.value===-1+Object.keys(N.value).length)return;_.value=(_.value+1)%Object.keys(N.value).length}else{if(_.value===0)return;_.value=(_.value-1+Object.keys(N.value).length)%Object.keys(N.value).length}},N=h({}),H=h(null),n=he(()=>({type:q[_.value],subType:ge[q[_.value]][j.value],bankEnName:o.bankEnName})),u=a=>{j.value=a,console.log(n.value),H.value.dialogFormVisible=!0},k=h(null),s=h({aspect:"",deviceId:"",deviceName:"",type:"",longitude:"",latitude:"",elevation:""}),E=he(()=>({type:q[_.value],subType:ge[q[_.value]][j.value],bankEnName:o.bankEnName,itemInfo:s})),ie=()=>{k.value.dialogFormVisible=!0},de=qe,pe=(a,e,i)=>{s.value=i,console.log("operatingItem",i),_e.confirm("确认删除该条资源？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{if(console.log("确认删除"),N.value[Ae[_.value]][e].resourceList.splice(a,1),o.bankEnName!="Mzs")switch(q[_.value]){case"model":let T=ge[q[_.value]][j.value];console.log("subType",T),c.deleteBankCalculateResourceFile(T,o.bankEnName,i.name).then(w=>{console.log(w)}).catch(w=>{console.warn(w)});break;case"visual":c.deleteBankVisualResourceFile(i.tileName,o.bankEnName).then(w=>{console.log(w)}).catch(w=>{console.warn(w)});break;case"device":c.deleteBankDevice(i.code).then(w=>{console.log(w)}).catch(w=>{console.warn(w)});break}S.success({offset:100,message:"删除成功！"})}).catch(b=>{console.log("取消删除",b)})},fe=(a,e,i)=>{j.value=e,s.value=i,ie()},P=h(!1);Me(async()=>{const a=se.params.id;await G(a),Be(()=>W.resourceInfo,(e,i)=>{N.value=$e(e)})});const G=async a=>{P.value=!0;const e=a,i=(await c.getOneBankBasicInfo(e)).data,b=(await c.getBankCalculateResourceList("DEM",e)).data,T=(await c.getBankCalculateResourceList("Hydrodynamic",e)).data,w=(await c.getBankCalculateResourceList("Boundary",e)).data,ae=(await c.getBankCalculateResourceList("Config",e)).data,te=[{key:"岸段地形资源",upload:!0,update:!1,delete:!0,resourceList:c.DEMResourcetoList(b)},{key:"模型参数文件",upload:!0,update:!1,delete:!0,resourceList:c.ConfigResourcetoList(ae)},{key:"岸段边界矢量",upload:!0,update:!1,delete:!0,resourceList:c.BoundaryResourcetoList(w)},{key:"水动力预算工况",upload:!0,update:!1,delete:!0,resourceList:c.HydrodynamicResourcetoList(T)}],X=(await c.getBankVisualResourceList("DEM",a)).data;X.map(g=>g.fileType="地形切片");const K=(await c.getBankVisualResourceList("vector",a)).data;K.map(g=>{g.fileType="矢量切片",g.name=g.tileName});const le=[{key:"栅格可视化资源",upload:!1,update:!1,delete:!1,resourceList:X},{key:"矢量可视化资源",upload:!0,update:!1,delete:!0,resourceList:K}];let Q=[];const ve=(await c.getBankDeviceResourceList("GNSS",a)).data,r=(await c.getBankDeviceResourceList("INCLINE",a)).data,oe=(await c.getBankDeviceResourceList("STRESS",a)).data,p=(await c.getBankDeviceResourceList("MENOMETER",a)).data,F=(await c.getBankDeviceResourceList("VEDIO",a)).data;Q=[{key:"GNSS设备",upload:!0,update:!0,delete:!0,resourceList:ve},{key:"孔隙水压力计设备",upload:!0,update:!0,delete:!0,resourceList:p},{key:"应力桩设备",upload:!0,update:!0,delete:!0,resourceList:oe},{key:"测斜仪设备",upload:!0,update:!0,delete:!0,resourceList:r},{key:"监控摄像设备",upload:!0,update:!0,delete:!0,resourceList:F}],o.name=i.name,o.bankEnName=e,R.value=Ve(i),console.log(R.value),N.value={模型资源管理:te,可视化资源管理:le,设备资源管理:Q},W.resourceInfo={模型资源管理:te,可视化资源管理:le,设备资源管理:Q},P.value=!1};return(a,e)=>{const i=m("el-input"),b=m("el-option"),T=m("el-select"),w=m("el-date-picker"),ae=m("el-scrollbar"),te=m("el-tag"),X=m("el-table-column"),K=m("el-button"),le=m("el-table"),Q=m("UpdateDialog"),ve=Ue("loading");return t(),f(O,null,[ye((t(),f("div",We,[Ze,d("div",ea,[ye(d("div",aa,[y.value?z("",!0):(t(),f("div",{key:0,class:"change-button delete",onClick:J}," 删除 "))],512),[[Re,o.bankEnName!="Mzs"&&o.bankEnName!=""]]),ta,d("div",la,[y.value?z("",!0):(t(),f("div",{key:0,class:"change-button",onClick:ce}," 修改 ")),y.value?(t(),f("div",{key:1,class:"change-button modify",onClick:ue}," 提交 ")):z("",!0),y.value?(t(),f("div",{key:2,class:"cancel-button",onClick:L}," 取消 ")):z("",!0)]),B(ae,{height:"77vh"},{default:v(()=>[d("div",oa,[d("div",na,[sa,y.value?(t(),f("div",ca,[B(i,{modelValue:o.name,"onUpdate:modelValue":e[0]||(e[0]=r=>o.name=r),style:{width:"100%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"},placeholder:"请输入",type:"text",autosize:{minRows:4,maxRows:6}},null,8,["modelValue"])])):(t(),f("div",ua,x(o.name),1))]),(t(!0),f(O,null,Y(R.value,(r,oe)=>(t(),f("div",{class:ke(["detail-box-item",r.type]),key:oe},[d("div",ra,x(r.key),1),y.value?(t(),f("div",ia,[r.key==="预警级别"?(t(),I(T,{key:0,modelValue:r.val,"onUpdate:modelValue":p=>r.val=p,placeholder:"请选择预警级别",style:{width:"100%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"}},{default:v(()=>[(t(),f(O,null,Y(l,(p,F)=>B(b,{key:F,value:p},{default:v(()=>[d("span",da,x(p),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):r.key==="监测起始时间"?(t(),I(w,{key:1,modelValue:r.val,"onUpdate:modelValue":p=>r.val=p,type:"date",placeholder:"请选择监测起始时间",format:"YYYY-MM-DD","date-format":"MMM DD, YYYY"},null,8,["modelValue","onUpdate:modelValue"])):r.key==="中心坐标"?(t(),f("div",pa,[B(i,{modelValue:V.lng,"onUpdate:modelValue":e[1]||(e[1]=p=>V.lng=p),style:{width:"50%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"},placeholder:"请输入经度",type:"number",step:1e-7,autosize:{minRows:4,maxRows:6}},null,8,["modelValue"]),B(i,{modelValue:V.lat,"onUpdate:modelValue":e[2]||(e[2]=p=>V.lat=p),style:{width:"50%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"},placeholder:"请输入纬度",type:"number",step:1e-7,autosize:{minRows:4,maxRows:6}},null,8,["modelValue"])])):(t(),I(i,{key:3,modelValue:r.val,"onUpdate:modelValue":p=>r.val=p,style:{width:"100%",height:"100%","font-size":"calc(0.6vw + 0.6vh)"},placeholder:r.key==="中心坐标"?"请输入坐标: [经度,维度]":"请输入"+r.key,type:r.type.includes("long-text")?"textarea":"text",autosize:{minRows:4,maxRows:6}},null,8,["modelValue","onUpdate:modelValue","placeholder","type"]))])):(t(),f("div",fa,x(r.key==="监测起始时间"&&r.val?r.val.slice(0,10):r.val),1))],2))),128))])]),_:1})]),d("div",va,[(t(!0),f(O,null,Y(Object.keys(N.value),(r,oe)=>(t(),f("div",{class:"one-type-resource-container",ref_for:!0,ref:re},[d("div",ma,[d("span",{onClick:e[3]||(e[3]=p=>ee(0)),class:ke(["page left",{ban:_.value===0}])},"上一页",2),d("span",null,x(r),1),d("span",{onClick:e[4]||(e[4]=p=>ee(1)),class:ke(["page right",{ban:_.value===Object.keys(N.value).length-1}])},"下一页",2)]),d("div",ya,[B(ae,{height:"75vh"},{default:v(()=>[(t(!0),f(O,null,Y(N.value[r],(p,F)=>(t(),f("div",{class:"resource-box-item",key:F},[d("div",_a,[M(x(p.key)+" ",1),ye(d("div",{class:"resource-upload-btn",onClick:g=>u(F)},"上传 ",8,ka),[[Re,p.upload]])]),d("div",ga,[B(le,{data:p.resourceList,style:{width:"95%","margin-left":"2.5%"},"max-height":"25vh"},{default:v(()=>[(t(!0),f(O,null,Y(ze(de)[r],(g,me)=>(t(),I(X,{key:me,prop:g.prop,label:g.label,"min-width":g["min-width"],align:"center"},Oe({_:2},[g.asTag?{name:"default",fn:v(Le=>[d("div",ha,[B(te,null,{default:v(()=>[M(x(Le.row.fileType),1)]),_:2},1024)])]),key:"0"}:void 0]),1032,["prop","label","min-width"]))),128)),p.delete||p.update?(t(),I(X,{key:0,fixed:"right",label:"操作","min-width":"20%",align:"center"},{default:v(g=>[p.delete?(t(),I(K,{key:0,link:"",type:"danger",size:"small",onClick:Ne(me=>pe(g.$index,F,g.row),["prevent"])},{default:v(()=>[M(" 删除 ")]),_:2},1032,["onClick"])):z("",!0),p.update?(t(),I(K,{key:1,link:"",type:"warning",size:"small",onClick:Ne(me=>fe(g.$index,F,g.row),["prevent"])},{default:v(()=>[M(" 更新 ")]),_:2},1032,["onClick"])):z("",!0)]),_:2},1024)):z("",!0)]),_:2},1032,["data"])])]))),128))]),_:2},1024)])]))),256))])])),[[ve,P.value]]),B(Qe,{ref_key:"uploadDialogRef",ref:H,type:n.value.type,"sub-type":n.value.subType,"bank-en-name":n.value.bankEnName},null,8,["type","sub-type","bank-en-name"]),B(Q,{ref_key:"updateDialogRef",ref:k,type:E.value.type,"sub-type":n.value.subType,"bank-en-name":E.value.bankEnName,"resource-item-info":E.value.itemInfo},null,8,["type","sub-type","bank-en-name","resource-item-info"])],64)}}},Na=Ee(ba,[["__scopeId","data-v-6c2e90e3"]]);export{Na as default};
