const __vite__fileDeps=["assets/riskResult-DB7jA26b.js","assets/index-CuzgIV3z.js","assets/index-DFPyRhYG.css","assets/riskResult-ATSSiHG3.css","assets/flowspeedInfo-DIXMdvhR.js","assets/util-CRZRFQLc.js","assets/flowspeedInfo-DhCc-SlV.css","assets/profileInfo-CdskzmHy.js","assets/profileInfo-V_w5SQ9g.css","assets/profileShapeYearly-CwKRmJod.js","assets/profileShapeYearly-Bxp6tmOB.css","assets/profileShapeCompare-D2aN-U_j.js","assets/profileShapeCompare-C0q7WLm1.css","assets/profileSlope-DBX74rVE.js","assets/profileSlope-BElbQp6g.css","assets/profileErosion-BdjZOcpD.js","assets/profileErosion-CF4DUzMW.css","assets/BedFlowChart-Bp2CwgH0.js","assets/BedFlowChart-DzRjOnJ2.css","assets/WaterProcessChart-B8fjX0hN.js","assets/WaterProcessChart-8A0LQImF.css","assets/GeologyAndProject-UNPhZgXB.js","assets/GeologyAndProject-BdX_dTSd.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{b7 as Wt,b8 as nt,aX as Jt,v as g,ah as Ht,h as Fe,i as vt,j as he,o as E,c as N,b as U,d as X,a as d,t as ve,b1 as Be,_ as xt,J as lt,g as u,af as $t,x as ce,z as Zt,A as Kt,k as Ve,e as I,N as S,D as pe,u as M,B as ut,C as qt,a0 as Tt,a8 as ct,w as dt,p as Qt,f as gt,b9 as z,a9 as Le,aQ as V}from"./index-CuzgIV3z.js";import"./index-ZKhpeRc_.js";import{M as ea}from"./mapbox-gl-draw-CMN8krDr.js";function ta(a=5){function e(c,b){return[(c[0]+b[0])/2,(c[1]+b[1])/2]}const r=[],s=[],t=new Map;function n(c){const b=c.join("-");return t.has(b)||t.set(b,s.length/2),s.push(c[0]),s.push(c[1]),c}const h=n([0,1]),o=n([0,0]),v=n([1,1]),T=n([1,0]),A={fst:h,snd:o,ted:T,level:0},_={fst:T,snd:v,ted:h,level:0},C=[];C.push(A),C.push(_);const B=[];for(;C.length;){const c=C.pop(C);if(c.level>=a){B.push(c);continue}const b=c.fst,L=c.snd,y=c.ted,$=n(e(b,y));C.push({fst:b,snd:$,ted:L,level:c.level+.5}),C.push({fst:y,snd:$,ted:L,level:c.level+.5})}return B.forEach(c=>{const b=c.fst.join("-"),L=c.snd.join("-"),y=c.ted.join("-");r.push(t.get(b)),r.push(t.get(L)),r.push(t.get(y))}),{positions:s,indices:r}}class Xe{constructor(e=0,r=0,s=void 0){this.parent=s,this.level=e,this.id=r,this.size=180/Math.pow(2,e);const t=this.id%4,n=(this.parent?this.parent.bBox.boundary.x:-180)+t%2*this.size,h=n+this.size,o=(this.parent?this.parent.bBox.boundary.y:-90)+Math.floor(t/2)*this.size,v=o+this.size;this.bBox=new Wt(n,o,h,v),this.children=[]}release(){return this.bBox=this.bBox.release(),this.children=null,this.parent=null,this.level=null,this.size=null,this.id=null,null}isSubdividable(e){const r=this.bBox.center,s=Math.ceil(Math.abs(r[0]-e.cameraPos[0])/this.size),t=Math.ceil(Math.abs(r[1]-e.cameraPos[1])/this.size);return Math.max(s,t)<=2}}class aa{constructor(e){this.type="custom",this.map=void 0,this.id="TerrainLayer",this.renderingMode="3d",this.asLine=!1,this.nodeCount=0,this.maxLevel=e,this.maxNodeCount=1e3,this.sectorSize=32,this.sectorRange=[0,0],this.exaggeration=50,this.tileBox=nt(),this.lodMapSize=[512,512],this.visibleNodeLevel=[0,this.maxLevel],this.elevationRange=[-80.06899999999999,4.3745],this.boundaryCondition=nt(120.04373606134682,31.173901952209487,121.96623240116922,32.08401085804678),this.nodeLevelArray=new Uint32Array(this.maxNodeCount),this.nodeBoxArray=new Float32Array(this.maxNodeCount*4),this.interval=5,this.color=[0,0,0],this.indexNum=0}onAdd(e,r){this.map=e;const{positions:s,indices:t}=ta(Math.log2(this.sectorSize));this.positionArray=new Float32Array(s),this.indexNum=t.length,this.indexTextureSize=Math.ceil(Math.sqrt(t.length)),this.positionTextureSize=Math.ceil(Math.sqrt(s.length/2)),this.indexTextureArray=new Uint32Array(this.indexTextureSize*this.indexTextureSize),t.forEach((v,T)=>{this.indexTextureArray[T]=v}),this.positionTextureArray=new Float32Array(this.positionTextureSize*this.positionTextureSize*2),s.forEach((v,T)=>{this.positionTextureArray[T]=v});const n=new Jt,h=n.addFolder("Contour");h.add(this,"interval",.1,20).onChange(()=>this.map.triggerRepaint()),h.addColor(this,"color").onChange(()=>this.map.triggerRepaint()),h.open();const o=n.addFolder("Terrain");o.add(this,"asLine",!1).onChange(()=>this.map.triggerRepaint()),o.add(this,"exaggeration",1,100).onChange(()=>this.map.triggerRepaint()),o.add(this,"maxLevel",14,20,1).onChange(()=>this.map.triggerRepaint()),o.open(),n.hide(),this.init(r)}async init(e){this.isInitialized=!1,ra(e),this.canvasWidth=e.canvas.width,this.canvasHeight=e.canvas.height,this.normalShader=await de(e,"/scratchSomething/terrainWebGL/shader/normal.glsl"),this.lodMapShader=await de(e,"/scratchSomething/terrainWebGL/shader/lodMap.glsl"),this.dLodMapShader=await de(e,"/scratchSomething/terrainWebGL/shader/dLodMap.glsl"),this.terrainLineShader=await de(e,"/scratchSomething/terrainWebGL/shader/terrainMeshLine.glsl"),this.terrainMeshShader=await de(e,"/scratchSomething/terrainWebGL/shader/terrainMesh.glsl"),this.terrainShader=this.asLine?this.terrainLineShader:this.terrainMeshShader,this.showShader=await de(e,"/scratchSomething/terrainWebGL/shader/terrainLayer.glsl");const r=await ft("/scratchSomething/terrainWebGL/image/dem.png"),s=await ft("/scratchSomething/terrainWebGL/image/contourPalette1D.png");this.demTexture=k(e,r.width,r.height,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),this.paletteTexture=k(e,s.width,s.height,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s),this.boxTexture=k(e,this.nodeBoxArray.length/4,1,e.RGBA32F,e.RGBA,e.FLOAT,this.nodeBoxArray),this.levelTexture=k(e,this.nodeLevelArray.length,1,e.R32UI,e.RED_INTEGER,e.UNSIGNED_INT,this.nodeLevelArray),this.indexTexture=k(e,this.indexTextureSize,this.indexTextureSize,e.R32UI,e.RED_INTEGER,e.UNSIGNED_INT,this.indexTextureArray),this.positionTexture=k(e,this.positionTextureSize,this.positionTextureSize,e.RG32F,e.RG,e.FLOAT,this.positionTextureArray),this.normalTexture=k(e,r.width,r.height,e.RGB8,e.RGB,e.UNSIGNED_BYTE);const t=De(e,[this.normalTexture]);e.bindFramebuffer(e.FRAMEBUFFER,t),e.viewport(0,0,r.width,r.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(this.normalShader),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.demTexture),e.uniform1i(e.getUniformLocation(this.normalShader,"demTexture"),0),e.uniform1f(e.getUniformLocation(this.normalShader,"exaggeration"),this.exaggeration),e.uniform2fv(e.getUniformLocation(this.normalShader,"e"),new Float32Array(this.elevationRange)),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.lodMapTexture=k(e,this.lodMapSize[0],this.lodMapSize[1],e.R32UI,e.RED_INTEGER,e.UNSIGNED_INT),this.dLodMapTexture=k(e,this.lodMapSize[0],this.lodMapSize[1],e.R32UI,e.RED_INTEGER,e.UNSIGNED_INT),this.layerDepthTexture=k(e,this.canvasWidth,this.canvasHeight,e.DEPTH_COMPONENT24,e.DEPTH_COMPONENT,e.UNSIGNED_INT),this.layerTexture=k(e,this.canvasWidth,this.canvasHeight,e.RGBA32F,e.RGBA,e.FLOAT),this.layerTextureMaxMipLevel=sa(this.canvasWidth,this.canvasHeight),this.layerRenderBuffer=ia(e,this.canvasWidth,this.canvasHeight),this.lodMapPass=De(e,[this.lodMapTexture]),this.dLodMapPass=De(e,[this.dLodMapTexture]),this.layerPass=De(e,[this.layerTexture],this.layerDepthTexture),this.isInitialized=!0}render(e,r){if(!this.isInitialized)return;this.map.update(),this.registerRenderableNode({cameraPos:this.map.mercatorCenter.toLngLat().toArray(),cameraBounds:this.map.cameraBounds,zoomLevel:this.map.getZoom()}),ht(e,this.boxTexture,this.nodeBoxArray.length/4,1,e.RGBA32F,e.RGBA,e.FLOAT,this.nodeBoxArray),ht(e,this.levelTexture,this.nodeLevelArray.length,1,e.R32UI,e.RED_INTEGER,e.UNSIGNED_INT,this.nodeLevelArray),e.bindFramebuffer(e.FRAMEBUFFER,this.lodMapPass),e.viewport(0,0,this.lodMapSize[0],this.lodMapSize[1]);const s=new Uint32Array([0,0,0,0]);e.clearBufferuiv(e.COLOR,0,s),e.useProgram(this.lodMapShader),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.boxTexture),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.levelTexture),e.uniform1i(e.getUniformLocation(this.lodMapShader,"boxTexture"),0),e.uniform1i(e.getUniformLocation(this.lodMapShader,"levelTexture"),1),e.uniform2fv(e.getUniformLocation(this.lodMapShader,"dimensions"),new Float32Array(this.lodMapSize)),e.uniform2fv(e.getUniformLocation(this.lodMapShader,"sectorRange"),new Float32Array(this.sectorRange)),e.uniform4fv(e.getUniformLocation(this.lodMapShader,"tileBox"),new Float32Array(this.tileBox.boundary.xyzw)),e.drawArraysInstanced(e.TRIANGLE_STRIP,0,4,this.nodeCount),e.bindFramebuffer(e.FRAMEBUFFER,this.dLodMapPass),e.viewport(0,0,this.lodMapSize[0],this.lodMapSize[1]),e.clearBufferuiv(e.COLOR,0,new Uint32Array([0,0,0,0])),e.useProgram(this.dLodMapShader),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.lodMapTexture),e.uniform1i(e.getUniformLocation(this.lodMapShader,"lodMap"),0),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.terrainShader=this.asLine?this.terrainLineShader:this.terrainMeshShader,e.bindFramebuffer(e.FRAMEBUFFER,this.layerPass),e.viewport(0,0,this.canvasWidth,this.canvasHeight),e.clearColor(1e3,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),e.disable(e.BLEND),e.useProgram(this.terrainShader),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.indexTexture),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.positionTexture),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.levelTexture),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.boxTexture),e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.dLodMapTexture),e.activeTexture(e.TEXTURE5),e.bindTexture(e.TEXTURE_2D,this.demTexture),e.activeTexture(e.TEXTURE6),e.bindTexture(e.TEXTURE_2D,this.normalTexture),e.uniform1i(e.getUniformLocation(this.terrainShader,"indicesTexture"),0),e.uniform1i(e.getUniformLocation(this.terrainShader,"positionsTexture"),1),e.uniform1i(e.getUniformLocation(this.terrainShader,"levelTexture"),2),e.uniform1i(e.getUniformLocation(this.terrainShader,"boxTexture"),3),e.uniform1i(e.getUniformLocation(this.terrainShader,"dLodMap"),4),e.uniform1i(e.getUniformLocation(this.terrainShader,"demTexture"),5),e.uniform1i(e.getUniformLocation(this.terrainShader,"normalTexture"),6),e.uniform1f(e.getUniformLocation(this.terrainShader,"sectorSize"),this.sectorSize),e.uniform1f(e.getUniformLocation(this.terrainShader,"worldSize"),this.map.WORLD_SIZE),e.uniform1f(e.getUniformLocation(this.terrainShader,"exaggeration"),this.exaggeration),e.uniform2fv(e.getUniformLocation(this.terrainShader,"centerHigh"),this.map.centerHigh),e.uniform2fv(e.getUniformLocation(this.terrainShader,"centerLow"),this.map.centerLow),e.uniform1f(e.getUniformLocation(this.terrainShader,"maxLodLevel"),this.maxVisibleNodeLevel),e.uniform1f(e.getUniformLocation(this.terrainShader,"maxMipLevel"),this.layerTextureMaxMipLevel),e.uniform2fv(e.getUniformLocation(this.terrainShader,"e"),new Float32Array(this.elevationRange)),e.uniform2fv(e.getUniformLocation(this.terrainShader,"sectorRange"),new Float32Array(this.sectorRange)),e.uniform4fv(e.getUniformLocation(this.terrainShader,"tileBox"),new Float32Array(this.tileBox.boundary.xyzw)),e.uniform4fv(e.getUniformLocation(this.terrainShader,"terrainBox"),new Float32Array(this.boundaryCondition.boundary.xyzw)),e.uniformMatrix4fv(e.getUniformLocation(this.terrainShader,"uMatrix"),!1,this.map.relativeEyeMatrix),this.asLine?e.drawArraysInstanced(e.LINES,0,this.indexNum/3*6,this.nodeCount):e.drawArraysInstanced(e.TRIANGLES,0,this.indexNum,this.nodeCount),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.useProgram(this.showShader),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.layerTexture),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.paletteTexture),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.layerDepthTexture),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.normalTexture),e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.lodMapTexture),e.uniform1i(e.getUniformLocation(this.showShader,"srcTexture"),0),e.uniform1i(e.getUniformLocation(this.showShader,"paletteTexture"),1),e.uniform1i(e.getUniformLocation(this.showShader,"depthTexture"),2),e.uniform1i(e.getUniformLocation(this.showShader,"normalTexture"),3),e.uniform1i(e.getUniformLocation(this.showShader,"lodMapTexture"),4),e.uniform1f(e.getUniformLocation(this.showShader,"interval"),this.interval),e.uniform1f(e.getUniformLocation(this.showShader,"asLine"),this.asLine?1:0),e.uniform1f(e.getUniformLocation(this.showShader,"maxMipLevel"),this.layerTextureMaxMipLevel),e.uniform2fv(e.getUniformLocation(this.showShader,"e"),new Float32Array(this.elevationRange)),e.uniform3fv(e.getUniformLocation(this.showShader,"contourColor"),new Float32Array(this.color)),e.drawArrays(e.TRIANGLE_STRIP,0,4);const t=e.getError();t!==e.NO_ERROR&&console.error("Error happened: ",oa(e,t))}registerRenderableNode(e){this.tileBox.reset(),this.sectorRange.fill(0),this.nodeCount=0,this.maxVisibleNodeLevel=0,this.minVisibleNodeLevel=this.maxLevel;const r=[],s=[];for(r.push(new Xe(0,0)),r.push(new Xe(0,1));r.length>0;){let t=r.pop();if(t.bBox.overlap(this.boundaryCondition)){if(!t.isSubdividable(e)||t.level>=Math.min(this.maxLevel,e.zoomLevel)){s.push(t),t.level>this.maxVisibleNodeLevel&&(this.sectorRange[0]=t.bBox.size[0],this.sectorRange[1]=t.bBox.size[1],this.maxVisibleNodeLevel=t.level);continue}for(let n=0;n<4;n++)t.children[n]=new Xe(t.level+1,4*t.id+n,t),r.push(t.children[n])}}s.forEach(t=>{(this.nodeCount<this.maxNodeCount||t.level+5>=this.maxVisibleNodeLevel)&&(this.minVisibleNodeLevel=t.level<this.minVisibleNodeLevel?t.level:this.minVisibleNodeLevel,this.tileBox.updateByBox(t.bBox),this.nodeLevelArray[this.nodeCount]=t.level,this.nodeBoxArray[this.nodeCount*4+0]=t.bBox.boundary.x,this.nodeBoxArray[this.nodeCount*4+1]=t.bBox.boundary.y,this.nodeBoxArray[this.nodeCount*4+2]=t.bBox.boundary.z,this.nodeBoxArray[this.nodeCount*4+3]=t.bBox.boundary.w,this.nodeCount++),t.release()})}}function ra(a){a.getSupportedExtensions().forEach(r=>{a.getExtension(r),console.log("Enabled extensions: ",r)})}async function de(a,e){let r="";await g.get(e).then(o=>r+=o.data);const s=h(a,r,a.VERTEX_SHADER),t=h(a,r,a.FRAGMENT_SHADER),n=a.createProgram();return a.attachShader(n,s),a.attachShader(n,t),a.linkProgram(n),a.getProgramParameter(n,a.LINK_STATUS)||console.error("An error occurred linking shader stages: "+a.getProgramInfoLog(n)),n;function h(o,v,T){const A=`#version 300 es
`,_=o.createShader(T);return T===o.VERTEX_SHADER?v=A+`#define VERTEX_SHADER
`+v:T===o.FRAGMENT_SHADER&&(v=A+`#define FRAGMENT_SHADER
`+v),o.shaderSource(_,v),o.compileShader(_),o.getShaderParameter(_,o.COMPILE_STATUS)?_:(console.error("An error occurred compiling the shader module: "+o.getShaderInfoLog(_)),o.deleteShader(_),null)}}function De(a,e,r,s){const t=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,t),e?.forEach((n,h)=>{a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+h,a.TEXTURE_2D,n,0)}),r&&a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,r,0),a.bindFramebuffer(a.FRAMEBUFFER,null),a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is not complete"),t}function k(a,e,r,s,t,n,h,o=!1){const v=a.createTexture();return a.bindTexture(a.TEXTURE_2D,v),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,o?a.LINEAR_MIPMAP_LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,s,e,r,0,t,n,h||null),a.bindTexture(a.TEXTURE_2D,null),v}function ht(a,e,r,s,t,n,h,o){a.bindTexture(a.TEXTURE_2D,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,t,r,s,0,n,h,o),a.bindTexture(a.TEXTURE_2D,null)}function ia(a,e,r){const s=e||a.canvas.width*window.devicePixelRatio,t=r||a.canvas.height*window.devicePixelRatio,n=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,n),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,s,t),a.bindRenderbuffer(a.RENDERBUFFER,null),n}function oa(a,e){switch(e){case a.NO_ERROR:return"NO_ERROR";case a.INVALID_ENUM:return"INVALID_ENUM";case a.INVALID_VALUE:return"INVALID_VALUE";case a.INVALID_OPERATION:return"INVALID_OPERATION";case a.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case a.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"UNKNOWN_ERROR"}}async function ft(a){try{const e=await fetch(a);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=await e.blob();return await createImageBitmap(r,{imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"default"})}catch(e){throw console.error(`Error loading image (url: ${a})`,e),e}}function sa(a,e){return Math.floor(Math.log2(Math.max(a,e)))}const na="/down_triangle.png",la="/rasterLegend1.png",H=g.create({baseURL:"/api"});class Q{static runProfileModelTest=e=>{const r=`/taskNode/start/multi/default/section/${e-1}`;return H.post(r)};static getProfileDataTest=e=>{const r=e<10?`/fileData/json/jsonStr/name/multiWholeRes-JC0${e}/newest`:`/fileData/json/jsonStr/name/multiWholeRes-JC${e}/newest`;return H.get(r)};static runProfileModel_short=(e,r,s)=>{const t=`/taskNode/start/multi/default/section/${s-1}/beg/${e}/end/${r}`;return H.post(t)};static runProfileModel_long=(e,r,s)=>{const t=`/taskNode/start/multi/default/section/long/${s-1}/beg/${e}/end/${r}`;return H.post(t)};static getProfileData=(e,r,s)=>{const t=s<10?`/fileData/json/jsonStr/name/multiWholeRes-JC0${s}_beg${e}_end${r}/newest`:`/fileData/json/jsonStr/name/multiWholeRes-JC${s}_beg${e}_end${r}/newest`;return H.get(t)};static runProfileModelByLine=(e,r,s,t,n,h)=>{const o=`/taskNode/start/multi/default?begTime=${e}&endTime=${r}&startPt=${s},${t}&endPt=${n},${h}`;return H.post(o)};static getRunStatus=e=>{const r="/taskNode/"+e+"/status";return H.get(r)};static getRunResult=e=>{const r="/fileData/json/jsonStr/id/"+e;return H.get(r)}}const ua={class:"timestep-shower"},ca={class:"percentage-value"},da=Ht({__name:"flowTimeShower",props:{timeStep:Number,totalCount:Number,type:String},setup(a){const e=a,r=Fe(()=>Math.ceil(e.timeStep/e.totalCount*100)),s=Fe(()=>{if(e.type=="normal"){let t=Be().startOf("day"),n=e.timeStep/6;return t.add(n,"hour").format("YYYY/MM/DD HH")}else if(e.type=="9711"){let t=Be("1997-08-16").startOf("day"),n=e.timeStep*6;return t.add(n,"hour").format("YYYY/MM/DD HH")}else if(e.type=="9711adwt"){let t=Be("1997-08-12").startOf("day"),n=e.timeStep*1;return t.add(n,"hour").format("YYYY/MM/DD HH")}else if(e.type=="exp"){let t=Be().startOf("day").subtract(1,"day"),n=Math.floor(e.timeStep)*1;return t.add(n,"hour").format("YYYY/MM/DD HH")}});return Fe(()=>s.value.split(" ")[1]),Fe(()=>s.value.split(" ")[0]),vt(()=>{}),(t,n)=>{const h=he("el-progress");return E(),N("div",ua,[U(h,{type:"dashboard",percentage:r.value},{default:X(({percentage:o})=>[d("span",ca,ve(Math.floor(e.timeStep)+"时"),1)]),_:1},8,["percentage"])])}}}),ha=xt(da,[["__scopeId","data-v-93ae3e93"]]);class fa{constructor(){this.lineNum=3e4,this.segmentNum=8,this.fullLife=this.segmentNum*10,this.progressRate=0,this.speedFactor=2,this.dropRate=.01,this.dropRateBump=.005,this.fillWidth=2,this.aaWidth=3,this.colorScheme=0,this.isUnsteady=!0,this.content="none",this.primitive=0,this.platform="mapbox no worker"}}class ma{constructor(e){this.url="",this.flowFieldResourceArr=[],this.seedingResourceArr=[],this.projection2DResource="",this.projection3DResource="",this.flowFieldTexSize=[0,0],this.seedingTexSize=[0,0],this.projectionTexSize=[0,0],this.flowBoundary=[0,0,0,0],this.extent=[0,0,0,0],this.maxDropRate=0,this.maxDropRateBump=0,this.maxSegmentNum=0,this.maxTrajectoryNum=0,this.maxTextureSize=0,this.url=e}async Parsing(){await g.get(this.url).then(e=>{console.log("reponse::"+e);for(let r of e.data.flow_fields)this.flowFieldResourceArr.push(r);for(let r of e.data.area_masks)this.seedingResourceArr.push(r);this.projection2DResource=e.data.projection["2D"],this.flowFieldTexSize=e.data.texture_size.flow_field,this.seedingTexSize=e.data.texture_size.area_mask,this.projectionTexSize=e.data.texture_size.projection,this.flowBoundary[0]=e.data.flow_boundary.u_min,this.flowBoundary[1]=e.data.flow_boundary.v_min,this.flowBoundary[2]=e.data.flow_boundary.u_max,this.flowBoundary[3]=e.data.flow_boundary.v_max,this.extent[0]=e.data.extent[0],this.extent[1]=e.data.extent[1],this.extent[2]=e.data.extent[2],this.extent[3]=e.data.extent[3],this.maxDropRate=e.data.constraints.max_drop_rate,this.maxDropRateBump=e.data.constraints.max_drop_rate_bump,this.maxSegmentNum=e.data.constraints.max_segment_num,this.maxTrajectoryNum=e.data.constraints.max_streamline_num,this.maxTextureSize=e.data.constraints.max_texture_size})}}class mt{constructor(e,r,s){this.map=null,this.GL=null,this.uboMapBufferData=new Float32Array(12),this.phaseCount=0,this.timePerFrame=150,this.timeLast=10,this.currentResourcePointer=0,this._timeCount=0,this._progressRate=0,this.textureArraySize=0,this.flowFieldTextureArr=[0,0,0],this.seedingTextureArr=[0,0,0],this.transformTexture=0,this.particleMapBufferData=new Float32Array(0),this.simulationBuffer=0,this.xfSimulationBuffer=0,this.lifeBuffer=0,this.xfLifeBuffer=0,this.BO=0,this.simulationVAO=0,this.simulationVAO2=0,this.XFO=0,this.XFO2=0,this.trajectoryPool=0,this.isReady=!1,this.renderVAO=0,this.renderVAO2=0,this.textureOffsetArray=[],this.beginBlock=-1,this.now_FFTextureArr=[0,0],this.now_SeedTextureArr=[0,0],this.now_sVAO=0,this.now_rVAO=0,this.now_XFO=0,this.now_XFBO=0,this.id=e,this.type="custom",this.renderingMode="2d",this.parser=new ma(r),this.resourcePrefix=s,this.controller=new fa}set progressRate(e){const r=Math.floor(this._progressRate*this.phaseCount)%this.phaseCount,s=Math.floor(e*this.phaseCount)%this.phaseCount,t=(s+1)%this.phaseCount;this._progressRate=e,this.now_FFTextureArr[0]=this.flowFieldTextureArr[s%this.textureArraySize],this.now_FFTextureArr[1]=this.flowFieldTextureArr[t%this.textureArraySize],this.now_SeedTextureArr[0]=this.seedingTextureArr[s%this.textureArraySize],this.now_SeedTextureArr[1]=this.seedingTextureArr[t%this.textureArraySize];let n=e*this.phaseCount;if(this.uboMapBufferData[0]=n-Math.floor(n),s!=r){this.currentResourcePointer=(this.currentResourcePointer+1)%this.phaseCount,console.log("now time step :: ",this.currentResourcePointer);let h=t%this.textureArraySize,o=this.GL;this.UpdateTextureByImage(o,this.flowFieldTextureArr[h],o.RG,o.LINEAR,this.parser.flowFieldTexSize[0],this.parser.flowFieldTexSize[1],this.parser.flowFieldResourceArr[t],"Float"),this.UpdateTextureByImage(o,this.seedingTextureArr[h],o.RGBA,o.NEAREST,this.parser.seedingTexSize[0],this.parser.seedingTexSize[1],this.parser.seedingResourceArr[t],"UNSIGHNED_BYTE")}}get progressRate(){return this._progressRate}set timeCount(e){this._timeCount=e%this.timeLast}get timeCount(){return this._timeCount}async init2ShadersFromSrc(e,r,s,t){const n=await g.get(r).then(A=>A.data).catch(A=>{console.log("ERROR::VERTEX_SHADER FILE NOT FOUND",A)}),h=await g.get(s).then(A=>A.data).catch(A=>{console.log("ERROR::FRAGMENT_SHADER FILE NOT FOUND",A)}),o=e.createShader(e.VERTEX_SHADER);e.shaderSource(o,n),e.compileShader(o);const v=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(v,h),e.compileShader(v);const T=e.createProgram();if(e.attachShader(T,o),e.attachShader(T,v),t&&e.transformFeedbackVaryings(T,t,e.SEPARATE_ATTRIBS),e.linkProgram(T),!e.getProgramParameter(T,e.LINK_STATUS)){console.log(e.getProgramInfoLog(T));return}return{program:T,vertexShader:o,fragmentShader:v}}async FillTextureByImage(e,r,s,t,n,h,o,v){let T=this.resourcePrefix+o;v==="Float"?g.get(T,{responseType:"blob"}).then(A=>{createImageBitmap(A.data,{imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"default"}).then(_=>{const C=new Uint8Array(_.width*_.height*4),c=new OffscreenCanvas(_.width,_.height).getContext("webgl2"),b=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,b);const L=c.createTexture();c.bindTexture(c.TEXTURE_2D,L),c.texImage2D(c.TEXTURE_2D,0,c.RGBA8,_.width,_.height,0,c.RGBA,c.UNSIGNED_BYTE,_),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,L,0),c.readPixels(0,0,_.width,_.height,c.RGBA,c.UNSIGNED_BYTE,C),c.bindTexture(c.TEXTURE_2D,null),c.bindFramebuffer(c.FRAMEBUFFER,null),c.deleteTexture(L),c.deleteFramebuffer(b),c.finish(),e.bindTexture(e.TEXTURE_2D,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,h,e.RG,e.FLOAT,new Float32Array(C.buffer)),e.bindTexture(e.TEXTURE_2D,null),e.finish()})}):await g.get(T,{responseType:"blob"}).then(A=>{createImageBitmap(A.data,{imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"default"}).then(_=>{e.bindTexture(e.TEXTURE_2D,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,h,s,e.UNSIGNED_BYTE,_),e.bindTexture(e.TEXTURE_2D,null),e.finish()})})}async UpdateTextureByImage(e,r,s,t,n,h,o,v){await this.FillTextureByImage(e,r,s,t,n,h,o,v)}FillBlockByData(e,r,s,t,n,h,o){e.bindTexture(e.TEXTURE_2D,r),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texSubImage2D(e.TEXTURE_2D,0,s,t,n,h,e.RGB,e.FLOAT,o),e.bindTexture(e.TEXTURE_2D,null)}swap(){this.beginBlock%2==0?(this.now_sVAO=this.simulationVAO,this.now_rVAO=this.renderVAO,this.now_XFO=this.XFO,this.now_XFBO=this.simulationBuffer):(this.now_sVAO=this.simulationVAO2,this.now_rVAO=this.renderVAO2,this.now_XFO=this.XFO2,this.now_XFBO=this.xfSimulationBuffer)}async prepare(e){await this.parser.Parsing();const r=e.getSupportedExtensions();for(let o of r)e.getExtension(o);console.log(this.parser),this.parser.trajectoryNum=this.controller.lineNum,this.parser.segmentPrepare=this.parser.maxSegmentNum,this.parser.segmentNum=this.parser.maxSegmentNum,this.parser.maxBlockSize=Math.ceil(Math.sqrt(this.parser.maxTrajectoryNum)),this.phaseCount=this.parser.flowFieldResourceArr.length,this.timeLast=this.phaseCount*this.timePerFrame,this.textureArraySize=3;for(var s=0;s<this.textureArraySize;s++){let o=e.createTexture();e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG32F,this.parser.flowFieldTexSize[0],this.parser.flowFieldTexSize[1]),e.bindTexture(e.TEXTURE_2D,null),await this.FillTextureByImage(e,o,e.RG,e.LINEAR,this.parser.flowFieldTexSize[0],this.parser.flowFieldTexSize[1],this.parser.flowFieldResourceArr[s],"Float"),this.flowFieldTextureArr[s]=o;let v=e.createTexture();e.bindTexture(e.TEXTURE_2D,v),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8,this.parser.seedingTexSize[0],this.parser.seedingTexSize[1]),e.bindTexture(e.TEXTURE_2D,null),await this.FillTextureByImage(e,v,e.RGBA,e.NEAREST,this.parser.seedingTexSize[0],this.parser.seedingTexSize[1],this.parser.seedingResourceArr[s],"UNSIGNED_BYTE"),this.seedingTextureArr[s]=v}let t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texStorage2D(e.TEXTURE_2D,1,e.RG32F,this.parser.projectionTexSize[0],this.parser.projectionTexSize[1]),e.bindTexture(e.TEXTURE_2D,null),await this.FillTextureByImage(e,t,e.RG,e.LINEAR,this.parser.projectionTexSize[0],this.parser.projectionTexSize[1],this.parser.projection2DResource,"Float"),this.transformTexture=t,this.particleMapBufferData=new Float32Array(this.parser.maxBlockSize*this.parser.maxBlockSize*3).fill(0);for(let o=0;o<this.parser.maxTrajectoryNum;o++)this.particleMapBufferData[o*3+0]=Math.random(),this.particleMapBufferData[o*3+1]=Math.random(),this.particleMapBufferData[o*3+2]=0;const n=new Float32Array(this.parser.maxTrajectoryNum);for(let o=0;o<this.parser.maxTrajectoryNum;o++)n[o]=this.parser.maxSegmentNum*9;this.simulationBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.simulationBuffer),e.bufferData(e.ARRAY_BUFFER,this.particleMapBufferData,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.xfSimulationBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.xfSimulationBuffer),e.bufferData(e.ARRAY_BUFFER,this.particleMapBufferData,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.lifeBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.lifeBuffer),e.bufferData(e.ARRAY_BUFFER,n,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.xfLifeBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.xfLifeBuffer),e.bufferData(e.ARRAY_BUFFER,n,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.simulationVAO=e.createVertexArray(),e.bindVertexArray(this.simulationVAO),e.bindBuffer(e.ARRAY_BUFFER,this.simulationBuffer),e.vertexAttribPointer(0,3,e.FLOAT,!1,3*4,0),e.enableVertexAttribArray(0),e.bindBuffer(e.ARRAY_BUFFER,this.lifeBuffer),e.vertexAttribPointer(1,1,e.FLOAT,!1,1*4,0),e.enableVertexAttribArray(1),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),this.simulationVAO2=e.createVertexArray(),e.bindVertexArray(this.simulationVAO2),e.bindBuffer(e.ARRAY_BUFFER,this.xfSimulationBuffer),e.vertexAttribPointer(0,3,e.FLOAT,!1,3*4,0),e.enableVertexAttribArray(0),e.bindBuffer(e.ARRAY_BUFFER,this.xfLifeBuffer),e.vertexAttribPointer(1,1,e.FLOAT,!1,1*4,0),e.enableVertexAttribArray(1),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),this.renderVAO=e.createVertexArray(),e.bindVertexArray(this.renderVAO),e.bindBuffer(e.ARRAY_BUFFER,this.lifeBuffer),e.vertexAttribPointer(0,1,e.FLOAT,!1,1*4,0),e.vertexAttribDivisor(0,1),e.enableVertexAttribArray(0),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),this.renderVAO2=e.createVertexArray(),e.bindVertexArray(this.renderVAO2),e.bindBuffer(e.ARRAY_BUFFER,this.xfLifeBuffer),e.vertexAttribPointer(0,1,e.FLOAT,!1,1*4,0),e.vertexAttribDivisor(0,1),e.enableVertexAttribArray(0),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),this.XFO=e.createTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.XFO),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.xfSimulationBuffer),e.bindBufferRange(e.TRANSFORM_FEEDBACK_BUFFER,0,this.xfSimulationBuffer,0,this.parser.maxBlockSize*this.parser.maxBlockSize*4*3),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.xfLifeBuffer),e.bindBufferRange(e.TRANSFORM_FEEDBACK_BUFFER,1,this.xfLifeBuffer,0,this.parser.maxBlockSize*this.parser.maxBlockSize*4),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,null),this.XFO2=e.createTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.XFO2),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.simulationBuffer),e.bindBufferRange(e.TRANSFORM_FEEDBACK_BUFFER,0,this.simulationBuffer,0,this.parser.maxBlockSize*this.parser.maxBlockSize*3*4),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.lifeBuffer),e.bindBufferRange(e.TRANSFORM_FEEDBACK_BUFFER,1,this.lifeBuffer,0,this.parser.maxBlockSize*this.parser.maxBlockSize*4),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,null),this.parser.maxBlockSize=Math.ceil(Math.sqrt(this.parser.maxTrajectoryNum)),this.parser.maxBlockColumn=Math.floor(this.parser.maxTextureSize/this.parser.maxBlockSize);for(let o=0;o<this.parser.maxSegmentNum;o++){let v={offsetX:this.parser.maxBlockSize*(o%this.parser.maxBlockColumn),offsetY:this.parser.maxBlockSize*Math.floor(o/this.parser.maxBlockColumn)};this.textureOffsetArray.push(v)}this.BO=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.BO),e.bufferData(e.ARRAY_BUFFER,48,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.trajectoryPool=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.trajectoryPool),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,this.parser.maxTextureSize,this.parser.maxTextureSize),e.bindTexture(e.TEXTURE_2D,null);for(let o=0;o<this.parser.maxSegmentNum;o++)this.FillBlockByData(e,this.trajectoryPool,this.textureOffsetArray[o].offsetX,this.textureOffsetArray[o].offsetY,this.parser.maxBlockSize,this.parser.maxBlockSize,this.particleMapBufferData);let h=["newInfo","aliveTime"];this.updateShaderObj=await this.init2ShadersFromSrc(e,"/scratchSomething/flowWebGL/shaders/update.vert","/scratchSomething/flowWebGL/shaders/update.frag",h),this.trajectoryShaderObj=await this.init2ShadersFromSrc(e,"/scratchSomething/flowWebGL/shaders/trajectory.noCulling.vert","/scratchSomething/flowWebGL/shaders/trajectory.noCulling.frag"),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,null),e.bindVertexArray(null),this.uboMapBufferData[8]=this.parser.flowBoundary[0],this.uboMapBufferData[9]=this.parser.flowBoundary[1],this.uboMapBufferData[10]=this.parser.flowBoundary[2],this.uboMapBufferData[11]=this.parser.flowBoundary[3],this.isReady=!0}tickfunc(e,r){this.beginBlock=(this.beginBlock+1)%this.parser.segmentNum,this.swap(),this.controller.isUnsteady&&(this.progressRate=this.timeCount/this.timeLast,this.timeCount=this.timeCount+1),this.uboMapBufferData[1]=this.parser.maxSegmentNum,this.uboMapBufferData[2]=this.parser.maxSegmentNum*10,this.uboMapBufferData[3]=this.controller.dropRate,this.uboMapBufferData[4]=this.controller.dropRateBump,this.uboMapBufferData[5]=this.controller.speedFactor*.01*100,this.uboMapBufferData[6]=this.controller.colorScheme,e.bindBuffer(e.UNIFORM_BUFFER,this.BO),e.bufferData(e.UNIFORM_BUFFER,this.uboMapBufferData,e.DYNAMIC_DRAW);let s=0;e.bindBufferRange(e.UNIFORM_BUFFER,s,this.BO,0,48),e.bindVertexArray(this.now_sVAO),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.now_XFO),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.now_FFTextureArr[0]),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.now_FFTextureArr[1]),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.now_SeedTextureArr[0]),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.now_SeedTextureArr[1]),e.useProgram(this.updateShaderObj.program);let t=null;t=e.getUniformLocation(this.updateShaderObj.program,"flowField"),e.uniform1iv(t,[0,1]),t=e.getUniformLocation(this.updateShaderObj.program,"mask"),e.uniform1iv(t,[2,3]),t=e.getUniformLocation(this.updateShaderObj.program,"randomSeed"),e.uniform1f(t,Math.random());let n=0;if(n=e.getUniformBlockIndex(this.updateShaderObj.program,"FlowFieldUniforms"),e.uniformBlockBinding(this.updateShaderObj.program,n,s),e.enable(e.RASTERIZER_DISCARD),e.beginTransformFeedback(e.POINTS),e.drawArrays(e.POINTS,0,this.parser.trajectoryNum),e.endTransformFeedback(),e.disable(e.RASTERIZER_DISCARD),e.bindVertexArray(null),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,this.now_XFBO),e.bindTexture(e.TEXTURE_2D,this.trajectoryPool),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texSubImage2D(e.TEXTURE_2D,0,this.textureOffsetArray[this.beginBlock].offsetX,this.textureOffsetArray[this.beginBlock].offsetY,this.parser.maxBlockSize,this.parser.maxBlockSize,e.RGB,e.FLOAT,0),e.bindTexture(e.TEXTURE_2D,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null),e.finish(),this.parser.segmentPrepare>0){this.parser.segmentPrepare--;return}e.bindVertexArray(this.now_rVAO),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.trajectoryPool),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.transformTexture),e.disable(e.DEPTH_TEST),e.useProgram(this.trajectoryShaderObj.program),t=e.getUniformLocation(this.trajectoryShaderObj.program,"particlePool"),e.uniform1i(t,0),t=e.getUniformLocation(this.trajectoryShaderObj.program,"projectionTexture"),e.uniform1i(t,1),t=e.getUniformLocation(this.trajectoryShaderObj.program,"blockNum"),e.uniform1i(t,this.parser.maxSegmentNum),t=e.getUniformLocation(this.trajectoryShaderObj.program,"beginBlock"),e.uniform1i(t,this.beginBlock),t=e.getUniformLocation(this.trajectoryShaderObj.program,"blockSize"),e.uniform1i(t,this.parser.maxBlockSize),t=e.getUniformLocation(this.trajectoryShaderObj.program,"fillWidth"),e.uniform1f(t,this.controller.fillWidth),t=e.getUniformLocation(this.trajectoryShaderObj.program,"aaWidth"),e.uniform1f(t,this.controller.aaWidth),t=e.getUniformLocation(this.trajectoryShaderObj.program,"viewport"),e.uniform2f(t,e.canvas.width,e.canvas.height),t=e.getUniformLocation(this.trajectoryShaderObj.program,"u_matrix"),e.uniformMatrix4fv(t,!1,r),n=e.getUniformBlockIndex(this.trajectoryShaderObj.program,"FlowFieldUniforms"),e.uniformBlockBinding(this.trajectoryShaderObj.program,n,s),e.drawArraysInstanced(e.TRIANGLE_STRIP,0,(this.parser.segmentNum-1)*2,this.parser.trajectoryNum),e.bindVertexArray(null),e.bindTexture(e.TEXTURE_2D,null)}async onAdd(e,r){this.GL=r,this.map=e,await this.prepare(r)}render(e,r){if(!this.isReady){this.map?.triggerRepaint();return}this.tickfunc(e,r),this.map?.triggerRepaint()}}class pa{constructor(e){this.id="岸段预警",this.jsonData=e,this.map=void 0,this.type="custom",this.showLayer=!1,this.prepared=!1,console.log("contruictasd12312",this.jsonData)}async onAdd(e,r){this.map=e,this.vertexData=[],this.warnValues=[],this.vertexCount=0,this.jsonData.forEach(o=>{let v=lt.MercatorCoordinate.fromLngLat({lng:o.coords[0][0],lat:o.coords[0][1]}),T=lt.MercatorCoordinate.fromLngLat({lng:o.coords[1][0],lat:o.coords[1][1]});this.vertexData.push(v.x,v.y,o.warnValue,T.x,T.y,o.warnValue),this.vertexCount+=2});const s=`
        uniform mat4 u_matrix;
        attribute vec3 a_position; 
        varying float v_warnValue; 

        void main() {
            v_warnValue = a_position.z; 
            gl_Position = u_matrix * vec4(a_position.x, a_position.y, 0.0, 1.0);
        }`,t=`
        precision mediump float;
        varying float v_warnValue; 

        void main() {
            // int pallete[10] = {
            //     0x00b0f0,
            //     0x76a9c8,
            //     0xa69f9f,
            //     0xcc9071,
            //     0xed7c31,
            //     0xf06f24,
            //     0xf46018,
            //     0xf84e0d,
            //     0xfb3704,
            //     0xff0000,
            // }
            // int pallete[3] = {
            //     0x00b0f0,
            //     0x76a9c8,
            //     0xff0000,
            // }
            // int botIndex = floor(v_warnValue * 2);
            // int topIndex = floor(v_warnValue * 2 + 0.5);
            // int interval = value * 10.0 - botIndex;

            // vec3 botColor = colorFromInt(rampColors[botIndex]);
            // vec3 topColor = colorFromInt(rampColors[botIndex+1]);
            // vec3 topColor = colorFromInt(rampColors[topIndex]);
            // vec3 resultColor = mix(botColor, topColor, interval);

            // vec3 green = vec3(0.0, 1.0, 0.0);
            vec3 blue = vec3(0.0, 0.0, 1.0);
            vec3 orange = vec3(240.0, 120.0, 0.0) / 255.0;
            vec3 red = vec3(1.0, 0.0, 0.0);
            float v_warnValueP = clamp(v_warnValue*1.4, 0.0, 1.0);


            vec3 greenToBlue = mix(blue, orange, smoothstep(0.0, 0.5, v_warnValueP));
            // Interpolate between blue and red from 0.5 to 1.0
            vec3 blueToRed = mix(orange, red, smoothstep(0.5, 1.0, v_warnValueP));
            // Combine the two interpolations
            vec3 color = mix(greenToBlue, blueToRed, smoothstep(0.0, 1.0, v_warnValueP));

            // gl_FragColor  = vec4(v_warnValueP, 0, 1.0-v_warnValueP, 0.85); // 使用 fragColor 代替 gl_FragColor
            gl_FragColor  = vec4(color, 0.85); // 使用 fragColor 代替 gl_FragColor
        }`,n=r.createShader(r.VERTEX_SHADER);r.shaderSource(n,s),r.compileShader(n);const h=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(h,t),r.compileShader(h),this.program=r.createProgram(),r.attachShader(this.program,n),r.attachShader(this.program,h),r.linkProgram(this.program),this.aPos=r.getAttribLocation(this.program,"a_position"),console.log(this.aPos),this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.vertexData),r.STATIC_DRAW),this.prepared=!0}async render(e,r){this.prepared&&(e.useProgram(this.program),e.uniformMatrix4fv(e.getUniformLocation(this.program,"u_matrix"),!1,r),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(this.aPos),e.vertexAttribPointer(this.aPos,3,e.FLOAT,!1,0,0),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,0,this.vertexCount))}show(){}hide(){}}const pt={20092003:{min:-20.216260910034,max:12.377036094666},21032003:{min:-18.057029724121,max:13.405656814575},21032009:{min:-11.904377937317,max:15.555559158325},21092003:{min:-29.0481300354,max:13.405656814575},21092009:{min:-21.573017120361,max:13.338559150696},21092103:{min:-22.064949035645,max:8.261926651001},22032003:{min:-26.315940856934,max:12.661833763123},22032009:{min:-18.946474075317,max:10.854301452637},22032103:{min:-18.682374954224,max:11.998920440674},22032109:{min:-18.682374954224,max:17.446615219116},22092003:{min:-34.24059677124,max:18.287557601929},22092009:{min:-28.642517089844,max:18.124055862427},22092103:{min:-28.885349273682,max:17.996383666992},22092109:{min:-20.775089263916,max:19.373840332031},22092203:{min:-20.959928512573,max:17.246448516846},23032003:{min:-25.497043609619,max:23.978927612305},23032009:{min:-15.159237861633,max:24.311046600342},23032103:{min:-16.9319896698,max:24.412498474121},23032109:{min:-11.673976898193,max:24.870639801025},23032203:{min:-10.602119445801,max:19.81965637207},23032209:{min:-10.008462905884,max:21.046541213989},23092003:{min:-24.543750762939,max:23.484636306763},23092009:{min:-14.633073806763,max:23.901466369629},23092103:{min:-15.942059516907,max:23.92653465271},23092109:{min:-12.148267745972,max:24.699771881104},23092203:{min:-11.635368347168,max:19.993438720703},23092209:{min:-11.635368347168,max:26.141702651978},23092303:{min:-11.635368347168,max:16.081762313843}},je=[{name:"JC01",coords:[[120.49989610501109,32.044845778820694],[120.49965852902085,32.043054010465546]],warnValue:.49},{name:"JC02",coords:[[120.51211644811006,32.04310480824947],[120.51157809855385,32.04135665004222]],warnValue:.59},{name:"JC03",coords:[[120.51598399026375,32.04244111945512],[120.51554162835052,32.04064910386879]],warnValue:.64},{name:"JC04",coords:[[120.52163733002358,32.040317481106044],[120.52010747944439,32.03901766791365]],warnValue:.67},{name:"JC05",coords:[[120.52344753736321,32.03912224359854],[120.52202732882418,32.037765786589944]],warnValue:.76},{name:"JC06",coords:[[120.5300568728269,32.035076196597906],[120.52886185568613,32.03359585101801]],warnValue:.83},{name:"JC07",coords:[[120.53577029390934,32.03306474923213],[120.53521759568126,32.03132371065091]],warnValue:.9},{name:"JC08",coords:[[120.54259039936055,32.03113531223312],[120.54191211481913,32.0294311450221]],warnValue:.73},{name:"JC09",coords:[[120.54845619793755,32.02942703528161],[120.547645906125,32.027757714058616]],warnValue:.53},{name:"JC10",coords:[[120.55217332294447,32.02819103999115],[120.55139957273384,32.02651468780271]],warnValue:.43},{name:"JC11",coords:[[120.55987007042168,32.0256085153387],[120.55938372124096,32.02385317986381]],warnValue:.29},{name:"JC12",coords:[[120.56542283954619,32.023997421425335],[120.56490201809913,32.022254233310434]],warnValue:.18}],va=[{value:1,id:"JC01",label:"MZ01围堤",name:"MZ01围堤",nickname:"围堤",filter:["==","name","JC01"],flowspeed:null,risk:null,color:null},{value:2,id:"JC02",label:"MZ02顺堤",name:"MZ02顺堤",nickname:"顺堤",filter:["==","name","JC02"],flowspeed:null,risk:null,color:null},{value:3,id:"JC03",label:"MZ03顺堤尾",name:"MZ03顺堤尾",nickname:"顺堤尾",filter:["==","name","JC03"],flowspeed:null,risk:null,color:null},{value:4,id:"JC04",label:"MZ04江滩办",name:"MZ04江滩办",nickname:"江滩办",filter:["==","name","JC04"],flowspeed:null,risk:null,color:null},{value:5,id:"JC05",label:"MZ05小港池",name:"MZ05小港池",nickname:"小港池",filter:["==","name","JC05"],flowspeed:null,risk:null,color:null},{value:6,id:"JC06",label:"MZ06张靖皋桥位",name:"MZ06张靖皋桥位",nickname:"张靖皋桥位",filter:["==","name","JC06"],flowspeed:null,risk:null,color:null},{value:7,id:"JC07",label:"MZ07桥位下游",name:"MZ07桥位下游",nickname:"桥位下游",filter:["==","name","JC07"],flowspeed:null,risk:null,color:null},{value:8,id:"JC08",label:"MZ08海事码头",name:"MZ08海事码头",nickname:"海事码头",filter:["==","name","JC08"],flowspeed:null,risk:null,color:null},{value:9,id:"JC09",label:"MZ09码头下游",name:"MZ09码头下游",nickname:"码头下游",filter:["==","name","JC09"],flowspeed:null,risk:null,color:null},{value:10,id:"JC10",label:"MZ10雷达站",name:"MZ10雷达站",nickname:"雷达站",filter:["==","name","JC10"],flowspeed:null,risk:null,color:null},{value:11,id:"JC11",label:"MZ11主路",name:"MZ11主路",nickname:"主路",filter:["==","name","JC11"],flowspeed:null,risk:null,color:null},{value:12,id:"JC12",label:"MZ12沙尾",name:"MZ12沙尾",nickname:"沙尾",filter:["==","name","JC12"],flowspeed:null,risk:null,color:null}],xa=[{value:"1999before",name:"1999汛前地形数据",label:"1999汛前",year:"1999",time:"汛前",date:"1999-01-01",dateShort:"9901"},{value:"2012after",name:"2012汛后地形数据",label:"2012汛后",year:"2012",time:"汛后",date:"2012-10-01",dateShort:"1210"},{value:"2019before",name:"2019汛前地形数据",label:"2019汛前",year:"2019",time:"汛前",date:"2019-04-01",dateShort:"1904"},{value:"2023before1",name:"2023汛前地形数据",label:"2023汛前",year:"2023",time:"汛前",date:"2023-04-01",dateShort:"2304"},{value:"2020before",name:"2020汛前地形数据",label:"2020汛前",year:"2020",time:"汛前",date:"2020-03-01",dateShort:"2003"},{value:"2020before",name:"2020汛前地形数据",label:"2020汛前",year:"2020",time:"汛前",date:"2020-03-01",dateShort:"2003"},{value:"2020after",name:"2020汛后地形数据",label:"2020汛后",year:"2020",time:"汛后",date:"2020-09-01",dateShort:"2009"},{value:"2021before",name:"2021汛前地形数据",label:"2021汛前",year:"2021",time:"汛前",date:"2021-03-01",dateShort:"2103"},{value:"2021after",name:"2021汛后地形数据",label:"2021汛后",year:"2021",time:"汛后",date:"2021-09-01",dateShort:"2109"},{value:"2022before",name:"2022汛前地形数据",label:"2022汛前",year:"2022",time:"汛前",date:"2022-03-01",dateShort:"2203"},{value:"2022after",name:"2022汛后地形数据",label:"2022汛后",year:"2022",time:"汛后",date:"2022-09-01",dateShort:"2209"},{value:"2023before",name:"2023汛前地形数据",label:"2023汛前",year:"2023",time:"汛前",date:"2023-03-01",dateShort:"2303"},{value:"2023after",name:"2023汛后地形数据",label:"2023汛后",year:"2023",time:"汛后",date:"2023-09-01",dateShort:"2309"}],Ta=[{label:"水流动力因素",active:!1,children:[{label:"造床流量当量指标",icon:"/icons/行政区划.png",active:!1,filter:!0},{label:"流速指标",icon:"/icons/河道分段.png",active:!1,filter:!0},{label:"水位变幅指标",icon:"/icons/流域水系.png",active:!1,filter:!0}]},{label:"河床演变因素",active:!1,filter:!0,children:[{label:"岸坡最大坡比",icon:"/icons/江堤港堤.png",active:!1,filter:!0},{label:"近岸冲刷速率",icon:"/icons/长江堤防.png",active:!1,filter:!0},{label:"滩槽高程",icon:"/icons/过江通道.png",active:!1,filter:!0}]},{label:"岸坡地质因素",active:!1,filter:!0,children:[{label:"河岸组成粒径",icon:"/icons/岸段名录.png",active:!1,filter:!0},{label:"垂向分层结构",icon:"/icons/过江通道.png",active:!1,filter:!0}]},{label:"外部工程因素",active:!1,filter:!0,children:[{label:"护岸强度",icon:"/icons/岸段名录.png",active:!1,filter:!0},{label:"局部突加荷载",icon:"/icons/过江通道.png",active:!1,filter:!0}]}],F=a=>(Qt("data-v-c30a912f"),a=a(),gt(),a),Ra={class:"risk-warn-container"},_a=Tt('<canvas id="GPUFrame" data-v-c30a912f></canvas><div class="basic-info-container" data-v-c30a912f><div class="basic-info-content" data-v-c30a912f><div class="title-container" data-v-c30a912f>民主沙右缘示范段</div><div class="key-val-container" data-v-c30a912f><div class="key-text" data-v-c30a912f>预警级别：</div><div class="val-text" data-v-c30a912f>Ⅰ级</div></div><div class="key-val-container right" data-v-c30a912f><div class="key-text" data-v-c30a912f>岸段长度：</div><div class="val-text" data-v-c30a912f>全长7公里</div></div></div></div><div class="risk-item-title" data-v-c30a912f>崩岸风险因素分析</div>',3),ba={class:"risk-item-container"},Ea=F(()=>d("div",{class:"risk-item-text"},"水流动力",-1)),ya=F(()=>d("div",{class:"risk-item-text"},"河床演变",-1)),Sa=F(()=>d("div",{class:"risk-item-text"},"地质与工程治理",-1)),Aa={key:0,class:"raster-control-block"},wa={class:"switch"},Fa=["checked"],Ba=F(()=>d("span",{class:"slider"},null,-1)),La=F(()=>d("div",{class:"text-block"},[d("div",{class:"text"},"冲淤图展示")],-1)),Da={class:"bankLine-control-block"},Ua={class:"switch"},Ca=["checked"],Ma=F(()=>d("span",{class:"slider"},null,-1)),Pa=F(()=>d("div",{class:"text-block"},[d("div",{class:"text"},"岸段展示")],-1)),ka={class:"terrain-control-block"},Na={class:"switch"},Oa=["checked"],Ia=F(()=>d("span",{class:"slider"},null,-1)),za=F(()=>d("div",{class:"text-block"},[d("div",{class:"text"},"三维地形")],-1)),Va=Tt('<div class="risk-line-container" data-v-c30a912f><div class="risk-line-title" data-v-c30a912f>风险等级图例：</div><div class="risk-line" data-v-c30a912f></div><div class="risk-line-arrow high" data-v-c30a912f><img src="'+na+'" alt="图例标记" data-v-c30a912f></div><div class="risk-line-mark low" data-v-c30a912f>低风险</div><div class="risk-line-mark middle" data-v-c30a912f>中风险</div><div class="risk-line-mark high" data-v-c30a912f>高风险</div></div>',1),Xa={key:1,class:"warn-status-container"},ja=F(()=>d("div",{class:"warn-status-title"},"民主沙右缘风险评估结果",-1)),Ga=F(()=>d("div",{class:"warn-status-content high"},"高风险",-1)),Ya=[ja,Ga],Wa={key:2,class:"warn-detail-container high"},Ja={class:"warn-detail-profile"},Ha={class:"warn-detail-text"},$a=F(()=>d("span",{class:"warn-detail-span"},null,-1)),Za={class:"warn-detail-span"},Ka={key:8,style:{position:"absolute",top:"16.25vh",left:"0.3vw",width:"26vw",height:"23.5vh","z-index":"10"}},qa={key:10,class:"flow-control-block"},Qa={class:"switch",style:{transform:"rotateZ(90deg)"}},ga=["checked"],er=F(()=>d("span",{class:"slider"},null,-1)),tr=F(()=>d("div",{class:"text-block"},[d("div",{class:"text"},"流场展示")],-1)),ar={key:11,class:"time-shower-block"},rr={key:12,style:{position:"absolute",top:"66vh",left:"0.3vw",width:"26vw",height:"25vh","z-index":"10"}},ir={key:14,class:"drag riskResult"},or={key:15,class:"raster-legend-container"},sr=F(()=>d("img",{src:la,alt:"比例尺"},null,-1)),nr=[sr],lr=F(()=>d("span",null,"确认使用此断面进行计算",-1)),ur={class:"dialog-footer"},cr={style:{"text-align":"right"}},dr=F(()=>d("span",null,"确认使用以下年份地形数据进行计算：",-1)),hr={style:{position:"absolute",top:"6.5vh","font-weight":"bold"}},fr={style:{position:"absolute",top:"8.5vh","font-weight":"bold"}},mr={class:"dialog-footer"},pr={style:{"text-align":"right"}},vr={class:"loading-container"},xr={class:"loading-message"},Tr={__name:"BankRiskWarnView",setup(a){const e="http://127.0.0.1:8989/api/v1",r=u(-1),s=z(()=>V(()=>import("./riskResult-DB7jA26b.js"),__vite__mapDeps([0,1,2,3]))),t=z(()=>V(()=>import("./flowspeedInfo-DIXMdvhR.js"),__vite__mapDeps([4,1,2,5,6]))),n=z(()=>V(()=>import("./profileInfo-CdskzmHy.js"),__vite__mapDeps([7,5,1,2,8]))),h=z(()=>V(()=>import("./profileShapeYearly-CwKRmJod.js"),__vite__mapDeps([9,5,1,2,10]))),o=z(()=>V(()=>import("./profileShapeCompare-D2aN-U_j.js"),__vite__mapDeps([11,5,1,2,12]))),v=z(()=>V(()=>import("./profileSlope-DBX74rVE.js"),__vite__mapDeps([13,5,1,2,14]))),T=z(()=>V(()=>import("./profileErosion-BdjZOcpD.js"),__vite__mapDeps([15,5,1,2,16]))),A=z(()=>V(()=>import("./BedFlowChart-Bp2CwgH0.js"),__vite__mapDeps([17,1,2,18]))),_=z(()=>V(()=>import("./WaterProcessChart-B8fjX0hN.js"),__vite__mapDeps([19,1,2,20]))),C=z(()=>V(()=>import("./GeologyAndProject-UNPhZgXB.js"),__vite__mapDeps([21,1,2,22]))),B=u("自定义断面信息计算中..."),c=u(),b=u(0);u(0);const L=u(!1),y=u(!1),$=u(!0),xe=u(!1);u(Ta);const G=u("洪季"),Rt=i=>{G.value=i,console.log(G.value),L.value=!1,b.value=0;let l=ce().getMap();l.getLayer("floodFlow")&&(l.removeLayer("floodFlow"),te&&(te(),te=null)),l.getLayer("dryFlow")&&(l.removeLayer("dryFlow"),ae&&(ae(),ae=null))},_t=i=>{i&&i.fitBounds([[120.43987922676835,32.03201616423072],[120.59089640208263,32.05217136261862]],{duration:1500})},R=u(va),ee=u(xa);let bt=je;u([{value:"low",label:"低风险"},{value:"middle",label:"中风险"},{value:"high",label:"高风险"}]),u("mzs");const Ge=()=>{re=ee.value.find(i=>i.value===Re.value),ie=ee.value.find(i=>i.value===_e.value),Ue=ee.value.find(i=>i.value===Lt.value),Ce=ee.value.find(i=>i.value===Dt.value)},Et=i=>{let l="";return R.value.map(p=>{p.risk===i&&(l=l+p.name+"; ")}),l},yt=()=>{Ae.value=!1},St=async()=>{if(Ge(),Ae.value=!1,ie.dateShort<=re.dateShort){Le.error("当前地形时间不能早于或等于对比地形时间！");return}if($e.value===Re.value&&Ze.value===_e.value){Le.error("当前地形时间与对比地形时间未发生变化！");return}B.value="冲淤图层加载中...",ue.value=!0,ne.value=!0,le.value=!0,ze.value=!0;const i=ie.dateShort+re.dateShort;y.value||(y.value=!0),w.removeLayer("mapRaster"),w.removeSource("mapRaster"),ot(w,i,"mapRaster"),w.moveLayer("mapRaster","mzsLine"),Ye(re,ie,Ue,Ce)},fe=i=>{w.setFilter("mzsBankLineChoosen",R.value[i-1].filter)},Ye=async(i,l,p,f)=>{const x=i.date,m=l.date,O=p.date,j=f.date;B.value="确认计算结果是否存在...",ue.value=!0;let D,we;D=await We(x,m),we=await We(O,j),D&&we?(B.value="地形对比数据加载中...",P.value=await Y(x,m),me.value=await Y(O,j)):D&&!we?(B.value="地形对比数据加载中...",await Te(O,j),B.value="地形对比数据加载中...",P.value=await Y(x,m),me.value=await Y(O,j)):!D&&we?(B.value="地形对比数据加载中...",await Te(x,m),B.value="地形对比数据加载中...",P.value=await Y(x,m),me.value=await Y(O,j)):(B.value="地形对比数据加载中...",await Te(O,j),await Te(x,m),B.value="地形对比数据加载中...",P.value=await Y(x,m),me.value=await Y(O,j)),ue.value=!1,ne.value=!1,ye.value=!1,le.value=!1,ze.value=!1,Yt(),wt(P.value),w.getLayer("mzsBankLineLowRisk")!==void 0&&w.removeLayer("mzsBankLineLowRisk"),st(w,R),be.value=!0,$e.value=Re.value,Ze.value=_e.value},We=async(i,l)=>{const p=[];let f=!0;try{for(let m=0;m<12;m++)p.push(Q.getProfileData(i,l,m+1));(await Promise.all(p)).forEach(m=>{(!m||!m.data||m.data.length===0)&&(f=!1)})}catch{f=!1}return f},Y=async(i,l)=>{const p=[],f=[];for(let m=0;m<12;m++)p.push(Q.getProfileData(i,l,m+1));return(await Promise.all(p)).forEach(m=>{m&&m.data&&f.push(m.data)}),f},Te=async(i,l)=>{const p=[];for(let f=0;f<R.value.length;f++)p.push(At(i,l,f));await Promise.all(p)},At=async(i,l,p)=>{const f=await Q.runProfileModel_long(i,l,p+1);let x;for(;;){try{x=await Q.getRunStatus(f.data)}catch{}if(x.data==2)break;if(x.data==-1)return;if(x.data==-2)return;x.data==1,await it(100)}},wt=i=>{i.map((l,p)=>{R.value[p].risk==="low"?R.value[p].color="rgb(31, 110, 209)":R.value[p].risk==="middle"?R.value[p].color="rgb(220, 126, 37)":R.value[p].color="rgb(250, 55, 36)";try{R.value[p].flowspeed=l.deepestPoint[2]}catch{}}),ce().getMap()};let te=null,ae=null;const Je=async()=>{L.value=!L.value;let i=ce().getMap();if(b.value=0,L.value){if(G.value=="洪季"){let l="/api/data/flow/configJson/flood",p="/api/data/flow/texture/flood/",f=ct(new mt("floodFlow",l,p));i.addLayer(f,"chaoWeiPointLable"),te=dt(()=>f._progressRate,x=>{let m=parseFloat((f.timeCount/f.timePerFrame).toFixed(1));b.value=m}),console.log("add 洪季")}else if(G.value=="枯季"){let l="/api/data/flow/configJson/dry",p="/api/data/flow/texture/dry/",f=ct(new mt("dryFlow",l,p));i.addLayer(f,"chaoWeiPointLable"),ae=dt(()=>f._progressRate,x=>{let m=parseFloat((f.timeCount/f.timePerFrame).toFixed(1));b.value=m}),console.log("add 枯季")}}else G.value=="洪季"?i.getLayer("floodFlow")&&(i.removeLayer("floodFlow"),te(),te=null):G.value=="枯季"&&i.getLayer("dryFlow")&&(i.removeLayer("dryFlow"),ae(),ae=null)},He=()=>{y.value&&Z.value?(w.setLayoutProperty("mapRaster","visibility","visible"),y.value=!y.value):!y.value&&Z.value||y.value&&!Z.value?(w.setLayoutProperty("mapRaster","visibility","none"),y.value=!y.value):w.setLayoutProperty("mapRaster","visibility","none")},Ft=()=>{$.value?w.setLayoutProperty("岸段预警","visibility","none"):w.setLayoutProperty("岸段预警","visibility","visible"),$.value=!$.value},Bt=()=>{xe.value?w.setLayoutProperty("TerrainLayer","visibility","none"):w.setLayoutProperty("TerrainLayer","visibility","visible"),xe.value=!xe.value},Re=u("2019before"),_e=u("2023before1"),Lt=u("1999before"),Dt=u("2012after"),$e=u("2019before"),Ze=u("2023before1");u("2012after"),u("2012after");let re,ie,Ue,Ce;const be=u(!1),Ke=u(!1),Me=u(!1),qe=()=>{Me.value=!Me.value},oe=u(!1),Qe=()=>{oe.value=!oe.value},ge=u(!1),et=u(!1),tt=u(!1),Pe=u(!1),Ut=()=>{Pe.value=!Pe.value},ke=u(!1),Ct=()=>{ke.value=!ke.value},W=u(!1),Mt=async()=>{if(L.value===!1&&W.value===!0){W.value=!1;return}W.value=!W.value,b.value=0,await Je()},Z=u(!1),at=()=>{He(),Z.value=!Z.value},se=u(!1),Ee=async()=>{console.log("213123213",r.value),J.value===!0?Ne():K.value===!0&&Oe(),Ut(),Ct(),await Mt(),se.value=!se.value},J=u(!1),Ne=()=>{if(se.value===!0?Ee():K.value===!0&&Oe(),y.value===!1&&oe.value===!0||y.value===!0&&oe.value===!1){Qe(),qe(),at(),J.value=!J.value;return}Qe(),qe(),at(),J.value=!J.value},K=u(!1),Oe=()=>{se.value===!0?Ee():J.value===!0&&Ne(),K.value=!K.value},P=u([]),me=u([]);u(0),u([]);const rt=u(null),Pt=u(null),Ie=u(!0),ne=u(!0),ye=u(!0),le=u(!0),ze=u(!0),q=u(""),kt=u("");u(""),u("");let w;const Se=u(!1),Ae=u(!1);u(""),u("");const ue=u(!1);let Nt,Ot,It,zt;new ea({displayControlsDefault:!1,controls:{line_string:!0,trash:!0},styles:[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["==","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000","line-width":3}}]});const Vt=()=>{Se.value=!1},Xt=async()=>{if(q.value===""){Le.error("断面名称不为空！");return}else if(R.value.find(m=>m.name===q.value)){Le.error("断面名称已存在！");return}ue.value=!0,Ie.value=!0,ne.value=!0,ye.value=!0,le.value=!0,B.value="自定义断面信息计算中...",Se.value=!1;const i=ee.value.find(m=>m.value==Re.value).date,l=ee.value.find(m=>m.value==_e.value).date,p=await jt(i,l,Nt,Ot,It,zt);let f="";for(;;){try{f=await Q.getRunStatus(p.data)}catch{}if(f.data==2)break;if(f.data==-1)return;if(f.data==-2)return;f.data==1,await it(500)}const x=await Q.getRunResult(p.data);Gt(x.data),P.value.push(x.data),ue.value=!1,Ie.value=!1,ne.value=!1,ye.value=!1,le.value=!1};async function it(i){return new Promise(l=>setTimeout(l,i))}const jt=async(i,l,p,f,x,m)=>await Q.runProfileModelByLine(i,l,p,f,x,m),Gt=i=>{let l;i.risk[2]<.25?l="low":i.risk[2]<.5?l="middle":l="high",kt.value=l,rt.value={value:R.value.length+1,label:q.value,name:q.value,filter:["==","$type",`${q.value}`],flowspeed:i.deepestPoint[2],risk:l},Pt.value=i,R.value.push(rt.value)},ot=(i,l,p)=>{i.addSource(p,{type:"raster",tiles:[e+`/tile/raster/mzs/flood/${l}/{x}/{y}/{z}`],tileSize:256,minzoom:10,maxzoom:20,bounds:[120.109,31.823,120.855,32.102]});let f=pt[l].min,x=pt[l].max;i.addLayer({id:p,type:"raster",source:p,paint:{"raster-color":["interpolate",["linear"],["raster-value"],-10-f,"rgba(0,0,255,1)",0-f,"rgba(255, 255, 255, 1)",10-f,"rgba(255, 0, 0, 1)"],"raster-color-mix":[x-f,0,0,0],"raster-opacity":.85,"raster-color-range":[-30,30]}})},Yt=()=>{for(let i=0;i<12;i++)je[i].warnValue<.25?R.value[i].risk="low":je[i].warnValue<.5?R.value[i].risk="middle":R.value[i].risk="high"},st=(i,l)=>{i.addLayer({id:"mzsBankLineLowRisk",type:"line",source:"mzsBankLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":["match",["get","name"],"JC01",`${l.value[0].color}`,"JC02",`${l.value[1].color}`,"JC03",`${l.value[2].color}`,"JC04",`${l.value[3].color}`,"JC05",`${l.value[4].color}`,"JC06",`${l.value[5].color}`,"JC07",`${l.value[6].color}`,"JC08",`${l.value[7].color}`,"JC09",`${l.value[8].color}`,"JC10",`${l.value[9].color}`,"JC11",`${l.value[10].color}`,"JC12",`${l.value[11].color}`,"rgb(255, 255, 255)"],"line-width":3}},"mzsSectionLabelLayer")};return vt(async()=>{await $t(c.value).then(async i=>{w=i,_t(i),i.addSource("mzsPlaceLabelSource",{type:"vector",tiles:[e+"/tile/vector/mzsPlaceLabel/{x}/{y}/{z}"]}),i.addSource("mzsPlaceLineSource",{type:"vector",tiles:[e+"/tile/vector/mzsPlaceLine/{x}/{y}/{z}"]}),i.addSource("mzsBankAreaSSource",{type:"vector",tiles:[e+"/tile/vector/mzsBankAreaOne/{x}/{y}/{z}"]}),i.addSource("mzsBankLineSource",{type:"vector",tiles:[e+"/tile/vector/mzsBankLine/{x}/{y}/{z}"]}),i.addSource("dockAreaSource",{type:"vector",tiles:[e+"/tile/vector/dockArea/{x}/{y}/{z}"]}),i.addSource("dockAreaLabelSource",{type:"vector",tiles:[e+"/tile/vector/center/dockArea/{x}/{y}/{z}"]}),i.addSource("fixProjectAreaSource",{type:"vector",tiles:[e+"/tile/vector/fixProjectArea/{x}/{y}/{z}"]}),i.addSource("fixProjectLineSource",{type:"vector",tiles:[e+"/tile/vector/fjsFixLine/{x}/{y}/{z}"]}),i.addSource("fixProjectAreaLabelSource",{type:"vector",tiles:[e+"/tile/vector/center/fixProjectArea/{x}/{y}/{z}"]}),i.addSource("riverPlaceLabel",{type:"vector",tiles:[e+"/tile/vector/placeLabel/{x}/{y}/{z}"]}),i.addSource("riverBeachSource",{type:"vector",tiles:[e+"/tile/vector/riverBeach/{x}/{y}/{z}"]}),i.addSource("zjgLine",{type:"vector",tiles:[e+"/tile/vector/zjgBridgeLine/{x}/{y}/{z}"]}),i.addLayer({id:"riverBeachArea",type:"fill",source:"riverBeachSource","source-layer":"default",paint:{"fill-color":"rgba(210,244,247, 1)"}}),i.addLayer({id:"zjgBridge",type:"line",source:"zjgLine","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":.6,"line-color":"rgb(183, 189, 183)","line-width":2}}),ot(i,23032209,"mapRaster"),i.setLayoutProperty("mapRaster","visibility","none"),i.addLayer(new aa(14)),i.setLayoutProperty("TerrainLayer","visibility","none"),i.addLayer({id:"mzsLine",type:"line",source:"mzsPlaceLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgba(26, 87, 138, 0.6)","line-width":2}}),i.addLayer({id:"fjsFixLine",type:"line",source:"fixProjectLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgba(216, 217, 228, 0.5)","line-width":4}}),i.addLayer({id:"fixProjectFillLayer",type:"fill",source:"fixProjectAreaSource","source-layer":"default",paint:{"fill-color":"rgba(220,224,237, 0.8)","fill-outline-color":"rgba(220,224,237, 0.8)"}}),i.addLayer({id:"fixProjectAreaLabel",type:"symbol",source:"fixProjectAreaLabelSource","source-layer":"default",layout:{"text-field":["get","layer"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"right","text-size":12},paint:{"text-color":"rgba(31, 44, 126, 0.6)"}}),i.addLayer({id:"mzsLabel",type:"symbol",source:"mzsPlaceLabelSource","source-layer":"default",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"left"},paint:{"text-color":"rgba(31, 14, 126, 0.75)"}}),i.addLayer({id:"dockArea",type:"fill",source:"dockAreaSource","source-layer":"default",paint:{"fill-color":"#18b915"}}),i.addLayer({id:"dockAreaLabel",type:"symbol",source:"dockAreaLabelSource","source-layer":"default",layout:{"text-field":["get","project_name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"bottom","text-size":12},paint:{"text-color":"rgba(31, 44, 126, 0.6)"}}),i.addLayer({id:"riverPlaceLabel",type:"symbol",source:"riverPlaceLabel","source-layer":"default",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"left","text-size":18},paint:{"text-color":"rgba(31, 44, 226, 1)"}}),i.addSource("mzsSectionLabel",{type:"vector",tiles:[e+"/tile/vector/geomCenter/mzsBankLine/{x}/{y}/{z}"]});const l={type:"FeatureCollection",features:[{type:"Feature",properties:{label:"潮位点"},geometry:{type:"Point",coordinates:[120.522864,32.035502]}}]};i.addSource("chaoWeiPoint",{type:"geojson",data:l}),i.addLayer({id:"chaoWeiPoint",type:"circle",source:"chaoWeiPoint",paint:{"circle-radius":7,"circle-color":"rgb(255, 0,0)"}}),i.addLayer({id:"chaoWeiPointLable",type:"symbol",source:"chaoWeiPoint",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"top","text-offset":[0,.5],"text-size":18,"text-allow-overlap":!0},paint:{"text-color":"rgb(255,255,255)"}},"chaoWeiPoint"),i.addLayer(new pa(bt),"chaoWeiPoint"),i.addLayer({id:"mzsBankLineChoosen",type:"line",source:"mzsBankLineSource","source-layer":"default",filter:R.value[1].filter,layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgb(134, 245, 230)","line-width":10}},"chaoWeiPoint"),i.addLayer({id:"mzsSectionLabelLayer-important",type:"symbol",source:"mzsSectionLabel","source-layer":"default",maxzoom:12,minzoom:8,filter:["==","label","MZ08海事码头"],layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[-1,1.15],"text-anchor":"top","text-size":18,"text-allow-overlap":!0},paint:{"text-color":"rgb(100, 2, 125)"}},"chaoWeiPoint"),i.addLayer({id:"mzsSectionLabelLayer",type:"symbol",source:"mzsSectionLabel","source-layer":"default",maxzoom:22,minzoom:12,layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[-1,1.15],"text-anchor":"top","text-size":18,"text-allow-overlap":!0},paint:{"text-color":"rgb(0, 22, 145)"}},"chaoWeiPoint"),ce().setMap(i)}),Ge(),be.value=!1,Ke.value=!1,oe.value=!1,ge.value=!1,et.value=!1,tt.value=!1,W.value=!1,await Ye(re,ie,Ue,Ce),Ee()}),Zt(()=>{ce().getMap().remove(),ce().destroyMap()}),(i,l)=>{const p=he("dv-border-box-12"),f=he("el-input"),x=he("el-button"),m=he("el-dialog"),O=he("dv-loading"),j=Kt("draggable");return E(),N("div",Ra,[d("div",{class:"map-container",id:"map",ref_key:"mapContainer",ref:c},null,512),_a,d("div",ba,[d("div",{class:Ve(["risk-item",{active:se.value}])},[d("div",{class:"risk-main-index waterpower",onClick:Ee},[se.value?(E(),I(p,{key:0})):S("",!0),Ea])],2),d("div",{class:Ve(["risk-item",{active:J.value}])},[d("div",{class:"risk-main-index riverbed",onClick:Ne},[J.value?(E(),I(p,{key:0,color:["rgb(73, 164, 101)","#9cf3e0"]})):S("",!0),ya])],2),d("div",{class:Ve(["risk-item",{active:K.value}])},[d("div",{class:"risk-main-index bankGeology",onClick:Oe},[K.value?(E(),I(p,{key:0,color:["rgb(153, 143, 199)","rgb(231, 161, 240)"]})):S("",!0),Sa])],2)]),Z.value?(E(),N("div",Aa,[d("label",wa,[d("input",{type:"checkbox",checked:y.value,onClick:l[0]||(l[0]=D=>He())},null,8,Fa),Ba]),La])):S("",!0),d("div",Da,[d("label",Ua,[d("input",{type:"checkbox",checked:$.value,onClick:l[1]||(l[1]=D=>Ft())},null,8,Ca),Ma]),Pa]),d("div",ka,[d("label",Na,[d("input",{type:"checkbox",checked:xe.value,onClick:l[2]||(l[2]=D=>Bt())},null,8,Oa),Ia]),za]),Va,be.value?(E(),N("div",Xa,Ya)):S("",!0),be.value?(E(),N("div",Wa,[d("div",Ja,[d("div",Ha,[$a,pe(" 高风险区域集中在： "),d("span",Za,ve(Et("high")),1)])])])):S("",!0),Ke.value?(E(),I(M(n),{key:3,onProfileValueChange:fe,profileData:P.value,profileList:R.value,shapeChartLoad:ne.value,erosionChartLoad:le.value},null,8,["profileData","profileList","shapeChartLoad","erosionChartLoad"])):S("",!0),Me.value?(E(),I(M(h),{key:4,onProfileValueChange:fe,profileData:P.value,profileList:R.value,shapeYearlyChartLoad:Ie.value},null,8,["profileData","profileList","shapeYearlyChartLoad"])):S("",!0),oe.value?(E(),I(M(o),{key:5,onProfileValueChange:fe,profileData:P.value,profileDataCompare:me.value,profileList:R.value,shapeChartLoad:ne.value},null,8,["profileData","profileDataCompare","profileList","shapeChartLoad"])):S("",!0),ge.value?(E(),I(M(v),{key:6,onProfileValueChange:fe,profileData:P.value,profileList:R.value,slopeChartLoad:ye.value},null,8,["profileData","profileList","slopeChartLoad"])):S("",!0),et.value?(E(),I(M(T),{key:7,onProfileValueChange:fe,profileData:P.value,profileList:R.value,slopeChartLoad:le.value},null,8,["profileData","profileList","slopeChartLoad"])):S("",!0),Pe.value?(E(),N("div",Ka,[U(M(A))])):S("",!0),W.value?(E(),I(M(t),{key:9,profileList:R.value,flowspeedChartLoad:ze.value,type:G.value,onConditionChange:Rt},null,8,["profileList","flowspeedChartLoad","type"])):S("",!0),W.value?(E(),N("div",qa,[d("label",Qa,[d("input",{type:"checkbox",checked:L.value,onClick:l[3]||(l[3]=D=>Je())},null,8,ga),er]),tr])):S("",!0),W.value?(E(),N("div",ar,[U(ha,{type:"exp","time-step":b.value,"total-count":25},null,8,["time-step"])])):S("",!0),ke.value?(E(),N("div",rr,[U(M(_),{timeStep:b.value,type:G.value},null,8,["timeStep","type"])])):S("",!0),K.value?(E(),I(M(C),{key:13})):S("",!0),tt.value?ut((E(),N("div",ir,[U(M(s),{profileList:R.value},null,8,["profileList"])])),[[j,{bounds:"body",cancel:"div.content"}]]):S("",!0),y.value&&Z.value?(E(),N("div",or,nr)):S("",!0),U(m,{modelValue:Se.value,"onUpdate:modelValue":l[5]||(l[5]=D=>Se.value=D),title:"绘制断面确认",width:"40vh"},{footer:X(()=>[d("div",ur,[d("div",cr,[U(x,{onClick:Vt},{default:X(()=>[pe("取消")]),_:1}),U(x,{type:"primary",onClick:Xt},{default:X(()=>[pe(" 确认 ")]),_:1})])])]),default:X(()=>[lr,U(f,{modelValue:q.value,"onUpdate:modelValue":l[4]||(l[4]=D=>q.value=D),style:{width:"240px","margin-bottom":"10px","margin-left":"2vw"},placeholder:"请输入断面名称",clearable:""},null,8,["modelValue"])]),_:1},8,["modelValue"]),U(m,{modelValue:Ae.value,"onUpdate:modelValue":l[6]||(l[6]=D=>Ae.value=D),title:"切换场景确认",width:"40vh"},{footer:X(()=>[d("div",mr,[d("div",pr,[U(x,{onClick:yt},{default:X(()=>[pe("取消")]),_:1}),U(x,{type:"primary",onClick:St},{default:X(()=>[pe(" 确认 ")]),_:1})])])]),default:X(()=>[dr,d("div",hr,ve(M(re).name),1),d("div",fr,ve(M(ie).name),1)]),_:1},8,["modelValue"]),ut(d("div",vr,[U(O,{class:"loading-icon"},{default:X(()=>[d("div",xr,ve(B.value),1)]),_:1})],512),[[qt,ue.value]])])}}},Er=xt(Tr,[["__scopeId","data-v-c30a912f"]]);export{Er as default};
