import{a2 as oi,a3 as li,a4 as Y,a5 as Xt,a6 as W,a7 as It,_ as Ne,a8 as Le,i as z,o as G,c as Z,a as p,b as v,d as w,D as X,a9 as pe,p as Ye,e as Xe,aa as hi,f as D,g as Ge,u as ot,t as de,N as ge,ab as ui,ac as Ee,ad as Fe,v as lt,ae as Mt,h as di,W as ci,af as fi,B as Ve,C as $e,F as Me,r as Ae,k as fe,ag as At}from"./index-DFEmcfO1.js";import{M as mi}from"./mapbox-gl-draw-BrVTn-t9.js";import{M as pi}from"./ModelTitle-Djmkzc1-.js";const q=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function be(){const o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(q[o&255]+q[o>>8&255]+q[o>>16&255]+q[o>>24&255]+"-"+q[e&255]+q[e>>8&255]+"-"+q[e>>16&15|64]+q[e>>24&255]+"-"+q[t&63|128]+q[t>>8&255]+"-"+q[t>>16&255]+q[t>>24&255]+q[i&255]+q[i>>8&255]+q[i>>16&255]+q[i>>24&255]).toLowerCase()}class mt{constructor(){this.uuid=be(),this.refCount=0,this.name="Base Object"}use(){return this.refCount++,this}release(){return--this.refCount===0&&this.destroy(),null}destroy(){this.name=null,this.uuid=null,this.refCount=null}}function gi(o,e){switch(o){case Uint8Array:return new Uint8Array(e);case Uint16Array:return new Uint16Array(e/2);case Uint32Array:return new Uint32Array(e/4);case Float32Array:return new Float32Array(e/4);default:throw new Error("Unsupported data type")}}function yi(o){let e=o.byteLength,t=(4-e%4)%4;if(t>0){let i=gi(o.constructor,e+t);for(let s=0;s<o.length;s++)i[s]=o[s];return i}return o}class bi{constructor(e,t){this.uuid=be(),this.name=e,this.length=t.length,this._data=yi(t),this.onChanges=[],this.structure=[],this.stride=0,this.refCount=0}use(){return this.refCount++,this}release(){return--this.refCount===0&&this.destroy(),null}registerCallback(e){return this.onChanges.push(e),this.onChanges.length-1}removeCallback(e){return this.onChanges[e]=null,null}get value(){return this._data}set value(e){this._data=e,this.onChanges.forEach(t=>t&&t())}setIndexed(e,t){this._data[e]=t,this.onChanges.forEach(i=>i&&i())}getIndexed(e){return this._data[e]}fill(e){this._data.fill(e),this.onChanges.forEach(t=>t&&t())}element(e,t){if(t!==void 0)this.setIndexed(e,t);else return this.getIndexed(e)}destroy(){this.uuid=null,this.name=null,this._data=null,this.onChanges=[],this.structure=[],this.stride=null}}function ve(o,e="arrayRef"){return new bi(e,o)}class Ht{constructor(e){this.uuid=be(),this.name=e.name;let t="";this.map=e.map;for(const s in this.map)t+=`${s}: ${this.map[s].type},
`;this.code=`struct Block {
            ${t}
        }`;const i=oi(this.code);this._view=li(i.structs.Block),this.onChanges=[],this.refCount=0,this._view&&this.update(),this.dynamic=e.dynamic!==void 0?e.dynamic:!1}get value(){return this._view.arrayBuffer}get view(){return this._view}set view(e){this._view=e,this.update()}use(){return this.refCount++,this}release(){return--this.refCount===0&&this.destroy(),null}registerCallback(e){return this.onChanges.push(e),this.onChanges.length-1}removeCallback(e){return this.onChanges[e]=null,null}update(){const e={};for(const t in this.map)e[t]=this.map[t].data;this._view.set(e),this.onChanges.forEach(t=>t&&t())}destroy(){this.refCount=null,this.dynamic=null,this.onChanges=[],this._view=null,this.uuid=null,this.name=null,this.code=null,this.map=null}}function Rt(o){return new Ht(o)}class _i{constructor(){this._memorySizeInBytes=0}get memorySizeInBytes(){return this._memorySizeInBytes}set memorySizeInBytes(e){this._memorySizeInBytes=e}getMemoryInMB(){return Math.floor(this._memorySizeInBytes/1024/1024+.5)}}const Lt=new _i;class He extends mt{constructor(e){super(),this.name=e.name!==void 0?e.name:"Buffer",this.buffer=void 0,this.size=e.size,Lt.memorySizeInBytes+=this.size,this.usage=e.usage,Y.dispatchEvent({type:"createBuffer",emitter:this}),this.areaMap={},this.lastAreaName=null,this.updatePerFrame=!1,this.dirtyList=new Set,this.needUpdate()}exportDescriptor(){return{label:this.name,size:this.size,usage:this.usage}}registerStrutureMap(e,t,i,s=1){let n=0;if(this.lastAreaName){const l=this.areaMap[this.lastAreaName];n=l.start+l.length}this.lastAreaName=e.name;let r=0;e.value.byteLength%s&&(r=s-e.value.byteLength%s);let a=e.value.byteLength+r;this.areaMap[e.name]={start:n,length:a,ref:e.use(),dataOffset:t,size:i,callbackIndex:e.registerCallback(()=>{this.makeDirty(e.name),this.needUpdate()})},this.makeDirty(e.name)}makeDirty(e){this.dirtyList.add(e)}updateSubArea(e){const t=this.areaMap[e];this.device.queue.writeBuffer(this.buffer,t.start,t.ref.value,t.dataOffset,t.size)}update(){this.dirtyList.size&&(this.dirtyList.forEach(e=>{Y.dispatchEvent({type:"writeBuffer",emitter:this,subArea:this.areaMap[e]})}),this.dirtyList=new Set)}needUpdate(){Y.addToUpdateList(this)}destroy(){this.buffer&&(this.buffer.destroy(),this.buffer=null),this.size&&(Lt.memorySizeInBytes-=this.size),this.uuid=null,this.name=null,this.refCount=null,this.size=null,this.usage=null,this.lastAreaName=null;for(const e in this.areaMap){let t=this.areaMap[e];t.callbackIndex=t.ref.removeCallback(t.callbackIndex),t.ref=t.ref.release(),t.dataOffset=null,t.length=null,t.start=null,t.size=null}this.areaMap=null,this.dirtyList.clear(),this.dirtyList=null,super.destroy()}}function vi(o){let e="",t=1;if(o instanceof Float32Array)e="float32",t=4;else if(o instanceof Int32Array)e="int32",t=4;else if(o instanceof Uint32Array)e="uint32",t=4;else return"Unknown Format";return{format:e,bytesPerComponent:t}}class pt extends He{constructor(e){let t=!1,i=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;t=e.randomAccessible===void 0?t:e.randomAccessible,t&&(i|=GPUBufferUsage.STORAGE);const s={name:e.name,usage:e.usage?e.usage:i,size:e.resource.arrayRef.value.byteLength};super(s),this.registerStrutureMap(e.resource.arrayRef,e.resource.dataOffset,e.resource.size),this.attributes=[],this.stride=0;const{format:n,bytesPerComponent:r}=vi(e.resource.arrayRef.value);this.bytesPerComponent=r,e.resource.structure.forEach(a=>{this.attributes.push({format:n+(a.components>1?`x${a.components}`:""),offset:this.stride}),this.stride+=r*a.components})}static create(e){return new pt(e)}getComponentsPerElement(){return this.stride/this.bytesPerComponent}destroy(){this.stride=null,this.attributes=[],super.destroy()}}function ht(o){return pt.create(o)}class gt extends He{constructor(e){const t={name:e.name,usage:e.usage?e.usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC,size:e.resource.arrayRef.value.byteLength};super(t),this.componetsPerElement=e.resource.components?e.resource.components:0,this.registerStrutureMap(e.resource.arrayRef,e.resource.dataOffset,e.resource.size)}static create(e){return new gt(e)}destroy(){this.componetsPerElement=null,super.destroy()}}function xi(o){return gt.create(o)}class We extends He{constructor(e){let t=0,i=e.blocks.length===1?1:256;for(const n of e.blocks){let r=0;n.value.byteLength%i&&(r=i-n.value.byteLength%i),t+=n.value.byteLength+r}const s={name:e.name,usage:e.usage?e.usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC,size:t};super(s),this.alignSize=i,this.dynamicBlocks=[],e.blocks.forEach(n=>{this.addBlock(n)}),this.dynamicBlocks.length&&(this.updatePerFrame=!0),this.isInitialized=!1}static create(e){return new We(e)}addBlock(e){e.dynamic&&this.dynamicBlocks.push(e),this.registerStrutureMap(e,void 0,void 0,this.alignSize)}update(){(this.dynamicBlocks.length||!this.isInitialized)&&(this.dynamicBlocks.forEach(e=>e.update()),this.isInitialized=!0,super.update())}destroy(){this.alignSize=null,this.dynamicBlocks=null,this.isInitialized=null,super.destroy()}}function Dt(o){return We.create(o)}function wi(o){return o instanceof Uint16Array?"uint16":o instanceof Uint32Array?"uint32":"Unknown Format"}class yt extends He{constructor(e){let t=!1,i=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;t=e.randomAccessible===void 0?t:e.randomAccessible,t&&(i|=GPUBufferUsage.STORAGE);const s={name:e.name,usage:e.usage?e.usage:i,size:e.resource.arrayRef.value.byteLength};super(s),this.length=e.resource.arrayRef.value.length,this.type=wi(e.resource.arrayRef.value),this.registerStrutureMap(e.resource.arrayRef,e.resource.dataOffset,e.resource.size)}static create(e){return new yt(e)}destroy(){this.length=null,this.type=null,super.destroy()}}function Si(o){return yt.create(o)}class bt extends Xt{constructor(e){e===void 0?super("u32",0):super("u32",e)}static create(e){return new bt(e)}set n(e){this._data=e}get n(){return this._data}add(e){return this._data+=e,this}}function Bi(o){return bt.create(o)}function Pi(o){return{type:"u32",data:o!==void 0?o:0}}function Ci(o,e){const t=[0,0];return o!==void 0&&e===void 0?(t[0]=o,t[1]=o):o!==void 0&&e!==void 0&&(t[0]=o,t[1]=e),{type:"vec2u",data:t}}class re extends Xt{constructor(){super("mat4x4f",W.identity())}static create(){return new re}scale(e){return W.scale(this._data,e.data,this._data),this}static rotationX(e){const t=new re;return t.data=W.rotationX(e),t}rotateX(e){return W.rotateX(this._data,e,this._data),this}static rotationY(e){const t=new re;return t.data=W.rotationY(e),t}rotateY(e){return W.rotateY(this._data,e,this._data),this}static rotationZ(e){const t=new re;return t.data=W.rotationZ(e),t}rotateZ(e){return W.rotateZ(this._data,e,this._data),this}lookAt(e,t,i){return W.lookAt(e.data,t.data,i.data,this._data),this}static transposing(e){const t=new re;return t.data=W.transpose(e.data),t}transpose(e){return W.transpose(e.data,this._data),this}static inverse(e){return new re().invert(e)}invert(e){return W.invert(e.data,this._data),this}static projection(e,t,i,s){const n=new re;return n.data=W.perspective(e,t,i,s),n}perspective(e,t,i,s){return W.perspective(e,t,i,s,this._data),this}static translation(e){return new re().translate(e)}translate(e){return W.translate(this._data,e.data,this._data),this}static multiplication(e){return new re().multiply(e)}multiply(e){return W.multiply(this._data,e.data,this._data),this}get array(){return this._data}copyFrom(e){for(let t=0;t<16;t++)this._data[t]=e._data[t]}}function Et(){return re.create()}class _t extends mt{constructor(e){super(),this.name=e.name,this.shaderModule=void 0,this.code=e.codeFunc,this.code()&&this.needUpdate()}static create(e){return new _t(e)}needUpdate(){Y.addToUpdateList(this)}exportDescriptor(){return{label:this.name,code:this.code()}}update(){Y.dispatchEvent({type:"createShader",emitter:this})}isComplete(){return!!this.shaderModule}destroy(){this.code=null,this.shaderModule=null,super.destroy()}}class vt extends mt{constructor(e){super(),this.uniforms=[],this.sharedUniforms=[],this.indexBinding=e.index,this.indexBinding&&this.indexBinding.buffer.use(),this.indirectBinding=e.indirect?{buffer:e.indirect.buffer.use(),byteOffset:e.indirect.byteOffset?e.indirect.byteOffset:0}:void 0,this.vertexBindings=[],this.storageBindings=[],this.textureBindings=[],this.samplerBindings=[],this.layouts=[],this.vertexLayouts=new Array(e.vertices?e.vertices.length:0),this.groups=[],this.name=e.name?e.name:"Binding",e.vertices&&e.vertices.forEach(i=>{this.addVertexBuffer(i)});let t=0;this.uniformOrder=0,(e.uniforms||e.sharedUniforms)&&(this.uniformOrder=t++,e.uniforms?.forEach(i=>this.addUniformBlock(i)),e.sharedUniforms?.forEach(i=>this.sharedUniforms.push({buffer:i.buffer.use(),visibility:i.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE}))),this.storageOrder=0,e.storages&&(this.storageOrder=t++),e.storages&&e.storages.forEach(i=>{this.addStorageBuffer(i)}),this.textureOrder=0,e.textures&&(this.textureOrder=t++),e.textures&&e.textures.forEach(i=>{this.addTexture(i)}),e.samplers&&e.samplers.forEach((i,s)=>{this.addSampler(s,i)}),this.isIndirect=e.range===void 0,this.isIndirect||(this.range=e.range),this.isComplete=!1,this.uniformBufferReady=!1,this.released=!1,Y.addBinding(this),this.executable=!0}static create(e){return new vt(e)}addUniformBlock(e){this.uniforms.push({ref:new Ht({map:e.map,name:e.name,dynamic:e.dynamic!==void 0?e.dynamic:!1}),visibility:e.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE});const t=[];this.uniforms.forEach(i=>t.push(i.ref)),this.uniformBuffer=We.create({name:`Uniform buffer (${this.name})`,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC,blocks:t}).use(),this.uniformBufferReady=!0}addVertexBuffer(e){let t=!1;t=e.isInstanced===void 0?t:e.isInstanced,this.vertexBindings.push({buffer:e.buffer.use(),stepMode:t?"instance":"vertex",visibility:e.visibility||GPUShaderStage.VERTEX})}addStorageBuffer(e){const t=e.writable!==void 0?e.writable:!1;this.storageBindings.push({buffer:e.buffer.use(),type:t?"storage":"read-only-storage",visibility:t?GPUShaderStage.COMPUTE:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE})}addTexture(e){let t="read-only",i=e.asStorage!==void 0?e.asStorage:!1,s=GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE;i&&(s=GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE,e.texture.computable&&(t="write-only")),e.visibility&&(s=e.visibility),this.textureBindings.push({texture:e.texture.use(),callbackIndex:e.texture.registerCallback(()=>{this.isComplete&&Y.dispatchEvent({type:"createBindGroup",emitter:this,bindGroupType:"texture",order:this.textureOrder})}),asStorage:i,visibility:s,accessibility:t,sampleType:e.sampleType||"float",multisampled:e.multisampled!==void 0?e.multisampled:!1,viewDimension:e.viewDimension||"2d"})}addSampler(e,t){this.samplerBindings[e]={sampler:t.sampler.use(),bindingType:t.bindingType||"filtering",visibility:t.visibility||GPUShaderStage.FRAGMENT}}createUniformBindGroupLayout(e){if(!this.uniforms.length&&!this.sharedUniforms.length)return;const t=new Array(this.uniforms.length+this.sharedUniforms.length);let i=0;this.uniforms.concat(this.sharedUniforms).forEach(s=>{t[i]={binding:i++,visibility:s.visibility,buffer:{type:"uniform"}}}),this.layouts[this.uniformOrder]=e.createBindGroupLayout({label:"Uniform binding group layout",entries:t})}createUniformBindGroup(e){if(!this.uniforms.length&&!this.sharedUniforms.length)return;const t=new Array(this.uniforms.length+this.sharedUniforms.length);let i=0;this.uniforms.forEach(s=>{const n=this.uniformBuffer.areaMap[s.ref.name];t[i]={binding:i++,resource:{buffer:this.uniformBuffer.buffer,offset:n.start,size:n.length}}}),this.sharedUniforms.forEach(s=>{t[i]={binding:i++,resource:{buffer:s.buffer.buffer}}}),this.groups[this.uniformOrder]=e.createBindGroup({label:"Uniform binding group",layout:this.layouts[this.uniformOrder],entries:t})}createStorageBindGroupLayout(e){if(!this.storageBindings.length)return;const t=new Array(this.storageBindings.length);this.storageBindings.forEach((i,s)=>{t[s]={binding:s,buffer:{type:i.type},visibility:i.visibility}}),this.layouts[this.storageOrder]=e.createBindGroupLayout({label:`Storage binding group layout (${this.name})`,entries:t})}createStorageBindGroup(e){if(!this.storageBindings.length)return;const t=new Array(this.storageBindings.length);this.storageBindings.forEach((i,s)=>{t[s]={binding:s,resource:{buffer:i.buffer.buffer}}}),this.groups[this.storageOrder]=e.createBindGroup({label:`Storage binding group (${this.name})`,layout:this.layouts[this.storageOrder],entries:t})}createVertexBufferLayout(){let e=0;this.vertexBindings.forEach((t,i)=>{const s=new Array(t.buffer.attributes.length);t.buffer.attributes.forEach((n,r)=>{s[r]={format:n.format,shaderLocation:e++,offset:n.offset}}),this.vertexLayouts[i]={arrayStride:t.buffer.stride,stepMode:t.stepMode,attributes:s}})}createTextureBindGroupLayout(e){if(!this.samplerBindings.length&&!this.textureBindings.length)return;const t=new Array(this.samplerBindings.length+this.textureBindings.length);this.samplerBindings.concat(this.textureBindings).forEach((i,s)=>{t[s]={binding:s,visibility:i.visibility,...i.sampler&&{sampler:{type:i.bindingType}},...i.texture&&!i.asStorage&&{texture:{sampleType:i.sampleType,viewDimension:i.viewDimension,multisampled:i.multisampled}},...i.texture&&i.asStorage&&{storageTexture:{access:i.accessibility,format:i.texture.format}}}}),this.layouts[this.textureOrder]=e.createBindGroupLayout({label:"Texture binding group layout",entries:t})}createTextureBindGroup(e){if(!this.samplerBindings.length&&!this.textureBindings.length)return;const t=new Array(this.samplerBindings.length+this.textureBindings.length);this.samplerBindings.concat(this.textureBindings).forEach((i,s)=>{t[s]={binding:s,...i.sampler&&{resource:i.sampler.sampler},...i.texture&&{resource:i.texture.view()}}}),!this.layouts[this.textureOrder]&&this.createTextureBindGroupLayout(e),this.groups[this.textureOrder]=e.createBindGroup({label:`Texture binding group (${this.name})`,layout:this.layouts[this.textureOrder],entries:t})}exportLayoutDescriptor(e){switch(e){case"uniform":{const t=new Array(this.uniforms.length+this.sharedUniforms.length);let i=0;return this.uniforms.concat(this.sharedUniforms).forEach(s=>{t[i]={binding:i++,visibility:s.visibility,buffer:{type:"uniform"}}}),{label:`Uniform binding group layout (${this.name})`,entries:t}}case"storage":{const t=new Array(this.storageBindings.length);return this.storageBindings.forEach((i,s)=>{t[s]={binding:s,buffer:{type:i.type},visibility:i.visibility}}),{label:`Storage binding group layout (${this.name})`,entries:t}}case"texture":{const t=new Array(this.samplerBindings.length+this.textureBindings.length);return this.samplerBindings.concat(this.textureBindings).forEach((i,s)=>{t[s]={binding:s,visibility:i.visibility,...i.sampler&&{sampler:{type:i.bindingType}},...i.texture&&!i.asStorage&&{texture:{sampleType:i.sampleType,viewDimension:i.viewDimension,multisampled:i.multisampled}},...i.texture&&i.asStorage&&{storageTexture:{access:i.accessibility,format:i.texture.format}}}}),{label:`Texture binding group layout (${this.name})`,entries:t}}}}exportDescriptor(e){switch(e){case"uniform":{const t=new Array(this.uniforms.length+this.sharedUniforms.length);let i=0;return this.uniforms.forEach(s=>{const n=this.uniformBuffer.areaMap[s.ref.name];t[i]={binding:i++,resource:{buffer:this.uniformBuffer.buffer,offset:n.start,size:n.length}}}),this.sharedUniforms.forEach(s=>{t[i]={binding:i++,resource:{buffer:s.buffer.buffer}}}),{label:`Uniform binding group (${this.name})`,layout:this.layouts[this.uniformOrder],entries:t}}case"storage":{const t=new Array(this.storageBindings.length);return this.storageBindings.forEach((i,s)=>{t[s]={binding:s,resource:{buffer:i.buffer.buffer}}}),{label:`Storage binding group (${this.name})`,layout:this.layouts[this.storageOrder],entries:t}}case"texture":{const t=new Array(this.samplerBindings.length+this.textureBindings.length);return this.samplerBindings.concat(this.textureBindings).forEach((i,s)=>{t[s]={binding:s,...i.sampler&&{resource:i.sampler.sampler},...i.texture&&{resource:i.texture.view()}}}),{label:`Texture binding group (${this.name})`,layout:this.layouts[this.textureOrder],entries:t}}}}crteateBindGroupLayouts(){(this.uniforms.length||this.sharedUniforms.length)&&Y.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"uniform",order:this.uniformOrder}),this.storageBindings.length&&Y.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"storage",order:this.storageOrder}),(this.samplerBindings.length||this.textureBindings.length)&&Y.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"texture",order:this.textureOrder})}createBindGroups(){this.createVertexBufferLayout(),(this.uniforms.length||this.sharedUniforms.length)&&(Y.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"uniform",order:this.uniformOrder}),Y.dispatchEvent({type:"createBindGroup",emitter:this,bindGroupType:"uniform",order:this.uniformOrder})),this.storageBindings.length&&(Y.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"storage",order:this.storageOrder}),Y.dispatchEvent({type:"createBindGroup",emitter:this,bindGroupType:"storage",order:this.storageOrder})),(this.samplerBindings.length||this.textureBindings.length)&&(Y.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"texture",order:this.textureOrder}),Y.dispatchEvent({type:"createBindGroup",emitter:this,bindGroupType:"texture",order:this.textureOrder}))}tryMakeComplete(){if(this.isComplete)return!0;if(this.released)return!1;for(const e of this.textureBindings)if(!e.texture.texture)return!1;return this.createBindGroups(),this.isComplete=!0,!0}update(){}getIndirect(){return this.indirectBinding}getBindGroupLayouts(){return this.layouts}getBindGroups(){return this.groups}getVertexLayouts(){return this.vertexLayouts}setBindGroups(e){this.groups.forEach((t,i)=>{e.setBindGroup(i,t)})}setVertexBuffers(e){this.vertexBindings.forEach((t,i)=>{e.setVertexBuffer(i,t.buffer.buffer)})}getShader(){return this.shader.shaderModule}getIndex(){return this.indexBinding?this.indexBinding.buffer:void 0}destroy(){return this.isComplete=!1,this.released=!0,this.range=null,this.uniforms.forEach(e=>{e.ref=e.ref?.release(),e.visibility=null,e.name=null,e.view=null,e.map=null}),this.uniforms=null,this.sharedUniforms.forEach(e=>{e.buffer=e.buffer.release(),e.visibility=null}),this.sharedUniforms=null,this.indexBinding&&(this.indexBinding.buffer=this.indexBinding.buffer.release(),this.indexBinding=null),this.indirectBinding&&(this.indirectBinding.buffer=this.indirectBinding.buffer.release(),this.indirectBinding=null),this.vertexBindings.forEach(e=>{e.buffer=e.buffer.release(),e.visibility=null,e.stepMode=null}),this.vertexBindings=null,this.storageBindings.forEach(e=>{e.buffer=e.buffer.release(),e.visibility=null,e.type=null}),this.storageBindings=null,this.textureBindings.forEach(e=>{e.callbackIndex=e.texture.removeCallback(e.callbackIndex),e.texture=e.texture.release(),e.viewDimension=null,e.accessibility=null,e.multisampled=null,e.sampleType=null,e.visibility=null,e.asStorage=null}),this.textureBindings=null,this.samplerBindings.forEach(e=>{e.sampler=e.sampler.release(),e.bindingType=null,e.visibility=null}),this.samplerBindings=null,this.vertexLayouts=null,this.layouts=null,this.groups=null,this.vertexLayouts=null,this.layouts=null,this.groups=null,this.uniformBuffer=this.uniformBuffer?.release(),this.refCount=null,this.name=null,super.destroy(),null}}function oe(o){return vt.create(o)}const ut={color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},Ft={color:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}};class xt{constructor(e){this.uuid=be(),this.name=e.name,this.colorDescription=e.colorAttachments,this.colorAttachments=new Array(this.colorDescription.length),this.depthStencilDescription=e.depthStencilAttachment,this.depthStencilAttachment=void 0,this.drawcalls=[],this.pass=null,this.dirty=!0,this.initialized=!1,this.completed=!1,this.executable=!0}addColorAttachments(){this.colorDescription.forEach((e,t)=>{this.colorAttachments[t]={view:e.colorResource.view(),clearValue:e.clearValue?e.clearValue:[0,0,0,1],loadOp:e.loadOp?e.loadOp:"clear",storeOp:e.storeOp?e.storeOp:"store"},e.colorResource.registerCallback(()=>{this.colorAttachments[t].view=e.colorResource.view()})})}addDepthStencilAttachment(){this.depthStencilDescription&&(this.depthStencilAttachment={view:this.depthStencilDescription.depthStencilResource.view(),depthClearValue:this.depthStencilDescription.depthClearValue?this.depthStencilDescription.depthClearValue:1,depthLoadOp:this.depthStencilDescription.depthLoadOp?this.depthStencilDescription.depthLoadOp:"clear",depthStoreOp:this.depthStencilDescription.depthStoreOp?this.depthStencilDescription.depthStoreOp:"store"},this.depthStencilDescription.depthStencilResource.registerCallback(()=>{this.depthStencilAttachment.view=this.depthStencilDescription.depthStencilResource.view()}))}makeColorFormats(){const e=new Array(this.colorDescription.length);return this.colorDescription.forEach((t,i)=>{e[i]=t.colorResource.format}),e}makeDepthStencilFormat(){if(this.depthStencilDescription)return this.depthStencilDescription.depthStencilResource.format}static create(e){return new xt(e)}updateColorAttachments(){this.colorDescription.forEach((e,t)=>{this.colorAttachments[t]={view:e.colorResource.view(),clearValue:e.clearValue?e.clearValue:[0,0,0,0],loadOp:e.loadOp?e.loadOp:"clear",storeOp:e.storeOp?e.storeOp:"store"}})}updateDepthStencilAttachment(){this.depthStencilDescription&&(this.depthStencilAttachment={view:this.depthStencilDescription.depthStencilResource.view(),depthClearValue:this.depthStencilDescription.depthClearValue?this.depthStencilDescription.depthClearValue:1,depthLoadOp:this.depthStencilDescription.depthLoadOp?this.depthStencilDescription.depthLoadOp:"clear",depthStoreOp:this.depthStencilDescription.depthStoreOp?this.depthStencilDescription.depthStoreOp:"store"})}updateSwapChain(e=0){this.passDescription.colorAttachments[e].view=this.colorDescription[e].colorResource.view()}initialize(){this.initialized||(this.addColorAttachments(),this.addDepthStencilAttachment(),this.initialize=!0)}isComplete(){return this.completed?!0:(this.completed=!0,this.colorDescription.forEach(e=>{!e.colorResource.texture&&(this.completed=!1)}),this.depthStencilDescription&&!this.depthStencilDescription.depthStencilResource.texture&&(this.completed=!1),this.completed)}update(){this.initialize(),this.updateColorAttachments(),this.updateDepthStencilAttachment(),this.passDescription={label:`Render pass (${this.name})`,colorAttachments:this.colorAttachments,...this.depthStencilDescription&&{depthStencilAttachment:this.depthStencilAttachment}},this.dirty=!1}add(e,t){return this.drawcalls.push({pipeline:e,binding:t}),this}empty(){this.drawcalls=[]}execute(e){this.isComplete()&&(this.dirty&&this.update(),this.executable&&(this.pass=e.beginRenderPass(this.passDescription),this.drawcalls.forEach(({binding:t,pipeline:i})=>{!t.tryMakeComplete()||!i.tryMakeComplete(this,t)||!i.executable||!t.executable||i.draw(this,t)}),this.pass.end()))}}function xe(o){return xt.create(o)}class wt{constructor(e){this.uuid=be(),this.shader=e.shader.module.use(),this.name=e.name||"Render Pipeline",this.vsEntryPoint=e.shader.vsEntryPoint||"vMain",this.fsEntryPoint=e.shader.fsEntryPoint||"fMain",this.colorTargetStates=[],this.colorTargetStateDescriptions=e.colorTargetStates,this.depthStencilState=void 0,this.primitive=e.primitive||{cullMode:"none",topology:"triangle-list"},this.depthTest=e.depthTest,this.pipelineLayout=void 0,this.pipeline=void 0,this.asBundle=e.asBundle!==void 0?e.asBundle:!1,this.bundleDirty=this.asBundle,this.renderBundle=void 0,this.pipelineCreating=!1,this.isFinite=!1,this.triggerCount=0,this.executable=!0}static create(e){return new wt(e)}createPipelineLayout(e,t){this.pipelineLayout=e.createPipelineLayout({label:`Rendering pipline layout (${this.name})`,bindGroupLayouts:t.getBindGroupLayouts()})}exportLayoutDescriptor(e){return this.layout?this.layout:(this.layout={label:`Rendering pipline layout (${this.name})`,bindGroupLayouts:e.getBindGroupLayouts()},this.layout)}exportDescriptor(e){const t={topology:this.primitive.topology,frontFace:this.primitive.frontFace,cullMode:this.primitive.cullMode,unclippedDepth:this.primitive.unclippedDepth,...e.indexBinding&&(this.primitive.topology==="line-strip"||this.primitive.topology==="triangle-strip")&&{stripIndexFormat:e.indexBinding.buffer.type}};return{label:`Rendering pipeline (${this.name})`,layout:this.pipelineLayout,vertex:{module:this.shader.shaderModule,entryPoint:this.vsEntryPoint,buffers:e.getVertexLayouts()},fragment:{module:this.shader.shaderModule,entryPoint:this.fsEntryPoint,targets:this.colorTargetStates},primitive:t,depthStencil:this.depthStencilState}}createTargetState(e){const t=e.makeColorFormats();this.colorTargetStates=new Array(t.length),t.forEach((s,n)=>{this.colorTargetStates[n]={format:s,blend:this.colorTargetStateDescriptions!==void 0?this.colorTargetStateDescriptions[n].blend:void 0,writeMask:this.colorTargetStateDescriptions!==void 0?this.colorTargetStateDescriptions[n].writeMask:void 0}});const i=e.makeDepthStencilFormat();i!==void 0&&(this.depthTest===void 0&&(this.depthTest=!0),this.depthStencilState={depthWriteEnabled:this.depthTest,depthCompare:"less",format:i})}createPipeline(e,t){this.pipelineCreating=!0,Y.dispatchEvent({type:"createPipelineLayout",emitter:this,binding:t}),this.createTargetState(e),Y.dispatchEvent({type:"createRenderPipelineAsync",emitter:this,binding:t})}tryMakeComplete(e,t){return this.pipeline?!0:(this.shader.isComplete()&&!this.pipelineCreating&&this.createPipeline(e,t),!1)}makeRenderBundle(e,t){Y.dispatchEvent({type:"createRenderBundle",emitter:this,renderPass:e,binding:t})}executeRenderPass(e,t){t.setBindGroups(e),t.setVertexBuffers(e),e.setPipeline(this.pipeline),t.indexBinding?(e.setIndexBuffer(t.indexBinding.buffer.buffer,t.indexBinding.buffer.type),t.isIndirect?e.drawIndexedIndirect(t.indirectBinding.buffer.buffer,t.indirectBinding.byteOffset):e.drawIndexed(...t.range())):t.isIndirect?e.drawIndirect(t.indirectBinding.buffer.buffer,t.indirectBinding.byteOffset):e.draw(...t.range())}triggerFiniteTimes(e){return this.isFinite=!0,this.triggerCount=e,this}draw(e,t){this.isFinite&&!this.triggerCount||(this.triggerCount=Math.max(this.triggerCount-1,0),this.executable&&(this.asBundle?(this.bundleDirty&&this.makeRenderBundle(e,t),e.pass.executeBundles([this.renderBundle])):this.executeRenderPass(e.pass,t)))}}function we(o){return wt.create(o)}class St{constructor(e){this.uuid=be(),this.name=e.name,this.computecalls=[],this.pass=void 0,this.update(),this.executable=!0}static create(e){return new St(e)}update(){this.passDescription={label:`Compute pass (${this.name})`}}add(e,t){return this.computecalls.push({pipeline:e,binding:t}),this}empty(){this.computecalls=[]}execute(e){this.executable&&(this.pass=e.beginComputePass(this.passDescription),this.computecalls.forEach(({binding:t,pipeline:i})=>{!t.tryMakeComplete()||!i.tryMakeComplete(this,t)||!i.executable||!t.executable||i.dispatch(this,t)}),this.pass.end())}}function ki(o){return St.create(o)}class Bt{constructor(e){this.uuid=be(),this.name=e.name?e.name:"Computable builder",this.shader=e.shader.module.use(),this.csEntryPoint=e.shader.csEntryPoint||"cMain",this.constants=e.constants,this.pipelineLayout=void 0,this.pipeline=void 0,this.pipelineCreating=!1,this.isFinite=!1,this.triggerCount=0,this.executable=!0}static create(e){return new Bt(e)}createPipelineLayout(e){const t=It();this.pipelineLayout=t.createPipelineLayout({label:`compute pipline layout (${this.name})`,bindGroupLayouts:e.getBindGroupLayouts()})}createPipeline(e){const t=It();this.pipelineCreating=!0,this.createPipelineLayout(e),t.createComputePipelineAsync({label:`compute pipeline (${this.name})`,layout:this.pipelineLayout,compute:{module:this.shader.shaderModule,entryPoint:this.csEntryPoint,constants:this.constants}}).then(i=>{this.pipeline=i,this.pipelineCreating=!1}).catch(i=>{console.error(`Error::Compute Pipeline (${this.name}) Creation FAILED!`,i)})}isComplete(e,t){return this.pipeline?!0:(!this.pipelineCreating&&this.createPipeline(renderPass,t),!1)}tryMakeComplete(e,t){return this.pipeline?!0:(this.shader.isComplete()&&!this.pipelineCreating&&this.createPipeline(t),!1)}triggerFiniteTimes(e){return this.isFinite=!0,this.triggerCount=e,this}dispatch(e,t){this.isFinite&&!this.triggerCount||(this.triggerCount=Math.max(this.triggerCount-1,0),this.executable&&(t.setBindGroups(e.pass),e.pass.setPipeline(this.pipeline),t.isIndirect?e.pass.dispatchWorkgroupsIndirect(t.indirectBinding.buffer.buffer,t.indirectBinding.byteOffset):e.pass.dispatchWorkgroups(...t.range())))}}function Ti(o){return Bt.create(o)}class Ui{constructor(){this.workerIndex=0,this.textResource=new WeakMap,this.workerKeys=new Map}load(e,t){const i={index:this.workerIndex};this.workerKeys.set(this.workerIndex,i);const s={name:e,codeFunc:()=>this.textResource.get(i)?this.textResource.get(i).deref().text:null},n=_t.create(s),r=new Worker(new URL("/assets/textLoader.worker-CLJPrufo.js",import.meta.url));return r.addEventListener("message",a=>{const{text:l}=a.data;this.textResource.set(i,new WeakRef({text:l})),r.terminate(),Y.dispatchEvent({type:"createShader",emitter:n})}),r.addEventListener("error",a=>{console.error("Error loading image: ",a),r.terminate()}),r.postMessage({url:t}),this.workerIndex++,n}}const me=new Ui,Ii=o=>(Ye("data-v-368baa2c"),o=o(),Xe(),o),Mi={class:"conditions"},Ai=Ii(()=>p("div",{class:"head"},[p("div",{class:"head-text"},"水文条件选择")],-1)),Ri={class:"form"},Li={class:"button-container"},Di={__name:"HydrologicalCondition",emits:["close","condition"],setup(o,{emit:e}){const t=Le({condition:""}),i=e,s=()=>{if(t.condition===""){pe({type:"warning",offset:100,message:"请选择水文条件后再确定！"});return}else{i("condition",t.condition),i("close");return}};return(n,r)=>{const a=z("el-option"),l=z("el-select"),u=z("el-form-item"),c=z("el-button"),h=z("el-form");return G(),Z("div",Mi,[Ai,p("div",Ri,[v(h,{model:t,"label-width":"auto",style:{"max-width":"600px"}},{default:w(()=>[v(u,{label:"水文条件"},{default:w(()=>[v(l,{modelValue:t.condition,"onUpdate:modelValue":r[0]||(r[0]=f=>t.condition=f),placeholder:"请选择水文条件"},{default:w(()=>[v(a,{label:"洪季大潮",value:"洪季大潮"}),v(a,{label:"枯季小潮",value:"枯季小潮"}),v(a,{label:"20年一遇",value:"20年一遇"})]),_:1},8,["modelValue"])]),_:1}),v(u,null,{default:w(()=>[p("div",Li,[v(c,{type:"primary",onClick:s},{default:w(()=>[X("确定")]),_:1}),v(c,{onClick:r[1]||(r[1]=f=>{i("close")})},{default:w(()=>[X("取消")]),_:1})])]),_:1})]),_:1},8,["model"])])])}}},Ei=Ne(Di,[["__scopeId","data-v-368baa2c"]]),Fi=o=>(Ye("data-v-22c7ec9b"),o=o(),Xe(),o),Vi={class:"stParams"},$i=Fi(()=>p("div",{class:"head"},[p("div",{class:"head-text"},"模型参数设置")],-1)),zi={class:"form"},Oi={class:"button-container"},Gi={__name:"SetParameter",emits:["close","params"],setup(o,{emit:e}){const t=e,i=Le({simulateHour:"72",simulateStep:"10",frictionParam:"0.013",minWaterDepth:"0.05",SmagorinskyParam:"0.23"}),s=()=>{t("params",i),t("close")};return(n,r)=>{const a=z("el-input"),l=z("el-form-item"),u=z("el-button"),c=z("el-form");return G(),Z("div",Vi,[$i,p("div",zi,[v(c,{model:i,"label-width":"auto",style:{"max-width":"600px"}},{default:w(()=>[v(l,{label:"模拟时间(小时)"},{default:w(()=>[v(a,{modelValue:i.simulateHour,"onUpdate:modelValue":r[0]||(r[0]=h=>i.simulateHour=h)},null,8,["modelValue"])]),_:1}),v(l,{label:"模拟步长(分钟)"},{default:w(()=>[v(a,{modelValue:i.simulateStep,"onUpdate:modelValue":r[1]||(r[1]=h=>i.simulateStep=h)},null,8,["modelValue"])]),_:1}),v(l,{label:"底摩擦系数(曼宁系数)"},{default:w(()=>[v(a,{modelValue:i.frictionParam,"onUpdate:modelValue":r[2]||(r[2]=h=>i.frictionParam=h)},null,8,["modelValue"])]),_:1}),v(l,{label:"最小水深(m)"},{default:w(()=>[v(a,{modelValue:i.minWaterDepth,"onUpdate:modelValue":r[3]||(r[3]=h=>i.minWaterDepth=h)},null,8,["modelValue"])]),_:1}),v(l,{label:"水平涡动粘性系数"},{default:w(()=>[v(a,{modelValue:i.SmagorinskyParam,"onUpdate:modelValue":r[4]||(r[4]=h=>i.SmagorinskyParam=h)},null,8,["modelValue"])]),_:1}),v(l,null,{default:w(()=>[p("div",Oi,[v(u,{type:"primary",onClick:s},{default:w(()=>[X("确定")]),_:1}),v(u,{onClick:r[5]||(r[5]=h=>t("close"))},{default:w(()=>[X("取消")]),_:1})])]),_:1})]),_:1},8,["model"])])])}}},ji=Ne(Gi,[["__scopeId","data-v-22c7ec9b"]]),Wt=hi("stability",()=>{const o=D("undefined"),e=D(0),t=D(0);return{modelStatus:o,modelProgress:e,modelStartTime:t}},{persist:{storage:sessionStorage,paths:["stability"]}}),Pt=o=>(Ye("data-v-f7b991d7"),o=o(),Xe(),o),Ni={class:"stParams"},Yi=Pt(()=>p("div",{class:"head"},[p("div",{class:"head-text"},"模型运行状况")],-1)),Xi={class:"status-container"},Hi={key:0},Wi={class:"slider-demo-block"},qi={class:"demonstration",style:{"padding-bottom":"10px"}},Ki={style:{"padding-top":"10px"}},Zi={key:1,style:{width:"100%",display:"flex","justify-content":"center"}},Ji=Pt(()=>p("div",null,"模型尚未运行",-1)),Qi=[Ji],es={key:2},ts=Pt(()=>p("div",null,"模型运行完成",-1)),is=[ts],ss={class:"button-container"},ns={__name:"ModelStatus",emits:["close"],setup(o,{emit:e}){const t=Wt(),i=Ge(()=>Number(t.modelProgress.toFixed(3))),s=Ge(()=>{const a=(Date.now()-t.modelStartTime)/1e3/t.modelProgress*(100-t.modelProgress),l=Math.floor(a/3600),u=Math.floor(a%3600/60),c=Math.floor(a%60);return u?`预计${l}小时${u}分${c}秒完成`:"预计时间正在计算中"}),n=e,r=()=>{n("close")};return(a,l)=>{const u=z("el-slider"),c=z("el-button");return G(),Z("div",Ni,[Yi,p("div",Xi,[ot(t).modelStatus==="pending"?(G(),Z("div",Hi,[p("div",Wi,[p("div",qi,de(`当前进度: ${i.value}%`),1),v(u,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=h=>i.value=h),"show-tooltip":!1},null,8,["modelValue"])]),p("div",Ki,de(s.value),1)])):ot(t).modelStatus==="undefined"?(G(),Z("div",Zi,Qi)):ot(t).modelStatus==="success"?(G(),Z("div",es,is)):ge("",!0)]),p("div",ss,[v(c,{type:"primary",onClick:r},{default:w(()=>[X("确定")]),_:1})])])}}},rs=Ne(ns,[["__scopeId","data-v-f7b991d7"]]),le=11102230246251565e-32,K=134217729,as=(3+8*le)*le;function dt(o,e,t,i,s){let n,r,a,l,u=e[0],c=i[0],h=0,f=0;c>u==c>-u?(n=u,u=e[++h]):(n=c,c=i[++f]);let d=0;if(h<o&&f<t)for(c>u==c>-u?(r=u+n,a=n-(r-u),u=e[++h]):(r=c+n,a=n-(r-c),c=i[++f]),n=r,a!==0&&(s[d++]=a);h<o&&f<t;)c>u==c>-u?(r=n+u,l=r-n,a=n-(r-l)+(u-l),u=e[++h]):(r=n+c,l=r-n,a=n-(r-l)+(c-l),c=i[++f]),n=r,a!==0&&(s[d++]=a);for(;h<o;)r=n+u,l=r-n,a=n-(r-l)+(u-l),u=e[++h],n=r,a!==0&&(s[d++]=a);for(;f<t;)r=n+c,l=r-n,a=n-(r-l)+(c-l),c=i[++f],n=r,a!==0&&(s[d++]=a);return(n!==0||d===0)&&(s[d++]=n),d}function os(o,e){let t=e[0];for(let i=1;i<o;i++)t+=e[i];return t}function De(o){return new Float64Array(o)}const ls=(3+16*le)*le,hs=(2+12*le)*le,us=(9+64*le)*le*le,Se=De(4),Vt=De(8),$t=De(12),zt=De(16),te=De(4);function ds(o,e,t,i,s,n,r){let a,l,u,c,h,f,d,y,g,S,_,P,M,L,E,F,$,A;const x=o-s,T=t-s,C=e-n,U=i-n;L=x*U,f=K*x,d=f-(f-x),y=x-d,f=K*U,g=f-(f-U),S=U-g,E=y*S-(L-d*g-y*g-d*S),F=C*T,f=K*C,d=f-(f-C),y=C-d,f=K*T,g=f-(f-T),S=T-g,$=y*S-(F-d*g-y*g-d*S),_=E-$,h=E-_,Se[0]=E-(_+h)+(h-$),P=L+_,h=P-L,M=L-(P-h)+(_-h),_=M-F,h=M-_,Se[1]=M-(_+h)+(h-F),A=P+_,h=A-P,Se[2]=P-(A-h)+(_-h),Se[3]=A;let R=os(4,Se),O=hs*r;if(R>=O||-R>=O||(h=o-x,a=o-(x+h)+(h-s),h=t-T,u=t-(T+h)+(h-s),h=e-C,l=e-(C+h)+(h-n),h=i-U,c=i-(U+h)+(h-n),a===0&&l===0&&u===0&&c===0)||(O=us*r+as*Math.abs(R),R+=x*c+U*a-(C*u+T*l),R>=O||-R>=O))return R;L=a*U,f=K*a,d=f-(f-a),y=a-d,f=K*U,g=f-(f-U),S=U-g,E=y*S-(L-d*g-y*g-d*S),F=l*T,f=K*l,d=f-(f-l),y=l-d,f=K*T,g=f-(f-T),S=T-g,$=y*S-(F-d*g-y*g-d*S),_=E-$,h=E-_,te[0]=E-(_+h)+(h-$),P=L+_,h=P-L,M=L-(P-h)+(_-h),_=M-F,h=M-_,te[1]=M-(_+h)+(h-F),A=P+_,h=A-P,te[2]=P-(A-h)+(_-h),te[3]=A;const I=dt(4,Se,4,te,Vt);L=x*c,f=K*x,d=f-(f-x),y=x-d,f=K*c,g=f-(f-c),S=c-g,E=y*S-(L-d*g-y*g-d*S),F=C*u,f=K*C,d=f-(f-C),y=C-d,f=K*u,g=f-(f-u),S=u-g,$=y*S-(F-d*g-y*g-d*S),_=E-$,h=E-_,te[0]=E-(_+h)+(h-$),P=L+_,h=P-L,M=L-(P-h)+(_-h),_=M-F,h=M-_,te[1]=M-(_+h)+(h-F),A=P+_,h=A-P,te[2]=P-(A-h)+(_-h),te[3]=A;const k=dt(I,Vt,4,te,$t);L=a*c,f=K*a,d=f-(f-a),y=a-d,f=K*c,g=f-(f-c),S=c-g,E=y*S-(L-d*g-y*g-d*S),F=l*u,f=K*l,d=f-(f-l),y=l-d,f=K*u,g=f-(f-u),S=u-g,$=y*S-(F-d*g-y*g-d*S),_=E-$,h=E-_,te[0]=E-(_+h)+(h-$),P=L+_,h=P-L,M=L-(P-h)+(_-h),_=M-F,h=M-_,te[1]=M-(_+h)+(h-F),A=P+_,h=A-P,te[2]=P-(A-h)+(_-h),te[3]=A;const V=dt(k,$t,4,te,zt);return zt[V-1]}function ze(o,e,t,i,s,n){const r=(e-n)*(t-s),a=(o-s)*(i-n),l=r-a,u=Math.abs(r+a);return Math.abs(l)>=ls*u?l:-ds(o,e,t,i,s,n,u)}const Ot=Math.pow(2,-52),Oe=new Uint32Array(512);class je{static from(e,t=gs,i=ys){const s=e.length,n=new Float64Array(s*2);for(let r=0;r<s;r++){const a=e[r];n[2*r]=t(a),n[2*r+1]=i(a)}return new je(n)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*t-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:i,_hullTri:s,_hullHash:n}=this,r=e.length>>1;let a=1/0,l=1/0,u=-1/0,c=-1/0;for(let x=0;x<r;x++){const T=e[2*x],C=e[2*x+1];T<a&&(a=T),C<l&&(l=C),T>u&&(u=T),C>c&&(c=C),this._ids[x]=x}const h=(a+u)/2,f=(l+c)/2;let d,y,g;for(let x=0,T=1/0;x<r;x++){const C=ct(h,f,e[2*x],e[2*x+1]);C<T&&(d=x,T=C)}const S=e[2*d],_=e[2*d+1];for(let x=0,T=1/0;x<r;x++){if(x===d)continue;const C=ct(S,_,e[2*x],e[2*x+1]);C<T&&C>0&&(y=x,T=C)}let P=e[2*y],M=e[2*y+1],L=1/0;for(let x=0;x<r;x++){if(x===d||x===y)continue;const T=ms(S,_,P,M,e[2*x],e[2*x+1]);T<L&&(g=x,L=T)}let E=e[2*g],F=e[2*g+1];if(L===1/0){for(let C=0;C<r;C++)this._dists[C]=e[2*C]-e[0]||e[2*C+1]-e[1];Pe(this._ids,this._dists,0,r-1);const x=new Uint32Array(r);let T=0;for(let C=0,U=-1/0;C<r;C++){const R=this._ids[C],O=this._dists[R];O>U&&(x[T++]=R,U=O)}this.hull=x.subarray(0,T),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(ze(S,_,P,M,E,F)<0){const x=y,T=P,C=M;y=g,P=E,M=F,g=x,E=T,F=C}const $=ps(S,_,P,M,E,F);this._cx=$.x,this._cy=$.y;for(let x=0;x<r;x++)this._dists[x]=ct(e[2*x],e[2*x+1],$.x,$.y);Pe(this._ids,this._dists,0,r-1),this._hullStart=d;let A=3;i[d]=t[g]=y,i[y]=t[d]=g,i[g]=t[y]=d,s[d]=0,s[y]=1,s[g]=2,n.fill(-1),n[this._hashKey(S,_)]=d,n[this._hashKey(P,M)]=y,n[this._hashKey(E,F)]=g,this.trianglesLen=0,this._addTriangle(d,y,g,-1,-1,-1);for(let x=0,T,C;x<this._ids.length;x++){const U=this._ids[x],R=e[2*U],O=e[2*U+1];if(x>0&&Math.abs(R-T)<=Ot&&Math.abs(O-C)<=Ot||(T=R,C=O,U===d||U===y||U===g))continue;let I=0;for(let he=0,qe=this._hashKey(R,O);he<this._hashSize&&(I=n[(qe+he)%this._hashSize],!(I!==-1&&I!==i[I]));he++);I=t[I];let k=I,V;for(;V=i[k],ze(R,O,e[2*k],e[2*k+1],e[2*V],e[2*V+1])>=0;)if(k=V,k===I){k=-1;break}if(k===-1)continue;let Q=this._addTriangle(k,U,i[k],-1,-1,s[k]);s[U]=this._legalize(Q+2),s[k]=Q,A++;let H=i[k];for(;V=i[H],ze(R,O,e[2*H],e[2*H+1],e[2*V],e[2*V+1])<0;)Q=this._addTriangle(H,U,V,s[U],-1,s[H]),s[U]=this._legalize(Q+2),i[H]=H,A--,H=V;if(k===I)for(;V=t[k],ze(R,O,e[2*V],e[2*V+1],e[2*k],e[2*k+1])<0;)Q=this._addTriangle(V,U,k,-1,s[k],s[V]),this._legalize(Q+2),s[V]=Q,i[k]=k,A--,k=V;this._hullStart=t[U]=k,i[k]=t[H]=U,i[U]=H,n[this._hashKey(R,O)]=U,n[this._hashKey(e[2*k],e[2*k+1])]=k}this.hull=new Uint32Array(A);for(let x=0,T=this._hullStart;x<A;x++)this.hull[x]=T,T=i[T];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(cs(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:i,coords:s}=this;let n=0,r=0;for(;;){const a=i[e],l=e-e%3;if(r=l+(e+2)%3,a===-1){if(n===0)break;e=Oe[--n];continue}const u=a-a%3,c=l+(e+1)%3,h=u+(a+2)%3,f=t[r],d=t[e],y=t[c],g=t[h];if(fs(s[2*f],s[2*f+1],s[2*d],s[2*d+1],s[2*y],s[2*y+1],s[2*g],s[2*g+1])){t[e]=g,t[a]=f;const _=i[h];if(_===-1){let M=this._hullStart;do{if(this._hullTri[M]===h){this._hullTri[M]=e;break}M=this._hullPrev[M]}while(M!==this._hullStart)}this._link(e,_),this._link(a,i[r]),this._link(r,h);const P=u+(a+1)%3;n<Oe.length&&(Oe[n++]=P)}else{if(n===0)break;e=Oe[--n]}}return r}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,i,s,n,r){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=i,this._link(a,s),this._link(a+1,n),this._link(a+2,r),this.trianglesLen+=3,a}}function cs(o,e){const t=o/(Math.abs(o)+Math.abs(e));return(e>0?3-t:1+t)/4}function ct(o,e,t,i){const s=o-t,n=e-i;return s*s+n*n}function fs(o,e,t,i,s,n,r,a){const l=o-r,u=e-a,c=t-r,h=i-a,f=s-r,d=n-a,y=l*l+u*u,g=c*c+h*h,S=f*f+d*d;return l*(h*S-g*d)-u*(c*S-g*f)+y*(c*d-h*f)<0}function ms(o,e,t,i,s,n){const r=t-o,a=i-e,l=s-o,u=n-e,c=r*r+a*a,h=l*l+u*u,f=.5/(r*u-a*l),d=(u*c-a*h)*f,y=(r*h-l*c)*f;return d*d+y*y}function ps(o,e,t,i,s,n){const r=t-o,a=i-e,l=s-o,u=n-e,c=r*r+a*a,h=l*l+u*u,f=.5/(r*u-a*l),d=o+(u*c-a*h)*f,y=e+(r*h-l*c)*f;return{x:d,y}}function Pe(o,e,t,i){if(i-t<=20)for(let s=t+1;s<=i;s++){const n=o[s],r=e[n];let a=s-1;for(;a>=t&&e[o[a]]>r;)o[a+1]=o[a--];o[a+1]=n}else{const s=t+i>>1;let n=t+1,r=i;Re(o,s,n),e[o[t]]>e[o[i]]&&Re(o,t,i),e[o[n]]>e[o[i]]&&Re(o,n,i),e[o[t]]>e[o[n]]&&Re(o,t,n);const a=o[n],l=e[a];for(;;){do n++;while(e[o[n]]<l);do r--;while(e[o[r]]>l);if(r<n)break;Re(o,n,r)}o[t+1]=o[r],o[r]=a,i-n+1>=r-t?(Pe(o,e,n,i),Pe(o,e,t,r-1)):(Pe(o,e,t,r-1),Pe(o,e,n,i))}}function Re(o,e,t){const i=o[e];o[e]=o[t],o[t]=i}function gs(o){return o[0]}function ys(o){return o[1]}const Gt=1e-6;class ye{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,i){e=+e,t=+t,i=+i;const s=e+i,n=t;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${s},${n}`:(Math.abs(this._x1-s)>Gt||Math.abs(this._y1-n)>Gt)&&(this._+="L"+s+","+n),i&&(this._+=`A${i},${i},0,1,1,${e-i},${t}A${i},${i},0,1,1,${this._x1=s},${this._y1=n}`)}rect(e,t,i,s){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+i}v${+s}h${-i}Z`}value(){return this._||null}}class ft{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class bs{constructor(e,[t,i,s,n]=[0,0,960,500]){if(!((s=+s)>=(t=+t))||!((n=+n)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=s,this.xmin=t,this.ymax=n,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:i},vectors:s}=this;let n,r;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let g=0,S=0,_=i.length,P,M;g<_;g+=3,S+=2){const L=i[g]*2,E=i[g+1]*2,F=i[g+2]*2,$=e[L],A=e[L+1],x=e[E],T=e[E+1],C=e[F],U=e[F+1],R=x-$,O=T-A,I=C-$,k=U-A,V=(R*k-O*I)*2;if(Math.abs(V)<1e-9){if(n===void 0){n=r=0;for(const H of t)n+=e[H*2],r+=e[H*2+1];n/=t.length,r/=t.length}const Q=1e9*Math.sign((n-$)*k-(r-A)*I);P=($+C)/2-Q*k,M=(A+U)/2+Q*I}else{const Q=1/V,H=R*R+O*O,he=I*I+k*k;P=$+(k*H-O*he)*Q,M=A+(R*he-I*H)*Q}a[S]=P,a[S+1]=M}let l=t[t.length-1],u,c=l*4,h,f=e[2*l],d,y=e[2*l+1];s.fill(0);for(let g=0;g<t.length;++g)l=t[g],u=c,h=f,d=y,c=l*4,f=e[2*l],y=e[2*l+1],s[u+2]=s[c]=d-y,s[u+3]=s[c+1]=f-h}render(e){const t=e==null?e=new ye:void 0,{delaunay:{halfedges:i,inedges:s,hull:n},circumcenters:r,vectors:a}=this;if(n.length<=1)return null;for(let c=0,h=i.length;c<h;++c){const f=i[c];if(f<c)continue;const d=Math.floor(c/3)*2,y=Math.floor(f/3)*2,g=r[d],S=r[d+1],_=r[y],P=r[y+1];this._renderSegment(g,S,_,P,e)}let l,u=n[n.length-1];for(let c=0;c<n.length;++c){l=u,u=n[c];const h=Math.floor(s[u]/3)*2,f=r[h],d=r[h+1],y=l*4,g=this._project(f,d,a[y+2],a[y+3]);g&&this._renderSegment(f,d,g[0],g[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new ye:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const i=t==null?t=new ye:void 0,s=this._clip(e);if(s===null||!s.length)return;t.moveTo(s[0],s[1]);let n=s.length;for(;s[0]===s[n-2]&&s[1]===s[n-1]&&n>1;)n-=2;for(let r=2;r<n;r+=2)(s[r]!==s[r-2]||s[r+1]!==s[r-1])&&t.lineTo(s[r],s[r+1]);return t.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,i=e.length/2;t<i;++t){const s=this.cellPolygon(t);s&&(s.index=t,yield s)}}cellPolygon(e){const t=new ft;return this.renderCell(e,t),t.value()}_renderSegment(e,t,i,s,n){let r;const a=this._regioncode(e,t),l=this._regioncode(i,s);a===0&&l===0?(n.moveTo(e,t),n.lineTo(i,s)):(r=this._clipSegment(e,t,i,s,a,l))&&(n.moveTo(r[0],r[1]),n.lineTo(r[2],r[3]))}contains(e,t,i){return t=+t,t!==t||(i=+i,i!==i)?!1:this.delaunay._step(e,t,i)===e}*neighbors(e){const t=this._clip(e);if(t)for(const i of this.delaunay.neighbors(e)){const s=this._clip(i);if(s){e:for(let n=0,r=t.length;n<r;n+=2)for(let a=0,l=s.length;a<l;a+=2)if(t[n]===s[a]&&t[n+1]===s[a+1]&&t[(n+2)%r]===s[(a+l-2)%l]&&t[(n+3)%r]===s[(a+l-1)%l]){yield i;break e}}}}_cell(e){const{circumcenters:t,delaunay:{inedges:i,halfedges:s,triangles:n}}=this,r=i[e];if(r===-1)return null;const a=[];let l=r;do{const u=Math.floor(l/3);if(a.push(t[u*2],t[u*2+1]),l=l%3===2?l-2:l+1,n[l]!==e)break;l=s[l]}while(l!==r&&l!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:i}=this,s=e*4;return this._simplify(i[s]||i[s+1]?this._clipInfinite(e,t,i[s],i[s+1],i[s+2],i[s+3]):this._clipFinite(e,t))}_clipFinite(e,t){const i=t.length;let s=null,n,r,a=t[i-2],l=t[i-1],u,c=this._regioncode(a,l),h,f=0;for(let d=0;d<i;d+=2)if(n=a,r=l,a=t[d],l=t[d+1],u=c,c=this._regioncode(a,l),u===0&&c===0)h=f,f=0,s?s.push(a,l):s=[a,l];else{let y,g,S,_,P;if(u===0){if((y=this._clipSegment(n,r,a,l,u,c))===null)continue;[g,S,_,P]=y}else{if((y=this._clipSegment(a,l,n,r,c,u))===null)continue;[_,P,g,S]=y,h=f,f=this._edgecode(g,S),h&&f&&this._edge(e,h,f,s,s.length),s?s.push(g,S):s=[g,S]}h=f,f=this._edgecode(_,P),h&&f&&this._edge(e,h,f,s,s.length),s?s.push(_,P):s=[_,P]}if(s)h=f,f=this._edgecode(s[0],s[1]),h&&f&&this._edge(e,h,f,s,s.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return s}_clipSegment(e,t,i,s,n,r){const a=n<r;for(a&&([e,t,i,s,n,r]=[i,s,e,t,r,n]);;){if(n===0&&r===0)return a?[i,s,e,t]:[e,t,i,s];if(n&r)return null;let l,u,c=n||r;c&8?(l=e+(i-e)*(this.ymax-t)/(s-t),u=this.ymax):c&4?(l=e+(i-e)*(this.ymin-t)/(s-t),u=this.ymin):c&2?(u=t+(s-t)*(this.xmax-e)/(i-e),l=this.xmax):(u=t+(s-t)*(this.xmin-e)/(i-e),l=this.xmin),n?(e=l,t=u,n=this._regioncode(e,t)):(i=l,s=u,r=this._regioncode(i,s))}}_clipInfinite(e,t,i,s,n,r){let a=Array.from(t),l;if((l=this._project(a[0],a[1],i,s))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],n,r))&&a.push(l[0],l[1]),a=this._clipFinite(e,a))for(let u=0,c=a.length,h,f=this._edgecode(a[c-2],a[c-1]);u<c;u+=2)h=f,f=this._edgecode(a[u],a[u+1]),h&&f&&(u=this._edge(e,h,f,a,u),c=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,t,i,s,n){for(;t!==i;){let r,a;switch(t){case 5:t=4;continue;case 4:t=6,r=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,r=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,r=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,r=this.xmin,a=this.ymin;break}(s[n]!==r||s[n+1]!==a)&&this.contains(e,r,a)&&(s.splice(n,0,r,a),n+=2)}return n}_project(e,t,i,s){let n=1/0,r,a,l;if(s<0){if(t<=this.ymin)return null;(r=(this.ymin-t)/s)<n&&(l=this.ymin,a=e+(n=r)*i)}else if(s>0){if(t>=this.ymax)return null;(r=(this.ymax-t)/s)<n&&(l=this.ymax,a=e+(n=r)*i)}if(i>0){if(e>=this.xmax)return null;(r=(this.xmax-e)/i)<n&&(a=this.xmax,l=t+(n=r)*s)}else if(i<0){if(e<=this.xmin)return null;(r=(this.xmin-e)/i)<n&&(a=this.xmin,l=t+(n=r)*s)}return[a,l]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const i=(t+2)%e.length,s=(t+4)%e.length;(e[t]===e[i]&&e[i]===e[s]||e[t+1]===e[i+1]&&e[i+1]===e[s+1])&&(e.splice(i,2),t-=2)}e.length||(e=null)}return e}}const _s=2*Math.PI,Be=Math.pow;function vs(o){return o[0]}function xs(o){return o[1]}function ws(o){const{triangles:e,coords:t}=o;for(let i=0;i<e.length;i+=3){const s=2*e[i],n=2*e[i+1],r=2*e[i+2];if((t[r]-t[s])*(t[n+1]-t[s+1])-(t[n]-t[s])*(t[r+1]-t[s+1])>1e-10)return!1}return!0}function Ss(o,e,t){return[o+Math.sin(o+e)*t,e+Math.cos(o-e)*t]}class Ct{static from(e,t=vs,i=xs,s){return new Ct("length"in e?Bs(e,t,i,s):Float64Array.from(Ps(e,t,i,s)))}constructor(e){this._delaunator=new je(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&ws(e)){this.collinear=Int32Array.from({length:t.length/2},(f,d)=>d).sort((f,d)=>t[2*f]-t[2*d]||t[2*f+1]-t[2*d+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],c=[t[2*l],t[2*l+1],t[2*u],t[2*u+1]],h=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let f=0,d=t.length/2;f<d;++f){const y=Ss(t[2*f],t[2*f+1],h);t[2*f]=y[0],t[2*f+1]=y[1]}this._delaunator=new je(t)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,s=this.hull=this._delaunator.hull,n=this.triangles=this._delaunator.triangles,r=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,u=i.length;l<u;++l){const c=n[l%3===2?l-2:l+1];(i[l]===-1||r[c]===-1)&&(r[c]=l)}for(let l=0,u=s.length;l<u;++l)a[s[l]]=l;s.length<=2&&s.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=s[0],r[s[0]]=1,s.length===2&&(r[s[1]]=0,this.triangles[1]=s[1],this.triangles[2]=s[1]))}voronoi(e){return new bs(this,e)}*neighbors(e){const{inedges:t,hull:i,_hullIndex:s,halfedges:n,triangles:r,collinear:a}=this;if(a){const h=a.indexOf(e);h>0&&(yield a[h-1]),h<a.length-1&&(yield a[h+1]);return}const l=t[e];if(l===-1)return;let u=l,c=-1;do{if(yield c=r[u],u=u%3===2?u-2:u+1,r[u]!==e)return;if(u=n[u],u===-1){const h=i[(s[e]+1)%i.length];h!==c&&(yield h);return}}while(u!==l)}find(e,t,i=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const s=i;let n;for(;(n=this._step(i,e,t))>=0&&n!==i&&n!==s;)i=n;return n}_step(e,t,i){const{inedges:s,hull:n,_hullIndex:r,halfedges:a,triangles:l,points:u}=this;if(s[e]===-1||!u.length)return(e+1)%(u.length>>1);let c=e,h=Be(t-u[e*2],2)+Be(i-u[e*2+1],2);const f=s[e];let d=f;do{let y=l[d];const g=Be(t-u[y*2],2)+Be(i-u[y*2+1],2);if(g<h&&(h=g,c=y),d=d%3===2?d-2:d+1,l[d]!==e)break;if(d=a[d],d===-1){if(d=n[(r[e]+1)%n.length],d!==y&&Be(t-u[d*2],2)+Be(i-u[d*2+1],2)<h)return d;break}}while(d!==f);return c}render(e){const t=e==null?e=new ye:void 0,{points:i,halfedges:s,triangles:n}=this;for(let r=0,a=s.length;r<a;++r){const l=s[r];if(l<r)continue;const u=n[r]*2,c=n[l]*2;e.moveTo(i[u],i[u+1]),e.lineTo(i[c],i[c+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!="function")&&(t=e,e=null),t=t==null?2:+t;const i=e==null?e=new ye:void 0,{points:s}=this;for(let n=0,r=s.length;n<r;n+=2){const a=s[n],l=s[n+1];e.moveTo(a+t,l),e.arc(a,l,t,0,_s)}return i&&i.value()}renderHull(e){const t=e==null?e=new ye:void 0,{hull:i,points:s}=this,n=i[0]*2,r=i.length;e.moveTo(s[n],s[n+1]);for(let a=1;a<r;++a){const l=2*i[a];e.lineTo(s[l],s[l+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new ft;return this.renderHull(e),e.value()}renderTriangle(e,t){const i=t==null?t=new ye:void 0,{points:s,triangles:n}=this,r=n[e*=3]*2,a=n[e+1]*2,l=n[e+2]*2;return t.moveTo(s[r],s[r+1]),t.lineTo(s[a],s[a+1]),t.lineTo(s[l],s[l+1]),t.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,i=e.length/3;t<i;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new ft;return this.renderTriangle(e,t),t.value()}}function Bs(o,e,t,i){const s=o.length,n=new Float64Array(s*2);for(let r=0;r<s;++r){const a=o[r];n[r*2]=e.call(i,a,r,o),n[r*2+1]=t.call(i,a,r,o)}return n}function*Ps(o,e,t,i){let s=0;for(const n of o)yield e.call(i,n,s,o),yield t.call(i,n,s,o),++s}class Cs{constructor(e,t,i,s){this.type="custom",this.map=void 0,this.id=e,this.renderingMode="3d",this.preheat=0,this.swapPointer=0,this.extent=ui(),this.worker=void 0,this.uvUrlList=i,this.stationUrl=t,this.endPoint="",this.progress=0,this.startPoint="",this.framesPerPhase=100,this.maxSpeed=Ee(),this.maxParticleNum=1e4,this.progressRate=Ee(),this.currentResourcePointer=0,this.particleNum=Bi(5e3),this.speedFactor=Ee(1),this.timePointParser=s,this.randomSeed=Ee(Math.random()),this.blockSizeX=16,this.blockSizeY=16,this.lastMvp=Et(),this.lastMvpInverse=Et(),this.groupSizeX=Math.ceil(Math.sqrt(this.maxParticleNum)/this.blockSizeX),this.groupSizeY=Math.ceil(Math.sqrt(this.maxParticleNum)/this.blockSizeY),this.randomFillData=new Float32Array(this.maxParticleNum*6).map((n,r)=>r%6==4||r%6==5?0:Math.random()),this.toRef=void 0,this.fromRef=void 0,this.nextRef=void 0,this.uniformBuffer_frame=void 0,this.indexBuffer_voronoi=void 0,this.vertexBuffer_voronoi=void 0,this.uniformBuffer_static=void 0,this.storageBuffer_particle=void 0,this.particleRef=ve(this.randomFillData),this.flowTexture=void 0,this.depthTexture=void 0,this.layerTexture1=void 0,this.layerTexture2=void 0,this.copiedDepthTexture=void 0,this.showBinding=void 0,this.layerBindings=void 0,this.voronoiBinding=void 0,this.segmentBinding=void 0,this.voronoiToBinding=void 0,this.simulationBinding=void 0,this.trajectoryBindings=void 0,this.showPipeline=void 0,this.layerPipeline=void 0,this.voronoiPipeline=void 0,this.segmentPipeline=void 0,this.trajectoryPipeline=void 0,this.simulationPipeline=void 0,this.swapPasses=void 0,this.voronoiPass=void 0,this.simulationPass=void 0,this.isHided=!1,this.isIdling=!1,this.showArrow=!1,this.showVoronoi=!0,this.nextPrepared=!1,this.isInitialized=!1,this.nextPreparing=!1}onAdd(e,t){this.map=e,this.map.on("movestart",()=>this.idle()),this.map.on("move",()=>this.idle()),this.map.on("moveend",()=>this.restart()),this.map.on("dragstart",()=>this.idle()),this.map.on("drag",()=>this.idle()),this.map.on("dragend",()=>this.restart()),this.map.on("zoomstart",()=>this.idle()),this.map.on("zoom",()=>this.idle()),this.map.on("zoomend",()=>this.restart()),this.map.on("rotatestart",()=>this.idle()),this.map.on("rotate",()=>this.idle()),this.map.on("rotateend",()=>this.restart()),this.map.on("pitchstart",()=>this.idle()),this.map.on("pitch",()=>this.idle()),this.map.on("pitchend",()=>this.restart()),this.addWorker(new Worker(new URL("/assets/flowJson.worker-CkmozBgC.js",import.meta.url),{type:"module"})),this.init()}render(e,t){if(this.map.triggerRepaint(),!(!this.isInitialized||this.isIdling||this.preheat-- >0)){if(this.isHided){this.makeVisibility(!1);return}else this.makeVisibility(!0);this.showBinding.executable=!1,this.swapPasses[0].executable=this.swapPasses[1].executable=this.layerBindings[0].executable=this.swapPointer,this.swapPasses[2].executable=this.swapPasses[3].executable=this.layerBindings[1].executable=1-this.swapPointer,this.swapPointer=(this.swapPointer+1)%2,this.updateVoronoi(),this.randomSeed.n=Math.random(),this.lastMvp.copyFrom(this.map.uMatrix),this.lastMvpInverse.copyFrom(this.map.mvpInverse)}}async resetResource(e){let t=async i=>{this.nextPreparing=!0;let s=await lt.get(i,{responseType:"arraybuffer"}),n=new Float32Array(s.data),r=-1/0;for(let a=0;a<n.length;a+=2){const l=n[a+0],u=n[a+1],c=Math.sqrt(l*l+u*u);r=c>r?c:r}this.nextRef.value=n,this.updateMaxSpeed(r),this.nextPreparing=!1,this.nextPrepared=!0,n=null,s=null};this.progress=0,this.maxSpeed.n=0,this.progressRate.n=0,this.uvUrlList=e,this.startPoint=this.timePointParser(this.uvUrlList[0]),this.endPoint=this.timePointParser(this.uvUrlList[this.uvUrlList.length-1]),await t(this.uvUrlList[0]),this.swapVoronoiBinding(),await t(this.uvUrlList[1]),this.swapVoronoiBinding(),this.currentResourcePointer=1,this.nextPrepared=!0}async setProgress(e){let t=Math.ceil(e/100*(this.uvUrlList.length-1)),i=t+1;i==this.uvUrlList.length&&(i=0);let s=async n=>{this.nextPreparing=!0;let r=await lt.get(n,{responseType:"arraybuffer"}),a=new Float32Array(r.data),l=-1/0;for(let u=0;u<a.length;u+=2){const c=a[u+0],h=a[u+1],f=Math.sqrt(c*c+h*h);l=f>l?f:l}this.nextRef.value=a,this.updateMaxSpeed(l),this.nextPreparing=!1,this.nextPrepared=!0,r=null,a=null};this.progress=0,this.maxSpeed.n=0,this.progressRate.n=0,this.startPoint=this.timePointParser(this.uvUrlList[0]),this.endPoint=this.timePointParser(this.uvUrlList[this.uvUrlList.length-1]),await s(this.uvUrlList[t]),this.swapVoronoiBinding(),await s(this.uvUrlList[i]),this.swapVoronoiBinding(),this.currentResourcePointer=i,this.nextPrepared=!0}async init(){this.isInitialized=!1;let e=async s=>{const n=await lt.get(s,{responseType:"arraybuffer"}),r=new Ct(new Float32Array(n.data)),a=[],l=r.triangles;for(let u=0;u<r.points.length;u+=2){this.extent.update(r.points[u+0],r.points[u+1]);const c=jt(Mt.mercatorXfromLon(r.points[u+0])),h=jt(Mt.mercatorYfromLat(r.points[u+1]));a.push(c[0]),a.push(h[0]),a.push(c[1]),a.push(h[1])}return this.nextRef=ve(new Float32Array(r.points.length).fill(0)),this.fromRef=ve(new Float32Array(r.points.length).fill(0)),this.toRef=ve(new Float32Array(r.points.length).fill(0)),{indices:l,vertices:a}};const{indices:t,vertices:i}=await e(this.stationUrl);await this.resetResource(this.uvUrlList),this.storageBuffer_particle=xi({name:"Storage Buffer (Particle Position & Velocity)",resource:{arrayRef:this.particleRef}}),this.uniformBuffer_static=Dt({name:"Uniform Buffer (Flow Layer Static)",blocks:[Rt({name:"staticUniform",map:{groupSize:Ci(this.groupSizeX,this.groupSizeY),extent:this.extent.boundary}})]}),this.uniformBuffer_frame=Dt({name:"Uniform Buffer (Flow Layer Frame)",blocks:[Rt({name:"frameUniform",dynamic:!0,map:{randomSeed:this.randomSeed,viewPort:this.map.screen.sizeF,mapBounds:this.map.cameraBounds.boundary,zoomLevel:this.map.zoom,progressRate:this.progressRate,maxSpeed:this.maxSpeed,lastMvp:this.lastMvp,lastMvpInverse:this.lastMvpInverse,fillWidth:Fe(1),aaWidth:Fe(2)}})]}),this.layerTexture1=this.map.screen.createScreenDependentTexture("Texture (Background 1)"),this.layerTexture2=this.map.screen.createScreenDependentTexture("Texture (Background 2)"),this.flowTexture=this.map.screen.createScreenDependentTexture("Texture (Velocity)","rg32float"),this.indexBuffer_voronoi=Si({name:"IndexBuffer (Voronoi Index)",resource:{arrayRef:ve(new Uint32Array(t))}}),this.vertexBuffer_voronoi=ht({name:"VertexBuffer (Station Position)",resource:{arrayRef:ve(new Float32Array(i)),structure:[{components:4}]}}),this.voronoiBinding=oe({name:"Binding (Flow-Field Voronoi)",range:()=>[this.indexBuffer_voronoi.length],index:{buffer:this.indexBuffer_voronoi},vertices:[{buffer:this.vertexBuffer_voronoi},{buffer:ht({name:"VertexBuffer (Station Velocity (From))",resource:{arrayRef:this.fromRef,structure:[{components:2}]}})},{buffer:ht({name:"VertexBuffer (Station Velocity (To))",resource:{arrayRef:this.toRef,structure:[{components:2}]}})}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.uniformBuffer_static},{buffer:this.map.dynamicUniformBuffer}]}),this.voronoiPipeline=we({name:"Render Pipeline (Voronoi Flow)",shader:{module:me.load("Shader (Flow Voronoi)","/scratchSomething/terrain_flow/shader/flowVoronoi.wgsl")}}),this.voronoiPass=xe({name:"Render Pass (Voronoi Flow From)",colorAttachments:[{colorResource:this.flowTexture}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture}}).add(this.voronoiPipeline,this.voronoiBinding),this.simulationBinding=oe({name:"Binding (Particle Simulation)",range:()=>[this.groupSizeX,this.groupSizeY],textures:[{texture:this.flowTexture,sampleType:"unfilterable-float"}],storages:[{buffer:this.storageBuffer_particle,writable:!0}],uniforms:[{name:"controllerUniform",dynamic:!0,map:{particleNum:Pi(this.maxParticleNum),dropRate:Fe(.003),dropRateBump:Fe(.001),speedFactor:this.speedFactor}}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.uniformBuffer_static},{buffer:this.map.dynamicUniformBuffer}]}),this.simulationPipeline=Ti({name:"Compute Pipeline (Flow Simulation)",shader:{module:me.load("Shader (Particle Simulation)","/scratchSomething/terrain_flow/shader/simulation.compute.wgsl")},constants:{blockSize:16}}),this.simulationPass=ki({name:"Compute Pass (Particle Simulation)"}).add(this.simulationPipeline,this.simulationBinding),this.trajectoryBindings=[oe({name:"Binding (Background Swap 1)",range:()=>[4],textures:[{texture:this.layerTexture2}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.map.dynamicUniformBuffer}]}),oe({name:"Binding (Background Swap 2)",range:()=>[4],textures:[{texture:this.layerTexture1}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.map.dynamicUniformBuffer}]})],this.trajectoryPipeline=we({name:"Render pipeline (Background Trajectory)",shader:{module:me.load("Shader (Background Trajectory)","/scratchSomething/terrain_flow/shader/trajectory.wgsl")},colorTargetStates:[{blend:Ft}],primitive:{topology:"triangle-strip"},depthTest:!1}),this.segmentBinding=oe({name:"Binding (Segment)",range:()=>[4,this.particleNum.n],storages:[{buffer:this.storageBuffer_particle}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.uniformBuffer_static},{buffer:this.map.dynamicUniformBuffer}]}),this.segmentPipeline=we({name:"Render Pipeline (Segment)",shader:{module:me.load("Shader (Segment)","/scratchSomething/terrain_flow/shader/segment.wgsl")},colorTargetStates:[{blend:Ft}],primitive:{topology:"triangle-strip"}}),this.swapPasses=[xe({name:"Render Pass (Past Trajectory 1)",colorAttachments:[{colorResource:this.layerTexture1}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture}}).add(this.trajectoryPipeline,this.trajectoryBindings[0]),xe({name:"Render Pass (Current Segment 1)",colorAttachments:[{colorResource:this.layerTexture1,loadOp:"load"}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture,depthLoadOp:"load"}}).add(this.segmentPipeline,this.segmentBinding),xe({name:"Render Pass (Past Trajectory 2)",colorAttachments:[{colorResource:this.layerTexture2}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture}}).add(this.trajectoryPipeline,this.trajectoryBindings[1]),xe({name:"Render Pass (Current Segment 2)",colorAttachments:[{colorResource:this.layerTexture2,loadOp:"load"}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture,depthLoadOp:"load"}}).add(this.segmentPipeline,this.segmentBinding),xe({name:"Render Pass (Texture Empty)",colorAttachments:[{colorResource:this.layerTexture1},{colorResource:this.layerTexture2}]})],this.layerBindings=[oe({name:"Binding (Layer Renderig 1)",range:()=>[4],textures:[{texture:this.layerTexture1}]}),oe({name:"Binding (Layer Renderig 2)",range:()=>[4],textures:[{texture:this.layerTexture2}]})],this.layerPipeline=we({name:"Render Pipeline (Layer Rendering)",shader:{module:me.load("Shader (Flow Layer Rendering)","/scratchSomething/terrain_flow/shader/flowLayer.wgsl")},primitive:{topology:"triangle-strip"},colorTargetStates:[{blend:ut}]}),this.showBinding=oe({name:"Binding (Flow Show)",range:()=>[4],textures:[{texture:this.flowTexture,sampleType:"unfilterable-float"}],sharedUniforms:[{buffer:this.uniformBuffer_frame}]}),this.showPipeline=we({name:"Render Pipeline (Flow Show)",shader:{module:me.load("Shader (Flow Show)","/scratchSomething/terrain_flow/shader/flowShow.wgsl")},primitive:{topology:"triangle-strip"},colorTargetStates:[{blend:ut}]}),this.arrowBinding=oe({name:"Binding (Arrow)",range:()=>[4,this.particleNum.n],storages:[{buffer:this.storageBuffer_particle}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.uniformBuffer_static},{buffer:this.map.dynamicUniformBuffer}]}),this.arrowPipeline=we({name:"Render Pipeline (Flow Arrow)",shader:{module:me.load("Shader (Flow Show)","/scratchSomething/terrain_flow/shader/arrow.wgsl")},primitive:{topology:"triangle-strip"},colorTargetStates:[{blend:ut}]}),this.swapPasses[0].executable=!0,this.swapPasses[1].executable=!0,this.swapPasses[2].executable=!1,this.swapPasses[3].executable=!1,this.swapPasses[4].executable=!1,this.layerBindings[0].executable=!0,this.layerBindings[1].executable=!1,this.showArrow&&this.map.add2RenderPass(this.arrowPipeline,this.arrowBinding),this.showVoronoi&&this.map.add2RenderPass(this.showPipeline,this.showBinding).add2RenderPass(this.layerPipeline,this.layerBindings[0]).add2RenderPass(this.layerPipeline,this.layerBindings[1]),this.map.add2PreProcess(this.voronoiPass).add2PreProcess(this.simulationPass).add2PreProcess(this.swapPasses[0]).add2PreProcess(this.swapPasses[1]).add2PreProcess(this.swapPasses[2]).add2PreProcess(this.swapPasses[3]).add2PreProcess(this.swapPasses[4]),this.isInitialized=!0}idle(){this.trajectoryPipeline&&(this.trajectoryPipeline.executable=!1)}restart(){this.trajectoryPipeline&&(this.trajectoryPipeline.executable=!0)}show(){this.isHided=!1}hide(){this.isHided=!0}makeVisibility(e){e?(this.showPipeline.executable=!0,this.voronoiPass.executable=!0,this.simulationPass.executable=!0):(this.showPipeline.executable=!1,this.layerBindings[0].executable=!1,this.layerBindings[1].executable=!1,this.voronoiPass.executable=!1,this.swapPasses[0].executable=!1,this.swapPasses[1].executable=!1,this.swapPasses[2].executable=!1,this.simulationPass.executable=!1)}updateMaxSpeed(e){this.maxSpeed.n=e>this.maxSpeed.n?e:this.maxSpeed.n}updateVoronoi(){this.nextPreparing||(this.progress===0&&(this.currentResourcePointer=(this.currentResourcePointer+1)%this.uvUrlList.length,this.addVoronoiBindingAsync(this.uvUrlList[this.currentResourcePointer])),this.progress=Math.min(this.progress+1,this.framesPerPhase-1),this.nextPrepared&&this.progress===this.framesPerPhase-1&&(this.progress=0,this.swapVoronoiBinding()),this.progressRate.n=this.progress/(this.framesPerPhase-1))}swapVoronoiBinding(){let e=this.fromRef.value;this.fromRef.value=this.toRef.value,this.toRef.value=e,e=this.toRef.value,this.toRef.value=this.nextRef.value,this.nextRef.value=e,this.nextPrepared=!1}addWorker(e){const t=this;this.worker=e,this.worker.addEventListener("message",i=>{const{url:s,maxSpeed:n,uvs:r}=i.data;t.updateMaxSpeed(n),t.nextRef.value=r,t.nextPrepared=!0,t.nextPreparing=!1})}addVoronoiBindingAsync(e){this.nextPreparing=!0,this.worker.postMessage({url:e})}get localProgress(){return this.progressRate.n}get globalProgress(){return(this.currentResourcePointer+this.progressRate.n)/this.uvUrlList.length}destroy(){this.type=void 0,this.map=void 0,this.id=void 0,this.renderingMode=void 0,this.preheat=void 0,this.swapPointer=void 0,this.extent=void 0,this.worker=void 0,this.uvUrlList=void 0,this.stationUrl=void 0,this.endPoint=void 0,this.progress=void 0,this.startPoint=void 0,this.framesPerPhase=void 0,this.maxSpeed=void 0,this.maxParticleNum=void 0,this.progressRate=void 0,this.currentResourcePointer=void 0,this.particleNum=void 0,this.speedFactor=void 0,this.timePointParser=void 0,this.randomSeed=void 0,this.blockSizeX=void 0,this.blockSizeY=void 0,this.lastMvp=void 0,this.lastMvpInverse=void 0,this.groupSizeX=void 0,this.groupSizeY=void 0,this.randomFillData=void 0,this.toRef=void 0,this.fromRef=void 0,this.nextRef=void 0,this.uniformBuffer_frame=void 0,this.indexBuffer_voronoi=void 0,this.vertexBuffer_voronoi=void 0,this.uniformBuffer_static=void 0,this.storageBuffer_particle=void 0,this.particleRef=void 0,this.flowTexture=void 0,this.depthTexture=void 0,this.layerTexture1=void 0,this.layerTexture2=void 0,this.copiedDepthTexture=void 0,this.showBinding=void 0,this.layerBindings=void 0,this.voronoiBinding=void 0,this.segmentBinding=void 0,this.voronoiToBinding=void 0,this.simulationBinding=void 0,this.trajectoryBindings=void 0,this.showPipeline=void 0,this.layerPipeline=void 0,this.voronoiPipeline=void 0,this.segmentPipeline=void 0,this.trajectoryPipeline=void 0,this.simulationPipeline=void 0,this.swapPasses=void 0,this.voronoiPass=void 0,this.simulationPass=void 0,this.isHided=void 0,this.isIdling=void 0,this.showArrow=void 0,this.showVoronoi=void 0,this.nextPrepared=void 0,this.isInitialized=void 0,this.nextPreparing=void 0}}function jt(o){const e=new Float32Array(2);e[0]=o;const t=o-e[0];return e[1]=t,e}const ks={date:"2023-09-01",vertex:[["13417691","3767754"],["13417931","3767270"]],scene:"minzhusha",dataFolderPath:"D:\\project\\JS_Bank_Collapse\\util\\model\\multi\\data",section:[[13417687957079306e-9,3.7677558293190524e6,3.121534824371338],[13417687957079306e-9,3.7677508293190524e6,3.1434929370880127],[13417692957079306e-9,3.7677458293190524e6,3.247708320617676],[13417692957079306e-9,3.7677408293190524e6,3.2636892795562744],[13417697957079306e-9,3.7677358293190524e6,3.291696786880493],[13417697957079306e-9,3.7677308293190524e6,3.299565553665161],[13417702957079306e-9,3.7677258293190524e6,3.299978733062744],[13417702957079306e-9,3.7677208293190524e6,3.299994468688965],[13417707957079306e-9,3.7677158293190524e6,3.2999579906463623],[13417707957079306e-9,3.7677108293190524e6,3.2996816635131836],[13417712957079306e-9,3.7677058293190524e6,3.296473979949951],[13417712957079306e-9,3.7677008293190524e6,3.2823452949523926],[13417717957079306e-9,3.7676958293190524e6,3.2385687828063965],[13417717957079306e-9,3.7676908293190524e6,3.189035654067993],[13417722957079306e-9,3.7676858293190524e6,3.067615032196045],[13417722957079306e-9,3.7676808293190524e6,3.028134822845459],[13417727957079306e-9,3.7676758293190524e6,3.001678943634033],[13417727957079306e-9,3.7676708293190524e6,2.9994516372680664],[13417732957079306e-9,3.7676658293190524e6,2.9988670349121094],[13417732957079306e-9,3.7676608293190524e6,2.9878454208374023],[13417737957079306e-9,3.7676558293190524e6,2.9787704944610596],[13417737957079306e-9,3.7676508293190524e6,2.899057388305664],[13417742957079306e-9,3.7676458293190524e6,2.9546520709991455],[13417742957079306e-9,3.7676408293190524e6,2.847874164581299],[13417747957079306e-9,3.7676358293190524e6,2.8334996700286865],[13417747957079306e-9,3.7676308293190524e6,2.8156447410583496],[13417752957079306e-9,3.7676258293190524e6,2.8378868103027344],[13417752957079306e-9,3.7676208293190524e6,2.8585641384124756],[13417757957079306e-9,3.7676158293190524e6,2.8983511924743652],[13417757957079306e-9,3.7676108293190524e6,2.5130932331085205],[13417762957079306e-9,3.7676058293190524e6,1.9344098567962646],[13417762957079306e-9,3.7676008293190524e6,-1.7289330959320068],[13417767957079306e-9,3.7675958293190524e6,-13.831005096435547],[13417767957079306e-9,3.7675908293190524e6,-17.1885986328125],[13417772957079306e-9,3.7675858293190524e6,-17.408037185668945],[13417772957079306e-9,3.7675808293190524e6,-17.806724548339844],[13417777957079306e-9,3.7675758293190524e6,-17.77374267578125],[13417777957079306e-9,3.7675708293190524e6,-17.518352508544922],[13417782957079306e-9,3.7675658293190524e6,-17.223793029785156],[13417782957079306e-9,3.7675608293190524e6,-16.875864028930664],[13417787957079306e-9,3.7675558293190524e6,-16.53278160095215],[13417787957079306e-9,3.7675508293190524e6,-16.165775299072266],[13417792957079306e-9,3.7675458293190524e6,-16.063810348510742],[13417792957079306e-9,3.7675408293190524e6,-15.54920768737793],[13417797957079306e-9,3.7675358293190524e6,-14.938090324401855],[13417797957079306e-9,3.7675308293190524e6,-14.127363204956055],[13417802957079306e-9,3.7675258293190524e6,-13.364641189575195],[13417802957079306e-9,3.7675208293190524e6,-12.430339813232422],[13417807957079306e-9,3.7675158293190524e6,-11.678702354431152],[13417807957079306e-9,3.7675108293190524e6,-11.449407577514648],[13417812957079306e-9,3.7675058293190524e6,-9.874521255493164],[13417812957079306e-9,3.7675008293190524e6,-8.721687316894531],[13417817957079306e-9,3.7674958293190524e6,-6.497688293457031],[13417817957079306e-9,3.7674908293190524e6,-6.655665397644043],[13417822957079306e-9,3.7674858293190524e6,-8.162154197692871],[13417822957079306e-9,3.7674808293190524e6,-8.65102481842041],[13417827957079306e-9,3.7674758293190524e6,-11.075912475585938],[13417827957079306e-9,3.7674708293190524e6,-11.722530364990234],[13417832957079306e-9,3.7674658293190524e6,-13.258783340454102],[13417832957079306e-9,3.7674608293190524e6,-13.783803939819336],[13417837957079306e-9,3.7674558293190524e6,-14.561233520507812],[13417837957079306e-9,3.7674508293190524e6,-14.897319793701172],[13417842957079306e-9,3.7674458293190524e6,-14.745083808898926],[13417842957079306e-9,3.7674408293190524e6,-14.91735553741455],[13417847957079306e-9,3.7674358293190524e6,-14.65709114074707],[13417847957079306e-9,3.7674308293190524e6,-13.974665641784668],[13417852957079306e-9,3.7674258293190524e6,-13.366701126098633],[13417852957079306e-9,3.7674208293190524e6,-15.094374656677246],[13417857957079306e-9,3.7674158293190524e6,-16.2069149017334],[13417857957079306e-9,3.7674108293190524e6,-17.09683609008789],[13417862957079306e-9,3.7674058293190524e6,-18.026731491088867],[13417862957079306e-9,3.7674008293190524e6,-18.64005470275879],[13417867957079306e-9,3.7673958293190524e6,-19.124711990356445],[13417867957079306e-9,3.7673908293190524e6,-19.64112091064453],[13417872957079306e-9,3.7673858293190524e6,-19.74228286743164],[13417872957079306e-9,3.7673808293190524e6,-19.911325454711914],[13417877957079306e-9,3.7673758293190524e6,-20.222097396850586],[13417877957079306e-9,3.7673708293190524e6,-21.015077590942383],[13417882957079306e-9,3.7673658293190524e6,-21.347070693969727],[13417882957079306e-9,3.7673608293190524e6,-22.014921188354492],[13417887957079306e-9,3.7673558293190524e6,-22.594650268554688],[13417887957079306e-9,3.7673508293190524e6,-23.058412551879883],[13417892957079306e-9,3.7673458293190524e6,-22.975597381591797],[13417892957079306e-9,3.7673408293190524e6,-23.3878173828125],[13417897957079306e-9,3.7673358293190524e6,-23.70122718811035],[13417897957079306e-9,3.7673308293190524e6,-24.130123138427734],[13417902957079306e-9,3.7673258293190524e6,-24.493906021118164],[13417902957079306e-9,3.7673208293190524e6,-24.88259506225586],[13417907957079306e-9,3.7673158293190524e6,-25.026247024536133],[13417907957079306e-9,3.7673108293190524e6,-25.398527145385742],[13417912957079306e-9,3.7673058293190524e6,-25.830562591552734],[13417912957079306e-9,3.7673008293190524e6,-26.824321746826172],[13417917957079306e-9,3.7672958293190524e6,-26.83916473388672],[13417917957079306e-9,3.7672908293190524e6,-27.092004776000977],[13417922957079306e-9,3.7672858293190524e6,-26.90294075012207],[13417922957079306e-9,3.7672808293190524e6,-26.982824325561523],[13417927957079306e-9,3.7672758293190524e6,-27.218549728393555],[13417927957079306e-9,3.7672708293190524e6,-27.60082244873047]],isSectionWithInArea:[!0,!0],PQ:[[0,1,0,0],"低风险",.8],KY:[[0,0,0,1],"较高风险",.9067293380808618],ZD:[[0,0,0,1],"较高风险",.8233316221765914],deepestPoint:[[13417687957079306e-9,3.7677558293190524e6],3.896,1.797,2.4285],ZB:[[1,0,0,0],"较低风险",3.896],SA:[[0,1,0,0],"低风险",[.008508098125457764,.00041306018829345703,-.003069460391998291,-.011844491958618164,-.0011454224586486816,-.007263541221618652,.0032425761222839356,-.8364678144454956,-.19713687896728516,.06204805374145508,.07973456382751465,.16296939849853515,.25905070304870603,-.2289112091064453,-.17426605224609376,-.0047928810119628905,-.0774911880493164,-.14588985443115235,-.05486927032470703,-.11862764358520508,-.0553288459777832,-.06625099182128906,-.0906458854675293,-.018969249725341798,-.07645454406738281]],LN:[[0,0,0,1],"较高风险",[-.0014290809631347656,-.024257421493530273,-.006379842758178711,-.000362396240234375,-20742416381835938e-21,-5245208740234375e-21,-16689300537109375e-22,-.0005278587341308594,-.00018072128295898438,-.006606340408325195,-.013387203216552734,-.0712432861328125,-.07682418823242188,-.0541994571685791,-.03546714782714844,-.002198934555053711,-.38700222969055176,-.9655985832214355,-4.628930568695068,-16.731022119522095,-20.088642597198486,-20.309069633483887,-20.725111722946167,-21.088707208633423,-22.950204372406006,-23.242689609527588,-22.804797172546387,-22.426447868347168,-21.78517246246338,-14.056722640991211,-12.477280378341675,-11.654539346694946,-10.704403400421143,-9.916126251220703,-8.661474227905273,-6.875741004943848,-5.015869617462158,-2.245750904083252]],beforeSection:[[1341768869359842e-8,3767754371655211e-9,3.1229639053344727],[1341769369359842e-8,3767749371655211e-9,3.1159889698028564],[1341769369359842e-8,3767744371655211e-9,3.239731550216675],[1341769369359842e-8,3767739371655211e-9,3.2879467010498047],[1341769869359842e-8,3767734371655211e-9,3.298076629638672],[1341770369359842e-8,3767729371655211e-9,3.2999279499053955],[1341770369359842e-8,3767724371655211e-9,3.299999475479126],[1341770369359842e-8,3767719371655211e-9,3.299999713897705],[1341770869359842e-8,3767714371655211e-9,3.299959659576416],[1341771369359842e-8,3767709371655211e-9,3.2978639602661133],[1341771369359842e-8,3767704371655211e-9,3.2888548374176025],[1341771369359842e-8,3767699371655211e-9,3.247558116912842],[1341771869359842e-8,3767694371655211e-9,3.1743929386138916],[1341772369359842e-8,3767689371655211e-9,3.121018171310425],[1341772369359842e-8,3767684371655211e-9,3.0371713638305664],[1341772369359842e-8,3767679371655211e-9,3.010349988937378],[1341772869359842e-8,3767674371655211e-9,3.0003602504730225],[1341773369359842e-8,3767669371655211e-9,2.9999794960021973],[1341773369359842e-8,3767664371655211e-9,2.9990477561950684],[1341773369359842e-8,3767659371655211e-9,2.9944517612457275],[1341773869359842e-8,3767654371655211e-9,2.9921576976776123],[1341774369359842e-8,3767649371655211e-9,2.9703006744384766],[1341774369359842e-8,3767644371655211e-9,2.8455734252929688],[1341774369359842e-8,3767639371655211e-9,2.8091800212860107],[1341774869359842e-8,3767634371655211e-9,2.8179984092712402],[1341775369359842e-8,3767629371655211e-9,2.8924689292907715],[1341775369359842e-8,3767624371655211e-9,2.8920862674713135],[1341775369359842e-8,3767619371655211e-9,2.894031286239624],[1341775869359842e-8,3767614371655211e-9,2.900550127029419],[1341776369359842e-8,3767609371655211e-9,2.9000954627990723],[1341776369359842e-8,3767604371655211e-9,2.9000084400177],[1341776369359842e-8,3767599371655211e-9,2.8999974727630615],[1341776869359842e-8,3767594371655211e-9,2.900017023086548],[1341777369359842e-8,3767589371655211e-9,2.9000439643859863],[1341777369359842e-8,3767584371655211e-9,2.9010324478149414],[1341777369359842e-8,3767579371655211e-9,2.9183871746063232],[1341777869359842e-8,3767574371655211e-9,3.314964532852173],[1341778369359842e-8,3767569371655211e-9,5.431851863861084],[1341778369359842e-8,3767564371655211e-9,6.018896579742432],[1341778369359842e-8,3767559371655211e-9,5.928933143615723],[1341778869359842e-8,3767554371655211e-9,5.8936662673950195],[1341779369359842e-8,3767549371655211e-9,5.619397163391113],[1341779369359842e-8,3767544371655211e-9,-2.0070877075195312],[1341779369359842e-8,3767539371655211e-9,-3.071927309036255],[1341779869359842e-8,3767534371655211e-9,-3.283550977706909],[1341780369359842e-8,3767529371655211e-9,-3.422959804534912],[1341780369359842e-8,3767524371655211e-9,-3.448514938354492],[1341780369359842e-8,3767519371655211e-9,-3.7688655853271484],[1341780869359842e-8,3767514371655211e-9,-4.802961349487305],[1341781369359842e-8,3767509371655211e-9,-6.43353796005249],[1341781369359842e-8,3767504371655211e-9,-7.628770351409912],[1341781369359842e-8,3767499371655211e-9,-8.946449279785156],[1341781869359842e-8,3767494371655211e-9,-9.244831085205078],[1341782369359842e-8,3767489371655211e-9,-10.476202964782715],[1341782369359842e-8,3767484371655211e-9,-12.233419418334961],[1341782369359842e-8,3767479371655211e-9,-13.30055046081543],[1341782869359842e-8,3767474371655211e-9,-14.014792442321777],[1341783369359842e-8,3767469371655211e-9,-14.270424842834473],[1341783369359842e-8,3767464371655211e-9,-14.97888469696045],[1341783369359842e-8,3767459371655211e-9,-15.168658256530762],[1341783869359842e-8,3767454371655211e-9,-16.535743713378906],[1341784369359842e-8,3767449371655211e-9,-17.253616333007812],[1341784369359842e-8,3767444371655211e-9,-17.6441650390625],[1341784369359842e-8,3767439371655211e-9,-18.0341854095459],[1341784869359842e-8,3767434371655211e-9,-18.871644973754883],[1341785369359842e-8,3767429371655211e-9,-19.163223266601562],[1341785369359842e-8,3767424371655211e-9,-19.695068359375],[1341785369359842e-8,3767419371655211e-9,-20.70911407470703],[1341785869359842e-8,3767414371655211e-9,-21.725101470947266],[1341786369359842e-8,3767409371655211e-9,-22.625085830688477],[1341786369359842e-8,3767404371655211e-9,-23.037151336669922],[1341786369359842e-8,3767399371655211e-9,-23.50472640991211],[1341786869359842e-8,3767394371655211e-9,-23.62897491455078],[1341787369359842e-8,3767389371655211e-9,-24.318498611450195],[1341787369359842e-8,3767384371655211e-9,-25.25609588623047],[1341787369359842e-8,3767379371655211e-9,-26.168140411376953],[1341787869359842e-8,3767374371655211e-9,-26.721012115478516],[1341788369359842e-8,3767369371655211e-9,-27.352996826171875],[1341788369359842e-8,3767364371655211e-9,-27.534730911254883],[1341788369359842e-8,3767359371655211e-9,-28.3227596282959],[1341788869359842e-8,3767354371655211e-9,-28.664649963378906],[1341789369359842e-8,3767349371655211e-9,-28.916494369506836],[1341789369359842e-8,3767344371655211e-9,-29.92958641052246],[1341789369359842e-8,3767339371655211e-9,-30.606996536254883],[1341789869359842e-8,3767334371655211e-9,-31.010469436645508],[1341790369359842e-8,3767329371655211e-9,-31.10230827331543],[1341790369359842e-8,3767324371655211e-9,-31.232851028442383],[1341790369359842e-8,3767319371655211e-9,-31.465221405029297],[1341790869359842e-8,3767314371655211e-9,-31.98632049560547],[1341791369359842e-8,3767309371655211e-9,-32.619144439697266],[1341791369359842e-8,3767304371655211e-9,-32.685813903808594],[1341791369359842e-8,3767299371655211e-9,-32.63957214355469],[1341791869359842e-8,3767294371655211e-9,-32.676307678222656],[1341792369359842e-8,3767289371655211e-9,-32.96323013305664],[1341792369359842e-8,3767284371655211e-9,-33.133304595947266],[1341792369359842e-8,3767279371655211e-9,-33.098289489746094],[1341792869359842e-8,3767274371655211e-9,-32.94529724121094]],risk:[[.08,.32,0,.6],"高风险",.6]};function Nt(o){var e=Math.PI/180,t=6378137,i=20037508342789244e-9,s=Math.abs(o[0])<=180?o[0]:o[0]-Math.sign(o[0])*360,n=[t*s*e,t*Math.log(Math.tan(Math.PI*.25+.5*o[1]*e))];return n[0]>i&&(n[0]=i),n[0]<-i&&(n[0]=-i),n[1]>i&&(n[1]=i),n[1]<-i&&(n[1]=-i),n}const Ts=(o,e,t,i)=>{if(!o.getSource(`${i}-source`)){const s={type:"Feature",properties:{},geometry:{coordinates:[e,t],type:"LineString"}};o.addSource(`${i}-source`,{type:"geojson",data:s})}o.getLayer(`${i}-layer`)?o.setLayoutProperty(`${i}-layer`,"visibility","visible"):o.addLayer({id:`${i}-layer`,type:"line",source:`${i}-source`,layout:{"line-join":"round","line-cap":"round",visibility:"visible"},paint:{"line-color":"#888","line-width":8}})},Yt=(o,e)=>{o.getLayer(`${e}-layer`)&&o.setLayoutProperty(`${e}-layer`,"visibility","none")},Us=(o,e)=>{o.getLayer(`${e}-layer`)&&o.removeLayer(`${e}-layer`),o.getSource(`${e}-source`)&&o.removeSource(`${e}-source`)},Is=(o,e,t)=>{console.log(e,t);const i=Math.min(...e,...t),s=Math.max(...e,...t),n=Math.min(e.length,t.length),r={title:{text:"断面形态"},grid:{width:"80%",height:"80%",top:"10%",show:!0,backgroundColor:"#d2f2ff"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["当前横截面","对比横截面"],right:"10%",top:"2%"},xAxis:{type:"category",data:new Array(n).fill(0).map((a,l)=>l*5),position:"bottom"},yAxis:{type:"value",splitLine:{show:!1},axisLine:{show:!1},scale:!0,max:Math.round(s+2),min:Math.round(i-2)},series:[{name:"当前横截面",data:e.slice(0,n).map(a=>a.toFixed(2)),type:"line",smooth:!0,areaStyle:{opacity:.8,color:"#2a5fdb"}},{name:"对比横截面",data:t.slice(0,n).map(a=>a.toFixed(2)),type:"line",smooth:!0,lineStyle:{color:"#ff7070"},itemStyle:{color:"#ff7070"}}]};o.setOption(r)},Ms=(o,e)=>{const t=Math.min(...e),i=Math.max(...e),s={title:{text:"断面冲淤"},grid:{width:"80%",height:"80%",top:"10%",show:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",data:e.map((n,r)=>r*5),position:"bottom"},yAxis:{type:"value",splitLine:{show:!1},axisLine:{show:!1},scale:!0,max:Math.round(i+2),min:Math.round(t-2)},series:[{name:"冲淤程度",data:e.map(n=>n.toFixed(2)),type:"line",smooth:!0}]};o.setOption(s)},As=(o,e,t,i)=>{const s=Math.min(...e,...t),n=Math.max(...e,...t),r=Math.min(e.length,t.length),a=[];for(let c=0;c<r;c+=10)a.push(c);a.push(r-1);const l=[];for(let c=0,h=0;c<a.length;c++,h++)if(c!==a.length-1){const f=a[c],d=a[c+1];for(let y=f;y<d;y++)l.push(i[h])}const u={title:{text:"断面坡比"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},grid:[{top:"10%",height:"40%",show:!0},{top:"58%",height:"35%",show:!0}],legend:{data:["当前横截面","对比横截面","坡比"],right:"10%",top:"2%"},axisPointer:{link:[{xAxisIndex:"all"}]},xAxis:[{type:"category",data:t.map((c,h)=>h*5),position:"bottom"},{gridIndex:1,type:"category",data:l.map((c,h)=>h*5),position:"bottom",axisLine:{show:!0,onZero:!1}}],yAxis:[{type:"value",splitLine:{show:!1},scale:!0,max:Math.round(n+1),min:Math.round(s-1)},{type:"value",splitLine:{show:!1},gridIndex:1,axisLine:{show:!1},scale:!0}],series:[{name:"当前横截面",type:"line",smooth:!0,data:e.map(c=>c.toFixed(2))},{name:"对比横截面",type:"line",smooth:!0,data:t.map(c=>c.toFixed(2)),lineStyle:{color:"#ff7070"},itemStyle:{color:"#ff7070"}},{name:"坡比",type:"bar",smooth:!0,data:l.map(c=>c.toFixed(4)),yAxisIndex:1,xAxisIndex:1,barCategoryGap:"0%",itemStyle:{normal:{color:function(c){let h=0;return a.some((d,y)=>{if(c.dataIndex<d)return h=y-1,!0}),["#059669","#84cc16"][h%2]},label:{show:!1}}}}]};o.setOption(u)},J=o=>(Ye("data-v-d05cdd16"),o=o(),Xe(),o),Rs={class:"all"},Ls={class:"model-content-container"},Ds={class:"model-item-container"},Es={class:"model-choice"},Fs={class:"basemap-radio-container"},Vs=["checked"],$s=J(()=>p("label",{class:"tab",for:"radio-1"},"近岸动力分析",-1)),zs=["checked"],Os=J(()=>p("label",{class:"tab",for:"radio-2"},"近岸演变分析",-1)),Gs=J(()=>p("span",{class:"glider"},null,-1)),js={class:"main-page"},Ns={class:"user-react"},Ys={class:"title"},Xs=J(()=>p("div",{class:"title-icon uricon"},null,-1)),Hs={class:"title-text"},Ws={class:"buttons"},qs=["onClick"],Ks={class:"data-panel"},Zs=J(()=>p("div",{class:"title"},[p("div",{class:"title-icon dpicon"}),p("div",{class:"title-text"},"数据面板")],-1)),Js={class:"dp-content"},Qs={class:"custom-tree-node",style:{width:"100%"}},en={class:"el-dropdown-link",style:{width:"100%"}},tn={class:"layer-panel"},sn=J(()=>p("div",{class:"title"},[p("div",{class:"title-icon lpicon"}),p("div",{class:"title-text"},"图层面板")],-1)),nn={class:"lp-content"},rn={class:"checkBox"},an={class:"main-page"},on={class:"data-panel",style:{height:"40vh"}},ln=J(()=>p("div",{class:"title"},[p("div",{class:"title-icon dpicon"}),p("div",{class:"title-text"},"数据面板")],-1)),hn={class:"dp-content",style:{height:"32vh"}},un={class:"evolution-tree-node",style:{width:"100%"}},dn={class:"el-dropdown-link",style:{width:"100%"}},cn={class:"layer-panel"},fn=J(()=>p("div",{class:"title"},[p("div",{class:"title-icon lpicon"}),p("div",{class:"title-text"},"图层面板")],-1)),mn={class:"dp-content",style:{height:"32vh"}},pn={class:"evolution-tree-node",style:{width:"100%"}},gn={class:"el-dropdown-link",style:{width:"100%"}},yn={class:"dialog-footer"},bn={class:"main"},_n={class:"map-container"},vn=J(()=>p("canvas",{id:"GPUFrame"},null,-1)),xn={class:"model-tooltip-container"},wn={key:0,class:"model-container"},Sn=J(()=>p("div",{style:{"font-size":"large","padding-bottom":"16px"}}," 近岸演变分析模型 ",-1)),Bn={class:"model-list"},Pn=J(()=>p("img",{src:"https://shadow.elemecdn.com/app/element/hamburger.9cf7b091-55e9-11e9-a976-7f4d0b07eef6.png",class:"image",style:{"margin-left":"0","margin-right":"0"}},null,-1)),Cn={style:{padding:"4px 0px"}},kn=J(()=>p("img",{src:"https://shadow.elemecdn.com/app/element/hamburger.9cf7b091-55e9-11e9-a976-7f4d0b07eef6.png",class:"image",style:{"margin-left":"0","margin-right":"0"}},null,-1)),Tn={style:{padding:"4px 0px"}},Un=J(()=>p("img",{src:"https://shadow.elemecdn.com/app/element/hamburger.9cf7b091-55e9-11e9-a976-7f4d0b07eef6.png",class:"image",style:{"margin-left":"0","margin-right":"0"}},null,-1)),In={style:{padding:"4px 0px"}},Mn={key:1,class:"model-params-container"},An=J(()=>p("div",{style:{"font-size":"large","padding-bottom":"16px"}}," 模型参数设置 ",-1)),Rn={class:"charts-container"},Ln={class:"analysisCenter"},Dn=J(()=>p("div",{class:"background"},null,-1)),En=J(()=>p("iframe",{id:"inlineFrameExample",title:"Inline Frame Example",width:"100%",height:"100%",src:"http://172.21.212.165:8050/#/analysis/73c29959-16f0-4478-8526-0927d1aff6f7"},null,-1)),Fn={__name:"StabilityAnalysis2",setup(o){const e="http://119.45.198.54:80/tileServer",t=D(!1),i=D(!1),s=D(!1),n=D(["水文条件选择","模型参数设置","模型计算","模型运行状态"]),r=D(null),a=D("模型配置"),l=D(!1),u=D(!1),c=D(!0),h=D(!1),f={"1998-01-dem":"199801_dem","2004-08-dem":"200408_dem","2006-02-dem":"200602_dem"},d={"1998-01-dem":{min:-64.1,max:11.97},"2004-08-dem":{min:-69.46,max:45.16},"2006-02-dem":{min:-71.16,max:40.1}},y=()=>{l.value=!1,c.value=!0,h.value=!1,u.value=!1},g=()=>{if(l.value=!0,h.value=!0,c.value=!1,s.value=!1,u.value=!0,j){for(let m in f)console.log(m),!j.getLayer("ras-"+m)&&j.addLayer({id:"ras-"+m,type:"raster",source:m,paint:{"raster-color":["interpolate",["linear"],["raster-value"],-60-d[m].min,"rgba(0,100,255,1)",-30-d[m].min,"rgba(0,150,255,1)",-20-d[m].min,"rgba(102,153,255,1)",-16-d[m].min,"rgba(0,204,255,1)",-15-d[m].min,"rgba(153,255,255,1)",-13.5-d[m].min,"rgba(255,255,255,1)",-13-d[m].min,"rgba(255,255,153,1)",-11-d[m].min,"rgba(230,230,128,1)",-10-d[m].min,"rgba(164,204,51,1)",-8-d[m].min,"rgba(153,204,51,1)",-5-d[m].min,"rgba(39,139,51,1)",-2-d[m].min,"rgba(10,143,82,1)",0-d[m].min,"rgba(0,113,11, 1)"],"raster-color-mix":[d[m].max-d[m].min,0,0,0],"raster-opacity":1,"raster-color-range":[0,d[m].max-d[m].min]},layout:{visibility:"none"}});j.addControl(Ke),j.on("draw.create",function(m){console.log("aaa"),console.log(m.features),Je.value=crypto.randomUUID(),Ce.value=!0;let b=m.features[0],N=Nt(b.geometry.coordinates[0]),ee=Nt(b.geometry.coordinates[1]);Ze.value[Je.value]=[N,ee]})}},S=D(),_=Wt();_.modelStatus="undefined";const P=m=>{pe({type:"success",offset:100,message:"水文条件："+m})},M=m=>{switch(m){case 0:t.value=!0;break;case 1:i.value=!0;break;case 2:pe({message:"模型计算中",offset:100}),_.modelStartTime=Date.now(),_.modelProgress=0,_.modelStatus="pending";const b=setInterval(()=>{_.modelProgress+=Math.random()*100/3600/.5/24*3,_.modelProgress>=100&&(_.modelStatus="success",pe({type:"success",offset:100,message:"模型计算完成"}),clearInterval(b))},3e3);s.value=!0;break;case 3:s.value=!0;break}},L=m=>{pe({type:"success",message:"模型参数设置成功",offset:100}),console.log(m)},E=(m,b)=>{b.nodeID?r.value=b.nodeID:r.value=null},F=m=>{r.value&&m==="add"&&T.value.push(r.value)},$=Le([{label:"旱季",children:[{label:"输入数据",children:[{label:"fort.13",nodeID:"dry-13"},{label:"fort.14",nodeID:"dry-14"},{label:"fort.15",nodeID:"dry-15"},{label:"fort.16",nodeID:"dry-16"},{label:"fort.19",nodeID:"dry-19"},{label:"fort.20",nodeID:"dry-20"}]},{label:"输出数据",children:[{label:"flow",nodeID:"dry-flow"}]}]},{label:"洪季",children:[{label:"输入数据",children:[{label:"fort.13",nodeID:"flood-13"},{label:"fort.14",nodeID:"flood-14"},{label:"fort.15",nodeID:"flood-15"},{label:"fort.16",nodeID:"flood-16"},{label:"fort.19",nodeID:"flood-19"},{label:"fort.20",nodeID:"flood-20"}]},{label:"输出数据",children:[{label:"flow",nodeID:"flood-flow"}]}]},{label:"20年一遇",children:[{label:"输入数据",children:[{label:"fort.13",nodeID:"20-13"},{label:"fort.14",nodeID:"20-14"},{label:"fort.15",nodeID:"20-15"},{label:"fort.16",nodeID:"20-16"},{label:"fort.19",nodeID:"20-19"},{label:"fort.20",nodeID:"20-20"}]},{label:"输出数据",children:[{label:"flow",nodeID:"20-flow"}]}]}]),A={children:"children",label:"label"},x=D([]),T=D([]);let C,U=[];for(let m=0;m<26;m++)U.push(`/scratchSomething/terrain_flow/json/uv_${m}.bin`);let R=new Cs("近岸流场","/scratchSomething/terrain_flow/json/station.bin",U,m=>m.match(/uv_(\d+)\.bin/)[1],"/scratchSomething/terrain_flow/json/ChangJiang.geojson");const O=m=>{console.log("handle checked layer",m);for(let b=0;b<m.length;b++)if(m[b].includes("flow")){R.show(),C&&C.flyTo({center:[120.54070965313991,32.042615280683805],pitch:31.99999999999988,bearing:0,zoom:10.245427972376211,speed:1,essential:!0});return}R.hide()},I=D(null),k=D([{label:"1998-01-dem",nodeID:"1998-01-dem-id",type:"dem"},{label:"2004-08-dem",nodeID:"2004-08-dem-id",type:"dem"},{label:"2006-02-dem",nodeID:"2006-02-dem-id",type:"dem"}]),V=Le([{label:"地形数据",type:null,children:[{label:"1998-01-dem",nodeID:"1998-01-dem-id",type:"dem"},{label:"2004-08-dem",nodeID:"2004-08-dem-id",type:"dem"},{label:"2006-02-dem",nodeID:"2006-02-dem-id",type:"dem"}]},{label:"断面数据",type:null,children:[]},{label:"示例断面形态",nodeID:"20200301-section-graph",type:"section-graph"},{label:"示例断面坡比",nodeID:"20200301-rate",type:"rate"},{label:"示例断面冲淤",nodeID:"20200301-chongyu",type:"chongyu"}]),Q=(m,b)=>{console.log(b),b.nodeID?I.value=b:I.value=null},H=m=>{if(console.log(I.value),I.value&&m==="layer")k.value===null?k.value=[I.value]:k.value.push(I.value);else if(I.value&&m==="visualize"){const b=I.value.type;console.log(b),it.value=!0;const N=ks;ue.clear(),b==="section-graph"?setTimeout(()=>{const ee=N.beforeSection,ae=N.section;Is(ue,ae.map(ie=>ie[2]),ee.map(ie=>ie[2])),ue.resize()},1):b==="rate"?setTimeout(()=>{const ee=N.beforeSection,ae=N.section;As(ue,ae.map(ie=>ie[2]),ee.map(ie=>ie[2]),N.SA[2]),ue.resize()},1):b==="chongyu"&&setTimeout(()=>{const ee=N.section,ae=N.beforeSection,ie=Math.min(ee.length,ae.length),Te=[];ee.some((st,Ue)=>{if(Ue>=ie)return!0;Te.push(st[2]-ae[Ue][2])}),console.log(Te),Ms(ue,Te),ue.resize()},1)}else I.value&&m==="delete"||I.value&&m==="add"&&console.log("12321")},he=(m,b)=>{b.nodeID?I.value=b:I.value=null},qe=m=>{console.log(m),I.value&&k.value&&m==="delete"&&(k.value=k.value.filter(b=>b.nodeID!==I.value.nodeID),I.value.type==="section-geojson"&&(Yt(j,I.value.nodeID),Us(j,I.value.nodeID)))},qt=(m,b)=>{if(console.log(m,b),b)if(m.type==="section-geojson"){const N=Ze.value[m.nodeID];Ts(j,N[0],N[1],m.nodeID),console.log(j.getLayoutProperty(`${m.nodeID}-layer`,"visibility"))}else m.type==="dem"&&(console.log("111"),j.getLayer("ras-"+m.label)?j.setLayoutProperty("ras-"+m.label,"visibility","visible"):j.addLayer({id:"ras-"+m.label,type:"raster",source:m.label,paint:{"raster-color":["interpolate",["linear"],["raster-value"],-60-d[m.label].min,"rgba(0,100,255,1)",-30-d[m.label].min,"rgba(0,150,255,1)",-20-d[m.label].min,"rgba(102,153,255,1)",-16-d[m.label].min,"rgba(0,204,255,1)",-15-d[m.label].min,"rgba(153,255,255,1)",-13.5-d[m.label].min,"rgba(255,255,255,1)",-13-d[m.label].min,"rgba(255,255,153,1)",-11-d[m.label].min,"rgba(230,230,128,1)",-10-d[m.label].min,"rgba(164,204,51,1)",-8-d[m.label].min,"rgba(153,204,51,1)",-5-d[m.label].min,"rgba(39,139,51,1)",-2-d[m.label].min,"rgba(10,143,82,1)",0-d[m.label].min,"rgba(0,113,11, 1)"],"raster-color-mix":[d[m.label].max-d[m.label].min,0,0,0],"raster-opacity":1,"raster-color-range":[0,d[m.label].max-d[m.label].min]}}));else m.type==="section-geojson"?(Yt(j,m.nodeID),console.log(j.getLayoutProperty(`${m.nodeID}-layer`,"visibility"))):m.type==="dem"&&j.setLayoutProperty("ras-"+m.label,"visibility","none")};let j;const Ke=new mi({displayControlsDefault:!1,controls:{line_string:!0},styles:[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["==","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000","line-width":3}}]}),Ze=D({}),Je=D(),Kt=D(!1),Ce=D(!1),_e=D(""),Zt=()=>{},Jt=()=>{Ce.value=!1,Ke.deleteAll(),_e.value=""},Qt=()=>{Ce.value=!1,Kt.value=!1,Ke.deleteAll(),V[1].children.push({label:_e.value,nodeID:Je.value,type:"section-geojson"}),console.log(Ze),_e.value=""},Qe=D(),se=D({name:"",date:"",beforeDate:"",section:""}),ei=Le({name:[{required:!0,message:"Please input Activity name",trigger:"blur"}],section:[{required:!0,trigger:"change"}],date:[{required:!0,trigger:"change"}],beforeDate:[{required:!0,trigger:"change"}]}),et=D(!1),ke=D(null),kt=Ge(()=>{let m=[];return V.forEach(b=>{b.label==="断面数据"&&(m=b.children)}),console.log(m),m}),Tt=Ge(()=>{let m=[];return V.forEach(b=>{b.label==="地形数据"&&(m=b.children)}),console.log(m),m}),ti=()=>{if(kt.value.length===0){pe({message:"当前不存在任意断面, 请先确定断面",type:"warning"});return}et.value=!0},tt=m=>{ke.value=m,et.value=!1},ii=async(m,b)=>{m&&await m.validate((N,ee)=>{N?(ke.value=null,pe("模型开始计算"),console.log(se.value),V.push({label:se.value.name,nodeID:"20200301-section-graph",type:b}),m.resetFields()):console.log("error submit!",ee)})},si=m=>{m.resetFields(),console.log(se.value),ke.value=null},Ut=D(),it=D(!1);let ue=null;const ni=()=>{it.value=!1};return di(async()=>{ue=ci(Ut.value),j=await fi(S.value),j.addSource("1998-01-dem",{type:"raster",tiles:[e+"/tile/raster/river/199801_dem/{x}/{y}/{z}"],tileSize:256,minzoom:1,maxzoom:15,bounds:[118.5791,31.0413,121.7718,32.4197]}),j.addSource("2004-08-dem",{type:"raster",tiles:[e+"/tile/raster/river/200408_dem/{x}/{y}/{z}"],tileSize:256,minzoom:1,maxzoom:15,bounds:[118.5791,31.0413,121.7718,32.4197]}),j.addSource("2006-02-dem",{type:"raster",tiles:[e+"/tile/raster/river/200602_dem/{x}/{y}/{z}"],tileSize:256,minzoom:1,maxzoom:15,bounds:[118.5791,31.0413,121.7718,32.4197]}),C=j,j.addLayer(R),R.hide()}),(m,b)=>{const N=z("el-dropdown-item"),ee=z("el-dropdown-menu"),ae=z("el-dropdown"),ie=z("el-tree"),Te=z("el-checkbox"),st=z("el-checkbox-group"),Ue=z("el-input"),ce=z("el-button"),ri=z("el-dialog"),nt=z("el-card"),Ie=z("el-form-item"),rt=z("el-option"),at=z("el-select"),ai=z("el-form");return G(),Z("div",Rs,[v(pi,{ModelName:"岸坡稳定性分析模型"}),p("div",Ls,[p("div",Ds,[p("div",Es,[p("div",Fs,[p("input",{type:"radio",id:"radio-1",name:"tabs",checked:c.value,onClick:b[0]||(b[0]=B=>y())},null,8,Vs),$s,p("input",{type:"radio",id:"radio-2",name:"tabs",checked:h.value,onClick:b[1]||(b[1]=B=>g())},null,8,zs),Os,Gs])]),Ve(p("div",js,[p("div",Ns,[p("div",Ys,[Xs,p("div",Hs,de(a.value),1)]),p("div",Ws,[(G(!0),Z(Me,null,Ae(n.value,(B,ne)=>(G(),Z("div",{class:"button",key:ne,onClick:Vn=>M(ne)},[p("div",null,de(B),1)],8,qs))),128))])]),p("div",Ks,[Zs,p("div",Js,[v(ie,{style:{"max-height":"28vh",overflow:"auto"},data:$,props:A,onNodeContextmenu:E,"node-key":"nodeID"},{default:w(({node:B,data:ne})=>[p("div",Qs,[v(ae,{onCommand:F,trigger:"contextmenu",placement:"bottom-end",style:{width:"100%"}},At({default:w(()=>[p("div",en,de(B.label),1)]),_:2},[ne.nodeID?{name:"dropdown",fn:w(()=>[v(ee,null,{default:w(()=>[v(N,{command:"add"},{default:w(()=>[X("添加至图层")]),_:1})]),_:1})]),key:"0"}:void 0]),1024)])]),_:1},8,["data"])])]),p("div",tn,[sn,p("div",nn,[p("div",rn,[v(st,{modelValue:x.value,"onUpdate:modelValue":b[2]||(b[2]=B=>x.value=B),onChange:O},{default:w(()=>[(G(!0),Z(Me,null,Ae(T.value,B=>(G(),fe(Te,{key:B,label:B,value:B},{default:w(()=>[X(de(B),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])])])],512),[[$e,!l.value]]),Ve(p("div",an,[p("div",on,[ln,p("div",hn,[v(ie,{style:{"max-width":"600px"},data:V,props:A,onNodeContextmenu:Q,"node-key":"nodeID"},{default:w(({node:B,data:ne})=>[p("div",un,[v(ae,{onCommand:H,trigger:"contextmenu",placement:"bottom-end",style:{width:"100%"}},At({default:w(()=>[p("div",dn,de(B.label),1)]),_:2},[ne.type==="dem"||ne.type==="section-geojson"?{name:"dropdown",fn:w(()=>[v(ee,null,{default:w(()=>[v(N,{command:"layer"},{default:w(()=>[X("添加至图层")]),_:1}),v(N,{command:"delete"},{default:w(()=>[X("删除")]),_:1})]),_:1})]),key:"0"}:void 0,ne.type&&ne.type!=="dem"&&ne.type!=="section-geojson"?{name:"dropdown",fn:w(()=>[v(ee,null,{default:w(()=>[v(N,{command:"visualize"},{default:w(()=>[X("可视化")]),_:1}),v(N,{command:"delete"},{default:w(()=>[X("删除")]),_:1})]),_:1})]),key:"1"}:void 0]),1032,["onCommand"])])]),_:1},8,["data"])])]),p("div",cn,[fn,p("div",mn,[v(ie,{style:{"max-width":"600px"},data:k.value,props:A,onNodeContextmenu:he,"node-key":"nodeID","show-checkbox":"",onCheckChange:qt},{default:w(({node:B,data:ne})=>[p("div",pn,[v(ae,{onCommand:qe,trigger:"contextmenu",placement:"bottom-end",style:{width:"100%"}},{dropdown:w(()=>[v(ee,null,{default:w(()=>[v(N,{command:"delete"},{default:w(()=>[X("删除图层")]),_:1})]),_:1})]),default:w(()=>[p("div",gn,de(B.label),1)]),_:2},1032,["onCommand"])])]),_:1},8,["data"])])])],512),[[$e,l.value]])]),v(ri,{modelValue:Ce.value,"onUpdate:modelValue":b[4]||(b[4]=B=>Ce.value=B),title:"绘制断面确认",width:"40vh","before-close":Zt},{footer:w(()=>[p("div",yn,[v(ce,{onClick:Jt},{default:w(()=>[X("取消")]),_:1}),v(ce,{type:"primary",onClick:Qt,disabled:!_e.value.length},{default:w(()=>[X(" 确认 ")]),_:1},8,["disabled"])])]),default:w(()=>[v(Ue,{modelValue:_e.value,"onUpdate:modelValue":b[3]||(b[3]=B=>_e.value=B),style:{width:"240px"},placeholder:"请输入断面名称"},null,8,["modelValue"])]),_:1},8,["modelValue"]),p("div",bn,[p("div",_n,[p("div",{id:"map",ref_key:"mapContainerRef",ref:S},null,512),vn]),p("div",xn,[l.value?(G(),Z("div",{key:0,class:"showAnalysisButton",onClick:ti}," 演变分析计算 ")):ge("",!0)]),et.value?(G(),Z("div",wn,[Sn,p("div",Bn,[v(nt,{style:{height:"300px","object-fit":"cover"}},{default:w(()=>[Pn,p("div",Cn,[v(ce,{onClick:b[5]||(b[5]=B=>tt("section-graph"))},{default:w(()=>[X("断面形态")]),_:1})])]),_:1}),v(nt,{style:{height:"300px","object-fit":"cover"}},{default:w(()=>[kn,p("div",Tn,[v(ce,{onClick:b[6]||(b[6]=B=>tt("rate"))},{default:w(()=>[X("断面坡比")]),_:1})])]),_:1}),v(nt,{style:{height:"300px","object-fit":"cover"}},{default:w(()=>[Un,p("div",In,[v(ce,{onClick:b[7]||(b[7]=B=>tt("chongyu"))},{default:w(()=>[X("断面冲淤")]),_:1})])]),_:1})])])):ge("",!0),ke.value?(G(),Z("div",Mn,[An,v(ai,{ref_key:"paramsRef",ref:Qe,rules:ei,model:se.value,"label-width":"auto",style:{width:"600px"}},{default:w(()=>[v(Ie,{label:"结果名称",prop:"name"},{default:w(()=>[v(Ue,{modelValue:se.value.name,"onUpdate:modelValue":b[8]||(b[8]=B=>se.value.name=B)},null,8,["modelValue"])]),_:1}),v(Ie,{label:"地形断面",prop:"section"},{default:w(()=>[v(at,{modelValue:se.value.section,"onUpdate:modelValue":b[9]||(b[9]=B=>se.value.section=B)},{default:w(()=>[(G(!0),Z(Me,null,Ae(kt.value,B=>(G(),fe(rt,{key:B.label,label:B.label,value:B.nodeID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v(Ie,{label:"当前地形数据",prop:"date"},{default:w(()=>[v(at,{modelValue:se.value.date,"onUpdate:modelValue":b[10]||(b[10]=B=>se.value.date=B)},{default:w(()=>[(G(!0),Z(Me,null,Ae(Tt.value,B=>(G(),fe(rt,{key:B.label,label:B.label,value:B.nodeID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v(Ie,{label:"对比地形数据",prop:"beforeDate"},{default:w(()=>[v(at,{modelValue:se.value.beforeDate,"onUpdate:modelValue":b[11]||(b[11]=B=>se.value.beforeDate=B)},{default:w(()=>[(G(!0),Z(Me,null,Ae(Tt.value,B=>(G(),fe(rt,{key:B.label,label:B.label,value:B.nodeID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v(Ie,null,{default:w(()=>[v(ce,{type:"primary",onClick:b[12]||(b[12]=B=>ii(Qe.value,ke.value))},{default:w(()=>[X("运行模型")]),_:1}),v(ce,{onClick:b[13]||(b[13]=B=>si(Qe.value))},{default:w(()=>[X("取消")]),_:1})]),_:1})]),_:1},8,["rules","model"])])):ge("",!0),Ve(p("div",Rn,[p("div",{class:"close-icon",onClick:ni},"关闭"),p("div",{ref_key:"echartRef",ref:Ut,class:"chart"},null,512)],512),[[$e,it.value]]),t.value?(G(),fe(Ei,{key:2,onClose:b[14]||(b[14]=B=>t.value=!t.value),onCondition:P})):ge("",!0),i.value?(G(),fe(ji,{key:3,onClose:b[15]||(b[15]=B=>i.value=!i.value),onParams:L})):ge("",!0),s.value?(G(),fe(rs,{key:4,onClose:b[16]||(b[16]=B=>s.value=!s.value)})):ge("",!0)])]),Ve(p("div",Ln,[Dn,p("div",{class:"back",onClick:b[17]||(b[17]=B=>{u.value=!u.value,c.value=!0,h.value=!1})}),En],512),[[$e,u.value]])])}}},Gn=Ne(Fn,[["__scopeId","data-v-d05cdd16"]]);export{Gn as default};
