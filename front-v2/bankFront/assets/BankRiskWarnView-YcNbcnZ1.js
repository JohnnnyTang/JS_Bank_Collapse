function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/riskResult-BAUcg4SX.js","assets/index-CKZiR0Qw.js","assets/index-BAfE7Odm.css","assets/riskResult-ATSSiHG3.css","assets/flowspeedInfo-DSjkUGJm.js","assets/util-CRZRFQLc.js","assets/flowspeedInfo-DhCc-SlV.css","assets/profileInfo-DxQG8xRM.js","assets/profileInfo-V_w5SQ9g.css","assets/profileShapeYearly-Dqb5JOpO.js","assets/profileShapeYearly-Bxp6tmOB.css","assets/profileShapeCompare-Dr5aboNV.js","assets/profileShapeCompare-C0q7WLm1.css","assets/profileSlope-CAXJWyVi.js","assets/profileSlope-BElbQp6g.css","assets/profileErosion-KJyv_Tl2.js","assets/profileErosion-CF4DUzMW.css","assets/BedFlowChart-OULyKu1V.js","assets/BedFlowChart-DzRjOnJ2.css","assets/WaterProcessChart-B4b2d6wB.js","assets/WaterProcessChart-BxwFNsGd.css","assets/GeologyAndProject-Tmu14U4D.js","assets/GeologyAndProject-EJ0Uzc_B.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{H as Ke,s as Fa,aB as Ja,h as be,i as oa,j as te,o as d,c as S,b as w,d as M,a as o,t as ie,bj as we,_ as ra,g as l,bg as $a,v as ae,x as ja,y as Ea,J as Ae,e as P,N as f,B as re,u as g,z as Qe,A as Ia,a8 as ia,a7 as ea,w as aa,p as Ta,f as Ya,bq as R,aa as ge,ba as V}from"./index-CKZiR0Qw.js";import"./index-uR7_hGNM.js";/* empty css                  */import{F as ta}from"./notSimpleLayer-Dq6lkal2.js";import{M as Na}from"./mapbox-gl-draw-WA46_0ma.js";class Za{constructor(t){this.id="岸段预警",this.jsonData=t,this.map=void 0,this.type="custom",this.showLayer=!1,this.prepared=!1,console.log("contruictasd12312",this.jsonData)}async onAdd(t,r){this.map=t,this.vertexData=[],this.warnValues=[],this.vertexCount=0,this.jsonData.forEach(x=>{let se=Ke.MercatorCoordinate.fromLngLat({lng:x.coords[0][0],lat:x.coords[0][1]}),ne=Ke.MercatorCoordinate.fromLngLat({lng:x.coords[1][0],lat:x.coords[1][1]});this.vertexData.push(se.x,se.y,x.warnValue,ne.x,ne.y,x.warnValue),this.vertexCount+=2});const p=`
        uniform mat4 u_matrix;
        attribute vec3 a_position; 
        varying float v_warnValue; 

        void main() {
            v_warnValue = a_position.z; 
            gl_Position = u_matrix * vec4(a_position.x, a_position.y, 0.0, 1.0);
        }`,v=`
        precision mediump float;
        varying float v_warnValue; 

        void main() {
            // int pallete[10] = {
            //     0x00b0f0,
            //     0x76a9c8,
            //     0xa69f9f,
            //     0xcc9071,
            //     0xed7c31,
            //     0xf06f24,
            //     0xf46018,
            //     0xf84e0d,
            //     0xfb3704,
            //     0xff0000,
            // }
            // int pallete[3] = {
            //     0x00b0f0,
            //     0x76a9c8,
            //     0xff0000,
            // }
            // int botIndex = floor(v_warnValue * 2);
            // int topIndex = floor(v_warnValue * 2 + 0.5);
            // int interval = value * 10.0 - botIndex;

            // vec3 botColor = colorFromInt(rampColors[botIndex]);
            // vec3 topColor = colorFromInt(rampColors[botIndex+1]);
            // vec3 topColor = colorFromInt(rampColors[topIndex]);
            // vec3 resultColor = mix(botColor, topColor, interval);

            // vec3 green = vec3(0.0, 1.0, 0.0);
            vec3 blue = vec3(0.0, 0.0, 1.0);
            vec3 orange = vec3(240.0, 120.0, 0.0) / 255.0;
            vec3 red = vec3(1.0, 0.0, 0.0);
            float v_warnValueP = clamp(v_warnValue*1.4, 0.0, 1.0);


            vec3 greenToBlue = mix(blue, orange, smoothstep(0.0, 0.5, v_warnValueP));
            // Interpolate between blue and red from 0.5 to 1.0
            vec3 blueToRed = mix(orange, red, smoothstep(0.5, 1.0, v_warnValueP));
            // Combine the two interpolations
            vec3 color = mix(greenToBlue, blueToRed, smoothstep(0.0, 1.0, v_warnValueP));

            // gl_FragColor  = vec4(v_warnValueP, 0, 1.0-v_warnValueP, 0.85); // 使用 fragColor 代替 gl_FragColor
            gl_FragColor  = vec4(color, 0.85); // 使用 fragColor 代替 gl_FragColor
        }`,m=r.createShader(r.VERTEX_SHADER);r.shaderSource(m,p),r.compileShader(m);const A=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(A,v),r.compileShader(A),this.program=r.createProgram(),r.attachShader(this.program,m),r.attachShader(this.program,A),r.linkProgram(this.program),this.aPos=r.getAttribLocation(this.program,"a_position"),console.log(this.aPos),this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.vertexData),r.STATIC_DRAW),this.prepared=!0}async render(t,r){this.prepared&&(t.useProgram(this.program),t.uniformMatrix4fv(t.getUniformLocation(this.program,"u_matrix"),!1,r),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.enableVertexAttribArray(this.aPos),t.vertexAttribPointer(this.aPos,3,t.FLOAT,!1,0,0),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLE_STRIP,0,this.vertexCount))}show(){}hide(){}}const Oa="/down_triangle.png",Ha="/rasterLegend1.png",j=Fa.create({baseURL:"/api"});class N{static runProfileModelTest=t=>{const r=`/taskNode/start/multi/default/section/${t-1}`;return j.post(r)};static getProfileDataTest=t=>{const r=t<10?`/fileData/json/jsonStr/name/multiWholeRes-JC0${t}/newest`:`/fileData/json/jsonStr/name/multiWholeRes-JC${t}/newest`;return j.get(r)};static runProfileModel_short=(t,r,p)=>{const v=`/taskNode/start/multi/default/section/${p-1}/beg/${t}/end/${r}`;return j.post(v)};static runProfileModel_long=(t,r,p)=>{const v=`/taskNode/start/multi/default/section/long/${p-1}/beg/${t}/end/${r}`;return j.post(v)};static getProfileData=(t,r,p)=>{const v=p<10?`/fileData/json/jsonStr/name/multiWholeRes-JC0${p}_beg${t}_end${r}/newest`:`/fileData/json/jsonStr/name/multiWholeRes-JC${p}_beg${t}_end${r}/newest`;return j.get(v)};static runProfileModelByLine=(t,r,p,v,m,A)=>{const x=`/taskNode/start/multi/default?begTime=${t}&endTime=${r}&startPt=${p},${v}&endPt=${m},${A}`;return j.post(x)};static getRunStatus=t=>{const r="/taskNode/"+t+"/status";return j.get(r)};static getRunResult=t=>{const r="/fileData/json/jsonStr/id/"+t;return j.get(r)}}const Wa={class:"timestep-shower"},Ua={class:"percentage-value"},Ga=Ja({__name:"flowTimeShower",props:{timeStep:Number,totalCount:Number,type:String},setup(B){const t=B,r=be(()=>Math.ceil(t.timeStep/t.totalCount*100)),p=be(()=>{if(t.type=="normal"){let v=we().startOf("day"),m=t.timeStep/6;return v.add(m,"hour").format("YYYY/MM/DD HH")}else if(t.type=="9711"){let v=we("1997-08-16").startOf("day"),m=t.timeStep*6;return v.add(m,"hour").format("YYYY/MM/DD HH")}else if(t.type=="9711adwt"){let v=we("1997-08-12").startOf("day"),m=t.timeStep*1;return v.add(m,"hour").format("YYYY/MM/DD HH")}else if(t.type=="exp"){let v=we().startOf("day").subtract(1,"day"),m=t.timeStep*1;return v.add(m,"hour").format("YYYY/MM/DD HH")}});return be(()=>p.value.split(" ")[1]),be(()=>p.value.split(" ")[0]),oa(()=>{}),(v,m)=>{const A=te("el-progress");return d(),S("div",Wa,[w(A,{type:"dashboard",percentage:r.value},{default:M(({percentage:x})=>[o("span",Ua,ie(t.timeStep+"时"),1)]),_:1},8,["percentage"])])}}}),Xa=ra(Ga,[["__scopeId","data-v-029927c2"]]),la={20092003:{min:-20.216260910034,max:12.377036094666},21032003:{min:-18.057029724121,max:13.405656814575},21032009:{min:-11.904377937317,max:15.555559158325},21092003:{min:-29.0481300354,max:13.405656814575},21092009:{min:-21.573017120361,max:13.338559150696},21092103:{min:-22.064949035645,max:8.261926651001},22032003:{min:-26.315940856934,max:12.661833763123},22032009:{min:-18.946474075317,max:10.854301452637},22032103:{min:-18.682374954224,max:11.998920440674},22032109:{min:-18.682374954224,max:17.446615219116},22092003:{min:-34.24059677124,max:18.287557601929},22092009:{min:-28.642517089844,max:18.124055862427},22092103:{min:-28.885349273682,max:17.996383666992},22092109:{min:-20.775089263916,max:19.373840332031},22092203:{min:-20.959928512573,max:17.246448516846},23032003:{min:-25.497043609619,max:23.978927612305},23032009:{min:-15.159237861633,max:24.311046600342},23032103:{min:-16.9319896698,max:24.412498474121},23032109:{min:-11.673976898193,max:24.870639801025},23032203:{min:-10.602119445801,max:19.81965637207},23032209:{min:-10.008462905884,max:21.046541213989},23092003:{min:-24.543750762939,max:23.484636306763},23092009:{min:-14.633073806763,max:23.901466369629},23092103:{min:-15.942059516907,max:23.92653465271},23092109:{min:-12.148267745972,max:24.699771881104},23092203:{min:-11.635368347168,max:19.993438720703},23092209:{min:-11.635368347168,max:26.141702651978},23092303:{min:-11.635368347168,max:16.081762313843}},De=[{name:"JC01",coords:[[120.49989610501109,32.044845778820694],[120.49965852902085,32.043054010465546]],warnValue:.49},{name:"JC02",coords:[[120.51211644811006,32.04310480824947],[120.51157809855385,32.04135665004222]],warnValue:.59},{name:"JC03",coords:[[120.51598399026375,32.04244111945512],[120.51554162835052,32.04064910386879]],warnValue:.64},{name:"JC04",coords:[[120.52163733002358,32.040317481106044],[120.52010747944439,32.03901766791365]],warnValue:.67},{name:"JC05",coords:[[120.52344753736321,32.03912224359854],[120.52202732882418,32.037765786589944]],warnValue:.7},{name:"JC06",coords:[[120.5300568728269,32.035076196597906],[120.52886185568613,32.03359585101801]],warnValue:.83},{name:"JC07",coords:[[120.53577029390934,32.03306474923213],[120.53521759568126,32.03132371065091]],warnValue:.9},{name:"JC08",coords:[[120.54259039936055,32.03113531223312],[120.54191211481913,32.0294311450221]],warnValue:.73},{name:"JC09",coords:[[120.54845619793755,32.02942703528161],[120.547645906125,32.027757714058616]],warnValue:.53},{name:"JC10",coords:[[120.55217332294447,32.02819103999115],[120.55139957273384,32.02651468780271]],warnValue:.43},{name:"JC11",coords:[[120.55987007042168,32.0256085153387],[120.55938372124096,32.02385317986381]],warnValue:.29},{name:"JC12",coords:[[120.56542283954619,32.023997421425335],[120.56490201809913,32.022254233310434]],warnValue:.18}],qa=[{value:1,id:"JC01",label:"MZ01围堤",name:"MZ01围堤",nickname:"围堤",filter:["==","name","JC01"],flowspeed:null,risk:null,color:null},{value:2,id:"JC02",label:"MZ02顺堤",name:"MZ02顺堤",nickname:"顺堤",filter:["==","name","JC02"],flowspeed:null,risk:null,color:null},{value:3,id:"JC03",label:"MZ03顺堤尾",name:"MZ03顺堤尾",nickname:"顺堤尾",filter:["==","name","JC03"],flowspeed:null,risk:null,color:null},{value:4,id:"JC04",label:"MZ04江滩办",name:"MZ04江滩办",nickname:"江滩办",filter:["==","name","JC04"],flowspeed:null,risk:null,color:null},{value:5,id:"JC05",label:"MZ05小港池",name:"MZ05小港池",nickname:"小港池",filter:["==","name","JC05"],flowspeed:null,risk:null,color:null},{value:6,id:"JC06",label:"MZ06张靖皋桥位",name:"MZ06张靖皋桥位",nickname:"张靖皋桥位",filter:["==","name","JC06"],flowspeed:null,risk:null,color:null},{value:7,id:"JC07",label:"MZ07桥位下游",name:"MZ07桥位下游",nickname:"桥位下游",filter:["==","name","JC07"],flowspeed:null,risk:null,color:null},{value:8,id:"JC08",label:"MZ08海事码头",name:"MZ08海事码头",nickname:"海事码头",filter:["==","name","JC08"],flowspeed:null,risk:null,color:null},{value:9,id:"JC09",label:"MZ09码头下游",name:"MZ09码头下游",nickname:"码头下游",filter:["==","name","JC09"],flowspeed:null,risk:null,color:null},{value:10,id:"JC10",label:"MZ10雷达站",name:"MZ10雷达站",nickname:"雷达站",filter:["==","name","JC10"],flowspeed:null,risk:null,color:null},{value:11,id:"JC11",label:"MZ11主路",name:"MZ11主路",nickname:"主路",filter:["==","name","JC11"],flowspeed:null,risk:null,color:null},{value:12,id:"JC12",label:"MZ12沙尾",name:"MZ12沙尾",nickname:"沙尾",filter:["==","name","JC12"],flowspeed:null,risk:null,color:null}],Ka=[{value:"1999before",name:"1999汛前地形数据",label:"1999汛前",year:"1999",time:"汛前",date:"1999-01-01",dateShort:"9901"},{value:"2012after",name:"2012汛后地形数据",label:"2012汛后",year:"2012",time:"汛后",date:"2012-10-01",dateShort:"1210"},{value:"2019before",name:"2019汛前地形数据",label:"2019汛前",year:"2019",time:"汛前",date:"2019-04-01",dateShort:"1904"},{value:"2023before1",name:"2023汛前地形数据",label:"2023汛前",year:"2023",time:"汛前",date:"2023-04-01",dateShort:"2304"},{value:"2020before",name:"2020汛前地形数据",label:"2020汛前",year:"2020",time:"汛前",date:"2020-03-01",dateShort:"2003"},{value:"2020before",name:"2020汛前地形数据",label:"2020汛前",year:"2020",time:"汛前",date:"2020-03-01",dateShort:"2003"},{value:"2020after",name:"2020汛后地形数据",label:"2020汛后",year:"2020",time:"汛后",date:"2020-09-01",dateShort:"2009"},{value:"2021before",name:"2021汛前地形数据",label:"2021汛前",year:"2021",time:"汛前",date:"2021-03-01",dateShort:"2103"},{value:"2021after",name:"2021汛后地形数据",label:"2021汛后",year:"2021",time:"汛后",date:"2021-09-01",dateShort:"2109"},{value:"2022before",name:"2022汛前地形数据",label:"2022汛前",year:"2022",time:"汛前",date:"2022-03-01",dateShort:"2203"},{value:"2022after",name:"2022汛后地形数据",label:"2022汛后",year:"2022",time:"汛后",date:"2022-09-01",dateShort:"2209"},{value:"2023before",name:"2023汛前地形数据",label:"2023汛前",year:"2023",time:"汛前",date:"2023-03-01",dateShort:"2303"},{value:"2023after",name:"2023汛后地形数据",label:"2023汛后",year:"2023",time:"汛后",date:"2023-09-01",dateShort:"2309"}],Qa=[{label:"水流动力因素",active:!1,children:[{label:"造床流量当量指标",icon:"/icons/行政区划.png",active:!1,filter:!0},{label:"流速指标",icon:"/icons/河道分段.png",active:!1,filter:!0},{label:"水位变幅指标",icon:"/icons/流域水系.png",active:!1,filter:!0}]},{label:"河床演变因素",active:!1,filter:!0,children:[{label:"岸坡最大坡比",icon:"/icons/江堤港堤.png",active:!1,filter:!0},{label:"近岸冲刷速率",icon:"/icons/长江堤防.png",active:!1,filter:!0},{label:"滩槽高程",icon:"/icons/过江通道.png",active:!1,filter:!0}]},{label:"岸坡地质因素",active:!1,filter:!0,children:[{label:"河岸组成粒径",icon:"/icons/岸段名录.png",active:!1,filter:!0},{label:"垂向分层结构",icon:"/icons/过江通道.png",active:!1,filter:!0}]},{label:"外部工程因素",active:!1,filter:!0,children:[{label:"护岸强度",icon:"/icons/岸段名录.png",active:!1,filter:!0},{label:"局部突加荷载",icon:"/icons/过江通道.png",active:!1,filter:!0}]}],_=B=>(Ta("data-v-83a34eb9"),B=B(),Ya(),B),et={class:"risk-warn-container"},at=ia('<canvas id="GPUFrame" data-v-83a34eb9></canvas><div class="basic-info-container" data-v-83a34eb9><div class="basic-info-content" data-v-83a34eb9><div class="title-container" data-v-83a34eb9>民主沙右缘示范段</div><div class="key-val-container" data-v-83a34eb9><div class="key-text" data-v-83a34eb9>预警级别：</div><div class="val-text" data-v-83a34eb9>Ⅰ级</div></div><div class="key-val-container right" data-v-83a34eb9><div class="key-text" data-v-83a34eb9>岸段长度：</div><div class="val-text" data-v-83a34eb9>全长7公里</div></div></div></div><div class="risk-item-title" data-v-83a34eb9>崩岸风险因素分析</div>',3),tt={class:"risk-item-container"},lt=_(()=>o("div",{class:"risk-item-text"},"水流动力",-1)),ot=_(()=>o("div",{class:"risk-item-text"},"河床演变",-1)),rt=_(()=>o("div",{class:"risk-item-text"},"地质与工程治理",-1)),it={key:0,class:"raster-control-block"},st={class:"switch"},nt=["checked"],ct=_(()=>o("span",{class:"slider"},null,-1)),ut=_(()=>o("div",{class:"text-block"},[o("div",{class:"text"},"冲淤图展示")],-1)),dt={class:"bankLine-control-block"},vt={class:"switch"},ft=["checked"],pt=_(()=>o("span",{class:"slider"},null,-1)),mt=_(()=>o("div",{class:"text-block"},[o("div",{class:"text"},"岸段展示")],-1)),ht=ia('<div class="risk-line-container" data-v-83a34eb9><div class="risk-line-title" data-v-83a34eb9>风险等级图例：</div><div class="risk-line" data-v-83a34eb9></div><div class="risk-line-arrow high" data-v-83a34eb9><img src="'+Oa+'" alt="图例标记" data-v-83a34eb9></div><div class="risk-line-mark low" data-v-83a34eb9>低风险</div><div class="risk-line-mark middle" data-v-83a34eb9>中风险</div><div class="risk-line-mark high" data-v-83a34eb9>高风险</div></div>',1),yt={key:1,class:"warn-status-container"},_t=_(()=>o("div",{class:"warn-status-title"},"民主沙右缘风险评估结果",-1)),bt=_(()=>o("div",{class:"warn-status-content high"},"高风险",-1)),wt=[_t,bt],gt={key:2,class:"warn-detail-container high"},xt={class:"warn-detail-profile"},kt={class:"warn-detail-text"},Ct=_(()=>o("span",{class:"warn-detail-span"},null,-1)),St={class:"warn-detail-span"},Lt={key:8,style:{position:"absolute",top:"16.25vh",left:"0.3vw",width:"26vw",height:"23.5vh","z-index":"10"}},Pt={key:10,class:"flow-control-block"},Rt={class:"switch",style:{transform:"rotateZ(90deg)"}},Vt=["checked"],Mt=_(()=>o("span",{class:"slider"},null,-1)),At=_(()=>o("div",{class:"text-block"},[o("div",{class:"text"},"流场展示")],-1)),Dt={key:11,class:"time-shower-block"},Bt={key:12,style:{position:"absolute",top:"66vh",left:"0.3vw",width:"26vw",height:"25vh","z-index":"10"}},zt={key:14,class:"drag riskResult"},Ft={key:15,class:"raster-legend-container"},Jt=_(()=>o("img",{src:Ha,alt:"比例尺"},null,-1)),$t=[Jt],jt=_(()=>o("span",null,"确认使用此断面进行计算",-1)),Et={class:"dialog-footer"},It={style:{"text-align":"right"}},Tt=_(()=>o("span",null,"确认使用以下年份地形数据进行计算：",-1)),Yt={style:{position:"absolute",top:"6.5vh","font-weight":"bold"}},Nt={style:{position:"absolute",top:"8.5vh","font-weight":"bold"}},Zt={class:"dialog-footer"},Ot={style:{"text-align":"right"}},Ht={class:"loading-container"},Wt={class:"loading-message"},Ut={__name:"BankRiskWarnView",setup(B){const t="http://127.0.0.1:8989/api/v1",r=l(-1),p=R(()=>V(()=>import("./riskResult-BAUcg4SX.js"),__vite__mapDeps([0,1,2,3]))),v=R(()=>V(()=>import("./flowspeedInfo-DSjkUGJm.js"),__vite__mapDeps([4,1,2,5,6]))),m=R(()=>V(()=>import("./profileInfo-DxQG8xRM.js"),__vite__mapDeps([7,5,1,2,8]))),A=R(()=>V(()=>import("./profileShapeYearly-Dqb5JOpO.js"),__vite__mapDeps([9,5,1,2,10]))),x=R(()=>V(()=>import("./profileShapeCompare-Dr5aboNV.js"),__vite__mapDeps([11,5,1,2,12]))),se=R(()=>V(()=>import("./profileSlope-CAXJWyVi.js"),__vite__mapDeps([13,5,1,2,14]))),ne=R(()=>V(()=>import("./profileErosion-KJyv_Tl2.js"),__vite__mapDeps([15,5,1,2,16]))),sa=R(()=>V(()=>import("./BedFlowChart-OULyKu1V.js"),__vite__mapDeps([17,1,2,18]))),na=R(()=>V(()=>import("./WaterProcessChart-B4b2d6wB.js"),__vite__mapDeps([19,1,2,20]))),ca=R(()=>V(()=>import("./GeologyAndProject-Tmu14U4D.js"),__vite__mapDeps([21,1,2,22]))),k=l("自定义断面信息计算中..."),Be=l(),E=l(0),Z=l(!1),y=l(!1),ce=l(!0);l(Qa);const z=l("洪季"),ua=e=>{z.value=e,console.log(z.value),Z.value=!1,E.value=0;let a=ae().getMap();a.getLayer("floodFlow")&&(a.removeLayer("floodFlow"),H&&(H(),H=null)),a.getLayer("dryFlow")&&(a.removeLayer("dryFlow"),W&&(W(),W=null))},da=e=>{e&&e.fitBounds([[120.43987922676835,32.03201616423072],[120.59089640208263,32.05217136261862]],{duration:1500})},u=l(qa),O=l(Ka);let va=De;l([{value:"low",label:"低风险"},{value:"middle",label:"中风险"},{value:"high",label:"高风险"}]),l("mzs");const ze=()=>{U=O.value.find(e=>e.value===de.value),G=O.value.find(e=>e.value===ve.value),xe=O.value.find(e=>e.value===ba.value),ke=O.value.find(e=>e.value===wa.value)},fa=e=>{let a="";return u.value.map(i=>{i.risk===e&&(a=a+i.name+"; ")}),a},pa=()=>{ye.value=!1},ma=async()=>{if(ze(),ye.value=!1,G.dateShort<=U.dateShort){ge.error("当前地形时间不能早于或等于对比地形时间！");return}if(Ee.value===de.value&&Ie.value===ve.value){ge.error("当前地形时间与对比地形时间未发生变化！");return}k.value="冲淤图层加载中...",ee.value=!0,K.value=!0,Q.value=!0,Me.value=!0;const e=G.dateShort+U.dateShort;y.value||(y.value=!0),h.removeLayer("mapRaster"),h.removeSource("mapRaster"),Xe(h,e,"mapRaster"),h.moveLayer("mapRaster","mzsLine"),Fe(U,G,xe,ke)},le=e=>{h.setFilter("mzsBankLineChoosen",u.value[e-1].filter)},Fe=async(e,a,i,s)=>{const c=e.date,n=a.date,L=i.date,D=s.date;k.value="确认计算结果是否存在...",ee.value=!0;let b,_e;b=await Je(c,n),_e=await Je(L,D),b&&_e?(k.value="地形对比数据加载中...",C.value=await F(c,n),oe.value=await F(L,D)):b&&!_e?(k.value="地形对比数据加载中...",await ue(L,D),k.value="地形对比数据加载中...",C.value=await F(c,n),oe.value=await F(L,D)):!b&&_e?(k.value="地形对比数据加载中...",await ue(c,n),k.value="地形对比数据加载中...",C.value=await F(c,n),oe.value=await F(L,D)):(k.value="地形对比数据加载中...",await ue(L,D),await ue(c,n),k.value="地形对比数据加载中...",C.value=await F(c,n),oe.value=await F(L,D)),ee.value=!1,K.value=!1,me.value=!1,Q.value=!1,Me.value=!1,za(),ya(C.value),h.getLayer("mzsBankLineLowRisk")!==void 0&&h.removeLayer("mzsBankLineLowRisk"),qe(h,u),fe.value=!0,Ee.value=de.value,Ie.value=ve.value},Je=async(e,a)=>{const i=[];let s=!0;try{for(let n=0;n<12;n++)i.push(N.getProfileData(e,a,n+1));(await Promise.all(i)).forEach(n=>{(!n||!n.data||n.data.length===0)&&(s=!1)})}catch{s=!1}return s},F=async(e,a)=>{const i=[],s=[];for(let n=0;n<12;n++)i.push(N.getProfileData(e,a,n+1));return(await Promise.all(i)).forEach(n=>{n&&n.data&&s.push(n.data)}),s},ue=async(e,a)=>{const i=[];for(let s=0;s<u.value.length;s++)i.push(ha(e,a,s));await Promise.all(i)},ha=async(e,a,i)=>{const s=await N.runProfileModel_long(e,a,i+1);let c;for(;;){try{c=await N.getRunStatus(s.data)}catch{}if(c.data==2)break;if(c.data==-1)return;if(c.data==-2)return;c.data==1,await Ge(100)}},ya=e=>{e.map((a,i)=>{u.value[i].risk==="low"?u.value[i].color="rgb(31, 110, 209)":u.value[i].risk==="middle"?u.value[i].color="rgb(220, 126, 37)":u.value[i].color="rgb(250, 55, 36)";try{u.value[i].flowspeed=a.deepestPoint[2]}catch{}}),ae().getMap()};let H=null,W=null;const $e=async()=>{Z.value=!Z.value;let e=ae().getMap();if(E.value=0,Z.value){if(z.value=="洪季"){let a="/api/data/flow/configJson/flood",i="/api/data/flow/texture/flood/",s=ea(new ta("floodFlow",a,i));e.addLayer(s),H=aa(()=>s.currentResourcePointer,c=>{E.value=s.currentResourcePointer}),console.log("add 洪季")}else if(z.value=="枯季"){let a="/api/data/flow/configJson/dry",i="/api/data/flow/texture/dry/",s=ea(new ta("dryFlow",a,i));e.addLayer(s),W=aa(()=>s.currentResourcePointer,c=>{E.value=s.currentResourcePointer}),console.log("add 枯季")}}else z.value=="洪季"?e.getLayer("floodFlow")&&(e.removeLayer("floodFlow"),H(),H=null):z.value=="枯季"&&e.getLayer("dryFlow")&&(e.removeLayer("dryFlow"),W(),W=null)},je=()=>{y.value&&I.value?(h.setLayoutProperty("mapRaster","visibility","visible"),y.value=!y.value):!y.value&&I.value||y.value&&!I.value?(h.setLayoutProperty("mapRaster","visibility","none"),y.value=!y.value):h.setLayoutProperty("mapRaster","visibility","none")},_a=()=>{ce.value?h.setLayoutProperty("岸段预警","visibility","none"):h.setLayoutProperty("岸段预警","visibility","visible"),ce.value=!ce.value},de=l("2019before"),ve=l("2023before1"),ba=l("1999before"),wa=l("2012after"),Ee=l("2019before"),Ie=l("2023before1");l("2012after"),l("2012after");let U,G,xe,ke;const fe=l(!1),Te=l(!1),Ce=l(!1),Ye=()=>{Ce.value=!Ce.value},X=l(!1),Ne=()=>{X.value=!X.value},Ze=l(!1),Oe=l(!1),He=l(!1),Se=l(!1),ga=()=>{Se.value=!Se.value},Le=l(!1),xa=()=>{Le.value=!Le.value},J=l(!1),ka=async()=>{if(Z.value===!1&&J.value===!0){J.value=!1;return}J.value=!J.value,E.value=0,await $e()},I=l(!1),We=()=>{je(),I.value=!I.value},q=l(!1),pe=async()=>{console.log("213123213",r.value),$.value===!0?Pe():T.value===!0&&Re(),ga(),xa(),await ka(),q.value=!q.value},$=l(!1),Pe=()=>{if(q.value===!0?pe():T.value===!0&&Re(),y.value===!1&&X.value===!0||y.value===!0&&X.value===!1){Ne(),Ye(),We(),$.value=!$.value;return}Ne(),Ye(),We(),$.value=!$.value},T=l(!1),Re=()=>{q.value===!0?pe():$.value===!0&&Pe(),T.value=!T.value},C=l([]),oe=l([]);l(0),l([]);const Ue=l(null),Ca=l(null),Ve=l(!0),K=l(!0),me=l(!0),Q=l(!0),Me=l(!0),Y=l(""),Sa=l("");l(""),l("");let h;const he=l(!1),ye=l(!1);l(""),l("");const ee=l(!1);let La,Pa,Ra,Va;new Na({displayControlsDefault:!1,controls:{line_string:!0,trash:!0},styles:[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["==","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000","line-width":3}}]});const Ma=()=>{he.value=!1},Aa=async()=>{if(Y.value===""){ge.error("断面名称不为空！");return}else if(u.value.find(n=>n.name===Y.value)){ge.error("断面名称已存在！");return}ee.value=!0,Ve.value=!0,K.value=!0,me.value=!0,Q.value=!0,k.value="自定义断面信息计算中...",he.value=!1;const e=O.value.find(n=>n.value==de.value).date,a=O.value.find(n=>n.value==ve.value).date,i=await Da(e,a,La,Pa,Ra,Va);let s="";for(;;){try{s=await N.getRunStatus(i.data)}catch{}if(s.data==2)break;if(s.data==-1)return;if(s.data==-2)return;s.data==1,await Ge(500)}const c=await N.getRunResult(i.data);Ba(c.data),C.value.push(c.data),ee.value=!1,Ve.value=!1,K.value=!1,me.value=!1,Q.value=!1};async function Ge(e){return new Promise(a=>setTimeout(a,e))}const Da=async(e,a,i,s,c,n)=>await N.runProfileModelByLine(e,a,i,s,c,n),Ba=e=>{let a;e.risk[2]<.25?a="low":e.risk[2]<.5?a="middle":a="high",Sa.value=a,Ue.value={value:u.value.length+1,label:Y.value,name:Y.value,filter:["==","$type",`${Y.value}`],flowspeed:e.deepestPoint[2],risk:a},Ca.value=e,u.value.push(Ue.value)},Xe=(e,a,i)=>{e.addSource(i,{type:"raster",tiles:[t+`/tile/raster/mzs/flood/${a}/{x}/{y}/{z}`],tileSize:256,minzoom:10,maxzoom:20,bounds:[120.109,31.823,120.855,32.102]});let s=la[a].min,c=la[a].max;e.addLayer({id:i,type:"raster",source:i,paint:{"raster-color":["interpolate",["linear"],["raster-value"],-10-s,"rgba(0,0,255,1)",0-s,"rgba(255, 255, 255, 1)",10-s,"rgba(255, 0, 0, 1)"],"raster-color-mix":[c-s,0,0,0],"raster-opacity":.85,"raster-color-range":[-30,30]}})},za=()=>{for(let e=0;e<12;e++)De[e].warnValue<.25?u.value[e].risk="low":De[e].warnValue<.5?u.value[e].risk="middle":u.value[e].risk="high"},qe=(e,a)=>{e.addLayer({id:"mzsBankLineLowRisk",type:"line",source:"mzsBankLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":["match",["get","name"],"JC01",`${a.value[0].color}`,"JC02",`${a.value[1].color}`,"JC03",`${a.value[2].color}`,"JC04",`${a.value[3].color}`,"JC05",`${a.value[4].color}`,"JC06",`${a.value[5].color}`,"JC07",`${a.value[6].color}`,"JC08",`${a.value[7].color}`,"JC09",`${a.value[8].color}`,"JC10",`${a.value[9].color}`,"JC11",`${a.value[10].color}`,"JC12",`${a.value[11].color}`,"rgb(255, 255, 255)"],"line-width":3}},"mzsSectionLabelLayer")};return oa(async()=>{await $a(Be.value).then(async e=>{h=e,da(e),e.addSource("mzsPlaceLabelSource",{type:"vector",tiles:[t+"/tile/vector/mzsPlaceLabel/{x}/{y}/{z}"]}),e.addSource("mzsPlaceLineSource",{type:"vector",tiles:[t+"/tile/vector/mzsPlaceLine/{x}/{y}/{z}"]}),e.addSource("mzsBankAreaSSource",{type:"vector",tiles:[t+"/tile/vector/mzsBankAreaOne/{x}/{y}/{z}"]}),e.addSource("mzsBankLineSource",{type:"vector",tiles:[t+"/tile/vector/mzsBankLine/{x}/{y}/{z}"]}),e.addSource("dockAreaSource",{type:"vector",tiles:[t+"/tile/vector/dockArea/{x}/{y}/{z}"]}),e.addSource("dockAreaLabelSource",{type:"vector",tiles:[t+"/tile/vector/center/dockArea/{x}/{y}/{z}"]}),e.addSource("fixProjectAreaSource",{type:"vector",tiles:[t+"/tile/vector/fixProjectArea/{x}/{y}/{z}"]}),e.addSource("fixProjectLineSource",{type:"vector",tiles:[t+"/tile/vector/fjsFixLine/{x}/{y}/{z}"]}),e.addSource("fixProjectAreaLabelSource",{type:"vector",tiles:[t+"/tile/vector/center/fixProjectArea/{x}/{y}/{z}"]}),e.addSource("riverPlaceLabel",{type:"vector",tiles:[t+"/tile/vector/placeLabel/{x}/{y}/{z}"]}),e.addSource("riverBeachSource",{type:"vector",tiles:[t+"/tile/vector/riverBeach/{x}/{y}/{z}"]}),e.addSource("zjgLine",{type:"vector",tiles:[t+"/tile/vector/zjgBridgeLine/{x}/{y}/{z}"]}),e.addLayer({id:"riverBeachArea",type:"fill",source:"riverBeachSource","source-layer":"default",paint:{"fill-color":"rgba(210,244,247, 1)"}}),e.addLayer({id:"zjgBridge",type:"line",source:"zjgLine","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":.6,"line-color":"rgb(183, 189, 183)","line-width":2}}),Xe(e,23032209,"mapRaster"),e.setLayoutProperty("mapRaster","visibility","none"),e.addLayer({id:"mzsLine",type:"line",source:"mzsPlaceLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgba(26, 87, 138, 0.6)","line-width":2}}),e.addLayer({id:"fjsFixLine",type:"line",source:"fixProjectLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgba(216, 217, 228, 0.5)","line-width":4}}),e.addLayer({id:"fixProjectFillLayer",type:"fill",source:"fixProjectAreaSource","source-layer":"default",paint:{"fill-color":"rgba(220,224,237, 0.8)","fill-outline-color":"rgba(220,224,237, 0.8)"}}),e.addLayer({id:"fixProjectAreaLabel",type:"symbol",source:"fixProjectAreaLabelSource","source-layer":"default",layout:{"text-field":["get","layer"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"right","text-size":12},paint:{"text-color":"rgba(31, 44, 126, 0.6)"}}),e.addLayer({id:"mzsLabel",type:"symbol",source:"mzsPlaceLabelSource","source-layer":"default",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"left"},paint:{"text-color":"rgba(31, 14, 126, 0.75)"}}),e.addLayer({id:"dockArea",type:"fill",source:"dockAreaSource","source-layer":"default",paint:{"fill-color":"#18b915"}}),e.addLayer({id:"dockAreaLabel",type:"symbol",source:"dockAreaLabelSource","source-layer":"default",layout:{"text-field":["get","project_name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"bottom","text-size":12},paint:{"text-color":"rgba(31, 44, 126, 0.6)"}}),e.addLayer({id:"riverPlaceLabel",type:"symbol",source:"riverPlaceLabel","source-layer":"default",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"left","text-size":18},paint:{"text-color":"rgba(31, 44, 226, 1)"}}),e.on("click",["mzsBankLine"],a=>{console.log(a.features[0])}),e.addSource("mzsSectionLabel",{type:"vector",tiles:[t+"/tile/vector/geomCenter/mzsBankLine/{x}/{y}/{z}"]}),e.addLayer(new Za(va)),e.addLayer({id:"mzsBankLineChoosen",type:"line",source:"mzsBankLineSource","source-layer":"default",filter:u.value[1].filter,layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgb(134, 245, 230)","line-width":10}}),e.addLayer({id:"mzsSectionLabelLayer",type:"symbol",source:"mzsSectionLabel","source-layer":"default",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[-1,1.15],"text-anchor":"top","text-size":18,"text-allow-overlap":!0},paint:{"text-color":"rgb(0, 22, 145)"}}),ae().setMap(e)}),ze(),fe.value=!1,Te.value=!1,X.value=!1,Ze.value=!1,Oe.value=!1,He.value=!1,J.value=!1,await Fe(U,G,xe,ke),pe()}),ja(()=>{ae().getMap().remove(),ae().destroyMap()}),(e,a)=>{const i=te("dv-border-box-12"),s=te("el-input"),c=te("el-button"),n=te("el-dialog"),L=te("dv-loading"),D=Ea("draggable");return d(),S("div",et,[o("div",{class:"map-container",id:"map",ref_key:"mapContainer",ref:Be},null,512),at,o("div",tt,[o("div",{class:Ae(["risk-item",{active:q.value}])},[o("div",{class:"risk-main-index waterpower",onClick:pe},[q.value?(d(),P(i,{key:0})):f("",!0),lt])],2),o("div",{class:Ae(["risk-item",{active:$.value}])},[o("div",{class:"risk-main-index riverbed",onClick:Pe},[$.value?(d(),P(i,{key:0,color:["rgb(73, 164, 101)","#9cf3e0"]},null,8,["color"])):f("",!0),ot])],2),o("div",{class:Ae(["risk-item",{active:T.value}])},[o("div",{class:"risk-main-index bankGeology",onClick:Re},[T.value?(d(),P(i,{key:0,color:["rgb(153, 143, 199)","rgb(231, 161, 240)"]},null,8,["color"])):f("",!0),rt])],2)]),I.value?(d(),S("div",it,[o("label",st,[o("input",{type:"checkbox",checked:y.value,onClick:a[0]||(a[0]=b=>je())},null,8,nt),ct]),ut])):f("",!0),o("div",dt,[o("label",vt,[o("input",{type:"checkbox",checked:ce.value,onClick:a[1]||(a[1]=b=>_a())},null,8,ft),pt]),mt]),ht,fe.value?(d(),S("div",yt,wt)):f("",!0),fe.value?(d(),S("div",gt,[o("div",xt,[o("div",kt,[Ct,re(" 高风险区域集中在： "),o("span",St,ie(fa("high")),1)])])])):f("",!0),Te.value?(d(),P(g(m),{key:3,onProfileValueChange:le,profileData:C.value,profileList:u.value,shapeChartLoad:K.value,erosionChartLoad:Q.value},null,8,["profileData","profileList","shapeChartLoad","erosionChartLoad"])):f("",!0),Ce.value?(d(),P(g(A),{key:4,onProfileValueChange:le,profileData:C.value,profileList:u.value,shapeYearlyChartLoad:Ve.value},null,8,["profileData","profileList","shapeYearlyChartLoad"])):f("",!0),X.value?(d(),P(g(x),{key:5,onProfileValueChange:le,profileData:C.value,profileDataCompare:oe.value,profileList:u.value,shapeChartLoad:K.value},null,8,["profileData","profileDataCompare","profileList","shapeChartLoad"])):f("",!0),Ze.value?(d(),P(g(se),{key:6,onProfileValueChange:le,profileData:C.value,profileList:u.value,slopeChartLoad:me.value},null,8,["profileData","profileList","slopeChartLoad"])):f("",!0),Oe.value?(d(),P(g(ne),{key:7,onProfileValueChange:le,profileData:C.value,profileList:u.value,slopeChartLoad:Q.value},null,8,["profileData","profileList","slopeChartLoad"])):f("",!0),Se.value?(d(),S("div",Lt,[w(g(sa))])):f("",!0),J.value?(d(),P(g(v),{key:9,profileList:u.value,flowspeedChartLoad:Me.value,type:z.value,onConditionChange:ua},null,8,["profileList","flowspeedChartLoad","type"])):f("",!0),J.value?(d(),S("div",Pt,[o("label",Rt,[o("input",{type:"checkbox",checked:Z.value,onClick:a[2]||(a[2]=b=>$e())},null,8,Vt),Mt]),At])):f("",!0),J.value?(d(),S("div",Dt,[w(Xa,{type:"exp","time-step":E.value,"total-count":25},null,8,["time-step"])])):f("",!0),Le.value?(d(),S("div",Bt,[w(g(na),{timeStep:E.value,type:z.value},null,8,["timeStep","type"])])):f("",!0),T.value?(d(),P(g(ca),{key:13})):f("",!0),He.value?Qe((d(),S("div",zt,[w(g(p),{profileList:u.value},null,8,["profileList"])])),[[D,{bounds:"body",cancel:"div.content"}]]):f("",!0),y.value&&I.value?(d(),S("div",Ft,$t)):f("",!0),w(n,{modelValue:he.value,"onUpdate:modelValue":a[4]||(a[4]=b=>he.value=b),title:"绘制断面确认",width:"40vh"},{footer:M(()=>[o("div",Et,[o("div",It,[w(c,{onClick:Ma},{default:M(()=>[re("取消")]),_:1}),w(c,{type:"primary",onClick:Aa},{default:M(()=>[re(" 确认 ")]),_:1})])])]),default:M(()=>[jt,w(s,{modelValue:Y.value,"onUpdate:modelValue":a[3]||(a[3]=b=>Y.value=b),style:{width:"240px","margin-bottom":"10px","margin-left":"2vw"},placeholder:"请输入断面名称",clearable:""},null,8,["modelValue"])]),_:1},8,["modelValue"]),w(n,{modelValue:ye.value,"onUpdate:modelValue":a[5]||(a[5]=b=>ye.value=b),title:"切换场景确认",width:"40vh"},{footer:M(()=>[o("div",Zt,[o("div",Ot,[w(c,{onClick:pa},{default:M(()=>[re("取消")]),_:1}),w(c,{type:"primary",onClick:ma},{default:M(()=>[re(" 确认 ")]),_:1})])])]),default:M(()=>[Tt,o("div",Yt,ie(g(U).name),1),o("div",Nt,ie(g(G).name),1)]),_:1},8,["modelValue"]),Qe(o("div",Ht,[w(L,{class:"loading-icon"},{default:M(()=>[o("div",Wt,ie(k.value),1)]),_:1})],512),[[Ia,ee.value]])])}}},el=ra(Ut,[["__scopeId","data-v-83a34eb9"]]);export{el as default};
