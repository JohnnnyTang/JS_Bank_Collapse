import{a4 as Ge,a5 as ut,a6 as Qt,a7 as Vt,a8 as H,a9 as ei,aa as ti,ab as St,_ as ze,ac as Ie,j as G,o as O,c as K,a as p,b as v,d as w,B as X,ad as ce,p as Oe,f as je,ae as ii,g as E,h as $e,u as it,t as le,N as fe,af as si,ag as Re,ah as Bt,ai as Tt,aj as Ct,ak as ni,al as Le,am as ge,s as st,an as kt,i as ri,W as oi,ao as ai,z as Ae,A as Ee,F as Ce,r as ke,e as he,ap as Ut}from"./index-SWrCUa1v.js";/* empty css                  */import{M as li}from"./mapbox-gl-draw-D7PYLG1M.js";import{M as ui}from"./ModelTitle-N8J-6nmO.js";function hi(l,e){switch(l){case Uint8Array:return new Uint8Array(e);case Uint16Array:return new Uint16Array(e/2);case Uint32Array:return new Uint32Array(e/4);case Float32Array:return new Float32Array(e/4);default:throw new Error("Unsupported data type")}}function di(l){let e=l.byteLength,t=(4-e%4)%4;if(t>0){let i=hi(l.constructor,e+t);for(let s=0;s<l.length;s++)i[s]=l[s];return i}return l}class ci{constructor(e,t){this.uuid=Ge(),this.name=e,this.length=t.length,this._data=di(t),this.onChanges=[],this.structure=[],this.stride=0,this.refCount=0}use(){return this.refCount++,this}release(){return--this.refCount===0&&this.destroy(),null}registerCallback(e){return this.onChanges.push(e),this.onChanges.length-1}removeCallback(e){return this.onChanges[e]=null,null}get value(){return this._data}set value(e){this._data=e,this.onChanges.forEach(t=>t&&t())}setIndexed(e,t){this._data[e]=t,this.onChanges.forEach(i=>i&&i())}getIndexed(e){return this._data[e]}fill(e){this._data.fill(e),this.onChanges.forEach(t=>t&&t())}element(e,t){if(t!==void 0)this.setIndexed(e,t);else return this.getIndexed(e)}destroy(){this.uuid=null,this.name=null,this._data=null,this.onChanges=[],this.structure=[],this.stride=null}}function ye(l,e="arrayRef"){return new ci(e,l)}function fi(l){let e="",t=1;if(l instanceof Float32Array)e="float32",t=4;else if(l instanceof Int32Array)e="int32",t=4;else if(l instanceof Uint32Array)e="uint32",t=4;else return"Unknown Format";return{format:e,bytesPerComponent:t}}class ht extends ut{constructor(e){let t=!1,i=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;t=e.randomAccessible===void 0?t:e.randomAccessible,t&&(i|=GPUBufferUsage.STORAGE);const s={name:e.name,usage:e.usage?e.usage:i,size:e.resource.arrayRef.value.byteLength};super(s),this.registerStrutureMap(e.resource.arrayRef,e.resource.dataOffset,e.resource.size),this.attributes=[],this.stride=0;const{format:n,bytesPerComponent:r}=fi(e.resource.arrayRef.value);this.bytesPerComponent=r,e.resource.structure.forEach(o=>{this.attributes.push({format:n+(o.components>1?`x${o.components}`:""),offset:this.stride}),this.stride+=r*o.components})}static create(e){return new ht(e)}getComponentsPerElement(){return this.stride/this.bytesPerComponent}destroy(){this.stride=null,this.attributes=[],super.destroy()}}function nt(l){return ht.create(l)}class dt extends ut{constructor(e){const t={name:e.name,usage:e.usage?e.usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC,size:e.resource.arrayRef.value.byteLength};super(t),this.componetsPerElement=e.resource.components?e.resource.components:0,this.registerStrutureMap(e.resource.arrayRef,e.resource.dataOffset,e.resource.size)}static create(e){return new dt(e)}destroy(){this.componetsPerElement=null,super.destroy()}}function mi(l){return dt.create(l)}function pi(l){return l instanceof Uint16Array?"uint16":l instanceof Uint32Array?"uint32":"Unknown Format"}class ct extends ut{constructor(e){let t=!1,i=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;t=e.randomAccessible===void 0?t:e.randomAccessible,t&&(i|=GPUBufferUsage.STORAGE);const s={name:e.name,usage:e.usage?e.usage:i,size:e.resource.arrayRef.value.byteLength};super(s),this.length=e.resource.arrayRef.value.length,this.type=pi(e.resource.arrayRef.value),this.registerStrutureMap(e.resource.arrayRef,e.resource.dataOffset,e.resource.size)}static create(e){return new ct(e)}destroy(){this.length=null,this.type=null,super.destroy()}}function gi(l){return ct.create(l)}class ft extends Qt{constructor(e){e===void 0?super("u32",0):super("u32",e)}static create(e){return new ft(e)}set n(e){this._data=e}get n(){return this._data}add(e){return this._data+=e,this}}function yi(l){return ft.create(l)}function _i(l){return{type:"u32",data:l!==void 0?l:0}}class mt extends Vt{constructor(e){super(),this.name=e.name,this.shaderModule=void 0,this.code=e.codeFunc,this.code()&&this.needUpdate()}static create(e){return new mt(e)}needUpdate(){H.addToUpdateList(this)}exportDescriptor(){return{label:this.name,code:this.code()}}update(){H.dispatchEvent({type:"createShader",emitter:this})}isComplete(){return!!this.shaderModule}destroy(){this.code=null,this.shaderModule=null,super.destroy()}}class pt extends Vt{constructor(e){super(),this.uniforms=[],this.sharedUniforms=[],this.indexBinding=e.index,this.indexBinding&&this.indexBinding.buffer.use(),this.indirectBinding=e.indirect?{buffer:e.indirect.buffer.use(),byteOffset:e.indirect.byteOffset?e.indirect.byteOffset:0}:void 0,this.vertexBindings=[],this.storageBindings=[],this.textureBindings=[],this.samplerBindings=[],this.layouts=[],this.vertexLayouts=new Array(e.vertices?e.vertices.length:0),this.groups=[],this.name=e.name?e.name:"Binding",e.vertices&&e.vertices.forEach(i=>{this.addVertexBuffer(i)});let t=0;this.uniformOrder=0,(e.uniforms||e.sharedUniforms)&&(this.uniformOrder=t++,e.uniforms?.forEach(i=>this.addUniformBlock(i)),e.sharedUniforms?.forEach(i=>this.sharedUniforms.push({buffer:i.buffer.use(),visibility:i.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE}))),this.storageOrder=0,e.storages&&(this.storageOrder=t++),e.storages&&e.storages.forEach(i=>{this.addStorageBuffer(i)}),this.textureOrder=0,e.textures&&(this.textureOrder=t++),e.textures&&e.textures.forEach(i=>{this.addTexture(i)}),e.samplers&&e.samplers.forEach((i,s)=>{this.addSampler(s,i)}),this.isIndirect=e.range===void 0,this.isIndirect||(this.range=e.range),this.isComplete=!1,this.uniformBufferReady=!1,this.released=!1,H.addBinding(this),this.executable=!0}static create(e){return new pt(e)}addUniformBlock(e){this.uniforms.push({ref:new ei({map:e.map,name:e.name,dynamic:e.dynamic!==void 0?e.dynamic:!1}),visibility:e.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE});const t=[];this.uniforms.forEach(i=>t.push(i.ref)),this.uniformBuffer=ti.create({name:`Uniform buffer (${this.name})`,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC,blocks:t}).use(),this.uniformBufferReady=!0}addVertexBuffer(e){let t=!1;t=e.isInstanced===void 0?t:e.isInstanced,this.vertexBindings.push({buffer:e.buffer.use(),stepMode:t?"instance":"vertex",visibility:e.visibility||GPUShaderStage.VERTEX})}addStorageBuffer(e){const t=e.writable!==void 0?e.writable:!1;this.storageBindings.push({buffer:e.buffer.use(),type:t?"storage":"read-only-storage",visibility:t?GPUShaderStage.COMPUTE:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE})}addTexture(e){let t="read-only",i=e.asStorage!==void 0?e.asStorage:!1,s=GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE;i&&(s=GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE,e.texture.computable&&(t="write-only")),e.visibility&&(s=e.visibility),this.textureBindings.push({texture:e.texture.use(),callbackIndex:e.texture.registerCallback(()=>{this.isComplete&&H.dispatchEvent({type:"createBindGroup",emitter:this,bindGroupType:"texture",order:this.textureOrder})}),asStorage:i,visibility:s,accessibility:t,sampleType:e.sampleType||"float",multisampled:e.multisampled!==void 0?e.multisampled:!1,viewDimension:e.viewDimension||"2d"})}addSampler(e,t){this.samplerBindings[e]={sampler:t.sampler.use(),bindingType:t.bindingType||"filtering",visibility:t.visibility||GPUShaderStage.FRAGMENT}}createUniformBindGroupLayout(e){if(!this.uniforms.length&&!this.sharedUniforms.length)return;const t=new Array(this.uniforms.length+this.sharedUniforms.length);let i=0;this.uniforms.concat(this.sharedUniforms).forEach(s=>{t[i]={binding:i++,visibility:s.visibility,buffer:{type:"uniform"}}}),this.layouts[this.uniformOrder]=e.createBindGroupLayout({label:"Uniform binding group layout",entries:t})}createUniformBindGroup(e){if(!this.uniforms.length&&!this.sharedUniforms.length)return;const t=new Array(this.uniforms.length+this.sharedUniforms.length);let i=0;this.uniforms.forEach(s=>{const n=this.uniformBuffer.areaMap[s.ref.name];t[i]={binding:i++,resource:{buffer:this.uniformBuffer.buffer,offset:n.start,size:n.length}}}),this.sharedUniforms.forEach(s=>{t[i]={binding:i++,resource:{buffer:s.buffer.buffer}}}),this.groups[this.uniformOrder]=e.createBindGroup({label:"Uniform binding group",layout:this.layouts[this.uniformOrder],entries:t})}createStorageBindGroupLayout(e){if(!this.storageBindings.length)return;const t=new Array(this.storageBindings.length);this.storageBindings.forEach((i,s)=>{t[s]={binding:s,buffer:{type:i.type},visibility:i.visibility}}),this.layouts[this.storageOrder]=e.createBindGroupLayout({label:`Storage binding group layout (${this.name})`,entries:t})}createStorageBindGroup(e){if(!this.storageBindings.length)return;const t=new Array(this.storageBindings.length);this.storageBindings.forEach((i,s)=>{t[s]={binding:s,resource:{buffer:i.buffer.buffer}}}),this.groups[this.storageOrder]=e.createBindGroup({label:`Storage binding group (${this.name})`,layout:this.layouts[this.storageOrder],entries:t})}createVertexBufferLayout(){let e=0;this.vertexBindings.forEach((t,i)=>{const s=new Array(t.buffer.attributes.length);t.buffer.attributes.forEach((n,r)=>{s[r]={format:n.format,shaderLocation:e++,offset:n.offset}}),this.vertexLayouts[i]={arrayStride:t.buffer.stride,stepMode:t.stepMode,attributes:s}})}createTextureBindGroupLayout(e){if(!this.samplerBindings.length&&!this.textureBindings.length)return;const t=new Array(this.samplerBindings.length+this.textureBindings.length);this.samplerBindings.concat(this.textureBindings).forEach((i,s)=>{t[s]={binding:s,visibility:i.visibility,...i.sampler&&{sampler:{type:i.bindingType}},...i.texture&&!i.asStorage&&{texture:{sampleType:i.sampleType,viewDimension:i.viewDimension,multisampled:i.multisampled}},...i.texture&&i.asStorage&&{storageTexture:{access:i.accessibility,format:i.texture.format}}}}),this.layouts[this.textureOrder]=e.createBindGroupLayout({label:"Texture binding group layout",entries:t})}createTextureBindGroup(e){if(!this.samplerBindings.length&&!this.textureBindings.length)return;const t=new Array(this.samplerBindings.length+this.textureBindings.length);this.samplerBindings.concat(this.textureBindings).forEach((i,s)=>{t[s]={binding:s,...i.sampler&&{resource:i.sampler.sampler},...i.texture&&{resource:i.texture.view()}}}),!this.layouts[this.textureOrder]&&this.createTextureBindGroupLayout(e),this.groups[this.textureOrder]=e.createBindGroup({label:`Texture binding group (${this.name})`,layout:this.layouts[this.textureOrder],entries:t})}exportLayoutDescriptor(e){switch(e){case"uniform":{const t=new Array(this.uniforms.length+this.sharedUniforms.length);let i=0;return this.uniforms.concat(this.sharedUniforms).forEach(s=>{t[i]={binding:i++,visibility:s.visibility,buffer:{type:"uniform"}}}),{label:`Uniform binding group layout (${this.name})`,entries:t}}case"storage":{const t=new Array(this.storageBindings.length);return this.storageBindings.forEach((i,s)=>{t[s]={binding:s,buffer:{type:i.type},visibility:i.visibility}}),{label:`Storage binding group layout (${this.name})`,entries:t}}case"texture":{const t=new Array(this.samplerBindings.length+this.textureBindings.length);return this.samplerBindings.concat(this.textureBindings).forEach((i,s)=>{t[s]={binding:s,visibility:i.visibility,...i.sampler&&{sampler:{type:i.bindingType}},...i.texture&&!i.asStorage&&{texture:{sampleType:i.sampleType,viewDimension:i.viewDimension,multisampled:i.multisampled}},...i.texture&&i.asStorage&&{storageTexture:{access:i.accessibility,format:i.texture.format}}}}),{label:`Texture binding group layout (${this.name})`,entries:t}}}}exportDescriptor(e){switch(e){case"uniform":{const t=new Array(this.uniforms.length+this.sharedUniforms.length);let i=0;return this.uniforms.forEach(s=>{const n=this.uniformBuffer.areaMap[s.ref.name];t[i]={binding:i++,resource:{buffer:this.uniformBuffer.buffer,offset:n.start,size:n.length}}}),this.sharedUniforms.forEach(s=>{t[i]={binding:i++,resource:{buffer:s.buffer.buffer}}}),{label:`Uniform binding group (${this.name})`,layout:this.layouts[this.uniformOrder],entries:t}}case"storage":{const t=new Array(this.storageBindings.length);return this.storageBindings.forEach((i,s)=>{t[s]={binding:s,resource:{buffer:i.buffer.buffer}}}),{label:`Storage binding group (${this.name})`,layout:this.layouts[this.storageOrder],entries:t}}case"texture":{const t=new Array(this.samplerBindings.length+this.textureBindings.length);return this.samplerBindings.concat(this.textureBindings).forEach((i,s)=>{t[s]={binding:s,...i.sampler&&{resource:i.sampler.sampler},...i.texture&&{resource:i.texture.view()}}}),{label:`Texture binding group (${this.name})`,layout:this.layouts[this.textureOrder],entries:t}}}}crteateBindGroupLayouts(){(this.uniforms.length||this.sharedUniforms.length)&&H.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"uniform",order:this.uniformOrder}),this.storageBindings.length&&H.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"storage",order:this.storageOrder}),(this.samplerBindings.length||this.textureBindings.length)&&H.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"texture",order:this.textureOrder})}createBindGroups(){this.createVertexBufferLayout(),(this.uniforms.length||this.sharedUniforms.length)&&(H.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"uniform",order:this.uniformOrder}),H.dispatchEvent({type:"createBindGroup",emitter:this,bindGroupType:"uniform",order:this.uniformOrder})),this.storageBindings.length&&(H.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"storage",order:this.storageOrder}),H.dispatchEvent({type:"createBindGroup",emitter:this,bindGroupType:"storage",order:this.storageOrder})),(this.samplerBindings.length||this.textureBindings.length)&&(H.dispatchEvent({type:"createBindGroupLayout",emitter:this,bindGroupType:"texture",order:this.textureOrder}),H.dispatchEvent({type:"createBindGroup",emitter:this,bindGroupType:"texture",order:this.textureOrder}))}tryMakeComplete(){if(this.isComplete)return!0;if(this.released)return!1;for(const e of this.textureBindings)if(!e.texture.texture)return!1;return this.createBindGroups(),this.isComplete=!0,!0}update(){}getIndirect(){return this.indirectBinding}getBindGroupLayouts(){return this.layouts}getBindGroups(){return this.groups}getVertexLayouts(){return this.vertexLayouts}setBindGroups(e){this.groups.forEach((t,i)=>{e.setBindGroup(i,t)})}setVertexBuffers(e){this.vertexBindings.forEach((t,i)=>{e.setVertexBuffer(i,t.buffer.buffer)})}getShader(){return this.shader.shaderModule}getIndex(){return this.indexBinding?this.indexBinding.buffer:void 0}destroy(){return this.isComplete=!1,this.released=!0,this.range=null,this.uniforms.forEach(e=>{e.ref=e.ref?.release(),e.visibility=null,e.name=null,e.view=null,e.map=null}),this.uniforms=null,this.sharedUniforms.forEach(e=>{e.buffer=e.buffer.release(),e.visibility=null}),this.sharedUniforms=null,this.indexBinding&&(this.indexBinding.buffer=this.indexBinding.buffer.release(),this.indexBinding=null),this.indirectBinding&&(this.indirectBinding.buffer=this.indirectBinding.buffer.release(),this.indirectBinding=null),this.vertexBindings.forEach(e=>{e.buffer=e.buffer.release(),e.visibility=null,e.stepMode=null}),this.vertexBindings=null,this.storageBindings.forEach(e=>{e.buffer=e.buffer.release(),e.visibility=null,e.type=null}),this.storageBindings=null,this.textureBindings.forEach(e=>{e.callbackIndex=e.texture.removeCallback(e.callbackIndex),e.texture=e.texture.release(),e.viewDimension=null,e.accessibility=null,e.multisampled=null,e.sampleType=null,e.visibility=null,e.asStorage=null}),this.textureBindings=null,this.samplerBindings.forEach(e=>{e.sampler=e.sampler.release(),e.bindingType=null,e.visibility=null}),this.samplerBindings=null,this.vertexLayouts=null,this.layouts=null,this.groups=null,this.vertexLayouts=null,this.layouts=null,this.groups=null,this.uniformBuffer=this.uniformBuffer?.release(),this.refCount=null,this.name=null,super.destroy(),null}}function ne(l){return pt.create(l)}const rt={color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},It={color:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}};class gt{constructor(e){this.uuid=Ge(),this.shader=e.shader.module.use(),this.name=e.name||"Render Pipeline",this.vsEntryPoint=e.shader.vsEntryPoint||"vMain",this.fsEntryPoint=e.shader.fsEntryPoint||"fMain",this.colorTargetStates=[],this.colorTargetStateDescriptions=e.colorTargetStates,this.depthStencilState=void 0,this.primitive=e.primitive||{cullMode:"none",topology:"triangle-list"},this.depthTest=e.depthTest,this.pipelineLayout=void 0,this.pipeline=void 0,this.asBundle=e.asBundle!==void 0?e.asBundle:!1,this.bundleDirty=this.asBundle,this.renderBundle=void 0,this.pipelineCreating=!1,this.isFinite=!1,this.triggerCount=0,this.executable=!0}static create(e){return new gt(e)}createPipelineLayout(e,t){this.pipelineLayout=e.createPipelineLayout({label:`Rendering pipline layout (${this.name})`,bindGroupLayouts:t.getBindGroupLayouts()})}exportLayoutDescriptor(e){return this.layout?this.layout:(this.layout={label:`Rendering pipline layout (${this.name})`,bindGroupLayouts:e.getBindGroupLayouts()},this.layout)}exportDescriptor(e){const t={topology:this.primitive.topology,frontFace:this.primitive.frontFace,cullMode:this.primitive.cullMode,unclippedDepth:this.primitive.unclippedDepth,...e.indexBinding&&(this.primitive.topology==="line-strip"||this.primitive.topology==="triangle-strip")&&{stripIndexFormat:e.indexBinding.buffer.type}};return{label:`Rendering pipeline (${this.name})`,layout:this.pipelineLayout,vertex:{module:this.shader.shaderModule,entryPoint:this.vsEntryPoint,buffers:e.getVertexLayouts()},fragment:{module:this.shader.shaderModule,entryPoint:this.fsEntryPoint,targets:this.colorTargetStates},primitive:t,depthStencil:this.depthStencilState}}createTargetState(e){const t=e.makeColorFormats();this.colorTargetStates=new Array(t.length),t.forEach((s,n)=>{this.colorTargetStates[n]={format:s,blend:this.colorTargetStateDescriptions!==void 0?this.colorTargetStateDescriptions[n].blend:void 0,writeMask:this.colorTargetStateDescriptions!==void 0?this.colorTargetStateDescriptions[n].writeMask:void 0}});const i=e.makeDepthStencilFormat();i!==void 0&&(this.depthTest===void 0&&(this.depthTest=!0),this.depthStencilState={depthWriteEnabled:this.depthTest,depthCompare:"less",format:i})}createPipeline(e,t){this.pipelineCreating=!0,H.dispatchEvent({type:"createPipelineLayout",emitter:this,binding:t}),this.createTargetState(e),H.dispatchEvent({type:"createRenderPipelineAsync",emitter:this,binding:t})}tryMakeComplete(e,t){return this.pipeline?!0:(this.shader.isComplete()&&!this.pipelineCreating&&this.createPipeline(e,t),!1)}makeRenderBundle(e,t){H.dispatchEvent({type:"createRenderBundle",emitter:this,renderPass:e,binding:t})}executeRenderPass(e,t){t.setBindGroups(e),t.setVertexBuffers(e),e.setPipeline(this.pipeline),t.indexBinding?(e.setIndexBuffer(t.indexBinding.buffer.buffer,t.indexBinding.buffer.type),t.isIndirect?e.drawIndexedIndirect(t.indirectBinding.buffer.buffer,t.indirectBinding.byteOffset):e.drawIndexed(...t.range())):t.isIndirect?e.drawIndirect(t.indirectBinding.buffer.buffer,t.indirectBinding.byteOffset):e.draw(...t.range())}triggerFiniteTimes(e){return this.isFinite=!0,this.triggerCount=e,this}draw(e,t){this.isFinite&&!this.triggerCount||(this.triggerCount=Math.max(this.triggerCount-1,0),this.executable&&(this.asBundle?(this.bundleDirty&&this.makeRenderBundle(e,t),e.pass.executeBundles([this.renderBundle])):this.executeRenderPass(e.pass,t)))}}function _e(l){return gt.create(l)}class yt{constructor(e){this.uuid=Ge(),this.name=e.name,this.computecalls=[],this.pass=void 0,this.update(),this.executable=!0}static create(e){return new yt(e)}update(){this.passDescription={label:`Compute pass (${this.name})`}}add(e,t){return this.computecalls.push({pipeline:e,binding:t}),this}empty(){this.computecalls=[]}execute(e){this.executable&&(this.pass=e.beginComputePass(this.passDescription),this.computecalls.forEach(({binding:t,pipeline:i})=>{!t.tryMakeComplete()||!i.tryMakeComplete(this,t)||!i.executable||!t.executable||i.dispatch(this,t)}),this.pass.end())}}function bi(l){return yt.create(l)}class _t{constructor(e){this.uuid=Ge(),this.name=e.name?e.name:"Computable builder",this.shader=e.shader.module.use(),this.csEntryPoint=e.shader.csEntryPoint||"cMain",this.constants=e.constants,this.pipelineLayout=void 0,this.pipeline=void 0,this.pipelineCreating=!1,this.isFinite=!1,this.triggerCount=0,this.executable=!0}static create(e){return new _t(e)}createPipelineLayout(e){const t=St();this.pipelineLayout=t.createPipelineLayout({label:`compute pipline layout (${this.name})`,bindGroupLayouts:e.getBindGroupLayouts()})}createPipeline(e){const t=St();this.pipelineCreating=!0,this.createPipelineLayout(e),t.createComputePipelineAsync({label:`compute pipeline (${this.name})`,layout:this.pipelineLayout,compute:{module:this.shader.shaderModule,entryPoint:this.csEntryPoint,constants:this.constants}}).then(i=>{this.pipeline=i,this.pipelineCreating=!1}).catch(i=>{console.error(`Error::Compute Pipeline (${this.name}) Creation FAILED!`,i)})}isComplete(e,t){return this.pipeline?!0:(!this.pipelineCreating&&this.createPipeline(renderPass,t),!1)}tryMakeComplete(e,t){return this.pipeline?!0:(this.shader.isComplete()&&!this.pipelineCreating&&this.createPipeline(t),!1)}triggerFiniteTimes(e){return this.isFinite=!0,this.triggerCount=e,this}dispatch(e,t){this.isFinite&&!this.triggerCount||(this.triggerCount=Math.max(this.triggerCount-1,0),this.executable&&(t.setBindGroups(e.pass),e.pass.setPipeline(this.pipeline),t.isIndirect?e.pass.dispatchWorkgroupsIndirect(t.indirectBinding.buffer.buffer,t.indirectBinding.byteOffset):e.pass.dispatchWorkgroups(...t.range())))}}function vi(l){return _t.create(l)}class xi{constructor(){this.workerIndex=0,this.textResource=new WeakMap,this.workerKeys=new Map}load(e,t){const i={index:this.workerIndex};this.workerKeys.set(this.workerIndex,i);const s={name:e,codeFunc:()=>this.textResource.get(i)?this.textResource.get(i).deref().text:null},n=mt.create(s),r=new Worker(new URL("/assets/textLoader.worker-CLJPrufo.js",import.meta.url));return r.addEventListener("message",o=>{const{text:a}=o.data;this.textResource.set(i,new WeakRef({text:a})),r.terminate(),H.dispatchEvent({type:"createShader",emitter:n})}),r.addEventListener("error",o=>{console.error("Error loading image: ",o),r.terminate()}),r.postMessage({url:t}),this.workerIndex++,n}}const de=new xi,wi=l=>(Oe("data-v-368baa2c"),l=l(),je(),l),Pi={class:"conditions"},Si=wi(()=>p("div",{class:"head"},[p("div",{class:"head-text"},"水文条件选择")],-1)),Bi={class:"form"},Ti={class:"button-container"},Ci={__name:"HydrologicalCondition",emits:["close","condition"],setup(l,{emit:e}){const t=Ie({condition:""}),i=e,s=()=>{if(t.condition===""){ce({type:"warning",offset:100,message:"请选择水文条件后再确定！"});return}else{i("condition",t.condition),i("close");return}};return(n,r)=>{const o=G("el-option"),a=G("el-select"),h=G("el-form-item"),c=G("el-button"),u=G("el-form");return O(),K("div",Pi,[Si,p("div",Bi,[v(u,{model:t,"label-width":"auto",style:{"max-width":"600px"}},{default:w(()=>[v(h,{label:"水文条件"},{default:w(()=>[v(a,{modelValue:t.condition,"onUpdate:modelValue":r[0]||(r[0]=f=>t.condition=f),placeholder:"请选择水文条件"},{default:w(()=>[v(o,{label:"洪季大潮",value:"洪季大潮"}),v(o,{label:"枯季小潮",value:"枯季小潮"}),v(o,{label:"20年一遇",value:"20年一遇"})]),_:1},8,["modelValue"])]),_:1}),v(h,null,{default:w(()=>[p("div",Ti,[v(c,{type:"primary",onClick:s},{default:w(()=>[X("确定")]),_:1}),v(c,{onClick:r[1]||(r[1]=f=>{i("close")})},{default:w(()=>[X("取消")]),_:1})])]),_:1})]),_:1},8,["model"])])])}}},ki=ze(Ci,[["__scopeId","data-v-368baa2c"]]),Ui=l=>(Oe("data-v-22c7ec9b"),l=l(),je(),l),Ii={class:"stParams"},Mi=Ui(()=>p("div",{class:"head"},[p("div",{class:"head-text"},"模型参数设置")],-1)),Ri={class:"form"},Li={class:"button-container"},Ai={__name:"SetParameter",emits:["close","params"],setup(l,{emit:e}){const t=e,i=Ie({simulateHour:"72",simulateStep:"10",frictionParam:"0.013",minWaterDepth:"0.05",SmagorinskyParam:"0.23"}),s=()=>{t("params",i),t("close")};return(n,r)=>{const o=G("el-input"),a=G("el-form-item"),h=G("el-button"),c=G("el-form");return O(),K("div",Ii,[Mi,p("div",Ri,[v(c,{model:i,"label-width":"auto",style:{"max-width":"600px"}},{default:w(()=>[v(a,{label:"模拟时间(小时)"},{default:w(()=>[v(o,{modelValue:i.simulateHour,"onUpdate:modelValue":r[0]||(r[0]=u=>i.simulateHour=u)},null,8,["modelValue"])]),_:1}),v(a,{label:"模拟步长(分钟)"},{default:w(()=>[v(o,{modelValue:i.simulateStep,"onUpdate:modelValue":r[1]||(r[1]=u=>i.simulateStep=u)},null,8,["modelValue"])]),_:1}),v(a,{label:"底摩擦系数(曼宁系数)"},{default:w(()=>[v(o,{modelValue:i.frictionParam,"onUpdate:modelValue":r[2]||(r[2]=u=>i.frictionParam=u)},null,8,["modelValue"])]),_:1}),v(a,{label:"最小水深(m)"},{default:w(()=>[v(o,{modelValue:i.minWaterDepth,"onUpdate:modelValue":r[3]||(r[3]=u=>i.minWaterDepth=u)},null,8,["modelValue"])]),_:1}),v(a,{label:"水平涡动粘性系数"},{default:w(()=>[v(o,{modelValue:i.SmagorinskyParam,"onUpdate:modelValue":r[4]||(r[4]=u=>i.SmagorinskyParam=u)},null,8,["modelValue"])]),_:1}),v(a,null,{default:w(()=>[p("div",Li,[v(h,{type:"primary",onClick:s},{default:w(()=>[X("确定")]),_:1}),v(h,{onClick:r[5]||(r[5]=u=>t("close"))},{default:w(()=>[X("取消")]),_:1})])]),_:1})]),_:1},8,["model"])])])}}},Ei=ze(Ai,[["__scopeId","data-v-22c7ec9b"]]),Gt=ii("stability",()=>{const l=E("undefined"),e=E(0),t=E(0);return{modelStatus:l,modelProgress:e,modelStartTime:t}},{persist:{storage:sessionStorage,paths:["stability"]}}),bt=l=>(Oe("data-v-f7b991d7"),l=l(),je(),l),Di={class:"stParams"},Fi=bt(()=>p("div",{class:"head"},[p("div",{class:"head-text"},"模型运行状况")],-1)),$i={class:"status-container"},Vi={key:0},Gi={class:"slider-demo-block"},zi={class:"demonstration",style:{"padding-bottom":"10px"}},Oi={style:{"padding-top":"10px"}},ji={key:1,style:{width:"100%",display:"flex","justify-content":"center"}},Ni=bt(()=>p("div",null,"模型尚未运行",-1)),Xi=[Ni],Yi={key:2},Hi=bt(()=>p("div",null,"模型运行完成",-1)),Wi=[Hi],Ki={class:"button-container"},qi={__name:"ModelStatus",emits:["close"],setup(l,{emit:e}){const t=Gt(),i=$e(()=>Number(t.modelProgress.toFixed(3))),s=$e(()=>{const o=(Date.now()-t.modelStartTime)/1e3/t.modelProgress*(100-t.modelProgress),a=Math.floor(o/3600),h=Math.floor(o%3600/60),c=Math.floor(o%60);return h?`预计${a}小时${h}分${c}秒完成`:"预计时间正在计算中"}),n=e,r=()=>{n("close")};return(o,a)=>{const h=G("el-slider"),c=G("el-button");return O(),K("div",Di,[Fi,p("div",$i,[it(t).modelStatus==="pending"?(O(),K("div",Vi,[p("div",Gi,[p("div",zi,le(`当前进度: ${i.value}%`),1),v(h,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=u=>i.value=u),"show-tooltip":!1},null,8,["modelValue"])]),p("div",Oi,le(s.value),1)])):it(t).modelStatus==="undefined"?(O(),K("div",ji,Xi)):it(t).modelStatus==="success"?(O(),K("div",Yi,Wi)):fe("",!0)]),p("div",Ki,[v(c,{type:"primary",onClick:r},{default:w(()=>[X("确定")]),_:1})])])}}},Ji=ze(qi,[["__scopeId","data-v-f7b991d7"]]),re=11102230246251565e-32,W=134217729,Zi=(3+8*re)*re;function ot(l,e,t,i,s){let n,r,o,a,h=e[0],c=i[0],u=0,f=0;c>h==c>-h?(n=h,h=e[++u]):(n=c,c=i[++f]);let d=0;if(u<l&&f<t)for(c>h==c>-h?(r=h+n,o=n-(r-h),h=e[++u]):(r=c+n,o=n-(r-c),c=i[++f]),n=r,o!==0&&(s[d++]=o);u<l&&f<t;)c>h==c>-h?(r=n+h,a=r-n,o=n-(r-a)+(h-a),h=e[++u]):(r=n+c,a=r-n,o=n-(r-a)+(c-a),c=i[++f]),n=r,o!==0&&(s[d++]=o);for(;u<l;)r=n+h,a=r-n,o=n-(r-a)+(h-a),h=e[++u],n=r,o!==0&&(s[d++]=o);for(;f<t;)r=n+c,a=r-n,o=n-(r-a)+(c-a),c=i[++f],n=r,o!==0&&(s[d++]=o);return(n!==0||d===0)&&(s[d++]=n),d}function Qi(l,e){let t=e[0];for(let i=1;i<l;i++)t+=e[i];return t}function Me(l){return new Float64Array(l)}const es=(3+16*re)*re,ts=(2+12*re)*re,is=(9+64*re)*re*re,be=Me(4),Mt=Me(8),Rt=Me(12),Lt=Me(16),Q=Me(4);function ss(l,e,t,i,s,n,r){let o,a,h,c,u,f,d,y,g,P,b,B,M,A,D,F,V,R;const x=l-s,k=t-s,T=e-n,U=i-n;A=x*U,f=W*x,d=f-(f-x),y=x-d,f=W*U,g=f-(f-U),P=U-g,D=y*P-(A-d*g-y*g-d*P),F=T*k,f=W*T,d=f-(f-T),y=T-d,f=W*k,g=f-(f-k),P=k-g,V=y*P-(F-d*g-y*g-d*P),b=D-V,u=D-b,be[0]=D-(b+u)+(u-V),B=A+b,u=B-A,M=A-(B-u)+(b-u),b=M-F,u=M-b,be[1]=M-(b+u)+(u-F),R=B+b,u=R-B,be[2]=B-(R-u)+(b-u),be[3]=R;let L=Qi(4,be),z=ts*r;if(L>=z||-L>=z||(u=l-x,o=l-(x+u)+(u-s),u=t-k,h=t-(k+u)+(u-s),u=e-T,a=e-(T+u)+(u-n),u=i-U,c=i-(U+u)+(u-n),o===0&&a===0&&h===0&&c===0)||(z=is*r+Zi*Math.abs(L),L+=x*c+U*o-(T*h+k*a),L>=z||-L>=z))return L;A=o*U,f=W*o,d=f-(f-o),y=o-d,f=W*U,g=f-(f-U),P=U-g,D=y*P-(A-d*g-y*g-d*P),F=a*k,f=W*a,d=f-(f-a),y=a-d,f=W*k,g=f-(f-k),P=k-g,V=y*P-(F-d*g-y*g-d*P),b=D-V,u=D-b,Q[0]=D-(b+u)+(u-V),B=A+b,u=B-A,M=A-(B-u)+(b-u),b=M-F,u=M-b,Q[1]=M-(b+u)+(u-F),R=B+b,u=R-B,Q[2]=B-(R-u)+(b-u),Q[3]=R;const I=ot(4,be,4,Q,Mt);A=x*c,f=W*x,d=f-(f-x),y=x-d,f=W*c,g=f-(f-c),P=c-g,D=y*P-(A-d*g-y*g-d*P),F=T*h,f=W*T,d=f-(f-T),y=T-d,f=W*h,g=f-(f-h),P=h-g,V=y*P-(F-d*g-y*g-d*P),b=D-V,u=D-b,Q[0]=D-(b+u)+(u-V),B=A+b,u=B-A,M=A-(B-u)+(b-u),b=M-F,u=M-b,Q[1]=M-(b+u)+(u-F),R=B+b,u=R-B,Q[2]=B-(R-u)+(b-u),Q[3]=R;const C=ot(I,Mt,4,Q,Rt);A=o*c,f=W*o,d=f-(f-o),y=o-d,f=W*c,g=f-(f-c),P=c-g,D=y*P-(A-d*g-y*g-d*P),F=a*h,f=W*a,d=f-(f-a),y=a-d,f=W*h,g=f-(f-h),P=h-g,V=y*P-(F-d*g-y*g-d*P),b=D-V,u=D-b,Q[0]=D-(b+u)+(u-V),B=A+b,u=B-A,M=A-(B-u)+(b-u),b=M-F,u=M-b,Q[1]=M-(b+u)+(u-F),R=B+b,u=R-B,Q[2]=B-(R-u)+(b-u),Q[3]=R;const $=ot(C,Rt,4,Q,Lt);return Lt[$-1]}function De(l,e,t,i,s,n){const r=(e-n)*(t-s),o=(l-s)*(i-n),a=r-o,h=Math.abs(r+o);return Math.abs(a)>=es*h?a:-ss(l,e,t,i,s,n,h)}const At=Math.pow(2,-52),Fe=new Uint32Array(512);class Ve{static from(e,t=ls,i=us){const s=e.length,n=new Float64Array(s*2);for(let r=0;r<s;r++){const o=e[r];n[2*r]=t(o),n[2*r+1]=i(o)}return new Ve(n)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*t-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:i,_hullTri:s,_hullHash:n}=this,r=e.length>>1;let o=1/0,a=1/0,h=-1/0,c=-1/0;for(let x=0;x<r;x++){const k=e[2*x],T=e[2*x+1];k<o&&(o=k),T<a&&(a=T),k>h&&(h=k),T>c&&(c=T),this._ids[x]=x}const u=(o+h)/2,f=(a+c)/2;let d,y,g;for(let x=0,k=1/0;x<r;x++){const T=at(u,f,e[2*x],e[2*x+1]);T<k&&(d=x,k=T)}const P=e[2*d],b=e[2*d+1];for(let x=0,k=1/0;x<r;x++){if(x===d)continue;const T=at(P,b,e[2*x],e[2*x+1]);T<k&&T>0&&(y=x,k=T)}let B=e[2*y],M=e[2*y+1],A=1/0;for(let x=0;x<r;x++){if(x===d||x===y)continue;const k=os(P,b,B,M,e[2*x],e[2*x+1]);k<A&&(g=x,A=k)}let D=e[2*g],F=e[2*g+1];if(A===1/0){for(let T=0;T<r;T++)this._dists[T]=e[2*T]-e[0]||e[2*T+1]-e[1];xe(this._ids,this._dists,0,r-1);const x=new Uint32Array(r);let k=0;for(let T=0,U=-1/0;T<r;T++){const L=this._ids[T],z=this._dists[L];z>U&&(x[k++]=L,U=z)}this.hull=x.subarray(0,k),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(De(P,b,B,M,D,F)<0){const x=y,k=B,T=M;y=g,B=D,M=F,g=x,D=k,F=T}const V=as(P,b,B,M,D,F);this._cx=V.x,this._cy=V.y;for(let x=0;x<r;x++)this._dists[x]=at(e[2*x],e[2*x+1],V.x,V.y);xe(this._ids,this._dists,0,r-1),this._hullStart=d;let R=3;i[d]=t[g]=y,i[y]=t[d]=g,i[g]=t[y]=d,s[d]=0,s[y]=1,s[g]=2,n.fill(-1),n[this._hashKey(P,b)]=d,n[this._hashKey(B,M)]=y,n[this._hashKey(D,F)]=g,this.trianglesLen=0,this._addTriangle(d,y,g,-1,-1,-1);for(let x=0,k,T;x<this._ids.length;x++){const U=this._ids[x],L=e[2*U],z=e[2*U+1];if(x>0&&Math.abs(L-k)<=At&&Math.abs(z-T)<=At||(k=L,T=z,U===d||U===y||U===g))continue;let I=0;for(let oe=0,Ne=this._hashKey(L,z);oe<this._hashSize&&(I=n[(Ne+oe)%this._hashSize],!(I!==-1&&I!==i[I]));oe++);I=t[I];let C=I,$;for(;$=i[C],De(L,z,e[2*C],e[2*C+1],e[2*$],e[2*$+1])>=0;)if(C=$,C===I){C=-1;break}if(C===-1)continue;let J=this._addTriangle(C,U,i[C],-1,-1,s[C]);s[U]=this._legalize(J+2),s[C]=J,R++;let Y=i[C];for(;$=i[Y],De(L,z,e[2*Y],e[2*Y+1],e[2*$],e[2*$+1])<0;)J=this._addTriangle(Y,U,$,s[U],-1,s[Y]),s[U]=this._legalize(J+2),i[Y]=Y,R--,Y=$;if(C===I)for(;$=t[C],De(L,z,e[2*$],e[2*$+1],e[2*C],e[2*C+1])<0;)J=this._addTriangle($,U,C,-1,s[C],s[$]),this._legalize(J+2),s[$]=J,i[C]=C,R--,C=$;this._hullStart=t[U]=C,i[C]=t[Y]=U,i[U]=Y,n[this._hashKey(L,z)]=U,n[this._hashKey(e[2*C],e[2*C+1])]=C}this.hull=new Uint32Array(R);for(let x=0,k=this._hullStart;x<R;x++)this.hull[x]=k,k=i[k];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(ns(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:i,coords:s}=this;let n=0,r=0;for(;;){const o=i[e],a=e-e%3;if(r=a+(e+2)%3,o===-1){if(n===0)break;e=Fe[--n];continue}const h=o-o%3,c=a+(e+1)%3,u=h+(o+2)%3,f=t[r],d=t[e],y=t[c],g=t[u];if(rs(s[2*f],s[2*f+1],s[2*d],s[2*d+1],s[2*y],s[2*y+1],s[2*g],s[2*g+1])){t[e]=g,t[o]=f;const b=i[u];if(b===-1){let M=this._hullStart;do{if(this._hullTri[M]===u){this._hullTri[M]=e;break}M=this._hullPrev[M]}while(M!==this._hullStart)}this._link(e,b),this._link(o,i[r]),this._link(r,u);const B=h+(o+1)%3;n<Fe.length&&(Fe[n++]=B)}else{if(n===0)break;e=Fe[--n]}}return r}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,i,s,n,r){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=i,this._link(o,s),this._link(o+1,n),this._link(o+2,r),this.trianglesLen+=3,o}}function ns(l,e){const t=l/(Math.abs(l)+Math.abs(e));return(e>0?3-t:1+t)/4}function at(l,e,t,i){const s=l-t,n=e-i;return s*s+n*n}function rs(l,e,t,i,s,n,r,o){const a=l-r,h=e-o,c=t-r,u=i-o,f=s-r,d=n-o,y=a*a+h*h,g=c*c+u*u,P=f*f+d*d;return a*(u*P-g*d)-h*(c*P-g*f)+y*(c*d-u*f)<0}function os(l,e,t,i,s,n){const r=t-l,o=i-e,a=s-l,h=n-e,c=r*r+o*o,u=a*a+h*h,f=.5/(r*h-o*a),d=(h*c-o*u)*f,y=(r*u-a*c)*f;return d*d+y*y}function as(l,e,t,i,s,n){const r=t-l,o=i-e,a=s-l,h=n-e,c=r*r+o*o,u=a*a+h*h,f=.5/(r*h-o*a),d=l+(h*c-o*u)*f,y=e+(r*u-a*c)*f;return{x:d,y}}function xe(l,e,t,i){if(i-t<=20)for(let s=t+1;s<=i;s++){const n=l[s],r=e[n];let o=s-1;for(;o>=t&&e[l[o]]>r;)l[o+1]=l[o--];l[o+1]=n}else{const s=t+i>>1;let n=t+1,r=i;Ue(l,s,n),e[l[t]]>e[l[i]]&&Ue(l,t,i),e[l[n]]>e[l[i]]&&Ue(l,n,i),e[l[t]]>e[l[n]]&&Ue(l,t,n);const o=l[n],a=e[o];for(;;){do n++;while(e[l[n]]<a);do r--;while(e[l[r]]>a);if(r<n)break;Ue(l,n,r)}l[t+1]=l[r],l[r]=o,i-n+1>=r-t?(xe(l,e,n,i),xe(l,e,t,r-1)):(xe(l,e,t,r-1),xe(l,e,n,i))}}function Ue(l,e,t){const i=l[e];l[e]=l[t],l[t]=i}function ls(l){return l[0]}function us(l){return l[1]}const Et=1e-6;class me{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,i){e=+e,t=+t,i=+i;const s=e+i,n=t;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${s},${n}`:(Math.abs(this._x1-s)>Et||Math.abs(this._y1-n)>Et)&&(this._+="L"+s+","+n),i&&(this._+=`A${i},${i},0,1,1,${e-i},${t}A${i},${i},0,1,1,${this._x1=s},${this._y1=n}`)}rect(e,t,i,s){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+i}v${+s}h${-i}Z`}value(){return this._||null}}class lt{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class hs{constructor(e,[t,i,s,n]=[0,0,960,500]){if(!((s=+s)>=(t=+t))||!((n=+n)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=s,this.xmin=t,this.ymax=n,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:i},vectors:s}=this;let n,r;const o=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let g=0,P=0,b=i.length,B,M;g<b;g+=3,P+=2){const A=i[g]*2,D=i[g+1]*2,F=i[g+2]*2,V=e[A],R=e[A+1],x=e[D],k=e[D+1],T=e[F],U=e[F+1],L=x-V,z=k-R,I=T-V,C=U-R,$=(L*C-z*I)*2;if(Math.abs($)<1e-9){if(n===void 0){n=r=0;for(const Y of t)n+=e[Y*2],r+=e[Y*2+1];n/=t.length,r/=t.length}const J=1e9*Math.sign((n-V)*C-(r-R)*I);B=(V+T)/2-J*C,M=(R+U)/2+J*I}else{const J=1/$,Y=L*L+z*z,oe=I*I+C*C;B=V+(C*Y-z*oe)*J,M=R+(L*oe-I*Y)*J}o[P]=B,o[P+1]=M}let a=t[t.length-1],h,c=a*4,u,f=e[2*a],d,y=e[2*a+1];s.fill(0);for(let g=0;g<t.length;++g)a=t[g],h=c,u=f,d=y,c=a*4,f=e[2*a],y=e[2*a+1],s[h+2]=s[c]=d-y,s[h+3]=s[c+1]=f-u}render(e){const t=e==null?e=new me:void 0,{delaunay:{halfedges:i,inedges:s,hull:n},circumcenters:r,vectors:o}=this;if(n.length<=1)return null;for(let c=0,u=i.length;c<u;++c){const f=i[c];if(f<c)continue;const d=Math.floor(c/3)*2,y=Math.floor(f/3)*2,g=r[d],P=r[d+1],b=r[y],B=r[y+1];this._renderSegment(g,P,b,B,e)}let a,h=n[n.length-1];for(let c=0;c<n.length;++c){a=h,h=n[c];const u=Math.floor(s[h]/3)*2,f=r[u],d=r[u+1],y=a*4,g=this._project(f,d,o[y+2],o[y+3]);g&&this._renderSegment(f,d,g[0],g[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new me:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const i=t==null?t=new me:void 0,s=this._clip(e);if(s===null||!s.length)return;t.moveTo(s[0],s[1]);let n=s.length;for(;s[0]===s[n-2]&&s[1]===s[n-1]&&n>1;)n-=2;for(let r=2;r<n;r+=2)(s[r]!==s[r-2]||s[r+1]!==s[r-1])&&t.lineTo(s[r],s[r+1]);return t.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,i=e.length/2;t<i;++t){const s=this.cellPolygon(t);s&&(s.index=t,yield s)}}cellPolygon(e){const t=new lt;return this.renderCell(e,t),t.value()}_renderSegment(e,t,i,s,n){let r;const o=this._regioncode(e,t),a=this._regioncode(i,s);o===0&&a===0?(n.moveTo(e,t),n.lineTo(i,s)):(r=this._clipSegment(e,t,i,s,o,a))&&(n.moveTo(r[0],r[1]),n.lineTo(r[2],r[3]))}contains(e,t,i){return t=+t,t!==t||(i=+i,i!==i)?!1:this.delaunay._step(e,t,i)===e}*neighbors(e){const t=this._clip(e);if(t)for(const i of this.delaunay.neighbors(e)){const s=this._clip(i);if(s){e:for(let n=0,r=t.length;n<r;n+=2)for(let o=0,a=s.length;o<a;o+=2)if(t[n]===s[o]&&t[n+1]===s[o+1]&&t[(n+2)%r]===s[(o+a-2)%a]&&t[(n+3)%r]===s[(o+a-1)%a]){yield i;break e}}}}_cell(e){const{circumcenters:t,delaunay:{inedges:i,halfedges:s,triangles:n}}=this,r=i[e];if(r===-1)return null;const o=[];let a=r;do{const h=Math.floor(a/3);if(o.push(t[h*2],t[h*2+1]),a=a%3===2?a-2:a+1,n[a]!==e)break;a=s[a]}while(a!==r&&a!==-1);return o}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:i}=this,s=e*4;return this._simplify(i[s]||i[s+1]?this._clipInfinite(e,t,i[s],i[s+1],i[s+2],i[s+3]):this._clipFinite(e,t))}_clipFinite(e,t){const i=t.length;let s=null,n,r,o=t[i-2],a=t[i-1],h,c=this._regioncode(o,a),u,f=0;for(let d=0;d<i;d+=2)if(n=o,r=a,o=t[d],a=t[d+1],h=c,c=this._regioncode(o,a),h===0&&c===0)u=f,f=0,s?s.push(o,a):s=[o,a];else{let y,g,P,b,B;if(h===0){if((y=this._clipSegment(n,r,o,a,h,c))===null)continue;[g,P,b,B]=y}else{if((y=this._clipSegment(o,a,n,r,c,h))===null)continue;[b,B,g,P]=y,u=f,f=this._edgecode(g,P),u&&f&&this._edge(e,u,f,s,s.length),s?s.push(g,P):s=[g,P]}u=f,f=this._edgecode(b,B),u&&f&&this._edge(e,u,f,s,s.length),s?s.push(b,B):s=[b,B]}if(s)u=f,f=this._edgecode(s[0],s[1]),u&&f&&this._edge(e,u,f,s,s.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return s}_clipSegment(e,t,i,s,n,r){const o=n<r;for(o&&([e,t,i,s,n,r]=[i,s,e,t,r,n]);;){if(n===0&&r===0)return o?[i,s,e,t]:[e,t,i,s];if(n&r)return null;let a,h,c=n||r;c&8?(a=e+(i-e)*(this.ymax-t)/(s-t),h=this.ymax):c&4?(a=e+(i-e)*(this.ymin-t)/(s-t),h=this.ymin):c&2?(h=t+(s-t)*(this.xmax-e)/(i-e),a=this.xmax):(h=t+(s-t)*(this.xmin-e)/(i-e),a=this.xmin),n?(e=a,t=h,n=this._regioncode(e,t)):(i=a,s=h,r=this._regioncode(i,s))}}_clipInfinite(e,t,i,s,n,r){let o=Array.from(t),a;if((a=this._project(o[0],o[1],i,s))&&o.unshift(a[0],a[1]),(a=this._project(o[o.length-2],o[o.length-1],n,r))&&o.push(a[0],a[1]),o=this._clipFinite(e,o))for(let h=0,c=o.length,u,f=this._edgecode(o[c-2],o[c-1]);h<c;h+=2)u=f,f=this._edgecode(o[h],o[h+1]),u&&f&&(h=this._edge(e,u,f,o,h),c=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,i,s,n){for(;t!==i;){let r,o;switch(t){case 5:t=4;continue;case 4:t=6,r=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,r=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,r=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,r=this.xmin,o=this.ymin;break}(s[n]!==r||s[n+1]!==o)&&this.contains(e,r,o)&&(s.splice(n,0,r,o),n+=2)}return n}_project(e,t,i,s){let n=1/0,r,o,a;if(s<0){if(t<=this.ymin)return null;(r=(this.ymin-t)/s)<n&&(a=this.ymin,o=e+(n=r)*i)}else if(s>0){if(t>=this.ymax)return null;(r=(this.ymax-t)/s)<n&&(a=this.ymax,o=e+(n=r)*i)}if(i>0){if(e>=this.xmax)return null;(r=(this.xmax-e)/i)<n&&(o=this.xmax,a=t+(n=r)*s)}else if(i<0){if(e<=this.xmin)return null;(r=(this.xmin-e)/i)<n&&(o=this.xmin,a=t+(n=r)*s)}return[o,a]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const i=(t+2)%e.length,s=(t+4)%e.length;(e[t]===e[i]&&e[i]===e[s]||e[t+1]===e[i+1]&&e[i+1]===e[s+1])&&(e.splice(i,2),t-=2)}e.length||(e=null)}return e}}const ds=2*Math.PI,ve=Math.pow;function cs(l){return l[0]}function fs(l){return l[1]}function ms(l){const{triangles:e,coords:t}=l;for(let i=0;i<e.length;i+=3){const s=2*e[i],n=2*e[i+1],r=2*e[i+2];if((t[r]-t[s])*(t[n+1]-t[s+1])-(t[n]-t[s])*(t[r+1]-t[s+1])>1e-10)return!1}return!0}function ps(l,e,t){return[l+Math.sin(l+e)*t,e+Math.cos(l-e)*t]}class vt{static from(e,t=cs,i=fs,s){return new vt("length"in e?gs(e,t,i,s):Float64Array.from(ys(e,t,i,s)))}constructor(e){this._delaunator=new Ve(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&ms(e)){this.collinear=Int32Array.from({length:t.length/2},(f,d)=>d).sort((f,d)=>t[2*f]-t[2*d]||t[2*f+1]-t[2*d+1]);const a=this.collinear[0],h=this.collinear[this.collinear.length-1],c=[t[2*a],t[2*a+1],t[2*h],t[2*h+1]],u=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let f=0,d=t.length/2;f<d;++f){const y=ps(t[2*f],t[2*f+1],u);t[2*f]=y[0],t[2*f+1]=y[1]}this._delaunator=new Ve(t)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,s=this.hull=this._delaunator.hull,n=this.triangles=this._delaunator.triangles,r=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let a=0,h=i.length;a<h;++a){const c=n[a%3===2?a-2:a+1];(i[a]===-1||r[c]===-1)&&(r[c]=a)}for(let a=0,h=s.length;a<h;++a)o[s[a]]=a;s.length<=2&&s.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=s[0],r[s[0]]=1,s.length===2&&(r[s[1]]=0,this.triangles[1]=s[1],this.triangles[2]=s[1]))}voronoi(e){return new hs(this,e)}*neighbors(e){const{inedges:t,hull:i,_hullIndex:s,halfedges:n,triangles:r,collinear:o}=this;if(o){const u=o.indexOf(e);u>0&&(yield o[u-1]),u<o.length-1&&(yield o[u+1]);return}const a=t[e];if(a===-1)return;let h=a,c=-1;do{if(yield c=r[h],h=h%3===2?h-2:h+1,r[h]!==e)return;if(h=n[h],h===-1){const u=i[(s[e]+1)%i.length];u!==c&&(yield u);return}}while(h!==a)}find(e,t,i=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const s=i;let n;for(;(n=this._step(i,e,t))>=0&&n!==i&&n!==s;)i=n;return n}_step(e,t,i){const{inedges:s,hull:n,_hullIndex:r,halfedges:o,triangles:a,points:h}=this;if(s[e]===-1||!h.length)return(e+1)%(h.length>>1);let c=e,u=ve(t-h[e*2],2)+ve(i-h[e*2+1],2);const f=s[e];let d=f;do{let y=a[d];const g=ve(t-h[y*2],2)+ve(i-h[y*2+1],2);if(g<u&&(u=g,c=y),d=d%3===2?d-2:d+1,a[d]!==e)break;if(d=o[d],d===-1){if(d=n[(r[e]+1)%n.length],d!==y&&ve(t-h[d*2],2)+ve(i-h[d*2+1],2)<u)return d;break}}while(d!==f);return c}render(e){const t=e==null?e=new me:void 0,{points:i,halfedges:s,triangles:n}=this;for(let r=0,o=s.length;r<o;++r){const a=s[r];if(a<r)continue;const h=n[r]*2,c=n[a]*2;e.moveTo(i[h],i[h+1]),e.lineTo(i[c],i[c+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!="function")&&(t=e,e=null),t=t==null?2:+t;const i=e==null?e=new me:void 0,{points:s}=this;for(let n=0,r=s.length;n<r;n+=2){const o=s[n],a=s[n+1];e.moveTo(o+t,a),e.arc(o,a,t,0,ds)}return i&&i.value()}renderHull(e){const t=e==null?e=new me:void 0,{hull:i,points:s}=this,n=i[0]*2,r=i.length;e.moveTo(s[n],s[n+1]);for(let o=1;o<r;++o){const a=2*i[o];e.lineTo(s[a],s[a+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new lt;return this.renderHull(e),e.value()}renderTriangle(e,t){const i=t==null?t=new me:void 0,{points:s,triangles:n}=this,r=n[e*=3]*2,o=n[e+1]*2,a=n[e+2]*2;return t.moveTo(s[r],s[r+1]),t.lineTo(s[o],s[o+1]),t.lineTo(s[a],s[a+1]),t.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,i=e.length/3;t<i;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new lt;return this.renderTriangle(e,t),t.value()}}function gs(l,e,t,i){const s=l.length,n=new Float64Array(s*2);for(let r=0;r<s;++r){const o=l[r];n[r*2]=e.call(i,o,r,l),n[r*2+1]=t.call(i,o,r,l)}return n}function*ys(l,e,t,i){let s=0;for(const n of l)yield e.call(i,n,s,l),yield t.call(i,n,s,l),++s}class _s{constructor(e,t,i,s){this.type="custom",this.map=void 0,this.id=e,this.renderingMode="3d",this.preheat=0,this.swapPointer=0,this.extent=si(),this.worker=void 0,this.uvUrlList=i,this.stationUrl=t,this.endPoint="",this.progress=0,this.startPoint="",this.framesPerPhase=100,this.maxSpeed=Re(),this.maxParticleNum=1e4,this.progressRate=Re(),this.currentResourcePointer=0,this.particleNum=yi(5e3),this.speedFactor=Re(1),this.timePointParser=s,this.randomSeed=Re(Math.random()),this.blockSizeX=16,this.blockSizeY=16,this.lastMvp=Bt(),this.lastMvpInverse=Bt(),this.groupSizeX=Math.ceil(Math.sqrt(this.maxParticleNum)/this.blockSizeX),this.groupSizeY=Math.ceil(Math.sqrt(this.maxParticleNum)/this.blockSizeY),this.randomFillData=new Float32Array(this.maxParticleNum*6).map((n,r)=>r%6==4||r%6==5?0:Math.random()),this.toRef=void 0,this.fromRef=void 0,this.nextRef=void 0,this.uniformBuffer_frame=void 0,this.indexBuffer_voronoi=void 0,this.vertexBuffer_voronoi=void 0,this.uniformBuffer_static=void 0,this.storageBuffer_particle=void 0,this.particleRef=ye(this.randomFillData),this.flowTexture=void 0,this.depthTexture=void 0,this.layerTexture1=void 0,this.layerTexture2=void 0,this.copiedDepthTexture=void 0,this.showBinding=void 0,this.layerBindings=void 0,this.voronoiBinding=void 0,this.segmentBinding=void 0,this.voronoiToBinding=void 0,this.simulationBinding=void 0,this.trajectoryBindings=void 0,this.showPipeline=void 0,this.layerPipeline=void 0,this.voronoiPipeline=void 0,this.segmentPipeline=void 0,this.trajectoryPipeline=void 0,this.simulationPipeline=void 0,this.swapPasses=void 0,this.voronoiPass=void 0,this.simulationPass=void 0,this.isHided=!1,this.isIdling=!1,this.showArrow=!1,this.showVoronoi=!0,this.nextPrepared=!1,this.isInitialized=!1,this.nextPreparing=!1}onAdd(e,t){this.map=e,this.map.on("movestart",()=>this.idle()),this.map.on("move",()=>this.idle()),this.map.on("moveend",()=>this.restart()),this.map.on("dragstart",()=>this.idle()),this.map.on("drag",()=>this.idle()),this.map.on("dragend",()=>this.restart()),this.map.on("zoomstart",()=>this.idle()),this.map.on("zoom",()=>this.idle()),this.map.on("zoomend",()=>this.restart()),this.map.on("rotatestart",()=>this.idle()),this.map.on("rotate",()=>this.idle()),this.map.on("rotateend",()=>this.restart()),this.map.on("pitchstart",()=>this.idle()),this.map.on("pitch",()=>this.idle()),this.map.on("pitchend",()=>this.restart()),this.addWorker(new Worker(new URL("/assets/flowJson.worker-CkmozBgC.js",import.meta.url),{type:"module"})),this.init()}render(e,t){if(this.map.triggerRepaint(),!(!this.isInitialized||this.isIdling||this.preheat-- >0)){if(this.isHided){this.makeVisibility(!1);return}else this.makeVisibility(!0);this.showBinding.executable=!1,this.swapPasses[0].executable=this.swapPasses[1].executable=this.layerBindings[0].executable=this.swapPointer,this.swapPasses[2].executable=this.swapPasses[3].executable=this.layerBindings[1].executable=1-this.swapPointer,this.swapPointer=(this.swapPointer+1)%2,this.updateVoronoi(),this.randomSeed.n=Math.random(),this.lastMvp.copyFrom(this.map.uMatrix),this.lastMvpInverse.copyFrom(this.map.mvpInverse)}}async resetResource(e){let t=async i=>{this.nextPreparing=!0;let s=await st.get(i,{responseType:"arraybuffer"}),n=new Float32Array(s.data),r=-1/0;for(let o=0;o<n.length;o+=2){const a=n[o+0],h=n[o+1],c=Math.sqrt(a*a+h*h);r=c>r?c:r}this.nextRef.value=n,this.updateMaxSpeed(r),this.nextPreparing=!1,this.nextPrepared=!0,n=null,s=null};this.progress=0,this.maxSpeed.n=0,this.progressRate.n=0,this.uvUrlList=e,this.startPoint=this.timePointParser(this.uvUrlList[0]),this.endPoint=this.timePointParser(this.uvUrlList[this.uvUrlList.length-1]),await t(this.uvUrlList[0]),this.swapVoronoiBinding(),await t(this.uvUrlList[1]),this.swapVoronoiBinding(),this.currentResourcePointer=1,this.nextPrepared=!0}async setProgress(e){let t=Math.ceil(e/100*(this.uvUrlList.length-1)),i=t+1;i==this.uvUrlList.length&&(i=0);let s=async n=>{this.nextPreparing=!0;let r=await st.get(n,{responseType:"arraybuffer"}),o=new Float32Array(r.data),a=-1/0;for(let h=0;h<o.length;h+=2){const c=o[h+0],u=o[h+1],f=Math.sqrt(c*c+u*u);a=f>a?f:a}this.nextRef.value=o,this.updateMaxSpeed(a),this.nextPreparing=!1,this.nextPrepared=!0,r=null,o=null};this.progress=0,this.maxSpeed.n=0,this.progressRate.n=0,this.startPoint=this.timePointParser(this.uvUrlList[0]),this.endPoint=this.timePointParser(this.uvUrlList[this.uvUrlList.length-1]),await s(this.uvUrlList[t]),this.swapVoronoiBinding(),await s(this.uvUrlList[i]),this.swapVoronoiBinding(),this.currentResourcePointer=i,this.nextPrepared=!0}async init(){this.isInitialized=!1;let e=async s=>{const n=await st.get(s,{responseType:"arraybuffer"}),r=new vt(new Float32Array(n.data)),o=[],a=r.triangles;for(let h=0;h<r.points.length;h+=2){this.extent.update(r.points[h+0],r.points[h+1]);const c=Dt(kt.mercatorXfromLon(r.points[h+0])),u=Dt(kt.mercatorYfromLat(r.points[h+1]));o.push(c[0]),o.push(u[0]),o.push(c[1]),o.push(u[1])}return this.nextRef=ye(new Float32Array(r.points.length).fill(0)),this.fromRef=ye(new Float32Array(r.points.length).fill(0)),this.toRef=ye(new Float32Array(r.points.length).fill(0)),{indices:a,vertices:o}};const{indices:t,vertices:i}=await e(this.stationUrl);await this.resetResource(this.uvUrlList),this.storageBuffer_particle=mi({name:"Storage Buffer (Particle Position & Velocity)",resource:{arrayRef:this.particleRef}}),this.uniformBuffer_static=Tt({name:"Uniform Buffer (Flow Layer Static)",blocks:[Ct({name:"staticUniform",map:{groupSize:ni(this.groupSizeX,this.groupSizeY),extent:this.extent.boundary}})]}),this.uniformBuffer_frame=Tt({name:"Uniform Buffer (Flow Layer Frame)",blocks:[Ct({name:"frameUniform",dynamic:!0,map:{randomSeed:this.randomSeed,viewPort:this.map.screen.sizeF,mapBounds:this.map.cameraBounds.boundary,zoomLevel:this.map.zoom,progressRate:this.progressRate,maxSpeed:this.maxSpeed,lastMvp:this.lastMvp,lastMvpInverse:this.lastMvpInverse,fillWidth:Le(1),aaWidth:Le(2)}})]}),this.layerTexture1=this.map.screen.createScreenDependentTexture("Texture (Background 1)"),this.layerTexture2=this.map.screen.createScreenDependentTexture("Texture (Background 2)"),this.flowTexture=this.map.screen.createScreenDependentTexture("Texture (Velocity)","rg32float"),this.indexBuffer_voronoi=gi({name:"IndexBuffer (Voronoi Index)",resource:{arrayRef:ye(new Uint32Array(t))}}),this.vertexBuffer_voronoi=nt({name:"VertexBuffer (Station Position)",resource:{arrayRef:ye(new Float32Array(i)),structure:[{components:4}]}}),this.voronoiBinding=ne({name:"Binding (Flow-Field Voronoi)",range:()=>[this.indexBuffer_voronoi.length],index:{buffer:this.indexBuffer_voronoi},vertices:[{buffer:this.vertexBuffer_voronoi},{buffer:nt({name:"VertexBuffer (Station Velocity (From))",resource:{arrayRef:this.fromRef,structure:[{components:2}]}})},{buffer:nt({name:"VertexBuffer (Station Velocity (To))",resource:{arrayRef:this.toRef,structure:[{components:2}]}})}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.uniformBuffer_static},{buffer:this.map.dynamicUniformBuffer}]}),this.voronoiPipeline=_e({name:"Render Pipeline (Voronoi Flow)",shader:{module:de.load("Shader (Flow Voronoi)","/scratchSomething/terrain_flow/shader/flowVoronoi.wgsl")}}),this.voronoiPass=ge({name:"Render Pass (Voronoi Flow From)",colorAttachments:[{colorResource:this.flowTexture}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture}}).add(this.voronoiPipeline,this.voronoiBinding),this.simulationBinding=ne({name:"Binding (Particle Simulation)",range:()=>[this.groupSizeX,this.groupSizeY],textures:[{texture:this.flowTexture,sampleType:"unfilterable-float"}],storages:[{buffer:this.storageBuffer_particle,writable:!0}],uniforms:[{name:"controllerUniform",dynamic:!0,map:{particleNum:_i(this.maxParticleNum),dropRate:Le(.003),dropRateBump:Le(.001),speedFactor:this.speedFactor}}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.uniformBuffer_static},{buffer:this.map.dynamicUniformBuffer}]}),this.simulationPipeline=vi({name:"Compute Pipeline (Flow Simulation)",shader:{module:de.load("Shader (Particle Simulation)","/scratchSomething/terrain_flow/shader/simulation.compute.wgsl")},constants:{blockSize:16}}),this.simulationPass=bi({name:"Compute Pass (Particle Simulation)"}).add(this.simulationPipeline,this.simulationBinding),this.trajectoryBindings=[ne({name:"Binding (Background Swap 1)",range:()=>[4],textures:[{texture:this.layerTexture2}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.map.dynamicUniformBuffer}]}),ne({name:"Binding (Background Swap 2)",range:()=>[4],textures:[{texture:this.layerTexture1}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.map.dynamicUniformBuffer}]})],this.trajectoryPipeline=_e({name:"Render pipeline (Background Trajectory)",shader:{module:de.load("Shader (Background Trajectory)","/scratchSomething/terrain_flow/shader/trajectory.wgsl")},colorTargetStates:[{blend:It}],primitive:{topology:"triangle-strip"},depthTest:!1}),this.segmentBinding=ne({name:"Binding (Segment)",range:()=>[4,this.particleNum.n],storages:[{buffer:this.storageBuffer_particle}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.uniformBuffer_static},{buffer:this.map.dynamicUniformBuffer}]}),this.segmentPipeline=_e({name:"Render Pipeline (Segment)",shader:{module:de.load("Shader (Segment)","/scratchSomething/terrain_flow/shader/segment.wgsl")},colorTargetStates:[{blend:It}],primitive:{topology:"triangle-strip"}}),this.swapPasses=[ge({name:"Render Pass (Past Trajectory 1)",colorAttachments:[{colorResource:this.layerTexture1}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture}}).add(this.trajectoryPipeline,this.trajectoryBindings[0]),ge({name:"Render Pass (Current Segment 1)",colorAttachments:[{colorResource:this.layerTexture1,loadOp:"load"}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture,depthLoadOp:"load"}}).add(this.segmentPipeline,this.segmentBinding),ge({name:"Render Pass (Past Trajectory 2)",colorAttachments:[{colorResource:this.layerTexture2}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture}}).add(this.trajectoryPipeline,this.trajectoryBindings[1]),ge({name:"Render Pass (Current Segment 2)",colorAttachments:[{colorResource:this.layerTexture2,loadOp:"load"}],depthStencilAttachment:{depthStencilResource:this.map.depthTexture,depthLoadOp:"load"}}).add(this.segmentPipeline,this.segmentBinding),ge({name:"Render Pass (Texture Empty)",colorAttachments:[{colorResource:this.layerTexture1},{colorResource:this.layerTexture2}]})],this.layerBindings=[ne({name:"Binding (Layer Renderig 1)",range:()=>[4],textures:[{texture:this.layerTexture1}]}),ne({name:"Binding (Layer Renderig 2)",range:()=>[4],textures:[{texture:this.layerTexture2}]})],this.layerPipeline=_e({name:"Render Pipeline (Layer Rendering)",shader:{module:de.load("Shader (Flow Layer Rendering)","/scratchSomething/terrain_flow/shader/flowLayer.wgsl")},primitive:{topology:"triangle-strip"},colorTargetStates:[{blend:rt}]}),this.showBinding=ne({name:"Binding (Flow Show)",range:()=>[4],textures:[{texture:this.flowTexture,sampleType:"unfilterable-float"}],sharedUniforms:[{buffer:this.uniformBuffer_frame}]}),this.showPipeline=_e({name:"Render Pipeline (Flow Show)",shader:{module:de.load("Shader (Flow Show)","/scratchSomething/terrain_flow/shader/flowShow.wgsl")},primitive:{topology:"triangle-strip"},colorTargetStates:[{blend:rt}]}),this.arrowBinding=ne({name:"Binding (Arrow)",range:()=>[4,this.particleNum.n],storages:[{buffer:this.storageBuffer_particle}],sharedUniforms:[{buffer:this.uniformBuffer_frame},{buffer:this.uniformBuffer_static},{buffer:this.map.dynamicUniformBuffer}]}),this.arrowPipeline=_e({name:"Render Pipeline (Flow Arrow)",shader:{module:de.load("Shader (Flow Show)","/scratchSomething/terrain_flow/shader/arrow.wgsl")},primitive:{topology:"triangle-strip"},colorTargetStates:[{blend:rt}]}),this.swapPasses[0].executable=!0,this.swapPasses[1].executable=!0,this.swapPasses[2].executable=!1,this.swapPasses[3].executable=!1,this.swapPasses[4].executable=!1,this.layerBindings[0].executable=!0,this.layerBindings[1].executable=!1,this.showArrow&&this.map.add2RenderPass(this.arrowPipeline,this.arrowBinding),this.showVoronoi&&this.map.add2RenderPass(this.showPipeline,this.showBinding).add2RenderPass(this.layerPipeline,this.layerBindings[0]).add2RenderPass(this.layerPipeline,this.layerBindings[1]),this.map.add2PreProcess(this.voronoiPass).add2PreProcess(this.simulationPass).add2PreProcess(this.swapPasses[0]).add2PreProcess(this.swapPasses[1]).add2PreProcess(this.swapPasses[2]).add2PreProcess(this.swapPasses[3]).add2PreProcess(this.swapPasses[4]),this.isInitialized=!0}idle(){this.trajectoryPipeline&&(this.trajectoryPipeline.executable=!1)}restart(){this.trajectoryPipeline&&(this.trajectoryPipeline.executable=!0)}show(){this.isHided=!1}hide(){this.isHided=!0}makeVisibility(e){e?(this.showPipeline.executable=!0,this.voronoiPass.executable=!0,this.simulationPass.executable=!0):(this.showPipeline.executable=!1,this.layerBindings[0].executable=!1,this.layerBindings[1].executable=!1,this.voronoiPass.executable=!1,this.swapPasses[0].executable=!1,this.swapPasses[1].executable=!1,this.swapPasses[2].executable=!1,this.simulationPass.executable=!1)}updateMaxSpeed(e){this.maxSpeed.n=e>this.maxSpeed.n?e:this.maxSpeed.n}updateVoronoi(){this.nextPreparing||(this.progress===0&&(this.currentResourcePointer=(this.currentResourcePointer+1)%this.uvUrlList.length,this.addVoronoiBindingAsync(this.uvUrlList[this.currentResourcePointer])),this.progress=Math.min(this.progress+1,this.framesPerPhase-1),this.nextPrepared&&this.progress===this.framesPerPhase-1&&(this.progress=0,this.swapVoronoiBinding()),this.progressRate.n=this.progress/(this.framesPerPhase-1))}swapVoronoiBinding(){let e=this.fromRef.value;this.fromRef.value=this.toRef.value,this.toRef.value=e,e=this.toRef.value,this.toRef.value=this.nextRef.value,this.nextRef.value=e,this.nextPrepared=!1}addWorker(e){const t=this;this.worker=e,this.worker.addEventListener("message",i=>{const{url:s,maxSpeed:n,uvs:r}=i.data;t.updateMaxSpeed(n),t.nextRef.value=r,t.nextPrepared=!0,t.nextPreparing=!1})}addVoronoiBindingAsync(e){this.nextPreparing=!0,this.worker.postMessage({url:e})}get localProgress(){return this.progressRate.n}get globalProgress(){return(this.currentResourcePointer+this.progressRate.n)/this.uvUrlList.length}destroy(){this.type=void 0,this.map=void 0,this.id=void 0,this.renderingMode=void 0,this.preheat=void 0,this.swapPointer=void 0,this.extent=void 0,this.worker=void 0,this.uvUrlList=void 0,this.stationUrl=void 0,this.endPoint=void 0,this.progress=void 0,this.startPoint=void 0,this.framesPerPhase=void 0,this.maxSpeed=void 0,this.maxParticleNum=void 0,this.progressRate=void 0,this.currentResourcePointer=void 0,this.particleNum=void 0,this.speedFactor=void 0,this.timePointParser=void 0,this.randomSeed=void 0,this.blockSizeX=void 0,this.blockSizeY=void 0,this.lastMvp=void 0,this.lastMvpInverse=void 0,this.groupSizeX=void 0,this.groupSizeY=void 0,this.randomFillData=void 0,this.toRef=void 0,this.fromRef=void 0,this.nextRef=void 0,this.uniformBuffer_frame=void 0,this.indexBuffer_voronoi=void 0,this.vertexBuffer_voronoi=void 0,this.uniformBuffer_static=void 0,this.storageBuffer_particle=void 0,this.particleRef=void 0,this.flowTexture=void 0,this.depthTexture=void 0,this.layerTexture1=void 0,this.layerTexture2=void 0,this.copiedDepthTexture=void 0,this.showBinding=void 0,this.layerBindings=void 0,this.voronoiBinding=void 0,this.segmentBinding=void 0,this.voronoiToBinding=void 0,this.simulationBinding=void 0,this.trajectoryBindings=void 0,this.showPipeline=void 0,this.layerPipeline=void 0,this.voronoiPipeline=void 0,this.segmentPipeline=void 0,this.trajectoryPipeline=void 0,this.simulationPipeline=void 0,this.swapPasses=void 0,this.voronoiPass=void 0,this.simulationPass=void 0,this.isHided=void 0,this.isIdling=void 0,this.showArrow=void 0,this.showVoronoi=void 0,this.nextPrepared=void 0,this.isInitialized=void 0,this.nextPreparing=void 0}}function Dt(l){const e=new Float32Array(2);e[0]=l;const t=l-e[0];return e[1]=t,e}const bs={date:"2023-09-01",vertex:[["13417691","3767754"],["13417931","3767270"]],scene:"minzhusha",dataFolderPath:"D:\\project\\JS_Bank_Collapse\\util\\model\\multi\\data",section:[[13417687957079306e-9,3.7677558293190524e6,3.121534824371338],[13417687957079306e-9,3.7677508293190524e6,3.1434929370880127],[13417692957079306e-9,3.7677458293190524e6,3.247708320617676],[13417692957079306e-9,3.7677408293190524e6,3.2636892795562744],[13417697957079306e-9,3.7677358293190524e6,3.291696786880493],[13417697957079306e-9,3.7677308293190524e6,3.299565553665161],[13417702957079306e-9,3.7677258293190524e6,3.299978733062744],[13417702957079306e-9,3.7677208293190524e6,3.299994468688965],[13417707957079306e-9,3.7677158293190524e6,3.2999579906463623],[13417707957079306e-9,3.7677108293190524e6,3.2996816635131836],[13417712957079306e-9,3.7677058293190524e6,3.296473979949951],[13417712957079306e-9,3.7677008293190524e6,3.2823452949523926],[13417717957079306e-9,3.7676958293190524e6,3.2385687828063965],[13417717957079306e-9,3.7676908293190524e6,3.189035654067993],[13417722957079306e-9,3.7676858293190524e6,3.067615032196045],[13417722957079306e-9,3.7676808293190524e6,3.028134822845459],[13417727957079306e-9,3.7676758293190524e6,3.001678943634033],[13417727957079306e-9,3.7676708293190524e6,2.9994516372680664],[13417732957079306e-9,3.7676658293190524e6,2.9988670349121094],[13417732957079306e-9,3.7676608293190524e6,2.9878454208374023],[13417737957079306e-9,3.7676558293190524e6,2.9787704944610596],[13417737957079306e-9,3.7676508293190524e6,2.899057388305664],[13417742957079306e-9,3.7676458293190524e6,2.9546520709991455],[13417742957079306e-9,3.7676408293190524e6,2.847874164581299],[13417747957079306e-9,3.7676358293190524e6,2.8334996700286865],[13417747957079306e-9,3.7676308293190524e6,2.8156447410583496],[13417752957079306e-9,3.7676258293190524e6,2.8378868103027344],[13417752957079306e-9,3.7676208293190524e6,2.8585641384124756],[13417757957079306e-9,3.7676158293190524e6,2.8983511924743652],[13417757957079306e-9,3.7676108293190524e6,2.5130932331085205],[13417762957079306e-9,3.7676058293190524e6,1.9344098567962646],[13417762957079306e-9,3.7676008293190524e6,-1.7289330959320068],[13417767957079306e-9,3.7675958293190524e6,-13.831005096435547],[13417767957079306e-9,3.7675908293190524e6,-17.1885986328125],[13417772957079306e-9,3.7675858293190524e6,-17.408037185668945],[13417772957079306e-9,3.7675808293190524e6,-17.806724548339844],[13417777957079306e-9,3.7675758293190524e6,-17.77374267578125],[13417777957079306e-9,3.7675708293190524e6,-17.518352508544922],[13417782957079306e-9,3.7675658293190524e6,-17.223793029785156],[13417782957079306e-9,3.7675608293190524e6,-16.875864028930664],[13417787957079306e-9,3.7675558293190524e6,-16.53278160095215],[13417787957079306e-9,3.7675508293190524e6,-16.165775299072266],[13417792957079306e-9,3.7675458293190524e6,-16.063810348510742],[13417792957079306e-9,3.7675408293190524e6,-15.54920768737793],[13417797957079306e-9,3.7675358293190524e6,-14.938090324401855],[13417797957079306e-9,3.7675308293190524e6,-14.127363204956055],[13417802957079306e-9,3.7675258293190524e6,-13.364641189575195],[13417802957079306e-9,3.7675208293190524e6,-12.430339813232422],[13417807957079306e-9,3.7675158293190524e6,-11.678702354431152],[13417807957079306e-9,3.7675108293190524e6,-11.449407577514648],[13417812957079306e-9,3.7675058293190524e6,-9.874521255493164],[13417812957079306e-9,3.7675008293190524e6,-8.721687316894531],[13417817957079306e-9,3.7674958293190524e6,-6.497688293457031],[13417817957079306e-9,3.7674908293190524e6,-6.655665397644043],[13417822957079306e-9,3.7674858293190524e6,-8.162154197692871],[13417822957079306e-9,3.7674808293190524e6,-8.65102481842041],[13417827957079306e-9,3.7674758293190524e6,-11.075912475585938],[13417827957079306e-9,3.7674708293190524e6,-11.722530364990234],[13417832957079306e-9,3.7674658293190524e6,-13.258783340454102],[13417832957079306e-9,3.7674608293190524e6,-13.783803939819336],[13417837957079306e-9,3.7674558293190524e6,-14.561233520507812],[13417837957079306e-9,3.7674508293190524e6,-14.897319793701172],[13417842957079306e-9,3.7674458293190524e6,-14.745083808898926],[13417842957079306e-9,3.7674408293190524e6,-14.91735553741455],[13417847957079306e-9,3.7674358293190524e6,-14.65709114074707],[13417847957079306e-9,3.7674308293190524e6,-13.974665641784668],[13417852957079306e-9,3.7674258293190524e6,-13.366701126098633],[13417852957079306e-9,3.7674208293190524e6,-15.094374656677246],[13417857957079306e-9,3.7674158293190524e6,-16.2069149017334],[13417857957079306e-9,3.7674108293190524e6,-17.09683609008789],[13417862957079306e-9,3.7674058293190524e6,-18.026731491088867],[13417862957079306e-9,3.7674008293190524e6,-18.64005470275879],[13417867957079306e-9,3.7673958293190524e6,-19.124711990356445],[13417867957079306e-9,3.7673908293190524e6,-19.64112091064453],[13417872957079306e-9,3.7673858293190524e6,-19.74228286743164],[13417872957079306e-9,3.7673808293190524e6,-19.911325454711914],[13417877957079306e-9,3.7673758293190524e6,-20.222097396850586],[13417877957079306e-9,3.7673708293190524e6,-21.015077590942383],[13417882957079306e-9,3.7673658293190524e6,-21.347070693969727],[13417882957079306e-9,3.7673608293190524e6,-22.014921188354492],[13417887957079306e-9,3.7673558293190524e6,-22.594650268554688],[13417887957079306e-9,3.7673508293190524e6,-23.058412551879883],[13417892957079306e-9,3.7673458293190524e6,-22.975597381591797],[13417892957079306e-9,3.7673408293190524e6,-23.3878173828125],[13417897957079306e-9,3.7673358293190524e6,-23.70122718811035],[13417897957079306e-9,3.7673308293190524e6,-24.130123138427734],[13417902957079306e-9,3.7673258293190524e6,-24.493906021118164],[13417902957079306e-9,3.7673208293190524e6,-24.88259506225586],[13417907957079306e-9,3.7673158293190524e6,-25.026247024536133],[13417907957079306e-9,3.7673108293190524e6,-25.398527145385742],[13417912957079306e-9,3.7673058293190524e6,-25.830562591552734],[13417912957079306e-9,3.7673008293190524e6,-26.824321746826172],[13417917957079306e-9,3.7672958293190524e6,-26.83916473388672],[13417917957079306e-9,3.7672908293190524e6,-27.092004776000977],[13417922957079306e-9,3.7672858293190524e6,-26.90294075012207],[13417922957079306e-9,3.7672808293190524e6,-26.982824325561523],[13417927957079306e-9,3.7672758293190524e6,-27.218549728393555],[13417927957079306e-9,3.7672708293190524e6,-27.60082244873047]],isSectionWithInArea:[!0,!0],PQ:[[0,1,0,0],"低风险",.8],KY:[[0,0,0,1],"较高风险",.9067293380808618],ZD:[[0,0,0,1],"较高风险",.8233316221765914],deepestPoint:[[13417687957079306e-9,3.7677558293190524e6],3.896,1.797,2.4285],ZB:[[1,0,0,0],"较低风险",3.896],SA:[[0,1,0,0],"低风险",[.008508098125457764,.00041306018829345703,-.003069460391998291,-.011844491958618164,-.0011454224586486816,-.007263541221618652,.0032425761222839356,-.8364678144454956,-.19713687896728516,.06204805374145508,.07973456382751465,.16296939849853515,.25905070304870603,-.2289112091064453,-.17426605224609376,-.0047928810119628905,-.0774911880493164,-.14588985443115235,-.05486927032470703,-.11862764358520508,-.0553288459777832,-.06625099182128906,-.0906458854675293,-.018969249725341798,-.07645454406738281]],LN:[[0,0,0,1],"较高风险",[-.0014290809631347656,-.024257421493530273,-.006379842758178711,-.000362396240234375,-20742416381835938e-21,-5245208740234375e-21,-16689300537109375e-22,-.0005278587341308594,-.00018072128295898438,-.006606340408325195,-.013387203216552734,-.0712432861328125,-.07682418823242188,-.0541994571685791,-.03546714782714844,-.002198934555053711,-.38700222969055176,-.9655985832214355,-4.628930568695068,-16.731022119522095,-20.088642597198486,-20.309069633483887,-20.725111722946167,-21.088707208633423,-22.950204372406006,-23.242689609527588,-22.804797172546387,-22.426447868347168,-21.78517246246338,-14.056722640991211,-12.477280378341675,-11.654539346694946,-10.704403400421143,-9.916126251220703,-8.661474227905273,-6.875741004943848,-5.015869617462158,-2.245750904083252]],beforeSection:[[1341768869359842e-8,3767754371655211e-9,3.1229639053344727],[1341769369359842e-8,3767749371655211e-9,3.1159889698028564],[1341769369359842e-8,3767744371655211e-9,3.239731550216675],[1341769369359842e-8,3767739371655211e-9,3.2879467010498047],[1341769869359842e-8,3767734371655211e-9,3.298076629638672],[1341770369359842e-8,3767729371655211e-9,3.2999279499053955],[1341770369359842e-8,3767724371655211e-9,3.299999475479126],[1341770369359842e-8,3767719371655211e-9,3.299999713897705],[1341770869359842e-8,3767714371655211e-9,3.299959659576416],[1341771369359842e-8,3767709371655211e-9,3.2978639602661133],[1341771369359842e-8,3767704371655211e-9,3.2888548374176025],[1341771369359842e-8,3767699371655211e-9,3.247558116912842],[1341771869359842e-8,3767694371655211e-9,3.1743929386138916],[1341772369359842e-8,3767689371655211e-9,3.121018171310425],[1341772369359842e-8,3767684371655211e-9,3.0371713638305664],[1341772369359842e-8,3767679371655211e-9,3.010349988937378],[1341772869359842e-8,3767674371655211e-9,3.0003602504730225],[1341773369359842e-8,3767669371655211e-9,2.9999794960021973],[1341773369359842e-8,3767664371655211e-9,2.9990477561950684],[1341773369359842e-8,3767659371655211e-9,2.9944517612457275],[1341773869359842e-8,3767654371655211e-9,2.9921576976776123],[1341774369359842e-8,3767649371655211e-9,2.9703006744384766],[1341774369359842e-8,3767644371655211e-9,2.8455734252929688],[1341774369359842e-8,3767639371655211e-9,2.8091800212860107],[1341774869359842e-8,3767634371655211e-9,2.8179984092712402],[1341775369359842e-8,3767629371655211e-9,2.8924689292907715],[1341775369359842e-8,3767624371655211e-9,2.8920862674713135],[1341775369359842e-8,3767619371655211e-9,2.894031286239624],[1341775869359842e-8,3767614371655211e-9,2.900550127029419],[1341776369359842e-8,3767609371655211e-9,2.9000954627990723],[1341776369359842e-8,3767604371655211e-9,2.9000084400177],[1341776369359842e-8,3767599371655211e-9,2.8999974727630615],[1341776869359842e-8,3767594371655211e-9,2.900017023086548],[1341777369359842e-8,3767589371655211e-9,2.9000439643859863],[1341777369359842e-8,3767584371655211e-9,2.9010324478149414],[1341777369359842e-8,3767579371655211e-9,2.9183871746063232],[1341777869359842e-8,3767574371655211e-9,3.314964532852173],[1341778369359842e-8,3767569371655211e-9,5.431851863861084],[1341778369359842e-8,3767564371655211e-9,6.018896579742432],[1341778369359842e-8,3767559371655211e-9,5.928933143615723],[1341778869359842e-8,3767554371655211e-9,5.8936662673950195],[1341779369359842e-8,3767549371655211e-9,5.619397163391113],[1341779369359842e-8,3767544371655211e-9,-2.0070877075195312],[1341779369359842e-8,3767539371655211e-9,-3.071927309036255],[1341779869359842e-8,3767534371655211e-9,-3.283550977706909],[1341780369359842e-8,3767529371655211e-9,-3.422959804534912],[1341780369359842e-8,3767524371655211e-9,-3.448514938354492],[1341780369359842e-8,3767519371655211e-9,-3.7688655853271484],[1341780869359842e-8,3767514371655211e-9,-4.802961349487305],[1341781369359842e-8,3767509371655211e-9,-6.43353796005249],[1341781369359842e-8,3767504371655211e-9,-7.628770351409912],[1341781369359842e-8,3767499371655211e-9,-8.946449279785156],[1341781869359842e-8,3767494371655211e-9,-9.244831085205078],[1341782369359842e-8,3767489371655211e-9,-10.476202964782715],[1341782369359842e-8,3767484371655211e-9,-12.233419418334961],[1341782369359842e-8,3767479371655211e-9,-13.30055046081543],[1341782869359842e-8,3767474371655211e-9,-14.014792442321777],[1341783369359842e-8,3767469371655211e-9,-14.270424842834473],[1341783369359842e-8,3767464371655211e-9,-14.97888469696045],[1341783369359842e-8,3767459371655211e-9,-15.168658256530762],[1341783869359842e-8,3767454371655211e-9,-16.535743713378906],[1341784369359842e-8,3767449371655211e-9,-17.253616333007812],[1341784369359842e-8,3767444371655211e-9,-17.6441650390625],[1341784369359842e-8,3767439371655211e-9,-18.0341854095459],[1341784869359842e-8,3767434371655211e-9,-18.871644973754883],[1341785369359842e-8,3767429371655211e-9,-19.163223266601562],[1341785369359842e-8,3767424371655211e-9,-19.695068359375],[1341785369359842e-8,3767419371655211e-9,-20.70911407470703],[1341785869359842e-8,3767414371655211e-9,-21.725101470947266],[1341786369359842e-8,3767409371655211e-9,-22.625085830688477],[1341786369359842e-8,3767404371655211e-9,-23.037151336669922],[1341786369359842e-8,3767399371655211e-9,-23.50472640991211],[1341786869359842e-8,3767394371655211e-9,-23.62897491455078],[1341787369359842e-8,3767389371655211e-9,-24.318498611450195],[1341787369359842e-8,3767384371655211e-9,-25.25609588623047],[1341787369359842e-8,3767379371655211e-9,-26.168140411376953],[1341787869359842e-8,3767374371655211e-9,-26.721012115478516],[1341788369359842e-8,3767369371655211e-9,-27.352996826171875],[1341788369359842e-8,3767364371655211e-9,-27.534730911254883],[1341788369359842e-8,3767359371655211e-9,-28.3227596282959],[1341788869359842e-8,3767354371655211e-9,-28.664649963378906],[1341789369359842e-8,3767349371655211e-9,-28.916494369506836],[1341789369359842e-8,3767344371655211e-9,-29.92958641052246],[1341789369359842e-8,3767339371655211e-9,-30.606996536254883],[1341789869359842e-8,3767334371655211e-9,-31.010469436645508],[1341790369359842e-8,3767329371655211e-9,-31.10230827331543],[1341790369359842e-8,3767324371655211e-9,-31.232851028442383],[1341790369359842e-8,3767319371655211e-9,-31.465221405029297],[1341790869359842e-8,3767314371655211e-9,-31.98632049560547],[1341791369359842e-8,3767309371655211e-9,-32.619144439697266],[1341791369359842e-8,3767304371655211e-9,-32.685813903808594],[1341791369359842e-8,3767299371655211e-9,-32.63957214355469],[1341791869359842e-8,3767294371655211e-9,-32.676307678222656],[1341792369359842e-8,3767289371655211e-9,-32.96323013305664],[1341792369359842e-8,3767284371655211e-9,-33.133304595947266],[1341792369359842e-8,3767279371655211e-9,-33.098289489746094],[1341792869359842e-8,3767274371655211e-9,-32.94529724121094]],risk:[[.08,.32,0,.6],"高风险",.6]};function Ft(l){var e=Math.PI/180,t=6378137,i=20037508342789244e-9,s=Math.abs(l[0])<=180?l[0]:l[0]-Math.sign(l[0])*360,n=[t*s*e,t*Math.log(Math.tan(Math.PI*.25+.5*l[1]*e))];return n[0]>i&&(n[0]=i),n[0]<-i&&(n[0]=-i),n[1]>i&&(n[1]=i),n[1]<-i&&(n[1]=-i),n}const vs=(l,e,t,i)=>{if(!l.getSource(`${i}-source`)){const s={type:"Feature",properties:{},geometry:{coordinates:[e,t],type:"LineString"}};l.addSource(`${i}-source`,{type:"geojson",data:s})}l.getLayer(`${i}-layer`)?l.setLayoutProperty(`${i}-layer`,"visibility","visible"):l.addLayer({id:`${i}-layer`,type:"line",source:`${i}-source`,layout:{"line-join":"round","line-cap":"round",visibility:"visible"},paint:{"line-color":"#888","line-width":8}})},$t=(l,e)=>{l.getLayer(`${e}-layer`)&&l.setLayoutProperty(`${e}-layer`,"visibility","none")},xs=(l,e)=>{l.getLayer(`${e}-layer`)&&l.removeLayer(`${e}-layer`),l.getSource(`${e}-source`)&&l.removeSource(`${e}-source`)},ws=(l,e,t)=>{console.log(e,t);const i=Math.min(...e,...t),s=Math.max(...e,...t),n=Math.min(e.length,t.length),r={title:{text:"断面形态"},grid:{width:"80%",height:"80%",top:"10%",show:!0,backgroundColor:"#d2f2ff"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["当前横截面","对比横截面"],right:"10%",top:"2%"},xAxis:{type:"category",data:new Array(n).fill(0).map((o,a)=>a*5),position:"bottom"},yAxis:{type:"value",splitLine:{show:!1},axisLine:{show:!1},scale:!0,max:Math.round(s+2),min:Math.round(i-2)},series:[{name:"当前横截面",data:e.slice(0,n).map(o=>o.toFixed(2)),type:"line",smooth:!0,areaStyle:{opacity:.8,color:"#2a5fdb"}},{name:"对比横截面",data:t.slice(0,n).map(o=>o.toFixed(2)),type:"line",smooth:!0,lineStyle:{color:"#ff7070"},itemStyle:{color:"#ff7070"}}]};l.setOption(r)},Ps=(l,e)=>{const t=Math.min(...e),i=Math.max(...e),s={title:{text:"断面冲淤"},grid:{width:"80%",height:"80%",top:"10%",show:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",data:e.map((n,r)=>r*5),position:"bottom"},yAxis:{type:"value",splitLine:{show:!1},axisLine:{show:!1},scale:!0,max:Math.round(i+2),min:Math.round(t-2)},series:[{name:"冲淤程度",data:e.map(n=>n.toFixed(2)),type:"line",smooth:!0}]};l.setOption(s)},Ss=(l,e,t,i)=>{const s=Math.min(...e,...t),n=Math.max(...e,...t),r=Math.min(e.length,t.length),o=[];for(let c=0;c<r;c+=10)o.push(c);o.push(r-1);const a=[];for(let c=0,u=0;c<o.length;c++,u++)if(c!==o.length-1){const f=o[c],d=o[c+1];for(let y=f;y<d;y++)a.push(i[u])}const h={title:{text:"断面坡比"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},grid:[{top:"10%",height:"40%",show:!0},{top:"58%",height:"35%",show:!0}],legend:{data:["当前横截面","对比横截面","坡比"],right:"10%",top:"2%"},axisPointer:{link:[{xAxisIndex:"all"}]},xAxis:[{type:"category",data:t.map((c,u)=>u*5),position:"bottom"},{gridIndex:1,type:"category",data:a.map((c,u)=>u*5),position:"bottom",axisLine:{show:!0,onZero:!1}}],yAxis:[{type:"value",splitLine:{show:!1},scale:!0,max:Math.round(n+1),min:Math.round(s-1)},{type:"value",splitLine:{show:!1},gridIndex:1,axisLine:{show:!1},scale:!0}],series:[{name:"当前横截面",type:"line",smooth:!0,data:e.map(c=>c.toFixed(2))},{name:"对比横截面",type:"line",smooth:!0,data:t.map(c=>c.toFixed(2)),lineStyle:{color:"#ff7070"},itemStyle:{color:"#ff7070"}},{name:"坡比",type:"bar",smooth:!0,data:a.map(c=>c.toFixed(4)),yAxisIndex:1,xAxisIndex:1,barCategoryGap:"0%",itemStyle:{normal:{color:function(c){let u=0;return o.some((d,y)=>{if(c.dataIndex<d)return u=y-1,!0}),["#059669","#84cc16"][u%2]},label:{show:!1}}}}]};l.setOption(h)},q=l=>(Oe("data-v-09038cba"),l=l(),je(),l),Bs={class:"all"},Ts={class:"model-content-container"},Cs={class:"model-item-container"},ks={class:"model-choice"},Us={class:"basemap-radio-container"},Is=["checked"],Ms=q(()=>p("label",{class:"tab",for:"radio-1"},"近岸动力分析",-1)),Rs=["checked"],Ls=q(()=>p("label",{class:"tab",for:"radio-2"},"近岸演变分析",-1)),As=q(()=>p("span",{class:"glider"},null,-1)),Es={class:"main-page"},Ds={class:"user-react"},Fs={class:"title"},$s=q(()=>p("div",{class:"title-icon uricon"},null,-1)),Vs={class:"title-text"},Gs={class:"buttons"},zs=["onClick"],Os={class:"data-panel"},js=q(()=>p("div",{class:"title"},[p("div",{class:"title-icon dpicon"}),p("div",{class:"title-text"},"数据面板")],-1)),Ns={class:"dp-content"},Xs={class:"custom-tree-node",style:{width:"100%"}},Ys={class:"el-dropdown-link",style:{width:"100%"}},Hs={class:"layer-panel"},Ws=q(()=>p("div",{class:"title"},[p("div",{class:"title-icon lpicon"}),p("div",{class:"title-text"},"图层面板")],-1)),Ks={class:"lp-content"},qs={class:"checkBox"},Js={class:"main-page"},Zs={class:"data-panel",style:{height:"40vh"}},Qs=q(()=>p("div",{class:"title"},[p("div",{class:"title-icon dpicon"}),p("div",{class:"title-text"},"数据面板")],-1)),en={class:"dp-content",style:{height:"32vh"}},tn={class:"evolution-tree-node",style:{width:"100%"}},sn={class:"el-dropdown-link",style:{width:"100%"}},nn={class:"layer-panel"},rn=q(()=>p("div",{class:"title"},[p("div",{class:"title-icon lpicon"}),p("div",{class:"title-text"},"图层面板")],-1)),on={class:"dp-content",style:{height:"32vh"}},an={class:"evolution-tree-node",style:{width:"100%"}},ln={class:"el-dropdown-link",style:{width:"100%"}},un={class:"dialog-footer"},hn={class:"main"},dn={class:"map-container"},cn=q(()=>p("canvas",{id:"GPUFrame"},null,-1)),fn={class:"model-tooltip-container"},mn={key:0,class:"model-container"},pn=q(()=>p("div",{style:{"font-size":"large","padding-bottom":"16px"}}," 近岸演变分析模型 ",-1)),gn={class:"model-list"},yn=q(()=>p("img",{src:"https://shadow.elemecdn.com/app/element/hamburger.9cf7b091-55e9-11e9-a976-7f4d0b07eef6.png",class:"image",style:{"margin-left":"0","margin-right":"0"}},null,-1)),_n={style:{padding:"4px 0px"}},bn=q(()=>p("img",{src:"https://shadow.elemecdn.com/app/element/hamburger.9cf7b091-55e9-11e9-a976-7f4d0b07eef6.png",class:"image",style:{"margin-left":"0","margin-right":"0"}},null,-1)),vn={style:{padding:"4px 0px"}},xn=q(()=>p("img",{src:"https://shadow.elemecdn.com/app/element/hamburger.9cf7b091-55e9-11e9-a976-7f4d0b07eef6.png",class:"image",style:{"margin-left":"0","margin-right":"0"}},null,-1)),wn={style:{padding:"4px 0px"}},Pn={key:1,class:"model-params-container"},Sn=q(()=>p("div",{style:{"font-size":"large","padding-bottom":"16px"}}," 模型参数设置 ",-1)),Bn={class:"charts-container"},Tn={class:"analysisCenter"},Cn=q(()=>p("div",{class:"background"},null,-1)),kn=q(()=>p("iframe",{id:"inlineFrameExample",title:"Inline Frame Example",width:"100%",height:"100%",src:"http://172.21.212.165:8050/#/analysis/73c29959-16f0-4478-8526-0927d1aff6f7"},null,-1)),Un={__name:"StabilityAnalysis2",setup(l){const e="http://127.0.0.1:8002/api/v1",t=E(!1),i=E(!1),s=E(!1),n=E(["水文条件选择","模型参数设置","模型计算","模型运行状态"]),r=E(null),o=E("模型配置"),a=E(!1),h=E(!1),c=E(!0),u=E(!1),f={"1998-01-dem":"199801_dem","2004-08-dem":"200408_dem","2006-02-dem":"200602_dem"},d={"1998-01-dem":{min:-64.1,max:11.97},"2004-08-dem":{min:-69.46,max:45.16},"2006-02-dem":{min:-71.16,max:40.1}},y=()=>{a.value=!1,c.value=!0,u.value=!1,h.value=!1},g=()=>{if(a.value=!0,u.value=!0,c.value=!1,s.value=!1,h.value=!0,j){for(let m in f)console.log(m),!j.getLayer("ras-"+m)&&j.addLayer({id:"ras-"+m,type:"raster",source:m,paint:{"raster-color":["interpolate",["linear"],["raster-value"],-60-d[m].min,"rgba(0,100,255,1)",-30-d[m].min,"rgba(0,150,255,1)",-20-d[m].min,"rgba(102,153,255,1)",-16-d[m].min,"rgba(0,204,255,1)",-15-d[m].min,"rgba(153,255,255,1)",-13.5-d[m].min,"rgba(255,255,255,1)",-13-d[m].min,"rgba(255,255,153,1)",-11-d[m].min,"rgba(230,230,128,1)",-10-d[m].min,"rgba(164,204,51,1)",-8-d[m].min,"rgba(153,204,51,1)",-5-d[m].min,"rgba(39,139,51,1)",-2-d[m].min,"rgba(10,143,82,1)",0-d[m].min,"rgba(0,113,11, 1)"],"raster-color-mix":[d[m].max-d[m].min,0,0,0],"raster-opacity":1,"raster-color-range":[0,d[m].max-d[m].min]},layout:{visibility:"none"}});j.addControl(Xe),j.on("draw.create",function(m){console.log("aaa"),console.log(m.features),He.value=crypto.randomUUID(),we.value=!0;let _=m.features[0],N=Ft(_.geometry.coordinates[0]),Z=Ft(_.geometry.coordinates[1]);Ye.value[He.value]=[N,Z]})}},P=E(),b=Gt();b.modelStatus="undefined";const B=m=>{ce({type:"success",offset:100,message:"水文条件："+m})},M=m=>{switch(m){case 0:t.value=!0;break;case 1:i.value=!0;break;case 2:ce({message:"模型计算中",offset:100}),b.modelStartTime=Date.now(),b.modelProgress=0,b.modelStatus="pending";const _=setInterval(()=>{b.modelProgress+=Math.random()*100/3600/.5/24*3,b.modelProgress>=100&&(b.modelStatus="success",ce({type:"success",offset:100,message:"模型计算完成"}),clearInterval(_))},3e3);s.value=!0;break;case 3:s.value=!0;break}},A=m=>{ce({type:"success",message:"模型参数设置成功",offset:100}),console.log(m)},D=(m,_)=>{_.nodeID?r.value=_.nodeID:r.value=null},F=m=>{r.value&&m==="add"&&k.value.push(r.value)},V=Ie([{label:"旱季",children:[{label:"输入数据",children:[{label:"fort.13",nodeID:"dry-13"},{label:"fort.14",nodeID:"dry-14"},{label:"fort.15",nodeID:"dry-15"},{label:"fort.16",nodeID:"dry-16"},{label:"fort.19",nodeID:"dry-19"},{label:"fort.20",nodeID:"dry-20"}]},{label:"输出数据",children:[{label:"flow",nodeID:"dry-flow"}]}]},{label:"洪季",children:[{label:"输入数据",children:[{label:"fort.13",nodeID:"flood-13"},{label:"fort.14",nodeID:"flood-14"},{label:"fort.15",nodeID:"flood-15"},{label:"fort.16",nodeID:"flood-16"},{label:"fort.19",nodeID:"flood-19"},{label:"fort.20",nodeID:"flood-20"}]},{label:"输出数据",children:[{label:"flow",nodeID:"flood-flow"}]}]},{label:"20年一遇",children:[{label:"输入数据",children:[{label:"fort.13",nodeID:"20-13"},{label:"fort.14",nodeID:"20-14"},{label:"fort.15",nodeID:"20-15"},{label:"fort.16",nodeID:"20-16"},{label:"fort.19",nodeID:"20-19"},{label:"fort.20",nodeID:"20-20"}]},{label:"输出数据",children:[{label:"flow",nodeID:"20-flow"}]}]}]),R={children:"children",label:"label"},x=E([]),k=E([]);let T,U=[];for(let m=0;m<26;m++)U.push(`/scratchSomething/terrain_flow/json/uv_${m}.bin`);let L=new _s("近岸流场","/scratchSomething/terrain_flow/json/station.bin",U,m=>m.match(/uv_(\d+)\.bin/)[1],"/scratchSomething/terrain_flow/json/ChangJiang.geojson");const z=m=>{console.log("handle checked layer",m);for(let _=0;_<m.length;_++)if(m[_].includes("flow")){L.show(),T&&T.flyTo({center:[120.54070965313991,32.042615280683805],pitch:31.99999999999988,bearing:0,zoom:10.245427972376211,speed:1,essential:!0});return}L.hide()},I=E(null),C=E([{label:"1998-01-dem",nodeID:"1998-01-dem-id",type:"dem"},{label:"2004-08-dem",nodeID:"2004-08-dem-id",type:"dem"},{label:"2006-02-dem",nodeID:"2006-02-dem-id",type:"dem"}]),$=Ie([{label:"地形数据",type:null,children:[{label:"1998-01-dem",nodeID:"1998-01-dem-id",type:"dem"},{label:"2004-08-dem",nodeID:"2004-08-dem-id",type:"dem"},{label:"2006-02-dem",nodeID:"2006-02-dem-id",type:"dem"}]},{label:"断面数据",type:null,children:[]},{label:"示例断面形态",nodeID:"20200301-section-graph",type:"section-graph"},{label:"示例断面坡比",nodeID:"20200301-rate",type:"rate"},{label:"示例断面冲淤",nodeID:"20200301-chongyu",type:"chongyu"}]),J=(m,_)=>{console.log(_),_.nodeID?I.value=_:I.value=null},Y=m=>{if(console.log(I.value),I.value&&m==="layer")C.value===null?C.value=[I.value]:C.value.push(I.value);else if(I.value&&m==="visualize"){const _=I.value.type;console.log(_),Je.value=!0;const N=bs;ae.clear(),_==="section-graph"?setTimeout(()=>{const Z=N.beforeSection,se=N.section;ws(ae,se.map(ee=>ee[2]),Z.map(ee=>ee[2])),ae.resize()},1):_==="rate"?setTimeout(()=>{const Z=N.beforeSection,se=N.section;Ss(ae,se.map(ee=>ee[2]),Z.map(ee=>ee[2]),N.SA[2]),ae.resize()},1):_==="chongyu"&&setTimeout(()=>{const Z=N.section,se=N.beforeSection,ee=Math.min(Z.length,se.length),Se=[];Z.some((Ze,Be)=>{if(Be>=ee)return!0;Se.push(Ze[2]-se[Be][2])}),console.log(Se),Ps(ae,Se),ae.resize()},1)}else I.value&&m==="delete"||I.value&&m==="add"&&console.log("12321")},oe=(m,_)=>{_.nodeID?I.value=_:I.value=null},Ne=m=>{console.log(m),I.value&&C.value&&m==="delete"&&(C.value=C.value.filter(_=>_.nodeID!==I.value.nodeID),I.value.type==="section-geojson"&&($t(j,I.value.nodeID),xs(j,I.value.nodeID)))},zt=(m,_)=>{if(console.log(m,_),_)if(m.type==="section-geojson"){const N=Ye.value[m.nodeID];vs(j,N[0],N[1],m.nodeID),console.log(j.getLayoutProperty(`${m.nodeID}-layer`,"visibility"))}else m.type==="dem"&&(console.log("111"),j.getLayer("ras-"+m.label)?j.setLayoutProperty("ras-"+m.label,"visibility","visible"):j.addLayer({id:"ras-"+m.label,type:"raster",source:m.label,paint:{"raster-color":["interpolate",["linear"],["raster-value"],-60-d[m.label].min,"rgba(0,100,255,1)",-30-d[m.label].min,"rgba(0,150,255,1)",-20-d[m.label].min,"rgba(102,153,255,1)",-16-d[m.label].min,"rgba(0,204,255,1)",-15-d[m.label].min,"rgba(153,255,255,1)",-13.5-d[m.label].min,"rgba(255,255,255,1)",-13-d[m.label].min,"rgba(255,255,153,1)",-11-d[m.label].min,"rgba(230,230,128,1)",-10-d[m.label].min,"rgba(164,204,51,1)",-8-d[m.label].min,"rgba(153,204,51,1)",-5-d[m.label].min,"rgba(39,139,51,1)",-2-d[m.label].min,"rgba(10,143,82,1)",0-d[m.label].min,"rgba(0,113,11, 1)"],"raster-color-mix":[d[m.label].max-d[m.label].min,0,0,0],"raster-opacity":1,"raster-color-range":[0,d[m.label].max-d[m.label].min]}}));else m.type==="section-geojson"?($t(j,m.nodeID),console.log(j.getLayoutProperty(`${m.nodeID}-layer`,"visibility"))):m.type==="dem"&&j.setLayoutProperty("ras-"+m.label,"visibility","none")};let j;const Xe=new li({displayControlsDefault:!1,controls:{line_string:!0},styles:[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["==","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000","line-width":3}}]}),Ye=E({}),He=E(),Ot=E(!1),we=E(!1),pe=E(""),jt=()=>{},Nt=()=>{we.value=!1,Xe.deleteAll(),pe.value=""},Xt=()=>{we.value=!1,Ot.value=!1,Xe.deleteAll(),$[1].children.push({label:pe.value,nodeID:He.value,type:"section-geojson"}),console.log(Ye),pe.value=""},We=E(),te=E({name:"",date:"",beforeDate:"",section:""}),Yt=Ie({name:[{required:!0,message:"Please input Activity name",trigger:"blur"}],section:[{required:!0,trigger:"change"}],date:[{required:!0,trigger:"change"}],beforeDate:[{required:!0,trigger:"change"}]}),Ke=E(!1),Pe=E(null),xt=$e(()=>{let m=[];return $.forEach(_=>{_.label==="断面数据"&&(m=_.children)}),console.log(m),m}),wt=$e(()=>{let m=[];return $.forEach(_=>{_.label==="地形数据"&&(m=_.children)}),console.log(m),m}),Ht=()=>{if(xt.value.length===0){ce({message:"当前不存在任意断面, 请先确定断面",type:"warning"});return}Ke.value=!0},qe=m=>{Pe.value=m,Ke.value=!1},Wt=async(m,_)=>{m&&await m.validate((N,Z)=>{N?(Pe.value=null,ce("模型开始计算"),console.log(te.value),$.push({label:te.value.name,nodeID:"20200301-section-graph",type:_}),m.resetFields()):console.log("error submit!",Z)})},Kt=m=>{m.resetFields(),console.log(te.value),Pe.value=null},Pt=E(),Je=E(!1);let ae=null;const qt=()=>{Je.value=!1};return ri(async()=>{ae=oi(Pt.value),j=await ai(P.value),j.addSource("1998-01-dem",{type:"raster",tiles:[e+"/tile/raster/river/199801_dem/{x}/{y}/{z}"],tileSize:256,minzoom:1,maxzoom:15,bounds:[118.5791,31.0413,121.7718,32.4197]}),j.addSource("2004-08-dem",{type:"raster",tiles:[e+"/tile/raster/river/200408_dem/{x}/{y}/{z}"],tileSize:256,minzoom:1,maxzoom:15,bounds:[118.5791,31.0413,121.7718,32.4197]}),j.addSource("2006-02-dem",{type:"raster",tiles:[e+"/tile/raster/river/200602_dem/{x}/{y}/{z}"],tileSize:256,minzoom:1,maxzoom:15,bounds:[118.5791,31.0413,121.7718,32.4197]}),T=j,j.addLayer(L),L.hide()}),(m,_)=>{const N=G("el-dropdown-item"),Z=G("el-dropdown-menu"),se=G("el-dropdown"),ee=G("el-tree"),Se=G("el-checkbox"),Ze=G("el-checkbox-group"),Be=G("el-input"),ue=G("el-button"),Jt=G("el-dialog"),Qe=G("el-card"),Te=G("el-form-item"),et=G("el-option"),tt=G("el-select"),Zt=G("el-form");return O(),K("div",Bs,[v(ui,{ModelName:"岸坡稳定性分析模型"}),p("div",Ts,[p("div",Cs,[p("div",ks,[p("div",Us,[p("input",{type:"radio",id:"radio-1",name:"tabs",checked:c.value,onClick:_[0]||(_[0]=S=>y())},null,8,Is),Ms,p("input",{type:"radio",id:"radio-2",name:"tabs",checked:u.value,onClick:_[1]||(_[1]=S=>g())},null,8,Rs),Ls,As])]),Ae(p("div",Es,[p("div",Ds,[p("div",Fs,[$s,p("div",Vs,le(o.value),1)]),p("div",Gs,[(O(!0),K(Ce,null,ke(n.value,(S,ie)=>(O(),K("div",{class:"button",key:ie,onClick:In=>M(ie)},[p("div",null,le(S),1)],8,zs))),128))])]),p("div",Os,[js,p("div",Ns,[v(ee,{style:{"max-height":"28vh",overflow:"auto"},data:V,props:R,onNodeContextmenu:D,"node-key":"nodeID"},{default:w(({node:S,data:ie})=>[p("div",Xs,[v(se,{onCommand:F,trigger:"contextmenu",placement:"bottom-end",style:{width:"100%"}},Ut({default:w(()=>[p("div",Ys,le(S.label),1)]),_:2},[ie.nodeID?{name:"dropdown",fn:w(()=>[v(Z,null,{default:w(()=>[v(N,{command:"add"},{default:w(()=>[X("添加至图层")]),_:1})]),_:1})]),key:"0"}:void 0]),1024)])]),_:1},8,["data"])])]),p("div",Hs,[Ws,p("div",Ks,[p("div",qs,[v(Ze,{modelValue:x.value,"onUpdate:modelValue":_[2]||(_[2]=S=>x.value=S),onChange:z},{default:w(()=>[(O(!0),K(Ce,null,ke(k.value,S=>(O(),he(Se,{key:S,label:S,value:S},{default:w(()=>[X(le(S),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])])])],512),[[Ee,!a.value]]),Ae(p("div",Js,[p("div",Zs,[Qs,p("div",en,[v(ee,{style:{"max-width":"600px"},data:$,props:R,onNodeContextmenu:J,"node-key":"nodeID"},{default:w(({node:S,data:ie})=>[p("div",tn,[v(se,{onCommand:Y,trigger:"contextmenu",placement:"bottom-end",style:{width:"100%"}},Ut({default:w(()=>[p("div",sn,le(S.label),1)]),_:2},[ie.type==="dem"||ie.type==="section-geojson"?{name:"dropdown",fn:w(()=>[v(Z,null,{default:w(()=>[v(N,{command:"layer"},{default:w(()=>[X("添加至图层")]),_:1}),v(N,{command:"delete"},{default:w(()=>[X("删除")]),_:1})]),_:1})]),key:"0"}:void 0,ie.type&&ie.type!=="dem"&&ie.type!=="section-geojson"?{name:"dropdown",fn:w(()=>[v(Z,null,{default:w(()=>[v(N,{command:"visualize"},{default:w(()=>[X("可视化")]),_:1}),v(N,{command:"delete"},{default:w(()=>[X("删除")]),_:1})]),_:1})]),key:"1"}:void 0]),1032,["onCommand"])])]),_:1},8,["data"])])]),p("div",nn,[rn,p("div",on,[v(ee,{style:{"max-width":"600px"},data:C.value,props:R,onNodeContextmenu:oe,"node-key":"nodeID","show-checkbox":"",onCheckChange:zt},{default:w(({node:S,data:ie})=>[p("div",an,[v(se,{onCommand:Ne,trigger:"contextmenu",placement:"bottom-end",style:{width:"100%"}},{dropdown:w(()=>[v(Z,null,{default:w(()=>[v(N,{command:"delete"},{default:w(()=>[X("删除图层")]),_:1})]),_:1})]),default:w(()=>[p("div",ln,le(S.label),1)]),_:2},1032,["onCommand"])])]),_:1},8,["data"])])])],512),[[Ee,a.value]])]),v(Jt,{modelValue:we.value,"onUpdate:modelValue":_[4]||(_[4]=S=>we.value=S),title:"绘制断面确认",width:"40vh","before-close":jt},{footer:w(()=>[p("div",un,[v(ue,{onClick:Nt},{default:w(()=>[X("取消")]),_:1}),v(ue,{type:"primary",onClick:Xt,disabled:!pe.value.length},{default:w(()=>[X(" 确认 ")]),_:1},8,["disabled"])])]),default:w(()=>[v(Be,{modelValue:pe.value,"onUpdate:modelValue":_[3]||(_[3]=S=>pe.value=S),style:{width:"240px"},placeholder:"请输入断面名称"},null,8,["modelValue"])]),_:1},8,["modelValue"]),p("div",hn,[p("div",dn,[p("div",{id:"map",ref_key:"mapContainerRef",ref:P},null,512),cn]),p("div",fn,[a.value?(O(),K("div",{key:0,class:"showAnalysisButton",onClick:Ht}," 演变分析计算 ")):fe("",!0)]),Ke.value?(O(),K("div",mn,[pn,p("div",gn,[v(Qe,{style:{height:"300px","object-fit":"cover"}},{default:w(()=>[yn,p("div",_n,[v(ue,{onClick:_[5]||(_[5]=S=>qe("section-graph"))},{default:w(()=>[X("断面形态")]),_:1})])]),_:1}),v(Qe,{style:{height:"300px","object-fit":"cover"}},{default:w(()=>[bn,p("div",vn,[v(ue,{onClick:_[6]||(_[6]=S=>qe("rate"))},{default:w(()=>[X("断面坡比")]),_:1})])]),_:1}),v(Qe,{style:{height:"300px","object-fit":"cover"}},{default:w(()=>[xn,p("div",wn,[v(ue,{onClick:_[7]||(_[7]=S=>qe("chongyu"))},{default:w(()=>[X("断面冲淤")]),_:1})])]),_:1})])])):fe("",!0),Pe.value?(O(),K("div",Pn,[Sn,v(Zt,{ref_key:"paramsRef",ref:We,rules:Yt,model:te.value,"label-width":"auto",style:{width:"600px"}},{default:w(()=>[v(Te,{label:"结果名称",prop:"name"},{default:w(()=>[v(Be,{modelValue:te.value.name,"onUpdate:modelValue":_[8]||(_[8]=S=>te.value.name=S)},null,8,["modelValue"])]),_:1}),v(Te,{label:"地形断面",prop:"section"},{default:w(()=>[v(tt,{modelValue:te.value.section,"onUpdate:modelValue":_[9]||(_[9]=S=>te.value.section=S)},{default:w(()=>[(O(!0),K(Ce,null,ke(xt.value,S=>(O(),he(et,{key:S.label,label:S.label,value:S.nodeID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v(Te,{label:"当前地形数据",prop:"date"},{default:w(()=>[v(tt,{modelValue:te.value.date,"onUpdate:modelValue":_[10]||(_[10]=S=>te.value.date=S)},{default:w(()=>[(O(!0),K(Ce,null,ke(wt.value,S=>(O(),he(et,{key:S.label,label:S.label,value:S.nodeID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v(Te,{label:"对比地形数据",prop:"beforeDate"},{default:w(()=>[v(tt,{modelValue:te.value.beforeDate,"onUpdate:modelValue":_[11]||(_[11]=S=>te.value.beforeDate=S)},{default:w(()=>[(O(!0),K(Ce,null,ke(wt.value,S=>(O(),he(et,{key:S.label,label:S.label,value:S.nodeID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v(Te,null,{default:w(()=>[v(ue,{type:"primary",onClick:_[12]||(_[12]=S=>Wt(We.value,Pe.value))},{default:w(()=>[X("运行模型")]),_:1}),v(ue,{onClick:_[13]||(_[13]=S=>Kt(We.value))},{default:w(()=>[X("取消")]),_:1})]),_:1})]),_:1},8,["rules","model"])])):fe("",!0),Ae(p("div",Bn,[p("div",{class:"close-icon",onClick:qt},"关闭"),p("div",{ref_key:"echartRef",ref:Pt,class:"chart"},null,512)],512),[[Ee,Je.value]]),t.value?(O(),he(ki,{key:2,onClose:_[14]||(_[14]=S=>t.value=!t.value),onCondition:B})):fe("",!0),i.value?(O(),he(Ei,{key:3,onClose:_[15]||(_[15]=S=>i.value=!i.value),onParams:A})):fe("",!0),s.value?(O(),he(Ji,{key:4,onClose:_[16]||(_[16]=S=>s.value=!s.value)})):fe("",!0)])]),Ae(p("div",Tn,[Cn,p("div",{class:"back",onClick:_[17]||(_[17]=S=>{h.value=!h.value,c.value=!0,u.value=!1})}),kn],512),[[Ee,h.value]])])}}},En=ze(Un,[["__scopeId","data-v-09038cba"]]);export{En as default};
