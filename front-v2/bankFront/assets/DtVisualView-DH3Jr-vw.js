import{_ as fe,w as Ve,o as b,c as I,a as i,b as r,d as n,u as R,U as dt,F as Q,r as ee,e as K,n as ne,p as je,f as ze,g as w,h as E,i as He,j as B,t as D,k as J,l as ut,m as pt,q as vt,s as Ne,v as O,x as ft,y as Me,z as ht,A as Be,B as q,C as Y,D as $e,E as gt,G as mt,H as _t,I as yt,J as ce,K as bt,L as kt,M as xt,N as Ce,S as wt}from"./index-CuzgIV3z.js";var he={},ve;Object.defineProperty(he,"__esModule",{value:!0});var It=ve=he.clickOutSide={mounted:function(e,a,p){e.clickOutsideEvent=function(y){e==y.target||e.contains(y.target)||a.value(y,e)},document.addEventListener("click",e.clickOutsideEvent)},unmounted:function(e){document.removeEventListener("click",e.clickOutsideEvent)}};he.default=It;const Re=u=>(je("data-v-9ef536c1"),u=u(),ze(),u),Dt={class:"legend-container"},At={class:"title"},Lt=Re(()=>i("div",{class:"title-back"},[i("span",{class:"title-text"},"图例")],-1)),St=Re(()=>i("hr",null,null,-1)),Nt={class:"content"},Mt={__name:"legend",props:{legendList:Array},emits:["close"],setup(u,{emit:e}){const a=e,p=u;Ve(p,(S,A)=>{console.log(S,A)});const y=()=>{a("close",2)};return(S,A)=>(b(),I("div",Dt,[i("div",At,[r(R(dt),{style:{width:"15vw",height:"4vh"},color:["rgb(28,13,106)","rgb(88,146,255)"]},{default:n(()=>[Lt]),_:1}),i("div",{class:"miniIcon",onClick:y})]),St,i("div",Nt,[(b(!0),I(Q,null,ee(p.legendList,(N,G)=>(b(),K(N,{key:G,style:ne(N.style),text:N.text},null,8,["style","text"]))),128))])]))}},Bt=fe(Mt,[["__scopeId","data-v-9ef536c1"]]),de={combineProjectPoint:{original:"name",fieldMap:{id:"编号",name:"名称"}},dockArea:{original:"project_name",fieldMap:{id:"id",new_id:"编号",city:"所在市",county:"所在区",project_type:"项目类型",dock_type:"码头类型",is_production:"是否为生产",start_time:"开工时间",area_type:"功能区类型",shoreline_type:"三生岸线"}},embankmentLine:{original:"sp_name",fieldMap:{id:"id",district:"起点位置地区",county:"起点位置县",class:"堤防类型",class_sub:"堤防型式",length:"长度",height:"堤顶起点高程",bank:"岸别",level:"级别"}},hydroStationPoint:{original:"sp_name",fieldMap:{id:"编号",begin:"设站日期",place:"测站地点"}},lakeArea:{original:"name",fieldMap:{id:"id",code:"编号",basin:"流域",water:"水系",area:"水面面积",height:"正常蓄水位"}},pumpArea:{original:"sp_name",fieldMap:{river:"所在区域",level:"级别"}},reservoirArea:{original:"sp_name",fieldMap:{id:"id",river:"所在河流湖泊水库渠道",class:"水库类型",area:"坝址控制流域面积",flow:"坝址多年平均径流量",level:"工程级别",length:"坝长",height:"坝高"}},riverArea:{original:"name",fieldMap:{basin:"流域",water:"水系",area:"水面面积",height:"正常蓄水位"}},sluiceArea:{original:"sp_name",fieldMap:{river:"所在区域",class:"水闸类型",level:"工程等别",volume:"过闸流量"}},importantBank:{original:"bank_name",fieldMap:{city_name:"所属城市",river_name:"所属河段",monitoring_length:"监测长度",description:"简介",fix_project:"治理工程"}},sandBar:{original:"name",fieldMap:{river:"所属河段",洲滩信息_面积:"面积(km²)",洲滩信息_人口:"人口",预案:"防汛预案"}},channel:{original:"name",fieldMap:{construct_date:"建设时间",bridge_type:"桥型"}}},Te={cityBoundaryLine:"name",riverSection:"label",riverArea:"name",lakeArea:"name",hydroStationPoint:"sp_name",combineProjectPoint:"name",dockArea:"project_name",embankmentLine:"sp_name",pumpArea:"sp_name",reservoirArea:"sp_name",sluiceArea:"sp_name",riverPassageLine:"name",riverPassagePolygon:"name",importantBank:"bank_name",channel:"name",riverBridge:"name"},$t={riverArea:2,lakeArea:2,hydroStationPoint:3,combineProjectPoint:10,dockArea:2,embankmentLine:2,pumpArea:2,reservoirArea:2,sluiceArea:3,importantBank:4,sandBar:2,channel:1},Ct=[{style:{height:"80%",width:"50%","background-image":"url('/legend/水文站.png')",transform:"translateX(28%)"},text:"水文站点"},{style:{height:"80%",width:"50%","background-image":"url('/legend/水闸.png')",transform:"translateX(10%) scale(0.75)"},text:"水闸工程"},{style:{height:"80%",width:"50%","background-image":"url('/legend/泵站.png')",transform:"translateX(35%) scale(1.3)"},text:"泵站工程"},{style:{height:"60%",width:"50%","background-image":"url('/legend/堤防.png')",transform:"translateX(10%)"},text:"长江干堤"},{style:{height:"15%",width:"50%","background-color":"#ff3d2b"},text:"一级预警岸段"},{style:{height:"15%",width:"50%","background-color":"rgb(255,120,3)"},text:"二级预警岸段"},{style:{height:"15%",width:"50%","background-color":"rgb(245,231,32)"},text:"三级预警岸段"},{style:{height:"50%",width:"50%","background-image":"url('/legend/已建通道2.png')",transform:"scaleY(0.5) translateX(5%)"},text:"已建过江通道"},{style:{height:"50%",width:"50%","background-image":"url('/legend/在建通道1.png')",transform:"scaleY(0.5) translateX(5%)"},text:"在建过江通道"},{style:{height:"50%",width:"50%","background-image":"url('/legend/规划通道.png')",transform:" translateX(5%)"},text:"规划过江通道"},{style:{height:"80%",width:"50%","background-color":"rgb(128,128,128)","background-size":"cover"},text:"码头工程"},{style:{height:"80%",width:"50%","background-color":"rgb(171,225,247)","background-size":"cover"},text:"湖泊/河流/水库"},{style:{height:"80%",width:"50%","background-color":"rgb(240,239,209)","background-size":"cover"},text:"长江沙洲"}],Tt={市级行政区:"cityBoundaryLine","市级行政区-注记":"cityBoundaryLine",骨干河道:"riverArea",大型湖泊:"lakeArea",水文站点:"hydroStationPoint",其他堤防:"embankmentLine",一级预警岸段:"importantBank",二级预警岸段:"importantBank",三级预警岸段:"importantBank","岸段-注记":"importantBank",水闸工程:"sluiceArea",枢纽工程:"combineProjectPoint",长江沙洲:"riverBeach",已建通道:"channel",在建通道:"channel",规划通道:"channel"},P=u=>(je("data-v-c0f77b67"),u=u(),ze(),u),Ot={class:"description-container"},Pt={key:0,class:"bankDesc"},Ft=P(()=>i("div",{class:"cell-item"}," 所属城市 ",-1)),Gt={style:{"text-align":"center","padding-left":"0.1vw"}},Vt=P(()=>i("div",{class:"cell-item"}," 所属河段 ",-1)),jt={style:{"text-align":"center","padding-left":"0.1vw"}},zt=P(()=>i("div",{class:"cell-item"}," 监测长度 ",-1)),Ht={style:{"text-align":"center","padding-left":"0.1vw"}},Rt=P(()=>i("div",{class:"cell-item"}," 岸段简介 ",-1)),Et={style:{"text-align":"left","padding-left":"0.1vw"}},Wt=P(()=>i("div",{class:"cell-item"}," 治理工程 ",-1)),Zt={style:{"text-align":"left","padding-left":"0.1vw"}},Ut={key:1,class:"sandDesc"},Xt=P(()=>i("div",{class:"cell-item"}," 面积 ",-1)),qt={style:{"text-align":"left","padding-left":"0.1vw"}},Jt=P(()=>i("div",{class:"cell-item"}," 人口 ",-1)),Kt={style:{"text-align":"left","padding-left":"0.1vw"}},Yt=P(()=>i("div",{class:"cell-item"}," 所属河段 ",-1)),Qt={style:{"text-align":"left","padding-left":"0.1vw"}},el=P(()=>i("div",{class:"cell-item"}," 防汛预案 ",-1)),tl={style:{"text-align":"left","padding-left":"0.1vw"}},ll={key:2,class:"channelDesc"},al=P(()=>i("div",{class:"cell-item"}," 建设时间 ",-1)),il={style:{"text-align":"center","padding-left":"0.1vw"}},nl=P(()=>i("div",{class:"cell-item"}," 桥型简介 ",-1)),ol={style:{"text-align":"left","padding-left":"0.1vw"}},sl={key:3,class:"waterDesc"},rl={class:"cell-item"},cl={style:{"text-align":"center","padding-left":"0.1vw"}},dl={key:4,class:"normal"},ul=P(()=>i("h1",null,"111",-1)),pl={class:"cell-item"},vl={style:{"text-align":"left","padding-left":"0.1vw"}},fl={__name:"featDetail",props:{ogData:Object,sourceId:String,column:Number},emits:["close","pin"],setup(u,{emit:e}){const a=u,p=e,y=w({}),S=w(""),A=w({}),N=w(!1),G=E(()=>N.value?{backgroundImage:"url('/icons/pin.png')"}:{backgroundImage:"url('/icons/notPin.png')"}),C=E(()=>["I","II","III"][a.ogData.warning_level-1]),W=E(()=>a.ogData.fix_project==null||a.ogData.fix_project==null||a.ogData.fix_project==""?"暂无信息":a.ogData.fix_project),Z=E(()=>a.ogData.洲滩信息_面积=="N/A"?"N/A":a.ogData.洲滩信息_面积+"km²"),U=E(()=>a.ogData.预案==null||a.ogData.预案==null||a.ogData.预案==""?"暂无信息":a.ogData.预案);Ve(a,T=>{de[a.sourceId]&&(y.value=de[a.sourceId].fieldMap,S.value=a.ogData[de[a.sourceId].original],A.value=a.ogData)});const X=()=>{N.value=!N.value,p("pin",N.value)},j=T=>T==="0"||T==="*"||T===""||T===void 0||T===null?"N/A":T;return He(()=>{}),(T,$)=>{const x=B("el-scrollbar"),o=B("el-descriptions-item"),V=B("el-descriptions");return b(),I("div",Ot,[i("div",{class:"miniIcon",style:ne(G.value),onClick:X},null,4),a.sourceId==="importantBank"?(b(),I("div",Pt,[r(V,{class:J(["margin-top",{smallFont:(a.ogData.bank_name+"--"+C.value+"级预警").length>15}]),title:a.ogData.bank_name+"--"+C.value+"级预警",column:3,border:""},{default:n(()=>[r(o,{align:"center"},{label:n(()=>[Ft]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",Gt,D(a.ogData.city_name),1)]),_:1})]),_:1}),r(o,{align:"center"},{label:n(()=>[Vt]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",jt,D(a.ogData.river_name),1)]),_:1})]),_:1}),r(o,{align:"center"},{label:n(()=>[zt]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",Ht,D(a.ogData.monitoring_length+"km"),1)]),_:1})]),_:1}),r(o,{align:"left",span:"3"},{label:n(()=>[Rt]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",Et,D(a.ogData.description),1)]),_:1})]),_:1}),r(o,{span:"3",align:"left"},{label:n(()=>[Wt]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",Zt,D(W.value),1)]),_:1})]),_:1})]),_:1},8,["title","class"])])):a.sourceId==="sandBar"?(b(),I("div",Ut,[r(V,{class:"margin-top",title:a.ogData.name,column:3,border:""},{default:n(()=>[r(o,{align:"center"},{label:n(()=>[Xt]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",qt,D(Z.value),1)]),_:1})]),_:1}),r(o,null,{label:n(()=>[Jt]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",Kt,D(a.ogData.洲滩信息_人口),1)]),_:1})]),_:1}),r(o,null,{label:n(()=>[Yt]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",Qt,D(a.ogData.river),1)]),_:1})]),_:1}),r(o,{span:"3"},{label:n(()=>[el]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",tl,D(U.value),1)]),_:1})]),_:1})]),_:1},8,["title"])])):a.sourceId==="channel"?(b(),I("div",ll,[r(V,{class:"margin-top",title:S.value,column:1,border:""},{default:n(()=>[r(o,null,{label:n(()=>[al]),default:n(()=>[i("p",il,D(j(A.value.construct_date)),1)]),_:1}),r(o,null,{label:n(()=>[nl]),default:n(()=>[i("p",ol,D(j(A.value.bridge_type)),1)]),_:1})]),_:1},8,["title"])])):a.sourceId==="riverArea"?(b(),I("div",sl,[r(V,{class:"margin-top",title:S.value,column:a.column,border:""},{default:n(()=>[(b(!0),I(Q,null,ee(Object.keys(y.value),(h,k)=>(b(),K(o,{key:k},{label:n(()=>[i("div",rl,D(y.value[h]),1)]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",cl,D(j(A.value[h])),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["title","column"])])):(b(),I("div",dl,[r(V,{class:"margin-top",title:S.value,column:a.column,border:""},{default:n(()=>[ul,(b(!0),I(Q,null,ee(Object.keys(y.value),(h,k)=>(b(),K(o,{key:k},{label:n(()=>[i("div",pl,D(y.value[h]),1)]),default:n(()=>[r(x,{"max-height":"10vh"},{default:n(()=>[i("p",vl,D(j(A.value[h])),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["title","column"])]))])}}},hl=fe(fl,[["__scopeId","data-v-c0f77b67"]]),ie=ut();class gl{constructor(e,a,p=void 0){this.map=p,this.title=e,this.active=!1,this.layerIDs=[],a.forEach(y=>{this.layerIDs.push(y)})}setMap(e){this.map=e}async showLayer(){if(this.map){for(let e=0;e<this.layerIDs.length;e++)await pt(this.map,this.layerIDs[e]);this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async hideLayer(){if(this.map){for(let e=0;e<this.layerIDs.length;e++)vt(this.map,this.layerIDs[e]);this.active=!1}else console.log("WARNING:: NOT VALID MAP")}async showFilteredLayer(){if(this.map){for(let e=0;e<this.layerIDs.length;e++){if(await Ne(this.map,this.layerIDs[e]),this.layerIDs[e].includes("长江干堤")||this.layerIDs[e].includes("里程桩")||this.layerIDs[e].includes("预警岸段"))continue;let a=["==",["get","if_important"],1];this.map.setFilter(this.layerIDs[e],a),ie.layerState[this.layerIDs[e]].showing=!0}this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async showCompleteLayer(){if(this.map){for(let e=0;e<this.layerIDs.length;e++)await Ne(this.map,this.layerIDs[e]),this.map.setFilter(this.layerIDs[e],null),ie.layerState[this.layerIDs[e]].showing=!0;this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async layerFilter(){if(this.map){for(let e=0;e<this.layerIDs.length;e++){if(this.layerIDs[e].includes("预警岸段")||this.layerIDs[e].includes("长江干堤")||this.layerIDs[e].includes("里程桩"))continue;let a=["==",["get","if_important"],1];a&&a.length!=0&&this.map.getLayer(this.layerIDs[e])&&this.map.setFilter(this.layerIDs[e],a),ie.layerState[this.layerIDs[e]].showing=!0}this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async layerNoFilter(){if(this.map){for(let e=0;e<this.layerIDs.length;e++)this.layerIDs[e].includes("预警岸段")||(this.map.getLayer(this.layerIDs[e])&&this.map.setFilter(this.layerIDs[e],null),ie.layerState[this.layerIDs[e]].showing=!0);this.active=!0}else console.log("WARNING:: NOT VALID MAP")}}class ml{constructor(e,a,p=void 0){this.map=p,this.title=e,this.LayerGroups=[],a.forEach(y=>{this.LayerGroups.push(y)}),this.active=!1}setMap(e){this.map=e;for(let a=0;a<this.LayerGroups.length;a++)this.LayerGroups[a].setMap(this.map)}async showScene(){if(this.map){for(let e=0;e<this.LayerGroups.length;e++)await this.LayerGroups[e].showLayer();this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async hideScene(){if(this.map)for(let e=0;e<this.LayerGroups.length;e++)this.LayerGroups[e].hideLayer();else console.log("WARNING:: NOT VALID MAP")}}const Ee=()=>{const u={行政区划:["市级行政区","市级行政区-注记","重点行政区边界"],骨干河道:["骨干河道","骨干河道-注记"],重要湖泊:["大型湖泊","大型湖泊-注记"],水文站点:["水文站点","水文站点-注记"],过江通道:["过江通道-桥","过江通道-隧道/通道","过江通道-隧道/通道-注记","过江通道-桥-注记"],重要水闸:["水闸工程","水闸工程-注记","水闸工程-重点"],重要泵站:["泵站工程","泵站工程-注记"],长江堤防:["长江干堤"],一级预警岸段:["一级预警岸段"],二级预警岸段:["二级预警岸段"],三级预警岸段:["三级预警岸段"]};let e=new Map;for(let a in u){let p=new gl(a,u[a]);e.set(a,p)}return e};let _l=Ee();const yl=()=>{const u={重点岸段:["一级预警岸段","二级预警岸段","三级预警岸段"],长江沙洲:["长江沙洲"],骨干河道:["骨干河道"]};let e=new Map;for(let a in u){let p=[];for(let S=0;S<u[a].length;S++)p.push(_l.get(u[a][S]));let y=new ml(a,p);e.set(a,y)}return e},We=u=>{const e={};return u.forEach((a,p)=>{e[p]=a}),e};We(yl());We(Ee());const H="http://127.0.0.1:8989/api/v1",bl={重点岸段:["一级预警岸段","二级预警岸段","三级预警岸段","一级岸段-注记","二级岸段-注记","三级岸段-注记","一级预警岸段-注记","一级岸段-点注记","二级岸段-点注记","三级岸段-点注记"],长江沙洲:["洲滩","洲滩-注记"],交通设施:["沿江码头","沿江码头-注记","已建通道","在建通道","规划通道","已建通道-注记","在建通道-注记","规划通道-注记"],骨干河道:["区域性骨干河道","流域性河道","其他河道","区域性骨干河道-注记","流域性河道-注记","其他河道-注记"],重要水闸:["大中型水闸-面","其他水闸-面","大中型水闸","其他水闸","大中型水闸-注记","其他水闸-注记"],重要泵站:["大中型泵站","其他泵站","大中型泵站-注记","其他泵站-注记"],长江堤防:["长江干堤","里程桩","长江干堤-影像","里程桩-影像-注记","里程桩-注记"],其他:["市级行政区","市级行政区-注记","重点行政区边界","水文站点","水文站点-注记","水库大坝","水库大坝-注记","大型湖泊","大型湖泊-注记"]},kl={一级预警岸段:["一级预警岸段","一级岸段-注记","一级预警岸段-注记","一级岸段-点注记"],二级预警岸段:["二级预警岸段","二级岸段-注记","二级岸段-点注记"],三级预警岸段:["三级预警岸段","三级岸段-注记","三级岸段-点注记"],过江通道:["已建通道","在建通道","规划通道","已建通道-注记","在建通道-注记","规划通道-注记","过江通道辅助线"],沿江码头:["沿江码头","沿江码头-注记"],区域性骨干河道:["区域性骨干河道","区域性骨干河道-注记"],流域性骨干河道:["流域性河道","流域性河道-注记"],大中型水闸:["大中型水闸-面","大中型水闸","大中型水闸-注记"],其他水闸:["其他水闸-面","其他水闸","其他水闸-注记"],大中型泵站:["大中型泵站","大中型泵站-注记"],其他泵站:["其他泵站","其他泵站-注记"],湖泊水库:["水库大坝","水库大坝-注记","大型湖泊","大型湖泊-注记"],行政区划:["市级行政区","市级行政区-注记","重点行政区边界"],水文站点:["水文站点","水文站点-注记"]},xl={已建通道:["已建通道","已建通道-注记"],在建通道:["在建通道","在建通道-注记","过江通道辅助线"],规划通道:["规划通道","规划通道-注记"]},wl={过江通道:"riverBridge",骨干河道:"riverArea",重要水闸:"sluiceArea",重要泵站:"pumpArea"},Il={riverArea:2,pumpArea:2,sluiceArea:2,importantBank:4,sandBar:2,channel:1},F={T1LayerDict:bl,T2LayerDict:kl,T3LayerDict:xl,sourceColumnMap:Il,LGIDSourceMap:wl},ue=(u,e)=>{if(u)for(let a=0;a<e.length;a++){let p=e[a];u.getLayer(p)&&u.setLayoutProperty(p,"visibility","none")}else console.log("WARNING:: NOT VALID MAP")},pe=(u,e)=>{if(u)for(let a=0;a<e.length;a++){let p=e[a];u.getLayer(p)&&u.setLayoutProperty(p,"visibility","visible")}else console.log("WARNING:: NOT VALID MAP")},Oe=["七坝","下关","和畅洲头及左右缘","孟家港","太平洲左缘（二墩港至胜利河）","六圩弯道","嘶马弯道","杨湾至高港闸","民主沙","段山港至越洋码头","新太海汽渡～七丫口"],Pe=["铜井","江宁河","大胜关","梅子洲头","浦口","八卦洲洲头及左右缘","天河口","燕子矶","94679部队","八卦洲左汊凹岸","西坝","栖龙岸段","龙门口","世业洲尾段","沙头河口以下","丰乐桥","炮子洲左缘","夹江兴隆弯道","泗源沟~扬子船厂","世业洲头及左右缘","大寨河","六助港至长江农场","录安洲头及左右缘","福姜沙右汊凹岸","双山沙左侧","铁黄沙整治工程下段","徐六泾","又来沙","长青沙西南缘","通吕运河至龙爪岩","东方红农场","青龙港至大新港","北支右岸庙港～新村沙头部"],Fe=["新济州左缘","新济州右缘","夹江大路弯道","夹江姚桥弯道","夹江长旺弯道","夹江九曲弯道","夹江六圩港弯道","四圩头","永安洲","西界河","下三圩下四圩","炮台圩","桃花港"],Ge=["新生洲","新济洲","子母洲","新潜洲","新洲","梅子洲","潜洲","槽坊沙","八卦洲","世业洲","星洲","征润洲","和畅洲","太平洲","落成洲","天星洲","杜家沙","小泡沙","炮子洲","录安洲","福姜沙","民主沙","大长青沙","新开沙","通州沙","狼山沙","白茆沙","永隆沙兴隆沙","启兴沙"],Dl=async()=>{let u=(await O.get(H+"/tile/vector/importantBank/info")).data,e={label:"一级预警岸段",active:!0,icon:"/icons/warn1.png",type:"title2",children:[]},a={label:"二级预警岸段",icon:"/icons/warn2.png",type:"title2",active:!0,children:[]},p={label:"三级预警岸段",icon:"/icons/warn3.png",type:"title2",active:!0,children:[]},y=[],S=[],A=[];for(let h=0;h<u.length;h++){let k=u[h];k.warning_level==1?y.push({label:k.bank_name,active:!1,type:"feature",property:k,lgId:"一级预警岸段"}):k.warning_level==2?S.push({label:k.bank_name,active:!1,type:"feature",property:k,lgId:"二级预警岸段"}):k.warning_level==3&&A.push({label:k.bank_name,active:!1,type:"feature",property:k,lgId:"三级预警岸段"})}y.sort((h,k)=>Oe.indexOf(h.label)-Oe.indexOf(k.label)),S.sort((h,k)=>Pe.indexOf(h.label)-Pe.indexOf(k.label)),A.sort((h,k)=>Fe.indexOf(h.label)-Fe.indexOf(k.label)),e.children=y,a.children=S,p.children=A;const N={label:"重点岸段",active:!0,type:"title1",source:"importantBank",children:[e,a,p]};console.log(N);let G=(await O.get(H+"/tile/vector/riverBeach/info")).data,C={label:"长江沙洲",active:!0,source:"riverBeach",type:"title1",children:[]};G.sort((h,k)=>Ge.indexOf(h.name)-Ge.indexOf(k.name)),G.forEach(h=>{C.children.push({label:h.name,active:!1,type:"feature",property:h,lgId:"长江沙洲"})}),console.log("11111");let W={label:"骨干河道",icon:"/icons/流域水系.png",type:"title1",source:"riverArea",active:!0,filter:!0,test:1,children:[{label:"流域性骨干河道",icon:"/icons/流域水系.png",type:"title2",active:!0,filter:!0},{label:"区域性骨干河道",icon:"/icons/流域水系.png",type:"title2",active:!0,filter:!0}],data:(await O.get(H+"/tile/vector/riverArea/info")).data},Z={label:"重要水闸",icon:"/icons/水闸工程.png",type:"title1",active:!1,filter:!0,source:"sluiceArea",children:[{label:"大中型水闸",type:"title2",active:!1,filter:!0,children:[]},{label:"其他水闸",type:"title2",active:!1,filter:!0,children:[]}],data:(await O.get(H+"/tile/vector/sluiceArea/info")).data},U={label:"重要泵站",icon:"/icons/泵站工程.png",type:"title1",active:!1,filter:!0,children:[{label:"大中型泵站",type:"title2",active:!1,filter:!0,children:[]},{label:"其他泵站",type:"title2",active:!1,filter:!0,children:[]}],data:(await O.get(H+"/tile/vector/pumpArea/info")).data},$={label:"过江通道",type:"title2",active:!1,filter:!0,children:[{label:"已建通道",type:"title3",active:!1,children:[]},{label:"在建通道",type:"title3",active:!1,children:[]},{label:"规划通道",type:"title3",active:!1,children:[]}],data:(await O.get(H+"/tile/vector/riverBridge/info")).data},x={label:"沿江码头",type:"title2",active:!1,filter:!0,children:[],data:(await O.get(H+"/tile/vector/dockArea/info")).data},o={label:"交通设施",type:"title1",active:!1,filter:!0,children:[$,x]};return console.log("22222"),[N,C,o,W,Z,U,{label:"长江堤防",icon:"/icons/江堤港堤.png",type:"title1",active:!0,filter:!0},{label:"其他",active:!0,type:"title1",children:[{label:"行政区划",icon:"/icons/行政区划.png",type:"title2",active:!0,filter:!0},{label:"湖泊水库",icon:"/icons/湖泊河流.png",type:"title2",active:!0,filter:!0},{label:"水文站点",icon:"/icons/水文站点.png",type:"title2",active:!1,filter:!0}]}]},Al={class:"data-visual-container"},Ll={class:"sideBar"},Sl={class:"sideBar-container"},Nl={class:"scenes-tree-container"},Ml={class:"custom-tree-node"},Bl={key:0,class:"scene-card"},$l=["onClick"],Cl={class:"scene-title"},Tl={class:"scene-title-text"},Ol={key:1,class:"subScene-container"},Pl=["onClick"],Fl={class:"title"},Gl={class:"subScene-title-text"},Vl={class:"detail-icon"},jl=["onClick"],zl=["onClick"],Hl={class:"mapBase"},Rl={class:"tools-container"},El=["onClick"],Wl={class:"legend-pos"},Zl={class:"featDetail"},Ul={class:"infomation-pannel"},Xl={class:"title-block"},ql={class:"title"},Jl={class:"important-feature"},Kl={class:"hydro-pannel"},Yl={class:"title"},Ql={class:"radio-container"},ea={__name:"DtVisualView",setup(u){const e="http://127.0.0.1:8989/api/v1",a=w(),p=ft(),y=w([!1,!1]),S=[{backgroundImage:"url('/icons/legend.png')"},{backgroundImage:"url('/icons/full.png')"}],A=w({}),N=w(!1),G=w(!1),C=w(!1),W=w(!0),Z=w([]),U=w(""),X=w(""),j=w(0),T=[{station:"大通站",flow:"N/A",level:"N/A"},{station:"南京站",flow:"N/A",level:"N/A"},{station:"镇江站",flow:"N/A",level:"N/A"},{station:"三江营站",flow:"N/A",level:"N/A"},{station:"江阴站",flow:"N/A",level:"N/A"},{station:"徐六泾站",flow:"N/A",level:"N/A"}],$=w([]),x=w([]);let o,V;const h=w(!0),k=w(1),oe=w([]),ge=w(!1),te=w(!1),Ze=E(()=>te.value?{backgroundImage:"url('/icons/pin.png')"}:{backgroundImage:"url('/icons/notPin.png')"}),Ue=["重点岸段","全江概貌"],Xe=E(()=>{let t=Te[o],l;if(o==null||o==null||o=="")l=ke($.value,t);else{let d=$.value.filter(s=>!!(s[""+t].includes(X.value)&&s[""+t]!=="长江"));l=ke(d,Te[o]),o=="riverArea"?V=="流域性骨干河道"?l.sort(it):V=="区域性骨干河道"&&l.sort(nt):o=="sluiceArea"?(console.log(l),console.log("sort"),l.sort(ot),console.log(l)):o=="pumpArea"&&l.sort(st)}return l}),qe=t=>{ge.value=t},Je=()=>{ge.value||(N.value=!1)},Ke=()=>{te.value||(C.value=!1)},se=(t,l)=>{const d=p.getMap();if(l.type=="title1"){l.active?pe(d,F.T1LayerDict[l.label]):ue(d,F.T1LayerDict[l.label]);let s=t.childNodes;for(let c=0;c<s.length;c++){s[c].data.active=l.active;for(let g=0;g<s[c].childNodes.length;g++)s[c].childNodes[g].data.active=l.active}}else if(l.type=="title2"){l.active?pe(d,F.T2LayerDict[l.label]):ue(d,F.T2LayerDict[l.label]);let s=t.childNodes;for(let c=0;c<s.length;c++)s[c].data.active=l.active}else l.type=="title3"&&(l.active?pe(d,F.T3LayerDict[l.label]):ue(d,F.T3LayerDict[l.label]))},me=async(t,l)=>{t.level==2&&(l.active=!l.active,se(t,l)),t.level==3&&(l.active=!l.active,se(t,l))},Ye=(t,l)=>{console.log("click!!",l.label),V=l.label;const d=t.parent.data.label,s=t.parent.data.data;U.value=l.label;const c=g=>{let M=[];return Object.keys(g).forEach(L=>{M.push({label:g[L],prop:L})}),M};if(d==="过江通道"){C.value=!0,$.value=[],x.value=[],o="",h.value=!0;const g={已建通道:1,在建通道:0,规划通道:-1},M={1:"已建通道",0:"在建通道","-1":"规划通道"};let v=s.filter(m=>m.plan==g[l.label]);for(let m=0;m<v.length;m++)v[m].typeText=M[""+v[m].plan];let L={name:"名称"};$.value=v,x.value={...c(L)},o=F.LGIDSourceMap.过江通道,h.value=!1;return}else if(d==="骨干河道"){C.value=!0,$.value=[],x.value=[],o="",h.value=!0;const g={流域性骨干河道:"流域性河道",区域性骨干河道:"区域性骨干河道"},M={流域性河道:"流域性骨干河道",区域性骨干河道:"区域性骨干河道"};let v=s.filter(m=>m.kind==g[l.label]);for(let m=0;m<v.length;m++)v[m].typeText=M[""+v[m].kind];let L={name:"名称"};$.value=v,x.value={...c(L)},o=F.LGIDSourceMap.骨干河道,h.value=!1;return}else if(d==="重要水闸"){C.value=!0,$.value=[],x.value=[],o="",h.value=!0;const g={大中型水闸:1,其他水闸:0},M={0:"其他水闸",1:"大中型水闸"};let v=s.filter(m=>m.if_important==g[l.label]);for(let m=0;m<v.length;m++)v[m].typeText=M[""+v[m].if_important];let L={sp_name:"名称"};$.value=v,x.value={...c(L)},o=F.LGIDSourceMap.重要水闸,h.value=!1;return}else if(d==="重要泵站"){C.value=!0,$.value=[],x.value=[],o="",h.value=!0;const g={大中型泵站:1,其他泵站:0},M={0:"其他泵站",1:"大中型泵站"};let v=s.filter(m=>m.if_important==g[l.label]);for(let m=0;m<v.length;m++)v[m].typeText=M[""+v[m].if_important];let L={sp_name:"名称"};$.value=v,x.value={...c(L)},o=F.LGIDSourceMap.重要泵站,h.value=!1;return}},Qe=async()=>{let t=p.getMap();k.value==0?(t.setStyle(gt()),be(),setTimeout(()=>{t.addSource("mapRaster22",{type:"raster",tiles:[e+"/tile/raster/image/base/{x}/{y}/{z}"],tileSize:256,minzoom:1,maxzoom:14,bounds:[118.33726722982796,30.561524488640828,122.39009376964434,32.83598118671959]}),t.addLayer({id:"ras",type:"raster",source:"mapRaster22"}),mt(t)},500)):(t.setStyle(_t()),be(),setTimeout(()=>{Me(t)},500))},et=async t=>{let l=t,d={ogData:l,sourceId:o,column:F.sourceColumnMap[o]};A.value=d;let s=p.getMap();if(o=="riverBridge"){let c=(await O.get(e+`/tile/vector/${o}/id/${l.id}/info/bbox`)).data,g=[[c.bbox[0],c.bbox[1]],[c.bbox[2],c.bbox[3]]];s.fitBounds(g,{padding:le[o],maxZoom:ae[o]})}else if(o=="riverArea"){let c=(await O.get(e+`/tile/vector/${o}/id/${l.id}/info/bbox`)).data,g=[[c.bbox[0],c.bbox[1]],[c.bbox[2],c.bbox[3]]];s.fitBounds(g,{padding:le[o],maxZoom:ae[o]}),!s.getSource(o+"-"+l.id)&&!s.getSource("riverArea")&&s.addSource("riverArea",{type:"vector",tiles:[e+"/tile/vector/riverArea/{x}/{y}/{z}"]}),!s.getLayer(o+"-"+l.id)&&s.addLayer({id:o+"-"+l.id,type:"fill",source:o,"source-layer":"default",filter:["==","id",l.id],layout:{},paint:{"fill-color":"#FF0000","fill-opacity":.3}}),setTimeout(()=>{s.removeLayer(o+"-"+l.id)},5e3)}else if(o=="sluiceArea"||o=="pumpArea"){let c=(await O.get(e+`/tile/vector/${o}/id/${l.id}/buffer/1000/cj/bbox`)).data,g=[[c.bbox[0],c.bbox[1]],[c.bbox[2],c.bbox[3]]];s.fitBounds(g,{padding:le[o],maxZoom:ae[o]});const M={sluiceArea:"#FF0000",pumpArea:"#0000FF"},v=new ce.Marker({color:M[o],draggable:!0}).setLngLat([l.center_x,l.center_y]).addTo(s);setTimeout(()=>{v.remove()},5e3)}else console.log("else")},_e=async(t,l)=>{let d=l.property,s=l.lgId,c=Tt[s];if(t.parent.data.label.includes("岸段")){N.value=!0;const L=(await O.get(e+`/tile/vector/${c}/id/${d.id}/info/bbox`)).data;A.value={ogData:L,sourceId:c,column:$t[c]}}let g=(await O.get(e+`/tile/vector/${c}/id/${l.property.id}/info/bbox`)).data,M=[[g.bbox[0],g.bbox[1]],[g.bbox[2],g.bbox[3]]],v=p.getMap();v.fitBounds(M,{padding:le[c],maxZoom:ae[c]}),c=="riverBeach"&&(!v.getSource("riverBeachLine")&&v.addSource("riverBeachLine",{type:"vector",tiles:[e+"/tile/vector/riverBeachLine/{x}/{y}/{z}"]}),!v.getLayer(c+"-"+d.id)&&v.addLayer({id:c+"-"+d.id,type:"line",source:"riverBeachLine","source-layer":"default",filter:["==","id",d.id],layout:{},paint:{"line-color":"rgb(240, 0, 0)","line-width":3,"line-opacity":.5,"line-dasharray":[5,3]}}),setTimeout(()=>{v.removeLayer(c+"-"+d.id)},5e3))},tt=t=>{if(t==1){ye(p.getMap());return}y.value[t]=!y.value[t]},ye=t=>{t&&t.fitBounds([[118.40770531586725,31.015473926104463],[122.06874017956159,32.73217294711945]],{pitch:0,duration:1500})},lt=t=>{y.value[t]=!1},be=()=>{console.log("reset!");let t=oe.value;t[0].active=!0,t[0].children[0].active=!0,t[0].children[1].active=!0,t[0].children[2].active=!0,t[1].active=!0,t[2].active=!1,t[2].children[0].active=!1,t[2].children[0].children[0].active=!1,t[2].children[0].children[1].active=!1,t[2].children[0].children[2].active=!1,t[2].children[1].active=!1,t[3].active=!0,t[3].children[0].active=!0,t[3].children[1].active=!0,t[4].active=!1,t[4].children[0].active=!1,t[4].children[1].active=!1,t[5].active=!1,t[5].children[0].active=!1,t[5].children[1].active=!1,t[6].active=!0,t[7].active=!1,t[7].children[0].active=!0,t[7].children[1].active=!0,t[7].children[2].active=!1},at=async()=>{const t=await yt(a.value);return p.setMap(t),t.addControl(new ce.NavigationControl({showZoom:!1,showCompass:!0,visualizePitch:!0}),"top-right"),t.addControl(new ce.ScaleControl({maxWidth:150}),"bottom-left"),t.dragRotate.disable(),t.touchZoomRotate.disableRotation(),ye(t),t.on("zoom",()=>{j.value=t.getZoom()}),t};He(async()=>{let t=await at();Z.value=Ct,oe.value=await Dl(),W.value=!1,Me(t),console.log("side bar tree ok")});const ke=(t,l)=>{let d=[],s={};for(let c=0;c<t.length;c++)s[t[c][l]]||(d.push(t[c]),s[t[c][l]]=!0);return d};ht(async()=>{p.getMap().remove(),p.destroyMap()});const le={importantBank:{top:50,bottom:0,left:300,right:300},riverBeach:{top:50,bottom:0,left:300,right:300},riverBridge:{top:150,bottom:50,left:100,right:100},riverArea:{top:150,bottom:50,left:100,right:100},sluiceArea:{},pumpArea:{}},ae={importantBank:14,riverBeach:13,riverBridge:14,riverArea:22,sluiceArea:14,pumpArea:14},xe=["滁河","望虞河","新孟河","京杭运河白马湖-高宝湖长江区段","泰州引江河","秦淮河"],we=["七浦塘","白茆塘","常浒河","张家港","锡澄运河","九曲河","白屈港","杨林塘","通扬运河","澡港河","德胜河","焦港","九圩港","划子口河","岳子河","朱家山河","如海运河","通吕运河","十一圩港","夏仕港","娄江-浏河","走马塘"],Ie=["秦淮新河节制闸","三汊河河口闸","朱家山河闸","岳子河河闸","划子口节制闸","中坝闸","七摆渡闸站","瓜洲节制闸","引航道枢纽工程-水闸工程","京口闸","泰州引江河枢纽—高港节制闸","三茅镇沙家港闸","口岸闸","过船节制闸","天星港闸","焦土港闸","夏仕港节制闸","太字港节制闸","南通节制闸","营船港闸","白茆闸","浏河节制闸"],De=["新沟泵站","秦淮新河闸站——泵站工程","杨家沟站","大年站","十二圩翻水站","大年站","引航道枢纽工程-泵站工程","东风泵站","谏壁抽水站","大港泵站","高港泵站","上九圩泵站","新夏港泵站","焦港泵站","三干河泵站","七浦塘江边枢纽泵站"],it=(t,l)=>{let d=xe.indexOf(t.name),s=xe.indexOf(l.name);return d===-1&&(d=1/0),s===-1&&(s=1/0),d-s},nt=(t,l)=>{let d=we.indexOf(t.name),s=we.indexOf(l.name);return d===-1&&(d=1/0),s===-1&&(s=1/0),d-s},ot=(t,l)=>{let d=Ie.indexOf(t.sp_name),s=Ie.indexOf(l.sp_name);return d===-1&&(d=1/0),s===-1&&(s=1/0),d-s},st=(t,l)=>{let d=De.indexOf(t.sp_name),s=De.indexOf(l.sp_name);return d===-1&&(d=1/0),s===-1&&(s=1/0),d-s};return(t,l)=>{const d=B("el-switch"),s=B("el-button"),c=B("House"),g=B("el-icon"),M=B("UserFilled"),v=B("el-tree"),L=B("el-table-column"),m=B("el-input"),Ae=B("el-table"),rt=B("More"),Le=B("el-radio-button"),ct=B("el-radio-group"),Se=Be("loading"),re=Be("draggable");return b(),I("div",Al,[i("div",Ll,[r(R(wt),null,{default:n(()=>[i("div",Sl,[q((b(),I("div",Nl,[r(v,{style:{"max-width":"400px"},data:oe.value,"expand-on-click-node":!1,"node-key":"label","default-expanded-keys":Ue},{default:n(({node:f,data:_})=>[i("span",Ml,[_.type=="title1"?(b(),I("div",Bl,[i("div",{class:J(["scene-top-section",{active:_.active}]),onClick:z=>me(f,_)},[i("div",Cl,[i("div",Tl,D(_.label),1)])],10,$l),r(d,{modelValue:_.active,"onUpdate:modelValue":z=>_.active=z,"active-action-icon":R(bt),"inactive-action-icon":R(kt),size:"large",onChange:z=>se(f,_)},null,8,["modelValue","onUpdate:modelValue","active-action-icon","inactive-action-icon","onChange"])])):_.type=="title2"||_.type=="title3"?(b(),I("div",Ol,[i("div",{class:J(["card",{active:_.active}])},[i("div",{class:"top-section",onClick:z=>me(f,_)},[i("div",Fl,[i("div",Gl,D(_.label),1)])],8,Pl),i("div",Vl,[q(r(s,{type:"info",icon:R(xt),circle:"",size:"large",onClick:z=>Ye(f,_)},null,8,["icon","onClick"]),[[Y,!(f.parent.data.label.includes("岸段")||f.parent.data.label.includes("其他")||_.label.includes("其他")||_.label.includes("过江通道")||_.label.includes("沿江码头"))]])])],2)])):_.type=="feature"&&f.parent.data.label.includes("岸段")?(b(),I("div",{key:2,class:"feature-container",onClick:z=>_e(f,_)},[i("div",{class:J(["feature-content",{smaller:_.label.length>10}])},D(_.label),3)],8,jl)):_.type=="feature"&&f.parent.data.label.includes("沙洲")?(b(),I("div",{key:3,class:"feature-container",onClick:z=>_e(f,_)},[i("div",{class:J(["feature-content",{smaller:_.label.length>10}])},[i("div",null,D(_.label),1),f.data.property.洲滩信息_人口活动=="2"?(b(),K(g,{key:0,style:{"margin-left":"0.6vw"}},{default:n(()=>[r(c)]),_:1})):f.data.property.洲滩信息_人口活动=="1"?(b(),K(g,{key:1,style:{"margin-left":"0.6vw"}},{default:n(()=>[r(M)]),_:1})):Ce("",!0)],2)],8,zl)):Ce("",!0)])]),_:1},8,["data"])])),[[Se,W.value]])])]),_:1})]),i("div",Hl,[i("div",{ref_key:"mapContainer",ref:a,id:"map"},null,512)]),i("div",Rl,[(b(),I(Q,null,ee(2,f=>i("div",{class:"icon-container",key:f},[i("div",{class:J(["icon",{active:y.value[f-1]}]),style:ne(S[f-1]),onClick:_=>tt(f-1)},null,14,El)])),64))]),q((b(),I("div",Wl,[r(Bt,{onClose:l[0]||(l[0]=f=>lt(0)),legendList:Z.value},null,8,["legendList"])])),[[Y,y.value[0]],[re,{bounds:"body",cancel:"div.content"}]]),q((b(),I("div",Zl,[r(hl,{column:A.value.column,ogData:A.value.ogData,sourceId:A.value.sourceId,onClose:l[1]||(l[1]=f=>N.value=!1),onPin:qe},null,8,["column","ogData","sourceId"])])),[[Y,N.value],[re,{bounds:"body",cancel:"div.content"}],[R(ve),Je]]),q((b(),I("div",Ul,[i("div",Xl,[i("div",ql,D(U.value),1),i("div",{class:"miniIcon",style:ne(Ze.value),onClick:l[2]||(l[2]=f=>te.value=!te.value)},null,4)]),i("div",Jl,[r(Ae,{data:Xe.value,height:"30vh",stripe:"",border:"",class:"infomation-table"},{default:n(()=>[(b(!0),I(Q,null,ee(x.value,(f,_)=>(b(),K(L,{key:_,prop:f.prop,label:f.label},null,8,["prop","label"]))),128)),r(L,{align:"right"},{header:n(()=>[r(m,{modelValue:X.value,"onUpdate:modelValue":l[3]||(l[3]=f=>X.value=f),size:"small",placeholder:"输入关键字搜索"},null,8,["modelValue"])]),default:n(f=>[r(s,{link:"",type:"primary",size:"small",onClick:_=>et(f.row)},{default:n(()=>[$e(" 查看详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])])),[[Y,C.value],[re,{bounds:"body",cancel:"div.content"}],[Se,!1],[R(ve),Ke]]),i("div",Kl,[i("div",Yl,[$e(" 实时水文信息 "),r(g,{onClick:l[4]||(l[4]=f=>G.value=!G.value),style:{"margin-left":"50%"},class:"iconn"},{default:n(()=>[r(rt)]),_:1})]),q(r(Ae,{data:T,border:"",style:{width:"15vw"}},{default:n(()=>[r(L,{prop:"station",label:"站点"}),r(L,{prop:"flow",label:"流量"}),r(L,{prop:"level",label:"水位"})]),_:1},512),[[Y,G.value]])]),i("div",Ql,[r(ct,{modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=f=>k.value=f),size:"large",onChange:Qe},{default:n(()=>[r(Le,{label:"矢量底图",value:"1"}),r(Le,{label:"影像底图",value:"0"})]),_:1},8,["modelValue"])])])}}},la=fe(ea,[["__scopeId","data-v-ea246360"]]);export{la as default};
