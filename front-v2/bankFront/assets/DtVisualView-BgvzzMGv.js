import{_ as he,w as ze,o as _,c as I,a as i,b as r,d as o,u as R,U as pt,F as K,r as Y,n as le,t as A,p as He,e as Re,f as D,g as E,h as Ee,i as M,j as W,k as Z,l as vt,m as ft,q as ht,s as Ne,v as P,x as gt,y as Me,z as mt,A as Be,B as H,C as J,D as $e,E as _t,G as yt,H as bt,I as kt,J as de,K as xt,L as wt,M as Dt,N as Te,S as It}from"./index-DFEmcfO1.js";var ge={},fe;Object.defineProperty(ge,"__esModule",{value:!0});var At=fe=ge.clickOutSide={mounted:function(e,l,p){e.clickOutsideEvent=function(y){e==y.target||e.contains(y.target)||l.value(y,e)},document.addEventListener("click",e.clickOutsideEvent)},unmounted:function(e){document.removeEventListener("click",e.clickOutsideEvent)}};ge.default=At;const We=u=>(He("data-v-5d529d22"),u=u(),Re(),u),Lt={class:"legend-container"},St={class:"title"},Nt=We(()=>i("div",{class:"title-back"},[i("span",{class:"title-text"},"图例")],-1)),Mt=We(()=>i("hr",null,null,-1)),Bt={class:"content"},$t={class:"legend-style-region"},Tt={class:"legend-text-region"},Ct={class:"legend-text"},Ot={__name:"legend",props:{legendList:Array},emits:["close"],setup(u,{emit:e}){const l=e,p=u;ze(p,(S,L)=>{console.log(S,L)});const y=()=>{l("close",2)};return(S,L)=>(_(),I("div",Lt,[i("div",St,[r(R(pt),{style:{width:"15vw",height:"4vh"},color:["rgb(28,13,106)","rgb(88,146,255)"]},{default:o(()=>[Nt]),_:1}),i("div",{class:"miniIcon",onClick:y})]),Mt,i("div",Bt,[(_(!0),I(K,null,Y(p.legendList,(B,F)=>(_(),I("div",{class:"legend-item",key:F},[i("div",$t,[i("div",{class:"legend-style",style:le(B.style)},null,4)]),i("div",Tt,[i("div",Ct,A(B.text),1)])]))),128))])]))}},Pt=he(Ot,[["__scopeId","data-v-5d529d22"]]),ue={combineProjectPoint:{original:"name",fieldMap:{id:"编号",name:"名称"}},dockArea:{original:"project_name",fieldMap:{id:"id",new_id:"编号",city:"所在市",county:"所在区",project_type:"项目类型",dock_type:"码头类型",is_production:"是否为生产",start_time:"开工时间",area_type:"功能区类型",shoreline_type:"三生岸线"}},embankmentLine:{original:"sp_name",fieldMap:{id:"id",district:"起点位置地区",county:"起点位置县",class:"堤防类型",class_sub:"堤防型式",length:"长度",height:"堤顶起点高程",bank:"岸别",level:"级别"}},hydroStationPoint:{original:"sp_name",fieldMap:{id:"编号",begin:"设站日期",place:"测站地点"}},lakeArea:{original:"name",fieldMap:{id:"id",code:"编号",basin:"流域",water:"水系",area:"水面面积",height:"正常蓄水位"}},pumpArea:{original:"sp_name",fieldMap:{river:"所在区域",level:"级别"}},reservoirArea:{original:"sp_name",fieldMap:{id:"id",river:"所在河流湖泊水库渠道",class:"水库类型",area:"坝址控制流域面积",flow:"坝址多年平均径流量",level:"工程级别",length:"坝长",height:"坝高"}},riverArea:{original:"name",fieldMap:{basin:"流域",water:"水系",area:"水面面积",height:"正常蓄水位"}},sluiceArea:{original:"sp_name",fieldMap:{river:"所在区域",class:"水闸类型",level:"工程等别",volume:"过闸流量"}},importantBank:{original:"bank_name",fieldMap:{city_name:"所属城市",river_name:"所属河段",monitoring_length:"监测长度",description:"简介",fix_project:"治理工程"}},sandBar:{original:"name",fieldMap:{river:"所属河段",洲滩信息_面积:"面积(km²)",洲滩信息_人口:"人口",预案:"防汛预案"}},channel:{original:"name",fieldMap:{construct_date:"建设时间",bridge_type:"桥型"}}},Ce={cityBoundaryLine:"name",riverSection:"label",riverArea:"name",lakeArea:"name",hydroStationPoint:"sp_name",combineProjectPoint:"name",dockArea:"project_name",embankmentLine:"sp_name",pumpArea:"sp_name",reservoirArea:"sp_name",sluiceArea:"sp_name",riverPassageLine:"name",riverPassagePolygon:"name",importantBank:"bank_name",channel:"name",riverBridge:"name"},Ft={riverArea:2,lakeArea:2,hydroStationPoint:3,combineProjectPoint:10,dockArea:2,embankmentLine:2,pumpArea:2,reservoirArea:2,sluiceArea:3,importantBank:4,sandBar:2,channel:1},Oe=[{style:{height:"80%",width:"50%","background-image":"url('/legend/水文站.png')",transform:"translateX(28%)"},text:"水文站点"},{style:{height:"80%",width:"50%","background-image":"url('/legend/水闸.png')",transform:"translateX(10%) scale(0.75)"},text:"水闸工程"},{style:{height:"80%",width:"50%","background-image":"url('/legend/泵站.png')",transform:"translateX(35%) scale(1.3)"},text:"泵站工程"},{style:{height:"60%",width:"50%","background-image":"url('/legend/堤防.png')",transform:"translateX(10%)"},text:"长江干堤"},{style:{height:"15%",width:"50%","background-color":"#ff3d2b"},text:"一级预警岸段"},{style:{height:"15%",width:"50%","background-color":"rgb(255,120,3)"},text:"二级预警岸段"},{style:{height:"15%",width:"50%","background-color":"rgb(245,231,32)"},text:"三级预警岸段"},{style:{height:"50%",width:"50%","background-image":"url('/legend/已建通道2.png')",transform:"scaleY(0.5) translateX(5%)"},text:"已建过江通道"},{style:{height:"50%",width:"50%","background-image":"url('/legend/在建通道1.png')",transform:"scaleY(0.5) translateX(5%)"},text:"在建过江通道"},{style:{height:"50%",width:"50%","background-image":"url('/legend/规划通道.png')",transform:" translateX(5%)"},text:"规划过江通道"},{style:{height:"80%",width:"50%","background-color":"rgb(128,128,128)","background-size":"cover"},text:"码头工程"},{style:{height:"80%",width:"50%","background-color":"rgb(171,225,247)","background-size":"cover"},text:"湖泊/河流/水库"},{style:{height:"80%",width:"50%","background-color":"rgb(240,239,209)","background-size":"cover"},text:"长江沙洲"}],Gt={市级行政区:"cityBoundaryLine","市级行政区-注记":"cityBoundaryLine",骨干河道:"riverArea",大型湖泊:"lakeArea",水文站点:"hydroStationPoint",其他堤防:"embankmentLine",一级预警岸段:"importantBank",二级预警岸段:"importantBank",三级预警岸段:"importantBank","岸段-注记":"importantBank",水闸工程:"sluiceArea",枢纽工程:"combineProjectPoint",长江沙洲:"riverBeach",已建通道:"channel",在建通道:"channel",规划通道:"channel"},C=u=>(He("data-v-c0f77b67"),u=u(),Re(),u),Vt={class:"description-container"},jt={key:0,class:"bankDesc"},zt=C(()=>i("div",{class:"cell-item"}," 所属城市 ",-1)),Ht={style:{"text-align":"center","padding-left":"0.1vw"}},Rt=C(()=>i("div",{class:"cell-item"}," 所属河段 ",-1)),Et={style:{"text-align":"center","padding-left":"0.1vw"}},Wt=C(()=>i("div",{class:"cell-item"}," 监测长度 ",-1)),Zt={style:{"text-align":"center","padding-left":"0.1vw"}},Ut=C(()=>i("div",{class:"cell-item"}," 岸段简介 ",-1)),Xt={style:{"text-align":"left","padding-left":"0.1vw"}},qt=C(()=>i("div",{class:"cell-item"}," 治理工程 ",-1)),Jt={style:{"text-align":"left","padding-left":"0.1vw"}},Kt={key:1,class:"sandDesc"},Yt=C(()=>i("div",{class:"cell-item"}," 面积 ",-1)),Qt={style:{"text-align":"left","padding-left":"0.1vw"}},ea=C(()=>i("div",{class:"cell-item"}," 人口 ",-1)),ta={style:{"text-align":"left","padding-left":"0.1vw"}},aa=C(()=>i("div",{class:"cell-item"}," 所属河段 ",-1)),la={style:{"text-align":"left","padding-left":"0.1vw"}},ia=C(()=>i("div",{class:"cell-item"}," 防汛预案 ",-1)),na={style:{"text-align":"left","padding-left":"0.1vw"}},oa={key:2,class:"channelDesc"},sa=C(()=>i("div",{class:"cell-item"}," 建设时间 ",-1)),ra={style:{"text-align":"center","padding-left":"0.1vw"}},ca=C(()=>i("div",{class:"cell-item"}," 桥型简介 ",-1)),da={style:{"text-align":"left","padding-left":"0.1vw"}},ua={key:3,class:"waterDesc"},pa={class:"cell-item"},va={style:{"text-align":"center","padding-left":"0.1vw"}},fa={key:4,class:"normal"},ha=C(()=>i("h1",null,"111",-1)),ga={class:"cell-item"},ma={style:{"text-align":"left","padding-left":"0.1vw"}},_a={__name:"featDetail",props:{ogData:Object,sourceId:String,column:Number},emits:["close","pin"],setup(u,{emit:e}){const l=u,p=e,y=D({}),S=D(""),L=D({}),B=D(!1),F=E(()=>B.value?{backgroundImage:"url('/icons/pin.png')"}:{backgroundImage:"url('/icons/notPin.png')"}),j=E(()=>["I","II","III"][l.ogData.warning_level-1]),G=E(()=>l.ogData.fix_project==null||l.ogData.fix_project==null||l.ogData.fix_project==""?"暂无信息":l.ogData.fix_project),U=E(()=>l.ogData.洲滩信息_面积=="N/A"?"N/A":l.ogData.洲滩信息_面积+"km²"),X=E(()=>l.ogData.预案==null||l.ogData.预案==null||l.ogData.预案==""?"暂无信息":l.ogData.预案);ze(l,$=>{ue[l.sourceId]&&(y.value=ue[l.sourceId].fieldMap,S.value=l.ogData[ue[l.sourceId].original],L.value=l.ogData)});const q=()=>{B.value=!B.value,p("pin",B.value)},V=$=>$==="0"||$==="*"||$===""||$===void 0||$===null?"N/A":$;return Ee(()=>{}),($,ie)=>{const w=M("el-scrollbar"),k=M("el-descriptions-item"),c=M("el-descriptions");return _(),I("div",Vt,[i("div",{class:"miniIcon",style:le(F.value),onClick:q},null,4),l.sourceId==="importantBank"?(_(),I("div",jt,[r(c,{class:W(["margin-top",{smallFont:(l.ogData.bank_name+"--"+j.value+"级预警").length>15}]),title:l.ogData.bank_name+"--"+j.value+"级预警",column:3,border:""},{default:o(()=>[r(k,{align:"center"},{label:o(()=>[zt]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",Ht,A(l.ogData.city_name),1)]),_:1})]),_:1}),r(k,{align:"center"},{label:o(()=>[Rt]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",Et,A(l.ogData.river_name),1)]),_:1})]),_:1}),r(k,{align:"center"},{label:o(()=>[Wt]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",Zt,A(l.ogData.monitoring_length+"km"),1)]),_:1})]),_:1}),r(k,{align:"left",span:"3"},{label:o(()=>[Ut]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",Xt,A(l.ogData.description),1)]),_:1})]),_:1}),r(k,{span:"3",align:"left"},{label:o(()=>[qt]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",Jt,A(G.value),1)]),_:1})]),_:1})]),_:1},8,["title","class"])])):l.sourceId==="sandBar"?(_(),I("div",Kt,[r(c,{class:"margin-top",title:l.ogData.name,column:3,border:""},{default:o(()=>[r(k,{align:"center"},{label:o(()=>[Yt]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",Qt,A(U.value),1)]),_:1})]),_:1}),r(k,null,{label:o(()=>[ea]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",ta,A(l.ogData.洲滩信息_人口),1)]),_:1})]),_:1}),r(k,null,{label:o(()=>[aa]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",la,A(l.ogData.river),1)]),_:1})]),_:1}),r(k,{span:"3"},{label:o(()=>[ia]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",na,A(X.value),1)]),_:1})]),_:1})]),_:1},8,["title"])])):l.sourceId==="channel"?(_(),I("div",oa,[r(c,{class:"margin-top",title:S.value,column:1,border:""},{default:o(()=>[r(k,null,{label:o(()=>[sa]),default:o(()=>[i("p",ra,A(V(L.value.construct_date)),1)]),_:1}),r(k,null,{label:o(()=>[ca]),default:o(()=>[i("p",da,A(V(L.value.bridge_type)),1)]),_:1})]),_:1},8,["title"])])):l.sourceId==="riverArea"?(_(),I("div",ua,[r(c,{class:"margin-top",title:S.value,column:l.column,border:""},{default:o(()=>[(_(!0),I(K,null,Y(Object.keys(y.value),(x,b)=>(_(),Z(k,{key:b},{label:o(()=>[i("div",pa,A(y.value[x]),1)]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",va,A(V(L.value[x])),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["title","column"])])):(_(),I("div",fa,[r(c,{class:"margin-top",title:S.value,column:l.column,border:""},{default:o(()=>[ha,(_(!0),I(K,null,Y(Object.keys(y.value),(x,b)=>(_(),Z(k,{key:b},{label:o(()=>[i("div",ga,A(y.value[x]),1)]),default:o(()=>[r(w,{"max-height":"10vh"},{default:o(()=>[i("p",ma,A(V(L.value[x])),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["title","column"])]))])}}},ya=he(_a,[["__scopeId","data-v-c0f77b67"]]),ae=vt();class ba{constructor(e,l,p=void 0){this.map=p,this.title=e,this.active=!1,this.layerIDs=[],l.forEach(y=>{this.layerIDs.push(y)})}setMap(e){this.map=e}async showLayer(){if(this.map){for(let e=0;e<this.layerIDs.length;e++)await ft(this.map,this.layerIDs[e]);this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async hideLayer(){if(this.map){for(let e=0;e<this.layerIDs.length;e++)ht(this.map,this.layerIDs[e]);this.active=!1}else console.log("WARNING:: NOT VALID MAP")}async showFilteredLayer(){if(this.map){for(let e=0;e<this.layerIDs.length;e++){if(await Ne(this.map,this.layerIDs[e]),this.layerIDs[e].includes("长江干堤")||this.layerIDs[e].includes("里程桩")||this.layerIDs[e].includes("预警岸段"))continue;let l=["==",["get","if_important"],1];this.map.setFilter(this.layerIDs[e],l),ae.layerState[this.layerIDs[e]].showing=!0}this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async showCompleteLayer(){if(this.map){for(let e=0;e<this.layerIDs.length;e++)await Ne(this.map,this.layerIDs[e]),this.map.setFilter(this.layerIDs[e],null),ae.layerState[this.layerIDs[e]].showing=!0;this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async layerFilter(){if(this.map){for(let e=0;e<this.layerIDs.length;e++){if(this.layerIDs[e].includes("预警岸段")||this.layerIDs[e].includes("长江干堤")||this.layerIDs[e].includes("里程桩"))continue;let l=["==",["get","if_important"],1];l&&l.length!=0&&this.map.getLayer(this.layerIDs[e])&&this.map.setFilter(this.layerIDs[e],l),ae.layerState[this.layerIDs[e]].showing=!0}this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async layerNoFilter(){if(this.map){for(let e=0;e<this.layerIDs.length;e++)this.layerIDs[e].includes("预警岸段")||(this.map.getLayer(this.layerIDs[e])&&this.map.setFilter(this.layerIDs[e],null),ae.layerState[this.layerIDs[e]].showing=!0);this.active=!0}else console.log("WARNING:: NOT VALID MAP")}}class ka{constructor(e,l,p=void 0){this.map=p,this.title=e,this.LayerGroups=[],l.forEach(y=>{this.LayerGroups.push(y)}),this.active=!1}setMap(e){this.map=e;for(let l=0;l<this.LayerGroups.length;l++)this.LayerGroups[l].setMap(this.map)}async showScene(){if(this.map){for(let e=0;e<this.LayerGroups.length;e++)await this.LayerGroups[e].showLayer();this.active=!0}else console.log("WARNING:: NOT VALID MAP")}async hideScene(){if(this.map)for(let e=0;e<this.LayerGroups.length;e++)this.LayerGroups[e].hideLayer();else console.log("WARNING:: NOT VALID MAP")}}const Ze=()=>{const u={行政区划:["市级行政区","市级行政区-注记","重点行政区边界"],骨干河道:["骨干河道","骨干河道-注记"],重要湖泊:["大型湖泊","大型湖泊-注记"],水文站点:["水文站点","水文站点-注记"],过江通道:["过江通道-桥","过江通道-隧道/通道","过江通道-隧道/通道-注记","过江通道-桥-注记"],重要水闸:["水闸工程","水闸工程-注记","水闸工程-重点"],重要泵站:["泵站工程","泵站工程-注记"],长江堤防:["长江干堤"],一级预警岸段:["一级预警岸段"],二级预警岸段:["二级预警岸段"],三级预警岸段:["三级预警岸段"]};let e=new Map;for(let l in u){let p=new ba(l,u[l]);e.set(l,p)}return e};let xa=Ze();const wa=()=>{const u={重点岸段:["一级预警岸段","二级预警岸段","三级预警岸段"],长江沙洲:["长江沙洲"],骨干河道:["骨干河道"]};let e=new Map;for(let l in u){let p=[];for(let S=0;S<u[l].length;S++)p.push(xa.get(u[l][S]));let y=new ka(l,p);e.set(l,y)}return e},Ue=u=>{const e={};return u.forEach((l,p)=>{e[p]=l}),e};Ue(wa());Ue(Ze());const Pe="http://119.45.198.54:80/tileServer",Da={重点岸段:["一级预警岸段","二级预警岸段","三级预警岸段","一级岸段-注记","二级岸段-注记","三级岸段-注记","一级预警岸段-注记","一级岸段-点注记","二级岸段-点注记","三级岸段-点注记"],长江沙洲:["洲滩","洲滩-注记"],交通设施:["沿江码头","沿江码头-注记","已建通道","在建通道","规划通道","已建通道-注记","在建通道-注记","规划通道-注记"],骨干河道:["区域性骨干河道","流域性河道","其他河道","区域性骨干河道-注记","流域性河道-注记","其他河道-注记"],重要水闸:["大中型水闸-面","其他水闸-面","大中型水闸","其他水闸","大中型水闸-注记","其他水闸-注记"],重要泵站:["大中型泵站","其他泵站","大中型泵站-注记","其他泵站-注记"],长江堤防:["长江干堤","里程桩","长江干堤-影像","里程桩-影像-注记","里程桩-注记"],其他:["市级行政区","市级行政区-注记","重点行政区边界","水文站点","水文站点-注记","水库大坝","水库大坝-注记","大型湖泊","大型湖泊-注记"]},Ia={一级预警岸段:["一级预警岸段","一级岸段-注记","一级预警岸段-注记","一级岸段-点注记"],二级预警岸段:["二级预警岸段","二级岸段-注记","二级岸段-点注记"],三级预警岸段:["三级预警岸段","三级岸段-注记","三级岸段-点注记"],过江通道:["已建通道","在建通道","规划通道","已建通道-注记","在建通道-注记","规划通道-注记","过江通道辅助线"],沿江码头:["沿江码头","沿江码头-注记"],区域性骨干河道:["区域性骨干河道","区域性骨干河道-注记"],流域性骨干河道:["流域性河道","流域性河道-注记"],大中型水闸:["大中型水闸-面","大中型水闸","大中型水闸-注记"],其他水闸:["其他水闸-面","其他水闸","其他水闸-注记"],大中型泵站:["大中型泵站","大中型泵站-注记"],其他泵站:["其他泵站","其他泵站-注记"],湖泊水库:["水库大坝","水库大坝-注记","大型湖泊","大型湖泊-注记"],行政区划:["市级行政区","市级行政区-注记","重点行政区边界"],水文站点:["水文站点","水文站点-注记"]},Aa={已建通道:["已建通道","已建通道-注记"],在建通道:["在建通道","在建通道-注记","过江通道辅助线"],规划通道:["规划通道","规划通道-注记"]},La={过江通道:"riverBridge",骨干河道:"riverArea",重要水闸:"sluiceArea",重要泵站:"pumpArea"},Sa={riverArea:2,pumpArea:2,sluiceArea:2,importantBank:4,sandBar:2,channel:1},O={T1LayerDict:Da,T2LayerDict:Ia,T3LayerDict:Aa,sourceColumnMap:Sa,LGIDSourceMap:La},pe=(u,e)=>{if(u)for(let l=0;l<e.length;l++){let p=e[l];u.getLayer(p)&&u.setLayoutProperty(p,"visibility","none")}else console.log("WARNING:: NOT VALID MAP")},ve=(u,e)=>{if(u)for(let l=0;l<e.length;l++){let p=e[l];u.getLayer(p)&&u.setLayoutProperty(p,"visibility","visible")}else console.log("WARNING:: NOT VALID MAP")},Fe=["七坝","下关","和畅洲头及左右缘","孟家港","太平洲左缘（二墩港至胜利河）","六圩弯道","嘶马弯道","杨湾至高港闸","民主沙","段山港至越洋码头","新太海汽渡～七丫口"],Ge=["铜井","江宁河","大胜关","梅子洲头","浦口","八卦洲洲头及左右缘","天河口","燕子矶","94679部队","八卦洲左汊凹岸","西坝","栖龙岸段","龙门口","世业洲尾段","沙头河口以下","丰乐桥","炮子洲左缘","夹江兴隆弯道","泗源沟~扬子船厂","世业洲头及左右缘","大寨河","六助港至长江农场","录安洲头及左右缘","福姜沙右汊凹岸","双山沙左侧","铁黄沙整治工程下段","徐六泾","又来沙","长青沙西南缘","通吕运河至龙爪岩","东方红农场","青龙港至大新港","北支右岸庙港～新村沙头部"],Ve=["新济州左缘","新济州右缘","夹江大路弯道","夹江姚桥弯道","夹江长旺弯道","夹江九曲弯道","夹江六圩港弯道","四圩头","永安洲","西界河","下三圩下四圩","炮台圩","桃花港"],je=["新生洲","新济洲","子母洲","新潜洲","新洲","梅子洲","潜洲","槽坊沙","八卦洲","世业洲","星洲","征润洲","和畅洲","太平洲","落成洲","天星洲","杜家沙","小泡沙","炮子洲","录安洲","福姜沙","民主沙","大长青沙","新开沙","通州沙","狼山沙","白茆沙","永隆沙兴隆沙","启兴沙"],Na=async()=>{let u=(await P.get(Pe+"/tile/vector/importantBank/info")).data,e={label:"一级预警岸段",active:!0,icon:"/icons/warn1.png",type:"title2",children:[]},l={label:"二级预警岸段",icon:"/icons/warn2.png",type:"title2",active:!0,children:[]},p={label:"三级预警岸段",icon:"/icons/warn3.png",type:"title2",active:!0,children:[]},y=[],S=[],L=[];for(let x=0;x<u.length;x++){let b=u[x];b.warning_level==1?y.push({label:b.bank_name,active:!1,type:"feature",property:b,lgId:"一级预警岸段"}):b.warning_level==2?S.push({label:b.bank_name,active:!1,type:"feature",property:b,lgId:"二级预警岸段"}):b.warning_level==3&&L.push({label:b.bank_name,active:!1,type:"feature",property:b,lgId:"三级预警岸段"})}y.sort((x,b)=>Fe.indexOf(x.label)-Fe.indexOf(b.label)),S.sort((x,b)=>Ge.indexOf(x.label)-Ge.indexOf(b.label)),L.sort((x,b)=>Ve.indexOf(x.label)-Ve.indexOf(b.label)),e.children=y,l.children=S,p.children=L;const B={label:"重点岸段",active:!0,type:"title1",source:"importantBank",children:[e,l,p]};let F=(await P.get(Pe+"/tile/vector/riverBeach/info")).data,j={label:"长江沙洲",active:!0,source:"riverBeach",type:"title1",children:[]};return F.sort((x,b)=>je.indexOf(x.name)-je.indexOf(b.name)),F.forEach(x=>{j.children.push({label:x.name,active:!1,type:"feature",property:x,lgId:"长江沙洲"})}),[B,j,{label:"交通设施",type:"title1",active:!1,filter:!0,children:[{label:"过江通道",type:"title2",active:!1,filter:!0,children:[{label:"已建通道",type:"title3",active:!1,children:[]},{label:"在建通道",type:"title3",active:!1,children:[]},{label:"规划通道",type:"title3",active:!1,children:[]}],data:[]},{label:"沿江码头",type:"title2",active:!1,filter:!0,children:[],data:[]}]},{label:"骨干河道",icon:"/icons/流域水系.png",type:"title1",source:"riverArea",active:!0,filter:!0,test:1,children:[{label:"流域性骨干河道",icon:"/icons/流域水系.png",type:"title2",active:!0,filter:!0},{label:"区域性骨干河道",icon:"/icons/流域水系.png",type:"title2",active:!0,filter:!0}],data:[]},{label:"重要水闸",icon:"/icons/水闸工程.png",type:"title1",active:!1,filter:!0,source:"sluiceArea",children:[{label:"大中型水闸",type:"title2",active:!1,filter:!0,children:[]},{label:"其他水闸",type:"title2",active:!1,filter:!0,children:[]}],data:[]},{label:"重要泵站",icon:"/icons/泵站工程.png",type:"title1",active:!1,filter:!0,children:[{label:"大中型泵站",type:"title2",active:!1,filter:!0,children:[]},{label:"其他泵站",type:"title2",active:!1,filter:!0,children:[]}],data:[]},{label:"长江堤防",icon:"/icons/江堤港堤.png",type:"title1",active:!0,filter:!0},{label:"其他",active:!0,type:"title1",children:[{label:"行政区划",icon:"/icons/行政区划.png",type:"title2",active:!0,filter:!0},{label:"湖泊水库",icon:"/icons/湖泊河流.png",type:"title2",active:!0,filter:!0},{label:"水文站点",icon:"/icons/水文站点.png",type:"title2",active:!1,filter:!0}]}]},Ma={class:"data-visual-container"},Ba={class:"sideBar"},$a={class:"sideBar-container"},Ta={class:"scenes-tree-container"},Ca={class:"custom-tree-node"},Oa={key:0,class:"scene-card"},Pa=["onClick"],Fa={class:"scene-title"},Ga={class:"scene-title-text"},Va={key:1,class:"subScene-container"},ja=["onClick"],za={class:"title"},Ha={class:"subScene-title-text"},Ra={class:"detail-icon"},Ea=["onClick"],Wa=["onClick"],Za={class:"mapBase"},Ua={class:"tools-container"},Xa=["onClick"],qa={class:"legend-pos"},Ja={class:"featDetail"},Ka={class:"infomation-pannel"},Ya={class:"title-block"},Qa={class:"title"},el={class:"important-feature"},tl={class:"hydro-pannel"},al={class:"title"},ll={class:"radio-container"},il={__name:"DtVisualView",setup(u){const e="http://119.45.198.54:80/tileServer",l=D(),p=gt(),y=D([!1,!1]),S=[{backgroundImage:"url('/icons/legend.png')"},{backgroundImage:"url('/icons/full.png')"}],L=D({}),B=D(!1),F=D(!1),j=D(!0),G=D(!1),U=D(!0),X=D([]),q=D(""),V=D(""),$=D(0),ie=[{station:"大通站",flow:"N/A",level:"N/A"},{station:"南京站",flow:"N/A",level:"N/A"},{station:"镇江站",flow:"N/A",level:"N/A"},{station:"三江营站",flow:"N/A",level:"N/A"},{station:"江阴站",flow:"N/A",level:"N/A"},{station:"徐六泾站",flow:"N/A",level:"N/A"}],w=D([]),k=D([]);let c,x;const b=D(!0),ne=D(1),oe=D([]),me=D(!1),Q=D(!1),Xe=E(()=>Q.value?{backgroundImage:"url('/icons/pin.png')"}:{backgroundImage:"url('/icons/notPin.png')"}),qe=["重点岸段","全江概貌"],Je=E(()=>{let t=Ce[c],a;if(c==null||c==null||c=="")a=xe(w.value,t);else{let d=w.value.filter(s=>!!(s[""+t].includes(V.value)&&s[""+t]!=="长江"));a=xe(d,Ce[c]),c=="riverArea"?x=="流域性骨干河道"?a.sort(ot):x=="区域性骨干河道"&&a.sort(st):c=="sluiceArea"?a.sort(rt):c=="pumpArea"&&a.sort(ct)}return b.value=!1,a}),Ke=t=>{me.value=t},Ye=()=>{me.value||(B.value=!1)},Qe=()=>{Q.value||(G.value=!1)},se=(t,a)=>{const d=p.getMap();if(a.type=="title1"){a.active?ve(d,O.T1LayerDict[a.label]):pe(d,O.T1LayerDict[a.label]);let s=t.childNodes;for(let n=0;n<s.length;n++){s[n].data.active=a.active;for(let h=0;h<s[n].childNodes.length;h++)s[n].childNodes[h].data.active=a.active}}else if(a.type=="title2"){a.active?ve(d,O.T2LayerDict[a.label]):pe(d,O.T2LayerDict[a.label]);let s=t.childNodes;for(let n=0;n<s.length;n++)s[n].data.active=a.active}else a.type=="title3"&&(a.active?ve(d,O.T3LayerDict[a.label]):pe(d,O.T3LayerDict[a.label]))},_e=async(t,a)=>{t.level==2&&(a.active=!a.active,se(t,a)),t.level==3&&(a.active=!a.active,se(t,a))},et=async(t,a)=>{b.value=!0,x=a.label;const d=t.parent.data.label;q.value=a.label;const s=n=>{let h=[];return Object.keys(n).forEach(v=>{h.push({label:n[v],prop:v})}),h};if(d==="过江通道"){j.value=!0,G.value=!0,w.value=[],k.value=[],c="";const n=(await P.get(e+"/tile/vector/riverBridge/info")).data,h={已建通道:1,在建通道:0,规划通道:-1},T={1:"已建通道",0:"在建通道","-1":"规划通道"};let v=n.filter(g=>g.plan==h[a.label]);for(let g=0;g<v.length;g++)v[g].typeText=T[""+v[g].plan];let N={name:"名称"};w.value=v,k.value={...s(N)},c=O.LGIDSourceMap.过江通道}else if(d==="骨干河道"){G.value=!0,w.value=[],k.value=[],c="";const n={流域性骨干河道:"流域性河道",区域性骨干河道:"区域性骨干河道"},h={流域性河道:"流域性骨干河道",区域性骨干河道:"区域性骨干河道"};let v=(await P.get(e+"/tile/vector/riverArea/info")).data.filter(g=>g.kind==n[a.label]);for(let g=0;g<v.length;g++)v[g].typeText=h[""+v[g].kind];let N={name:"名称"};w.value=v,k.value={...s(N)},c=O.LGIDSourceMap.骨干河道}else if(d==="重要水闸"){G.value=!0,w.value=[],k.value=[],c="";const n=(await P.get(e+"/tile/vector/sluiceArea/info")).data,h={大中型水闸:1,其他水闸:0},T={0:"其他水闸",1:"大中型水闸"};let v=n.filter(g=>g.if_important==h[a.label]);for(let g=0;g<v.length;g++)v[g].typeText=T[""+v[g].if_important];let N={sp_name:"名称"};w.value=v,k.value={...s(N)},c=O.LGIDSourceMap.重要水闸}else if(d==="重要泵站"){G.value=!0,w.value=[],k.value=[],c="";const n={大中型泵站:1,其他泵站:0},h={0:"其他泵站",1:"大中型泵站"};let v=(await P.get(e+"/tile/vector/pumpArea/info")).data.filter(g=>g.if_important==n[a.label]);for(let g=0;g<v.length;g++)v[g].typeText=h[""+v[g].if_important];let N={sp_name:"名称"};w.value=v,k.value={...s(N)},c=O.LGIDSourceMap.重要泵站}},tt=async()=>{let t=p.getMap();ne.value==0?(t.setStyle(_t()),ke(),setTimeout(()=>{t.addSource("mapRaster22",{type:"raster",tiles:[e+"/tile/raster/image/base/{x}/{y}/{z}"],tileSize:256,minzoom:1,maxzoom:14,bounds:[118.33726722982796,30.561524488640828,122.39009376964434,32.83598118671959]}),t.addLayer({id:"ras",type:"raster",source:"mapRaster22"}),yt(t)},500)):(t.setStyle(bt()),ke(),setTimeout(()=>{Me(t)},500))},at=async t=>{let a=t,d={ogData:a,sourceId:c,column:O.sourceColumnMap[c]};L.value=d;let s=p.getMap();if(c=="riverBridge"){let n=(await P.get(e+`/tile/vector/${c}/id/${a.id}/info/bbox`)).data,h=[[n.bbox[0],n.bbox[1]],[n.bbox[2],n.bbox[3]]];s.fitBounds(h,{padding:ee[c],maxZoom:te[c]})}else if(c=="riverArea"){let n=(await P.get(e+`/tile/vector/${c}/id/${a.id}/info/bbox`)).data,h=[[n.bbox[0],n.bbox[1]],[n.bbox[2],n.bbox[3]]];s.fitBounds(h,{padding:ee[c],maxZoom:te[c]}),!s.getSource(c+"-"+a.id)&&!s.getSource("riverArea")&&s.addSource("riverArea",{type:"vector",tiles:[e+"/tile/vector/riverArea/{x}/{y}/{z}"]}),!s.getLayer(c+"-"+a.id)&&s.addLayer({id:c+"-"+a.id,type:"fill",source:c,"source-layer":"default",filter:["==","id",a.id],layout:{},paint:{"fill-color":"#FF0000","fill-opacity":.3}}),setTimeout(()=>{s.getLayer(c+"-"+a.id)&&s.removeLayer(c+"-"+a.id)},5e3)}else if(c=="sluiceArea"||c=="pumpArea"){let n=(await P.get(e+`/tile/vector/${c}/id/${a.id}/buffer/1000/cj/bbox`)).data,h=[[n.bbox[0],n.bbox[1]],[n.bbox[2],n.bbox[3]]];s.fitBounds(h,{padding:ee[c],maxZoom:te[c]});const T={sluiceArea:"#FF0000",pumpArea:"#0000FF"},v=new de.Marker({color:T[c],draggable:!0}).setLngLat([a.center_x,a.center_y]).addTo(s);setTimeout(()=>{v.remove()},5e3)}},ye=async(t,a)=>{let d=a.property,s=a.lgId,n=Gt[s];if(t.parent.data.label.includes("岸段")){B.value=!0;const N=(await P.get(e+`/tile/vector/${n}/id/${d.id}/info/bbox`)).data;L.value={ogData:N,sourceId:n,column:Ft[n]}}let h=(await P.get(e+`/tile/vector/${n}/id/${a.property.id}/info/bbox`)).data,T=[[h.bbox[0],h.bbox[1]],[h.bbox[2],h.bbox[3]]],v=p.getMap();v.fitBounds(T,{padding:ee[n],maxZoom:te[n]}),n=="riverBeach"&&(!v.getSource("riverBeachLine")&&v.addSource("riverBeachLine",{type:"vector",tiles:[e+"/tile/vector/riverBeachLine/{x}/{y}/{z}"]}),!v.getLayer(n+"-"+d.id)&&v.addLayer({id:n+"-"+d.id,type:"line",source:"riverBeachLine","source-layer":"default",filter:["==","id",d.id],layout:{},paint:{"line-color":"rgb(240, 0, 0)","line-width":3,"line-opacity":.5,"line-dasharray":[5,3]}}),setTimeout(()=>{v.removeLayer(n+"-"+d.id)},5e3))},lt=t=>{if(t==1){be(p.getMap());return}y.value[t]=!y.value[t]},be=t=>{t&&t.fitBounds([[118.40770531586725,31.015473926104463],[122.06874017956159,32.73217294711945]],{pitch:0,duration:1500})},it=t=>{y.value[t]=!1},ke=()=>{let t=oe.value;t[0].active=!0,t[0].children[0].active=!0,t[0].children[1].active=!0,t[0].children[2].active=!0,t[1].active=!0,t[2].active=!1,t[2].children[0].active=!1,t[2].children[0].children[0].active=!1,t[2].children[0].children[1].active=!1,t[2].children[0].children[2].active=!1,t[2].children[1].active=!1,t[3].active=!0,t[3].children[0].active=!0,t[3].children[1].active=!0,t[4].active=!1,t[4].children[0].active=!1,t[4].children[1].active=!1,t[5].active=!1,t[5].children[0].active=!1,t[5].children[1].active=!1,t[6].active=!0,t[7].active=!1,t[7].children[0].active=!0,t[7].children[1].active=!0,t[7].children[2].active=!1},nt=async()=>{const t=await kt(l.value);return p.setMap(t),t.addControl(new de.NavigationControl({showZoom:!1,showCompass:!0,visualizePitch:!0}),"top-right"),t.addControl(new de.ScaleControl({maxWidth:150}),"bottom-left"),t.dragRotate.disable(),t.touchZoomRotate.disableRotation(),be(t),t.on("zoom",()=>{$.value=t.getZoom()}),t};Ee(async()=>{let t=await nt();X.value=Oe,console.log(Oe),oe.value=await Na(),U.value=!1,Me(t)});const xe=(t,a)=>{let d=[],s={};for(let n=0;n<t.length;n++)s[t[n][a]]||(d.push(t[n]),s[t[n][a]]=!0);return d};mt(async()=>{p.getMap().remove(),p.destroyMap()});const ee={importantBank:{top:50,bottom:0,left:300,right:300},riverBeach:{top:50,bottom:0,left:300,right:300},riverBridge:{top:150,bottom:50,left:100,right:100},riverArea:{top:150,bottom:50,left:100,right:100},sluiceArea:{},pumpArea:{}},te={importantBank:14,riverBeach:13,riverBridge:14,riverArea:22,sluiceArea:14,pumpArea:14},we=["滁河","望虞河","新孟河","京杭运河白马湖-高宝湖长江区段","泰州引江河","秦淮河"],De=["七浦塘","白茆塘","常浒河","张家港","锡澄运河","九曲河","白屈港","杨林塘","通扬运河","澡港河","德胜河","焦港","九圩港","划子口河","岳子河","朱家山河","如海运河","通吕运河","十一圩港","夏仕港","娄江-浏河","走马塘"],Ie=["秦淮新河节制闸","三汊河河口闸","朱家山河闸","岳子河河闸","划子口节制闸","中坝闸","七摆渡闸站","瓜洲节制闸","引航道枢纽工程-水闸工程","京口闸","泰州引江河枢纽—高港节制闸","三茅镇沙家港闸","口岸闸","过船节制闸","天星港闸","焦土港闸","夏仕港节制闸","太字港节制闸","南通节制闸","营船港闸","白茆闸","浏河节制闸"],Ae=["望虞河常熟水利枢纽泵站工程","秦淮新河闸站一泵站工程","武定门闸站—泵站工程","高港泵站","九圩港提水泵站","澡港河水利枢纽-泵站工程","魏村水利枢纽-泵站工程","杨家沟站","大年站","十二圩翻水站","大年站","引航道枢纽工程-泵站工程","东风泵站","谏壁抽水站","大港泵站","上九圩泵站","新夏港泵站","焦港泵站","三干河泵站","七浦塘江边枢纽泵站","新沟泵站"],ot=(t,a)=>{let d=we.indexOf(t.name),s=we.indexOf(a.name);return d===-1&&(d=1/0),s===-1&&(s=1/0),d-s},st=(t,a)=>{let d=De.indexOf(t.name),s=De.indexOf(a.name);return d===-1&&(d=1/0),s===-1&&(s=1/0),d-s},rt=(t,a)=>{let d=Ie.indexOf(t.sp_name),s=Ie.indexOf(a.sp_name);return d===-1&&(d=1/0),s===-1&&(s=1/0),d-s},ct=(t,a)=>{let d=Ae.indexOf(t.sp_name),s=Ae.indexOf(a.sp_name);return d===-1&&(d=1/0),s===-1&&(s=1/0),d-s};return(t,a)=>{const d=M("el-switch"),s=M("el-button"),n=M("House"),h=M("el-icon"),T=M("UserFilled"),v=M("el-tree"),N=M("el-table-column"),g=M("el-input"),Le=M("el-table"),dt=M("More"),Se=M("el-radio-button"),ut=M("el-radio-group"),re=Be("loading"),ce=Be("draggable");return _(),I("div",Ma,[i("div",Ba,[r(R(It),null,{default:o(()=>[i("div",$a,[H((_(),I("div",Ta,[r(v,{style:{"max-width":"400px"},data:oe.value,"expand-on-click-node":!1,"node-key":"label","default-expanded-keys":qe},{default:o(({node:f,data:m})=>[i("span",Ca,[m.type=="title1"?(_(),I("div",Oa,[i("div",{class:W(["scene-top-section",{active:m.active}]),onClick:z=>_e(f,m)},[i("div",Fa,[i("div",Ga,A(m.label),1)])],10,Pa),r(d,{modelValue:m.active,"onUpdate:modelValue":z=>m.active=z,"active-action-icon":R(xt),"inactive-action-icon":R(wt),size:"large",onChange:z=>se(f,m)},null,8,["modelValue","onUpdate:modelValue","active-action-icon","inactive-action-icon","onChange"])])):m.type=="title2"||m.type=="title3"?(_(),I("div",Va,[i("div",{class:W(["card",{active:m.active}])},[i("div",{class:"top-section",onClick:z=>_e(f,m)},[i("div",za,[i("div",Ha,A(m.label),1)])],8,ja),i("div",Ra,[H(r(s,{type:"info",icon:R(Dt),circle:"",size:"large",onClick:z=>et(f,m)},null,8,["icon","onClick"]),[[J,!(f.parent.data.label.includes("岸段")||f.parent.data.label.includes("其他")||m.label.includes("其他")||m.label.includes("过江通道")||m.label.includes("沿江码头"))]])])],2)])):m.type=="feature"&&f.parent.data.label.includes("岸段")?(_(),I("div",{key:2,class:"feature-container",onClick:z=>ye(f,m)},[i("div",{class:W(["feature-content",{smaller:m.label.length>10}])},A(m.label),3)],8,Ea)):m.type=="feature"&&f.parent.data.label.includes("沙洲")?(_(),I("div",{key:3,class:"feature-container",onClick:z=>ye(f,m)},[i("div",{class:W(["feature-content",{smaller:m.label.length>10}])},[i("div",null,A(m.label),1),f.data.property.洲滩信息_人口活动=="2"?(_(),Z(h,{key:0,style:{"margin-left":"0.6vw"}},{default:o(()=>[r(n)]),_:1})):f.data.property.洲滩信息_人口活动=="1"?(_(),Z(h,{key:1,style:{"margin-left":"0.6vw"}},{default:o(()=>[r(T)]),_:1})):Te("",!0)],2)],8,Wa)):Te("",!0)])]),_:1},8,["data"])])),[[re,U.value]])])]),_:1})]),i("div",Za,[i("div",{ref_key:"mapContainer",ref:l,id:"map"},null,512)]),i("div",Ua,[(_(),I(K,null,Y(2,f=>i("div",{class:"icon-container",key:f},[i("div",{class:W(["icon",{active:y.value[f-1]}]),style:le(S[f-1]),onClick:m=>lt(f-1)},null,14,Xa)])),64))]),H((_(),I("div",qa,[r(Pt,{onClose:a[0]||(a[0]=f=>it(0)),legendList:X.value},null,8,["legendList"])])),[[J,y.value[0]],[ce,{bounds:"body",cancel:"div.content"}]]),H((_(),I("div",Ja,[r(ya,{column:L.value.column,ogData:L.value.ogData,sourceId:L.value.sourceId,onClose:a[1]||(a[1]=f=>B.value=!1),onPin:Ke},null,8,["column","ogData","sourceId"])])),[[J,B.value],[ce,{bounds:"body",cancel:"div.content"}],[R(fe),Ye]]),H((_(),I("div",Ka,[i("div",Ya,[i("div",Qa,A(q.value),1),i("div",{class:"miniIcon",style:le(Xe.value),onClick:a[2]||(a[2]=f=>Q.value=!Q.value)},null,4)]),i("div",el,[H((_(),Z(Le,{data:Je.value,height:"30vh",stripe:"",border:"",class:"infomation-table"},{default:o(()=>[(_(!0),I(K,null,Y(k.value,(f,m)=>(_(),Z(N,{key:m,prop:f.prop,label:f.label},null,8,["prop","label"]))),128)),r(N,{align:"right"},{header:o(()=>[r(g,{modelValue:V.value,"onUpdate:modelValue":a[3]||(a[3]=f=>V.value=f),size:"small",placeholder:"输入关键字搜索"},null,8,["modelValue"])]),default:o(f=>[r(s,{link:"",type:"primary",size:"small",onClick:m=>at(f.row)},{default:o(()=>[$e(" 查看详情 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,b.value]])])])),[[J,G.value],[ce,{bounds:"body",cancel:"div.content"}],[re,!1],[R(fe),Qe]]),i("div",tl,[i("div",al,[$e(" 实时水文信息 "),r(h,{onClick:a[4]||(a[4]=f=>F.value=!F.value),style:{"margin-left":"50%"},class:"iconn"},{default:o(()=>[r(dt)]),_:1})]),H(r(Le,{data:ie,border:"",style:{width:"15vw"}},{default:o(()=>[r(N,{prop:"station",label:"站点"}),r(N,{prop:"flow",label:"流量"}),r(N,{prop:"level",label:"水位"})]),_:1},512),[[J,F.value]])]),i("div",ll,[r(ut,{modelValue:ne.value,"onUpdate:modelValue":a[5]||(a[5]=f=>ne.value=f),size:"large",onChange:tt},{default:o(()=>[r(Se,{label:"矢量底图",value:"1"}),r(Se,{label:"影像底图",value:"0"})]),_:1},8,["modelValue"])])])}}},ol=he(il,[["__scopeId","data-v-3fb00d93"]]);export{ol as default};
