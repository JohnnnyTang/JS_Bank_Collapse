const __vite__fileDeps=["assets/riskResult-_LltqOjr.js","assets/index-SWrCUa1v.js","assets/index-BPBP_e2u.css","assets/riskResult-ATSSiHG3.css","assets/flowspeedInfo-CvLMzx2a.js","assets/util-CRZRFQLc.js","assets/flowspeedInfo-DhCc-SlV.css","assets/profileInfo-CSX5PwCR.js","assets/profileInfo-V_w5SQ9g.css","assets/profileShapeYearly-CFMx5Mwe.js","assets/profileShapeYearly-Bxp6tmOB.css","assets/profileShapeCompare-StyU9qlv.js","assets/profileShapeCompare-C0q7WLm1.css","assets/profileSlope-B9T-gAba.js","assets/profileSlope-BElbQp6g.css","assets/profileErosion-D60jlLM3.js","assets/profileErosion-CF4DUzMW.css","assets/BedFlowChart-CkQDcNTA.js","assets/BedFlowChart-DzRjOnJ2.css","assets/WaterProcessChart-CDbWO4kk.js","assets/WaterProcessChart-DUwbw-8I.css","assets/GeologyAndProject-BazCAgtW.js","assets/GeologyAndProject-B_v6qjsY.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{H as at,s as le,aq as Ot,h as Ae,i as lt,j as ne,o as _,c as D,b as F,d as N,a as n,t as fe,ba as Be,_ as ut,g as s,b6 as Vt,v as se,x as zt,y as Nt,J as Oe,e as O,N as b,B as de,u as k,z as rt,A as jt,a2 as ct,ac as it,w as ot,p as It,f as Xt,bf as V,ad as Te,a$ as z}from"./index-SWrCUa1v.js";import"./index-CSSfrmGn.js";/* empty css                  */import{M as Yt}from"./mapbox-gl-draw-D7PYLG1M.js";class Jt{constructor(e){this.id="岸段预警",this.jsonData=e,this.map=void 0,this.type="custom",this.showLayer=!1,this.prepared=!1,console.log("contruictasd12312",this.jsonData)}async onAdd(e,a){this.map=e,this.vertexData=[],this.warnValues=[],this.vertexCount=0,this.jsonData.forEach(o=>{let x=at.MercatorCoordinate.fromLngLat({lng:o.coords[0][0],lat:o.coords[0][1]}),R=at.MercatorCoordinate.fromLngLat({lng:o.coords[1][0],lat:o.coords[1][1]});this.vertexData.push(x.x,x.y,o.warnValue,R.x,R.y,o.warnValue),this.vertexCount+=2});const l=`
        uniform mat4 u_matrix;
        attribute vec3 a_position; 
        varying float v_warnValue; 

        void main() {
            v_warnValue = a_position.z; 
            gl_Position = u_matrix * vec4(a_position.x, a_position.y, 0.0, 1.0);
        }`,i=`
        precision mediump float;
        varying float v_warnValue; 

        void main() {
            // int pallete[10] = {
            //     0x00b0f0,
            //     0x76a9c8,
            //     0xa69f9f,
            //     0xcc9071,
            //     0xed7c31,
            //     0xf06f24,
            //     0xf46018,
            //     0xf84e0d,
            //     0xfb3704,
            //     0xff0000,
            // }
            // int pallete[3] = {
            //     0x00b0f0,
            //     0x76a9c8,
            //     0xff0000,
            // }
            // int botIndex = floor(v_warnValue * 2);
            // int topIndex = floor(v_warnValue * 2 + 0.5);
            // int interval = value * 10.0 - botIndex;

            // vec3 botColor = colorFromInt(rampColors[botIndex]);
            // vec3 topColor = colorFromInt(rampColors[botIndex+1]);
            // vec3 topColor = colorFromInt(rampColors[topIndex]);
            // vec3 resultColor = mix(botColor, topColor, interval);

            // vec3 green = vec3(0.0, 1.0, 0.0);
            vec3 blue = vec3(0.0, 0.0, 1.0);
            vec3 orange = vec3(240.0, 120.0, 0.0) / 255.0;
            vec3 red = vec3(1.0, 0.0, 0.0);
            float v_warnValueP = clamp(v_warnValue*1.4, 0.0, 1.0);


            vec3 greenToBlue = mix(blue, orange, smoothstep(0.0, 0.5, v_warnValueP));
            // Interpolate between blue and red from 0.5 to 1.0
            vec3 blueToRed = mix(orange, red, smoothstep(0.5, 1.0, v_warnValueP));
            // Combine the two interpolations
            vec3 color = mix(greenToBlue, blueToRed, smoothstep(0.0, 1.0, v_warnValueP));

            // gl_FragColor  = vec4(v_warnValueP, 0, 1.0-v_warnValueP, 0.85); // 使用 fragColor 代替 gl_FragColor
            gl_FragColor  = vec4(color, 0.85); // 使用 fragColor 代替 gl_FragColor
        }`,d=a.createShader(a.VERTEX_SHADER);a.shaderSource(d,l),a.compileShader(d);const p=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(p,i),a.compileShader(p),this.program=a.createProgram(),a.attachShader(this.program,d),a.attachShader(this.program,p),a.linkProgram(this.program),this.aPos=a.getAttribLocation(this.program,"a_position"),console.log(this.aPos),this.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertexData),a.STATIC_DRAW),this.prepared=!0}async render(e,a){this.prepared&&(e.useProgram(this.program),e.uniformMatrix4fv(e.getUniformLocation(this.program,"u_matrix"),!1,a),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(this.aPos),e.vertexAttribPointer(this.aPos,3,e.FLOAT,!1,0,0),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,0,this.vertexCount))}show(){}hide(){}}class $t{constructor(){this.lineNum=3e4,this.segmentNum=8,this.fullLife=this.segmentNum*10,this.progressRate=0,this.speedFactor=2,this.dropRate=.01,this.dropRateBump=.005,this.fillWidth=2,this.aaWidth=3,this.colorScheme=0,this.isUnsteady=!0,this.content="none",this.primitive=0,this.platform="mapbox no worker"}}class Gt{constructor(e){this.url="",this.flowFieldResourceArr=[],this.seedingResourceArr=[],this.projection2DResource="",this.projection3DResource="",this.flowFieldTexSize=[0,0],this.seedingTexSize=[0,0],this.projectionTexSize=[0,0],this.flowBoundary=[0,0,0,0],this.extent=[0,0,0,0],this.maxDropRate=0,this.maxDropRateBump=0,this.maxSegmentNum=0,this.maxTrajectoryNum=0,this.maxTextureSize=0,this.url=e}async Parsing(){await le.get(this.url).then(e=>{console.log("reponse::"+e);for(let a of e.data.flow_fields)this.flowFieldResourceArr.push(a);for(let a of e.data.area_masks)this.seedingResourceArr.push(a);this.projection2DResource=e.data.projection["2D"],this.flowFieldTexSize=e.data.texture_size.flow_field,this.seedingTexSize=e.data.texture_size.area_mask,this.projectionTexSize=e.data.texture_size.projection,this.flowBoundary[0]=e.data.flow_boundary.u_min,this.flowBoundary[1]=e.data.flow_boundary.v_min,this.flowBoundary[2]=e.data.flow_boundary.u_max,this.flowBoundary[3]=e.data.flow_boundary.v_max,this.extent[0]=e.data.extent[0],this.extent[1]=e.data.extent[1],this.extent[2]=e.data.extent[2],this.extent[3]=e.data.extent[3],this.maxDropRate=e.data.constraints.max_drop_rate,this.maxDropRateBump=e.data.constraints.max_drop_rate_bump,this.maxSegmentNum=e.data.constraints.max_segment_num,this.maxTrajectoryNum=e.data.constraints.max_streamline_num,this.maxTextureSize=e.data.constraints.max_texture_size})}}class st{constructor(e,a,l){this.map=null,this.GL=null,this.uboMapBufferData=new Float32Array(12),this.phaseCount=0,this.timeLast=10,this.currentResourcePointer=0,this._timeCount=0,this._progressRate=0,this.textureArraySize=0,this.flowFieldTextureArr=[0,0,0],this.seedingTextureArr=[0,0,0],this.transformTexture=0,this.particleMapBufferData=new Float32Array(0),this.simulationBuffer=0,this.xfSimulationBuffer=0,this.lifeBuffer=0,this.xfLifeBuffer=0,this.BO=0,this.simulationVAO=0,this.simulationVAO2=0,this.XFO=0,this.XFO2=0,this.trajectoryPool=0,this.isReady=!1,this.renderVAO=0,this.renderVAO2=0,this.textureOffsetArray=[],this.beginBlock=-1,this.now_FFTextureArr=[0,0],this.now_SeedTextureArr=[0,0],this.now_sVAO=0,this.now_rVAO=0,this.now_XFO=0,this.now_XFBO=0,this.id=e,this.type="custom",this.renderingMode="2d",this.parser=new Gt(a),this.resourcePrefix=l,this.controller=new $t}set progressRate(e){const a=Math.floor(this._progressRate*this.phaseCount)%this.phaseCount,l=Math.floor(e*this.phaseCount)%this.phaseCount,i=(l+1)%this.phaseCount;this._progressRate=e,this.now_FFTextureArr[0]=this.flowFieldTextureArr[l%this.textureArraySize],this.now_FFTextureArr[1]=this.flowFieldTextureArr[i%this.textureArraySize],this.now_SeedTextureArr[0]=this.seedingTextureArr[l%this.textureArraySize],this.now_SeedTextureArr[1]=this.seedingTextureArr[i%this.textureArraySize];let d=e*this.phaseCount;if(this.uboMapBufferData[0]=d-Math.floor(d),l!=a){this.currentResourcePointer=(this.currentResourcePointer+1)%this.phaseCount,console.log("now time step :: ",this.currentResourcePointer);let p=i%this.textureArraySize,o=this.GL;this.UpdateTextureByImage(o,this.flowFieldTextureArr[p],o.RG,o.LINEAR,this.parser.flowFieldTexSize[0],this.parser.flowFieldTexSize[1],this.parser.flowFieldResourceArr[i],"Float"),this.UpdateTextureByImage(o,this.seedingTextureArr[p],o.RGBA,o.NEAREST,this.parser.seedingTexSize[0],this.parser.seedingTexSize[1],this.parser.seedingResourceArr[i],"UNSIGHNED_BYTE")}}get progressRate(){return this._progressRate}set timeCount(e){this._timeCount=e%this.timeLast}get timeCount(){return this._timeCount}async init2ShadersFromSrc(e,a,l,i){const d=await le.get(a).then(A=>A.data).catch(A=>{console.log("ERROR::VERTEX_SHADER FILE NOT FOUND",A)}),p=await le.get(l).then(A=>A.data).catch(A=>{console.log("ERROR::FRAGMENT_SHADER FILE NOT FOUND",A)}),o=e.createShader(e.VERTEX_SHADER);e.shaderSource(o,d),e.compileShader(o);const x=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(x,p),e.compileShader(x);const R=e.createProgram();if(e.attachShader(R,o),e.attachShader(R,x),i&&e.transformFeedbackVaryings(R,i,e.SEPARATE_ATTRIBS),e.linkProgram(R),!e.getProgramParameter(R,e.LINK_STATUS)){console.log(e.getProgramInfoLog(R));return}return{program:R,vertexShader:o,fragmentShader:x}}async FillTextureByImage(e,a,l,i,d,p,o,x){let R=this.resourcePrefix+o;x==="Float"?le.get(R,{responseType:"blob"}).then(A=>{createImageBitmap(A.data,{imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"default"}).then(B=>{const he=new Uint8Array(B.width*B.height*4),f=new OffscreenCanvas(B.width,B.height).getContext("webgl2"),P=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,P);const U=f.createTexture();f.bindTexture(f.TEXTURE_2D,U),f.texImage2D(f.TEXTURE_2D,0,f.RGBA8,B.width,B.height,0,f.RGBA,f.UNSIGNED_BYTE,B),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,U,0),f.readPixels(0,0,B.width,B.height,f.RGBA,f.UNSIGNED_BYTE,he),f.bindTexture(f.TEXTURE_2D,null),f.bindFramebuffer(f.FRAMEBUFFER,null),f.deleteTexture(U),f.deleteFramebuffer(P),f.finish(),e.bindTexture(e.TEXTURE_2D,a),e.texSubImage2D(e.TEXTURE_2D,0,0,0,d,p,e.RG,e.FLOAT,new Float32Array(he.buffer)),e.bindTexture(e.TEXTURE_2D,null),e.finish()})}):await le.get(R,{responseType:"blob"}).then(A=>{createImageBitmap(A.data,{imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"default"}).then(B=>{e.bindTexture(e.TEXTURE_2D,a),e.texSubImage2D(e.TEXTURE_2D,0,0,0,d,p,l,e.UNSIGNED_BYTE,B),e.bindTexture(e.TEXTURE_2D,null),e.finish()})})}async UpdateTextureByImage(e,a,l,i,d,p,o,x){await this.FillTextureByImage(e,a,l,i,d,p,o,x)}FillBlockByData(e,a,l,i,d,p,o){e.bindTexture(e.TEXTURE_2D,a),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texSubImage2D(e.TEXTURE_2D,0,l,i,d,p,e.RGB,e.FLOAT,o),e.bindTexture(e.TEXTURE_2D,null)}swap(){this.beginBlock%2==0?(this.now_sVAO=this.simulationVAO,this.now_rVAO=this.renderVAO,this.now_XFO=this.XFO,this.now_XFBO=this.simulationBuffer):(this.now_sVAO=this.simulationVAO2,this.now_rVAO=this.renderVAO2,this.now_XFO=this.XFO2,this.now_XFBO=this.xfSimulationBuffer)}async prepare(e){await this.parser.Parsing();const a=e.getSupportedExtensions();for(let o of a)e.getExtension(o);console.log(this.parser),this.parser.trajectoryNum=this.controller.lineNum,this.parser.segmentPrepare=this.parser.maxSegmentNum,this.parser.segmentNum=this.parser.maxSegmentNum,this.parser.maxBlockSize=Math.ceil(Math.sqrt(this.parser.maxTrajectoryNum)),this.phaseCount=this.parser.flowFieldResourceArr.length,this.timeLast=this.phaseCount*150,this.textureArraySize=3;for(var l=0;l<this.textureArraySize;l++){let o=e.createTexture();e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG32F,this.parser.flowFieldTexSize[0],this.parser.flowFieldTexSize[1]),e.bindTexture(e.TEXTURE_2D,null),await this.FillTextureByImage(e,o,e.RG,e.LINEAR,this.parser.flowFieldTexSize[0],this.parser.flowFieldTexSize[1],this.parser.flowFieldResourceArr[l],"Float"),this.flowFieldTextureArr[l]=o;let x=e.createTexture();e.bindTexture(e.TEXTURE_2D,x),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8,this.parser.seedingTexSize[0],this.parser.seedingTexSize[1]),e.bindTexture(e.TEXTURE_2D,null),await this.FillTextureByImage(e,x,e.RGBA,e.NEAREST,this.parser.seedingTexSize[0],this.parser.seedingTexSize[1],this.parser.seedingResourceArr[l],"UNSIGNED_BYTE"),this.seedingTextureArr[l]=x}let i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texStorage2D(e.TEXTURE_2D,1,e.RG32F,this.parser.projectionTexSize[0],this.parser.projectionTexSize[1]),e.bindTexture(e.TEXTURE_2D,null),await this.FillTextureByImage(e,i,e.RG,e.LINEAR,this.parser.projectionTexSize[0],this.parser.projectionTexSize[1],this.parser.projection2DResource,"Float"),this.transformTexture=i,this.particleMapBufferData=new Float32Array(this.parser.maxBlockSize*this.parser.maxBlockSize*3).fill(0);for(let o=0;o<this.parser.maxTrajectoryNum;o++)this.particleMapBufferData[o*3+0]=Math.random(),this.particleMapBufferData[o*3+1]=Math.random(),this.particleMapBufferData[o*3+2]=0;const d=new Float32Array(this.parser.maxTrajectoryNum);for(let o=0;o<this.parser.maxTrajectoryNum;o++)d[o]=this.parser.maxSegmentNum*9;this.simulationBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.simulationBuffer),e.bufferData(e.ARRAY_BUFFER,this.particleMapBufferData,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.xfSimulationBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.xfSimulationBuffer),e.bufferData(e.ARRAY_BUFFER,this.particleMapBufferData,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.lifeBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.lifeBuffer),e.bufferData(e.ARRAY_BUFFER,d,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.xfLifeBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.xfLifeBuffer),e.bufferData(e.ARRAY_BUFFER,d,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.simulationVAO=e.createVertexArray(),e.bindVertexArray(this.simulationVAO),e.bindBuffer(e.ARRAY_BUFFER,this.simulationBuffer),e.vertexAttribPointer(0,3,e.FLOAT,!1,3*4,0),e.enableVertexAttribArray(0),e.bindBuffer(e.ARRAY_BUFFER,this.lifeBuffer),e.vertexAttribPointer(1,1,e.FLOAT,!1,1*4,0),e.enableVertexAttribArray(1),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),this.simulationVAO2=e.createVertexArray(),e.bindVertexArray(this.simulationVAO2),e.bindBuffer(e.ARRAY_BUFFER,this.xfSimulationBuffer),e.vertexAttribPointer(0,3,e.FLOAT,!1,3*4,0),e.enableVertexAttribArray(0),e.bindBuffer(e.ARRAY_BUFFER,this.xfLifeBuffer),e.vertexAttribPointer(1,1,e.FLOAT,!1,1*4,0),e.enableVertexAttribArray(1),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),this.renderVAO=e.createVertexArray(),e.bindVertexArray(this.renderVAO),e.bindBuffer(e.ARRAY_BUFFER,this.lifeBuffer),e.vertexAttribPointer(0,1,e.FLOAT,!1,1*4,0),e.vertexAttribDivisor(0,1),e.enableVertexAttribArray(0),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),this.renderVAO2=e.createVertexArray(),e.bindVertexArray(this.renderVAO2),e.bindBuffer(e.ARRAY_BUFFER,this.xfLifeBuffer),e.vertexAttribPointer(0,1,e.FLOAT,!1,1*4,0),e.vertexAttribDivisor(0,1),e.enableVertexAttribArray(0),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),this.XFO=e.createTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.XFO),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.xfSimulationBuffer),e.bindBufferRange(e.TRANSFORM_FEEDBACK_BUFFER,0,this.xfSimulationBuffer,0,this.parser.maxBlockSize*this.parser.maxBlockSize*4*3),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.xfLifeBuffer),e.bindBufferRange(e.TRANSFORM_FEEDBACK_BUFFER,1,this.xfLifeBuffer,0,this.parser.maxBlockSize*this.parser.maxBlockSize*4),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,null),this.XFO2=e.createTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.XFO2),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.simulationBuffer),e.bindBufferRange(e.TRANSFORM_FEEDBACK_BUFFER,0,this.simulationBuffer,0,this.parser.maxBlockSize*this.parser.maxBlockSize*3*4),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.lifeBuffer),e.bindBufferRange(e.TRANSFORM_FEEDBACK_BUFFER,1,this.lifeBuffer,0,this.parser.maxBlockSize*this.parser.maxBlockSize*4),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,null),this.parser.maxBlockSize=Math.ceil(Math.sqrt(this.parser.maxTrajectoryNum)),this.parser.maxBlockColumn=Math.floor(this.parser.maxTextureSize/this.parser.maxBlockSize);for(let o=0;o<this.parser.maxSegmentNum;o++){let x={offsetX:this.parser.maxBlockSize*(o%this.parser.maxBlockColumn),offsetY:this.parser.maxBlockSize*Math.floor(o/this.parser.maxBlockColumn)};this.textureOffsetArray.push(x)}this.BO=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.BO),e.bufferData(e.ARRAY_BUFFER,48,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.trajectoryPool=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.trajectoryPool),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,this.parser.maxTextureSize,this.parser.maxTextureSize),e.bindTexture(e.TEXTURE_2D,null);for(let o=0;o<this.parser.maxSegmentNum;o++)this.FillBlockByData(e,this.trajectoryPool,this.textureOffsetArray[o].offsetX,this.textureOffsetArray[o].offsetY,this.parser.maxBlockSize,this.parser.maxBlockSize,this.particleMapBufferData);let p=["newInfo","aliveTime"];this.updateShaderObj=await this.init2ShadersFromSrc(e,"/scratchSomething/flowWebGL/shaders/update.vert","/scratchSomething/flowWebGL/shaders/update.frag",p),this.trajectoryShaderObj=await this.init2ShadersFromSrc(e,"/scratchSomething/flowWebGL/shaders/trajectory.noCulling.vert","/scratchSomething/flowWebGL/shaders/trajectory.noCulling.frag"),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,null),e.bindVertexArray(null),this.uboMapBufferData[8]=this.parser.flowBoundary[0],this.uboMapBufferData[9]=this.parser.flowBoundary[1],this.uboMapBufferData[10]=this.parser.flowBoundary[2],this.uboMapBufferData[11]=this.parser.flowBoundary[3],this.isReady=!0}tickfunc(e,a){this.beginBlock=(this.beginBlock+1)%this.parser.segmentNum,this.swap(),this.controller.isUnsteady&&(this.progressRate=this.timeCount/this.timeLast,this.timeCount=this.timeCount+1),this.uboMapBufferData[1]=this.parser.maxSegmentNum,this.uboMapBufferData[2]=this.parser.maxSegmentNum*10,this.uboMapBufferData[3]=this.controller.dropRate,this.uboMapBufferData[4]=this.controller.dropRateBump,this.uboMapBufferData[5]=this.controller.speedFactor*.01*100,this.uboMapBufferData[6]=this.controller.colorScheme,e.bindBuffer(e.UNIFORM_BUFFER,this.BO),e.bufferData(e.UNIFORM_BUFFER,this.uboMapBufferData,e.DYNAMIC_DRAW);let l=0;e.bindBufferRange(e.UNIFORM_BUFFER,l,this.BO,0,48),e.bindVertexArray(this.now_sVAO),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.now_XFO),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.now_FFTextureArr[0]),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.now_FFTextureArr[1]),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.now_SeedTextureArr[0]),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.now_SeedTextureArr[1]),e.useProgram(this.updateShaderObj.program);let i=null;i=e.getUniformLocation(this.updateShaderObj.program,"flowField"),e.uniform1iv(i,[0,1]),i=e.getUniformLocation(this.updateShaderObj.program,"mask"),e.uniform1iv(i,[2,3]),i=e.getUniformLocation(this.updateShaderObj.program,"randomSeed"),e.uniform1f(i,Math.random());let d=0;if(d=e.getUniformBlockIndex(this.updateShaderObj.program,"FlowFieldUniforms"),e.uniformBlockBinding(this.updateShaderObj.program,d,l),e.enable(e.RASTERIZER_DISCARD),e.beginTransformFeedback(e.POINTS),e.drawArrays(e.POINTS,0,this.parser.trajectoryNum),e.endTransformFeedback(),e.disable(e.RASTERIZER_DISCARD),e.bindVertexArray(null),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,this.now_XFBO),e.bindTexture(e.TEXTURE_2D,this.trajectoryPool),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texSubImage2D(e.TEXTURE_2D,0,this.textureOffsetArray[this.beginBlock].offsetX,this.textureOffsetArray[this.beginBlock].offsetY,this.parser.maxBlockSize,this.parser.maxBlockSize,e.RGB,e.FLOAT,0),e.bindTexture(e.TEXTURE_2D,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null),e.finish(),this.parser.segmentPrepare>0){this.parser.segmentPrepare--;return}e.bindVertexArray(this.now_rVAO),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.trajectoryPool),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.transformTexture),e.disable(e.DEPTH_TEST),e.useProgram(this.trajectoryShaderObj.program),i=e.getUniformLocation(this.trajectoryShaderObj.program,"particlePool"),e.uniform1i(i,0),i=e.getUniformLocation(this.trajectoryShaderObj.program,"projectionTexture"),e.uniform1i(i,1),i=e.getUniformLocation(this.trajectoryShaderObj.program,"blockNum"),e.uniform1i(i,this.parser.maxSegmentNum),i=e.getUniformLocation(this.trajectoryShaderObj.program,"beginBlock"),e.uniform1i(i,this.beginBlock),i=e.getUniformLocation(this.trajectoryShaderObj.program,"blockSize"),e.uniform1i(i,this.parser.maxBlockSize),i=e.getUniformLocation(this.trajectoryShaderObj.program,"fillWidth"),e.uniform1f(i,this.controller.fillWidth),i=e.getUniformLocation(this.trajectoryShaderObj.program,"aaWidth"),e.uniform1f(i,this.controller.aaWidth),i=e.getUniformLocation(this.trajectoryShaderObj.program,"viewport"),e.uniform2f(i,e.canvas.width,e.canvas.height),i=e.getUniformLocation(this.trajectoryShaderObj.program,"u_matrix"),e.uniformMatrix4fv(i,!1,a),d=e.getUniformBlockIndex(this.trajectoryShaderObj.program,"FlowFieldUniforms"),e.uniformBlockBinding(this.trajectoryShaderObj.program,d,l),e.drawArraysInstanced(e.TRIANGLE_STRIP,0,(this.parser.segmentNum-1)*2,this.parser.trajectoryNum),e.bindVertexArray(null),e.bindTexture(e.TEXTURE_2D,null)}async onAdd(e,a){this.GL=a,this.map=e,await this.prepare(a)}render(e,a){if(!this.isReady){this.map?.triggerRepaint();return}this.tickfunc(e,a),this.map?.triggerRepaint()}}const gt="/down_triangle.png",Wt="/rasterLegend1.png",$=le.create({baseURL:"/api"});class H{static runProfileModelTest=e=>{const a=`/taskNode/start/multi/default/section/${e-1}`;return $.post(a)};static getProfileDataTest=e=>{const a=e<10?`/fileData/json/jsonStr/name/multiWholeRes-JC0${e}/newest`:`/fileData/json/jsonStr/name/multiWholeRes-JC${e}/newest`;return $.get(a)};static runProfileModel_short=(e,a,l)=>{const i=`/taskNode/start/multi/default/section/${l-1}/beg/${e}/end/${a}`;return $.post(i)};static runProfileModel_long=(e,a,l)=>{const i=`/taskNode/start/multi/default/section/long/${l-1}/beg/${e}/end/${a}`;return $.post(i)};static getProfileData=(e,a,l)=>{const i=l<10?`/fileData/json/jsonStr/name/multiWholeRes-JC0${l}_beg${e}_end${a}/newest`:`/fileData/json/jsonStr/name/multiWholeRes-JC${l}_beg${e}_end${a}/newest`;return $.get(i)};static runProfileModelByLine=(e,a,l,i,d,p)=>{const o=`/taskNode/start/multi/default?begTime=${e}&endTime=${a}&startPt=${l},${i}&endPt=${d},${p}`;return $.post(o)};static getRunStatus=e=>{const a="/taskNode/"+e+"/status";return $.get(a)};static getRunResult=e=>{const a="/fileData/json/jsonStr/id/"+e;return $.get(a)}}const Ht={class:"timestep-shower"},Zt={class:"percentage-value"},Kt=Ot({__name:"flowTimeShower",props:{timeStep:Number,totalCount:Number,type:String},setup(C){const e=C,a=Ae(()=>Math.ceil(e.timeStep/e.totalCount*100)),l=Ae(()=>{if(e.type=="normal"){let i=Be().startOf("day"),d=e.timeStep/6;return i.add(d,"hour").format("YYYY/MM/DD HH")}else if(e.type=="9711"){let i=Be("1997-08-16").startOf("day"),d=e.timeStep*6;return i.add(d,"hour").format("YYYY/MM/DD HH")}else if(e.type=="9711adwt"){let i=Be("1997-08-12").startOf("day"),d=e.timeStep*1;return i.add(d,"hour").format("YYYY/MM/DD HH")}else if(e.type=="exp"){let i=Be().startOf("day").subtract(1,"day"),d=e.timeStep*1;return i.add(d,"hour").format("YYYY/MM/DD HH")}});return Ae(()=>l.value.split(" ")[1]),Ae(()=>l.value.split(" ")[0]),lt(()=>{}),(i,d)=>{const p=ne("el-progress");return _(),D("div",Ht,[F(p,{type:"dashboard",percentage:a.value},{default:N(({percentage:o})=>[n("span",Zt,fe(e.timeStep+"时"),1)]),_:1},8,["percentage"])])}}}),qt=ut(Kt,[["__scopeId","data-v-029927c2"]]),nt={20092003:{min:-20.216260910034,max:12.377036094666},21032003:{min:-18.057029724121,max:13.405656814575},21032009:{min:-11.904377937317,max:15.555559158325},21092003:{min:-29.0481300354,max:13.405656814575},21092009:{min:-21.573017120361,max:13.338559150696},21092103:{min:-22.064949035645,max:8.261926651001},22032003:{min:-26.315940856934,max:12.661833763123},22032009:{min:-18.946474075317,max:10.854301452637},22032103:{min:-18.682374954224,max:11.998920440674},22032109:{min:-18.682374954224,max:17.446615219116},22092003:{min:-34.24059677124,max:18.287557601929},22092009:{min:-28.642517089844,max:18.124055862427},22092103:{min:-28.885349273682,max:17.996383666992},22092109:{min:-20.775089263916,max:19.373840332031},22092203:{min:-20.959928512573,max:17.246448516846},23032003:{min:-25.497043609619,max:23.978927612305},23032009:{min:-15.159237861633,max:24.311046600342},23032103:{min:-16.9319896698,max:24.412498474121},23032109:{min:-11.673976898193,max:24.870639801025},23032203:{min:-10.602119445801,max:19.81965637207},23032209:{min:-10.008462905884,max:21.046541213989},23092003:{min:-24.543750762939,max:23.484636306763},23092009:{min:-14.633073806763,max:23.901466369629},23092103:{min:-15.942059516907,max:23.92653465271},23092109:{min:-12.148267745972,max:24.699771881104},23092203:{min:-11.635368347168,max:19.993438720703},23092209:{min:-11.635368347168,max:26.141702651978},23092303:{min:-11.635368347168,max:16.081762313843}},Ve=[{name:"JC01",coords:[[120.49989610501109,32.044845778820694],[120.49965852902085,32.043054010465546]],warnValue:.49},{name:"JC02",coords:[[120.51211644811006,32.04310480824947],[120.51157809855385,32.04135665004222]],warnValue:.59},{name:"JC03",coords:[[120.51598399026375,32.04244111945512],[120.51554162835052,32.04064910386879]],warnValue:.64},{name:"JC04",coords:[[120.52163733002358,32.040317481106044],[120.52010747944439,32.03901766791365]],warnValue:.67},{name:"JC05",coords:[[120.52344753736321,32.03912224359854],[120.52202732882418,32.037765786589944]],warnValue:.7},{name:"JC06",coords:[[120.5300568728269,32.035076196597906],[120.52886185568613,32.03359585101801]],warnValue:.83},{name:"JC07",coords:[[120.53577029390934,32.03306474923213],[120.53521759568126,32.03132371065091]],warnValue:.9},{name:"JC08",coords:[[120.54259039936055,32.03113531223312],[120.54191211481913,32.0294311450221]],warnValue:.73},{name:"JC09",coords:[[120.54845619793755,32.02942703528161],[120.547645906125,32.027757714058616]],warnValue:.53},{name:"JC10",coords:[[120.55217332294447,32.02819103999115],[120.55139957273384,32.02651468780271]],warnValue:.43},{name:"JC11",coords:[[120.55987007042168,32.0256085153387],[120.55938372124096,32.02385317986381]],warnValue:.29},{name:"JC12",coords:[[120.56542283954619,32.023997421425335],[120.56490201809913,32.022254233310434]],warnValue:.18}],Qt=[{value:1,id:"JC01",label:"MZ01围堤",name:"MZ01围堤",nickname:"围堤",filter:["==","name","JC01"],flowspeed:null,risk:null,color:null},{value:2,id:"JC02",label:"MZ02顺堤",name:"MZ02顺堤",nickname:"顺堤",filter:["==","name","JC02"],flowspeed:null,risk:null,color:null},{value:3,id:"JC03",label:"MZ03顺堤尾",name:"MZ03顺堤尾",nickname:"顺堤尾",filter:["==","name","JC03"],flowspeed:null,risk:null,color:null},{value:4,id:"JC04",label:"MZ04江滩办",name:"MZ04江滩办",nickname:"江滩办",filter:["==","name","JC04"],flowspeed:null,risk:null,color:null},{value:5,id:"JC05",label:"MZ05小港池",name:"MZ05小港池",nickname:"小港池",filter:["==","name","JC05"],flowspeed:null,risk:null,color:null},{value:6,id:"JC06",label:"MZ06张靖皋桥位",name:"MZ06张靖皋桥位",nickname:"张靖皋桥位",filter:["==","name","JC06"],flowspeed:null,risk:null,color:null},{value:7,id:"JC07",label:"MZ07桥位下游",name:"MZ07桥位下游",nickname:"桥位下游",filter:["==","name","JC07"],flowspeed:null,risk:null,color:null},{value:8,id:"JC08",label:"MZ08海事码头",name:"MZ08海事码头",nickname:"海事码头",filter:["==","name","JC08"],flowspeed:null,risk:null,color:null},{value:9,id:"JC09",label:"MZ09码头下游",name:"MZ09码头下游",nickname:"码头下游",filter:["==","name","JC09"],flowspeed:null,risk:null,color:null},{value:10,id:"JC10",label:"MZ10雷达站",name:"MZ10雷达站",nickname:"雷达站",filter:["==","name","JC10"],flowspeed:null,risk:null,color:null},{value:11,id:"JC11",label:"MZ11主路",name:"MZ11主路",nickname:"主路",filter:["==","name","JC11"],flowspeed:null,risk:null,color:null},{value:12,id:"JC12",label:"MZ12沙尾",name:"MZ12沙尾",nickname:"沙尾",filter:["==","name","JC12"],flowspeed:null,risk:null,color:null}],ea=[{value:"1999before",name:"1999汛前地形数据",label:"1999汛前",year:"1999",time:"汛前",date:"1999-01-01",dateShort:"9901"},{value:"2012after",name:"2012汛后地形数据",label:"2012汛后",year:"2012",time:"汛后",date:"2012-10-01",dateShort:"1210"},{value:"2019before",name:"2019汛前地形数据",label:"2019汛前",year:"2019",time:"汛前",date:"2019-04-01",dateShort:"1904"},{value:"2023before1",name:"2023汛前地形数据",label:"2023汛前",year:"2023",time:"汛前",date:"2023-04-01",dateShort:"2304"},{value:"2020before",name:"2020汛前地形数据",label:"2020汛前",year:"2020",time:"汛前",date:"2020-03-01",dateShort:"2003"},{value:"2020before",name:"2020汛前地形数据",label:"2020汛前",year:"2020",time:"汛前",date:"2020-03-01",dateShort:"2003"},{value:"2020after",name:"2020汛后地形数据",label:"2020汛后",year:"2020",time:"汛后",date:"2020-09-01",dateShort:"2009"},{value:"2021before",name:"2021汛前地形数据",label:"2021汛前",year:"2021",time:"汛前",date:"2021-03-01",dateShort:"2103"},{value:"2021after",name:"2021汛后地形数据",label:"2021汛后",year:"2021",time:"汛后",date:"2021-09-01",dateShort:"2109"},{value:"2022before",name:"2022汛前地形数据",label:"2022汛前",year:"2022",time:"汛前",date:"2022-03-01",dateShort:"2203"},{value:"2022after",name:"2022汛后地形数据",label:"2022汛后",year:"2022",time:"汛后",date:"2022-09-01",dateShort:"2209"},{value:"2023before",name:"2023汛前地形数据",label:"2023汛前",year:"2023",time:"汛前",date:"2023-03-01",dateShort:"2303"},{value:"2023after",name:"2023汛后地形数据",label:"2023汛后",year:"2023",time:"汛后",date:"2023-09-01",dateShort:"2309"}],ta=[{label:"水流动力因素",active:!1,children:[{label:"造床流量当量指标",icon:"/icons/行政区划.png",active:!1,filter:!0},{label:"流速指标",icon:"/icons/河道分段.png",active:!1,filter:!0},{label:"水位变幅指标",icon:"/icons/流域水系.png",active:!1,filter:!0}]},{label:"河床演变因素",active:!1,filter:!0,children:[{label:"岸坡最大坡比",icon:"/icons/江堤港堤.png",active:!1,filter:!0},{label:"近岸冲刷速率",icon:"/icons/长江堤防.png",active:!1,filter:!0},{label:"滩槽高程",icon:"/icons/过江通道.png",active:!1,filter:!0}]},{label:"岸坡地质因素",active:!1,filter:!0,children:[{label:"河岸组成粒径",icon:"/icons/岸段名录.png",active:!1,filter:!0},{label:"垂向分层结构",icon:"/icons/过江通道.png",active:!1,filter:!0}]},{label:"外部工程因素",active:!1,filter:!0,children:[{label:"护岸强度",icon:"/icons/岸段名录.png",active:!1,filter:!0},{label:"局部突加荷载",icon:"/icons/过江通道.png",active:!1,filter:!0}]}],w=C=>(It("data-v-83a34eb9"),C=C(),Xt(),C),aa={class:"risk-warn-container"},ra=ct('<canvas id="GPUFrame" data-v-83a34eb9></canvas><div class="basic-info-container" data-v-83a34eb9><div class="basic-info-content" data-v-83a34eb9><div class="title-container" data-v-83a34eb9>民主沙右缘示范段</div><div class="key-val-container" data-v-83a34eb9><div class="key-text" data-v-83a34eb9>预警级别：</div><div class="val-text" data-v-83a34eb9>Ⅰ级</div></div><div class="key-val-container right" data-v-83a34eb9><div class="key-text" data-v-83a34eb9>岸段长度：</div><div class="val-text" data-v-83a34eb9>全长7公里</div></div></div></div><div class="risk-item-title" data-v-83a34eb9>崩岸风险因素分析</div>',3),ia={class:"risk-item-container"},oa=w(()=>n("div",{class:"risk-item-text"},"水流动力",-1)),sa=w(()=>n("div",{class:"risk-item-text"},"河床演变",-1)),na=w(()=>n("div",{class:"risk-item-text"},"地质与工程治理",-1)),la={key:0,class:"raster-control-block"},ua={class:"switch"},ca=["checked"],da=w(()=>n("span",{class:"slider"},null,-1)),fa=w(()=>n("div",{class:"text-block"},[n("div",{class:"text"},"冲淤图展示")],-1)),ha={class:"bankLine-control-block"},ma={class:"switch"},va=["checked"],pa=w(()=>n("span",{class:"slider"},null,-1)),_a=w(()=>n("div",{class:"text-block"},[n("div",{class:"text"},"岸段展示")],-1)),xa=ct('<div class="risk-line-container" data-v-83a34eb9><div class="risk-line-title" data-v-83a34eb9>风险等级图例：</div><div class="risk-line" data-v-83a34eb9></div><div class="risk-line-arrow high" data-v-83a34eb9><img src="'+gt+'" alt="图例标记" data-v-83a34eb9></div><div class="risk-line-mark low" data-v-83a34eb9>低风险</div><div class="risk-line-mark middle" data-v-83a34eb9>中风险</div><div class="risk-line-mark high" data-v-83a34eb9>高风险</div></div>',1),ba={key:1,class:"warn-status-container"},ya=w(()=>n("div",{class:"warn-status-title"},"民主沙右缘风险评估结果",-1)),Ra=w(()=>n("div",{class:"warn-status-content high"},"高风险",-1)),Sa=[ya,Ra],wa={key:2,class:"warn-detail-container high"},Aa={class:"warn-detail-profile"},Ba={class:"warn-detail-text"},Ta=w(()=>n("span",{class:"warn-detail-span"},null,-1)),Fa={class:"warn-detail-span"},Ea={key:8,style:{position:"absolute",top:"16.25vh",left:"0.3vw",width:"26vw",height:"23.5vh","z-index":"10"}},ka={key:10,class:"flow-control-block"},Ca={class:"switch",style:{transform:"rotateZ(90deg)"}},La=["checked"],Da=w(()=>n("span",{class:"slider"},null,-1)),Pa=w(()=>n("div",{class:"text-block"},[n("div",{class:"text"},"流场展示")],-1)),Ua={key:11,class:"time-shower-block"},Ma={key:12,style:{position:"absolute",top:"66vh",left:"0.3vw",width:"26vw",height:"25vh","z-index":"10"}},Oa={key:14,class:"drag riskResult"},Va={key:15,class:"raster-legend-container"},za=w(()=>n("img",{src:Wt,alt:"比例尺"},null,-1)),Na=[za],ja=w(()=>n("span",null,"确认使用此断面进行计算",-1)),Ia={class:"dialog-footer"},Xa={style:{"text-align":"right"}},Ya=w(()=>n("span",null,"确认使用以下年份地形数据进行计算：",-1)),Ja={style:{position:"absolute",top:"6.5vh","font-weight":"bold"}},$a={style:{position:"absolute",top:"8.5vh","font-weight":"bold"}},Ga={class:"dialog-footer"},ga={style:{"text-align":"right"}},Wa={class:"loading-container"},Ha={class:"loading-message"},Za={__name:"BankRiskWarnView",setup(C){const e="http://127.0.0.1:8002/api/v1",a=s(-1),l=V(()=>z(()=>import("./riskResult-_LltqOjr.js"),__vite__mapDeps([0,1,2,3]))),i=V(()=>z(()=>import("./flowspeedInfo-CvLMzx2a.js"),__vite__mapDeps([4,1,2,5,6]))),d=V(()=>z(()=>import("./profileInfo-CSX5PwCR.js"),__vite__mapDeps([7,5,1,2,8]))),p=V(()=>z(()=>import("./profileShapeYearly-CFMx5Mwe.js"),__vite__mapDeps([9,5,1,2,10]))),o=V(()=>z(()=>import("./profileShapeCompare-StyU9qlv.js"),__vite__mapDeps([11,5,1,2,12]))),x=V(()=>z(()=>import("./profileSlope-B9T-gAba.js"),__vite__mapDeps([13,5,1,2,14]))),R=V(()=>z(()=>import("./profileErosion-D60jlLM3.js"),__vite__mapDeps([15,5,1,2,16]))),A=V(()=>z(()=>import("./BedFlowChart-CkQDcNTA.js"),__vite__mapDeps([17,1,2,18]))),B=V(()=>z(()=>import("./WaterProcessChart-CDbWO4kk.js"),__vite__mapDeps([19,1,2,20]))),he=V(()=>z(()=>import("./GeologyAndProject-BazCAgtW.js"),__vite__mapDeps([21,1,2,22]))),E=s("自定义断面信息计算中..."),f=s(),P=s(0),U=s(!1),S=s(!1),me=s(!0);s(ta);const I=s("洪季"),dt=t=>{I.value=t,console.log(I.value),U.value=!1,P.value=0;let r=se().getMap();r.getLayer("floodFlow")&&(r.removeLayer("floodFlow"),K&&(K(),K=null)),r.getLayer("dryFlow")&&(r.removeLayer("dryFlow"),q&&(q(),q=null))},ft=t=>{t&&t.fitBounds([[120.43987922676835,32.03201616423072],[120.59089640208263,32.05217136261862]],{duration:1500})},v=s(Qt),Z=s(ea);let ht=Ve;s([{value:"low",label:"低风险"},{value:"middle",label:"中风险"},{value:"high",label:"高风险"}]),s("mzs");const ze=()=>{Q=Z.value.find(t=>t.value===pe.value),ee=Z.value.find(t=>t.value===_e.value),Fe=Z.value.find(t=>t.value===yt.value),Ee=Z.value.find(t=>t.value===Rt.value)},mt=t=>{let r="";return v.value.map(u=>{u.risk===t&&(r=r+u.name+"; ")}),r},vt=()=>{Se.value=!1},pt=async()=>{if(ze(),Se.value=!1,ee.dateShort<=Q.dateShort){Te.error("当前地形时间不能早于或等于对比地形时间！");return}if(Ye.value===pe.value&&Je.value===_e.value){Te.error("当前地形时间与对比地形时间未发生变化！");return}E.value="冲淤图层加载中...",oe.value=!0,re.value=!0,ie.value=!0,Me.value=!0;const t=ee.dateShort+Q.dateShort;S.value||(S.value=!0),y.removeLayer("mapRaster"),y.removeSource("mapRaster"),et(y,t,"mapRaster"),y.moveLayer("mapRaster","mzsLine"),Ne(Q,ee,Fe,Ee)},ue=t=>{y.setFilter("mzsBankLineChoosen",v.value[t-1].filter)},Ne=async(t,r,u,c)=>{const m=t.date,h=r.date,M=u.date,j=c.date;E.value="确认计算结果是否存在...",oe.value=!0;let T,we;T=await je(m,h),we=await je(M,j),T&&we?(E.value="地形对比数据加载中...",L.value=await X(m,h),ce.value=await X(M,j)):T&&!we?(E.value="地形对比数据加载中...",await ve(M,j),E.value="地形对比数据加载中...",L.value=await X(m,h),ce.value=await X(M,j)):!T&&we?(E.value="地形对比数据加载中...",await ve(m,h),E.value="地形对比数据加载中...",L.value=await X(m,h),ce.value=await X(M,j)):(E.value="地形对比数据加载中...",await ve(M,j),await ve(m,h),E.value="地形对比数据加载中...",L.value=await X(m,h),ce.value=await X(M,j)),oe.value=!1,re.value=!1,ye.value=!1,ie.value=!1,Me.value=!1,Mt(),xt(L.value),y.getLayer("mzsBankLineLowRisk")!==void 0&&y.removeLayer("mzsBankLineLowRisk"),tt(y,v),xe.value=!0,Ye.value=pe.value,Je.value=_e.value},je=async(t,r)=>{const u=[];let c=!0;try{for(let h=0;h<12;h++)u.push(H.getProfileData(t,r,h+1));(await Promise.all(u)).forEach(h=>{(!h||!h.data||h.data.length===0)&&(c=!1)})}catch{c=!1}return c},X=async(t,r)=>{const u=[],c=[];for(let h=0;h<12;h++)u.push(H.getProfileData(t,r,h+1));return(await Promise.all(u)).forEach(h=>{h&&h.data&&c.push(h.data)}),c},ve=async(t,r)=>{const u=[];for(let c=0;c<v.value.length;c++)u.push(_t(t,r,c));await Promise.all(u)},_t=async(t,r,u)=>{const c=await H.runProfileModel_long(t,r,u+1);let m;for(;;){try{m=await H.getRunStatus(c.data)}catch{}if(m.data==2)break;if(m.data==-1)return;if(m.data==-2)return;m.data==1,await Qe(100)}},xt=t=>{t.map((r,u)=>{v.value[u].risk==="low"?v.value[u].color="rgb(31, 110, 209)":v.value[u].risk==="middle"?v.value[u].color="rgb(220, 126, 37)":v.value[u].color="rgb(250, 55, 36)";try{v.value[u].flowspeed=r.deepestPoint[2]}catch{}}),se().getMap()};let K=null,q=null;const Ie=async()=>{U.value=!U.value;let t=se().getMap();if(P.value=0,U.value){if(I.value=="洪季"){let r="/api/data/flow/configJson/flood",u="/api/data/flow/texture/flood/",c=it(new st("floodFlow",r,u));t.addLayer(c),K=ot(()=>c.currentResourcePointer,m=>{P.value=c.currentResourcePointer}),console.log("add 洪季")}else if(I.value=="枯季"){let r="/api/data/flow/configJson/dry",u="/api/data/flow/texture/dry/",c=it(new st("dryFlow",r,u));t.addLayer(c),q=ot(()=>c.currentResourcePointer,m=>{P.value=c.currentResourcePointer}),console.log("add 枯季")}}else I.value=="洪季"?t.getLayer("floodFlow")&&(t.removeLayer("floodFlow"),K(),K=null):I.value=="枯季"&&t.getLayer("dryFlow")&&(t.removeLayer("dryFlow"),q(),q=null)},Xe=()=>{S.value&&G.value?(y.setLayoutProperty("mapRaster","visibility","visible"),S.value=!S.value):!S.value&&G.value||S.value&&!G.value?(y.setLayoutProperty("mapRaster","visibility","none"),S.value=!S.value):y.setLayoutProperty("mapRaster","visibility","none")},bt=()=>{me.value?y.setLayoutProperty("岸段预警","visibility","none"):y.setLayoutProperty("岸段预警","visibility","visible"),me.value=!me.value},pe=s("2019before"),_e=s("2023before1"),yt=s("1999before"),Rt=s("2012after"),Ye=s("2019before"),Je=s("2023before1");s("2012after"),s("2012after");let Q,ee,Fe,Ee;const xe=s(!1),$e=s(!1),ke=s(!1),Ge=()=>{ke.value=!ke.value},te=s(!1),ge=()=>{te.value=!te.value},We=s(!1),He=s(!1),Ze=s(!1),Ce=s(!1),St=()=>{Ce.value=!Ce.value},Le=s(!1),wt=()=>{Le.value=!Le.value},Y=s(!1),At=async()=>{if(U.value===!1&&Y.value===!0){Y.value=!1;return}Y.value=!Y.value,P.value=0,await Ie()},G=s(!1),Ke=()=>{Xe(),G.value=!G.value},ae=s(!1),be=async()=>{console.log("213123213",a.value),J.value===!0?De():g.value===!0&&Pe(),St(),wt(),await At(),ae.value=!ae.value},J=s(!1),De=()=>{if(ae.value===!0?be():g.value===!0&&Pe(),S.value===!1&&te.value===!0||S.value===!0&&te.value===!1){ge(),Ge(),Ke(),J.value=!J.value;return}ge(),Ge(),Ke(),J.value=!J.value},g=s(!1),Pe=()=>{ae.value===!0?be():J.value===!0&&De(),g.value=!g.value},L=s([]),ce=s([]);s(0),s([]);const qe=s(null),Bt=s(null),Ue=s(!0),re=s(!0),ye=s(!0),ie=s(!0),Me=s(!0),W=s(""),Tt=s("");s(""),s("");let y;const Re=s(!1),Se=s(!1);s(""),s("");const oe=s(!1);let Ft,Et,kt,Ct;new Yt({displayControlsDefault:!1,controls:{line_string:!0,trash:!0},styles:[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["==","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#D20C0C","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":5,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","mode","draw_line_string"]],paint:{"circle-radius":3,"circle-color":"#D20C0C"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","draw_line_string"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000","line-width":3}}]});const Lt=()=>{Re.value=!1},Dt=async()=>{if(W.value===""){Te.error("断面名称不为空！");return}else if(v.value.find(h=>h.name===W.value)){Te.error("断面名称已存在！");return}oe.value=!0,Ue.value=!0,re.value=!0,ye.value=!0,ie.value=!0,E.value="自定义断面信息计算中...",Re.value=!1;const t=Z.value.find(h=>h.value==pe.value).date,r=Z.value.find(h=>h.value==_e.value).date,u=await Pt(t,r,Ft,Et,kt,Ct);let c="";for(;;){try{c=await H.getRunStatus(u.data)}catch{}if(c.data==2)break;if(c.data==-1)return;if(c.data==-2)return;c.data==1,await Qe(500)}const m=await H.getRunResult(u.data);Ut(m.data),L.value.push(m.data),oe.value=!1,Ue.value=!1,re.value=!1,ye.value=!1,ie.value=!1};async function Qe(t){return new Promise(r=>setTimeout(r,t))}const Pt=async(t,r,u,c,m,h)=>await H.runProfileModelByLine(t,r,u,c,m,h),Ut=t=>{let r;t.risk[2]<.25?r="low":t.risk[2]<.5?r="middle":r="high",Tt.value=r,qe.value={value:v.value.length+1,label:W.value,name:W.value,filter:["==","$type",`${W.value}`],flowspeed:t.deepestPoint[2],risk:r},Bt.value=t,v.value.push(qe.value)},et=(t,r,u)=>{t.addSource(u,{type:"raster",tiles:[e+`/tile/raster/mzs/flood/${r}/{x}/{y}/{z}`],tileSize:256,minzoom:10,maxzoom:20,bounds:[120.109,31.823,120.855,32.102]});let c=nt[r].min,m=nt[r].max;t.addLayer({id:u,type:"raster",source:u,paint:{"raster-color":["interpolate",["linear"],["raster-value"],-10-c,"rgba(0,0,255,1)",0-c,"rgba(255, 255, 255, 1)",10-c,"rgba(255, 0, 0, 1)"],"raster-color-mix":[m-c,0,0,0],"raster-opacity":.85,"raster-color-range":[-30,30]}})},Mt=()=>{for(let t=0;t<12;t++)Ve[t].warnValue<.25?v.value[t].risk="low":Ve[t].warnValue<.5?v.value[t].risk="middle":v.value[t].risk="high"},tt=(t,r)=>{t.addLayer({id:"mzsBankLineLowRisk",type:"line",source:"mzsBankLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":["match",["get","name"],"JC01",`${r.value[0].color}`,"JC02",`${r.value[1].color}`,"JC03",`${r.value[2].color}`,"JC04",`${r.value[3].color}`,"JC05",`${r.value[4].color}`,"JC06",`${r.value[5].color}`,"JC07",`${r.value[6].color}`,"JC08",`${r.value[7].color}`,"JC09",`${r.value[8].color}`,"JC10",`${r.value[9].color}`,"JC11",`${r.value[10].color}`,"JC12",`${r.value[11].color}`,"rgb(255, 255, 255)"],"line-width":3}},"mzsSectionLabelLayer")};return lt(async()=>{await Vt(f.value).then(async t=>{y=t,ft(t),t.addSource("mzsPlaceLabelSource",{type:"vector",tiles:[e+"/tile/vector/mzsPlaceLabel/{x}/{y}/{z}"]}),t.addSource("mzsPlaceLineSource",{type:"vector",tiles:[e+"/tile/vector/mzsPlaceLine/{x}/{y}/{z}"]}),t.addSource("mzsBankAreaSSource",{type:"vector",tiles:[e+"/tile/vector/mzsBankAreaOne/{x}/{y}/{z}"]}),t.addSource("mzsBankLineSource",{type:"vector",tiles:[e+"/tile/vector/mzsBankLine/{x}/{y}/{z}"]}),t.addSource("dockAreaSource",{type:"vector",tiles:[e+"/tile/vector/dockArea/{x}/{y}/{z}"]}),t.addSource("dockAreaLabelSource",{type:"vector",tiles:[e+"/tile/vector/center/dockArea/{x}/{y}/{z}"]}),t.addSource("fixProjectAreaSource",{type:"vector",tiles:[e+"/tile/vector/fixProjectArea/{x}/{y}/{z}"]}),t.addSource("fixProjectLineSource",{type:"vector",tiles:[e+"/tile/vector/fjsFixLine/{x}/{y}/{z}"]}),t.addSource("fixProjectAreaLabelSource",{type:"vector",tiles:[e+"/tile/vector/center/fixProjectArea/{x}/{y}/{z}"]}),t.addSource("riverPlaceLabel",{type:"vector",tiles:[e+"/tile/vector/placeLabel/{x}/{y}/{z}"]}),t.addSource("riverBeachSource",{type:"vector",tiles:[e+"/tile/vector/riverBeach/{x}/{y}/{z}"]}),t.addSource("zjgLine",{type:"vector",tiles:[e+"/tile/vector/zjgBridgeLine/{x}/{y}/{z}"]}),t.addLayer({id:"riverBeachArea",type:"fill",source:"riverBeachSource","source-layer":"default",paint:{"fill-color":"rgba(210,244,247, 1)"}}),t.addLayer({id:"zjgBridge",type:"line",source:"zjgLine","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":.6,"line-color":"rgb(183, 189, 183)","line-width":2}}),et(t,23032209,"mapRaster"),t.setLayoutProperty("mapRaster","visibility","none"),t.addLayer({id:"mzsLine",type:"line",source:"mzsPlaceLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgba(26, 87, 138, 0.6)","line-width":2}}),t.addLayer({id:"fjsFixLine",type:"line",source:"fixProjectLineSource","source-layer":"default",layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgba(216, 217, 228, 0.5)","line-width":4}}),t.addLayer({id:"fixProjectFillLayer",type:"fill",source:"fixProjectAreaSource","source-layer":"default",paint:{"fill-color":"rgba(220,224,237, 0.8)","fill-outline-color":"rgba(220,224,237, 0.8)"}}),t.addLayer({id:"fixProjectAreaLabel",type:"symbol",source:"fixProjectAreaLabelSource","source-layer":"default",layout:{"text-field":["get","layer"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"right","text-size":12},paint:{"text-color":"rgba(31, 44, 126, 0.6)"}}),t.addLayer({id:"mzsLabel",type:"symbol",source:"mzsPlaceLabelSource","source-layer":"default",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"left"},paint:{"text-color":"rgba(31, 14, 126, 0.75)"}}),t.addLayer({id:"dockArea",type:"fill",source:"dockAreaSource","source-layer":"default",paint:{"fill-color":"#18b915"}}),t.addLayer({id:"dockAreaLabel",type:"symbol",source:"dockAreaLabelSource","source-layer":"default",layout:{"text-field":["get","project_name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"bottom","text-size":12},paint:{"text-color":"rgba(31, 44, 126, 0.6)"}}),t.addLayer({id:"riverPlaceLabel",type:"symbol",source:"riverPlaceLabel","source-layer":"default",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"left","text-size":18},paint:{"text-color":"rgba(31, 44, 226, 1)"}}),t.on("click",["mzsBankLine"],r=>{console.log(r.features[0])}),t.addSource("mzsSectionLabel",{type:"vector",tiles:[e+"/tile/vector/geomCenter/mzsBankLine/{x}/{y}/{z}"]}),t.addLayer(new Jt(ht)),t.addLayer({id:"mzsBankLineChoosen",type:"line",source:"mzsBankLineSource","source-layer":"default",filter:v.value[1].filter,layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":1,"line-color":"rgb(134, 245, 230)","line-width":10}}),t.addLayer({id:"mzsSectionLabelLayer",type:"symbol",source:"mzsSectionLabel","source-layer":"default",layout:{"text-field":["get","label"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[-1,1.15],"text-anchor":"top","text-size":18,"text-allow-overlap":!0},paint:{"text-color":"rgb(0, 22, 145)"}}),se().setMap(t)}),ze(),xe.value=!1,$e.value=!1,te.value=!1,We.value=!1,He.value=!1,Ze.value=!1,Y.value=!1,await Ne(Q,ee,Fe,Ee),be()}),zt(()=>{se().getMap().remove(),se().destroyMap()}),(t,r)=>{const u=ne("dv-border-box-12"),c=ne("el-input"),m=ne("el-button"),h=ne("el-dialog"),M=ne("dv-loading"),j=Nt("draggable");return _(),D("div",aa,[n("div",{class:"map-container",id:"map",ref_key:"mapContainer",ref:f},null,512),ra,n("div",ia,[n("div",{class:Oe(["risk-item",{active:ae.value}])},[n("div",{class:"risk-main-index waterpower",onClick:be},[ae.value?(_(),O(u,{key:0})):b("",!0),oa])],2),n("div",{class:Oe(["risk-item",{active:J.value}])},[n("div",{class:"risk-main-index riverbed",onClick:De},[J.value?(_(),O(u,{key:0,color:["rgb(73, 164, 101)","#9cf3e0"]})):b("",!0),sa])],2),n("div",{class:Oe(["risk-item",{active:g.value}])},[n("div",{class:"risk-main-index bankGeology",onClick:Pe},[g.value?(_(),O(u,{key:0,color:["rgb(153, 143, 199)","rgb(231, 161, 240)"]})):b("",!0),na])],2)]),G.value?(_(),D("div",la,[n("label",ua,[n("input",{type:"checkbox",checked:S.value,onClick:r[0]||(r[0]=T=>Xe())},null,8,ca),da]),fa])):b("",!0),n("div",ha,[n("label",ma,[n("input",{type:"checkbox",checked:me.value,onClick:r[1]||(r[1]=T=>bt())},null,8,va),pa]),_a]),xa,xe.value?(_(),D("div",ba,Sa)):b("",!0),xe.value?(_(),D("div",wa,[n("div",Aa,[n("div",Ba,[Ta,de(" 高风险区域集中在： "),n("span",Fa,fe(mt("high")),1)])])])):b("",!0),$e.value?(_(),O(k(d),{key:3,onProfileValueChange:ue,profileData:L.value,profileList:v.value,shapeChartLoad:re.value,erosionChartLoad:ie.value},null,8,["profileData","profileList","shapeChartLoad","erosionChartLoad"])):b("",!0),ke.value?(_(),O(k(p),{key:4,onProfileValueChange:ue,profileData:L.value,profileList:v.value,shapeYearlyChartLoad:Ue.value},null,8,["profileData","profileList","shapeYearlyChartLoad"])):b("",!0),te.value?(_(),O(k(o),{key:5,onProfileValueChange:ue,profileData:L.value,profileDataCompare:ce.value,profileList:v.value,shapeChartLoad:re.value},null,8,["profileData","profileDataCompare","profileList","shapeChartLoad"])):b("",!0),We.value?(_(),O(k(x),{key:6,onProfileValueChange:ue,profileData:L.value,profileList:v.value,slopeChartLoad:ye.value},null,8,["profileData","profileList","slopeChartLoad"])):b("",!0),He.value?(_(),O(k(R),{key:7,onProfileValueChange:ue,profileData:L.value,profileList:v.value,slopeChartLoad:ie.value},null,8,["profileData","profileList","slopeChartLoad"])):b("",!0),Ce.value?(_(),D("div",Ea,[F(k(A))])):b("",!0),Y.value?(_(),O(k(i),{key:9,profileList:v.value,flowspeedChartLoad:Me.value,type:I.value,onConditionChange:dt},null,8,["profileList","flowspeedChartLoad","type"])):b("",!0),Y.value?(_(),D("div",ka,[n("label",Ca,[n("input",{type:"checkbox",checked:U.value,onClick:r[2]||(r[2]=T=>Ie())},null,8,La),Da]),Pa])):b("",!0),Y.value?(_(),D("div",Ua,[F(qt,{type:"exp","time-step":P.value,"total-count":25},null,8,["time-step"])])):b("",!0),Le.value?(_(),D("div",Ma,[F(k(B),{timeStep:P.value,type:I.value},null,8,["timeStep","type"])])):b("",!0),g.value?(_(),O(k(he),{key:13})):b("",!0),Ze.value?rt((_(),D("div",Oa,[F(k(l),{profileList:v.value},null,8,["profileList"])])),[[j,{bounds:"body",cancel:"div.content"}]]):b("",!0),S.value&&G.value?(_(),D("div",Va,Na)):b("",!0),F(h,{modelValue:Re.value,"onUpdate:modelValue":r[4]||(r[4]=T=>Re.value=T),title:"绘制断面确认",width:"40vh"},{footer:N(()=>[n("div",Ia,[n("div",Xa,[F(m,{onClick:Lt},{default:N(()=>[de("取消")]),_:1}),F(m,{type:"primary",onClick:Dt},{default:N(()=>[de(" 确认 ")]),_:1})])])]),default:N(()=>[ja,F(c,{modelValue:W.value,"onUpdate:modelValue":r[3]||(r[3]=T=>W.value=T),style:{width:"240px","margin-bottom":"10px","margin-left":"2vw"},placeholder:"请输入断面名称",clearable:""},null,8,["modelValue"])]),_:1},8,["modelValue"]),F(h,{modelValue:Se.value,"onUpdate:modelValue":r[5]||(r[5]=T=>Se.value=T),title:"切换场景确认",width:"40vh"},{footer:N(()=>[n("div",Ga,[n("div",ga,[F(m,{onClick:vt},{default:N(()=>[de("取消")]),_:1}),F(m,{type:"primary",onClick:pt},{default:N(()=>[de(" 确认 ")]),_:1})])])]),default:N(()=>[Ya,n("div",Ja,fe(k(Q).name),1),n("div",$a,fe(k(ee).name),1)]),_:1},8,["modelValue"]),rt(n("div",Wa,[F(M,{class:"loading-icon"},{default:N(()=>[n("div",Ha,fe(E.value),1)]),_:1})],512),[[jt,oe.value]])])}}},tr=ut(Za,[["__scopeId","data-v-83a34eb9"]]);export{tr as default};
