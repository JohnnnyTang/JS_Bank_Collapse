import { defineStore } from 'pinia'
import { ref } from 'vue'
import {
    initialNodes,
    initialEdges,
} from '../components/modelStore/riskCalc/flowChartConfig.js'

export const useMultiIndexStore = defineStore(
    'multiIndex',
    () => {
        const resJson = ref({
            year: '2023',
            vertex: [
                ['13415473', '3768179'],
                ['13415962', '3767887'],
            ],
            scene: 'minzhusha',
            dataFolderPath: 'D:\\2024-work\\shore_collapse\\model\\modelData',
            section: [
                [13415472.343966354, 3768180.165073654, -35.82797622680664],
                [13415477.343275337, 3768175.169561252, -35.272220611572266],
                [13415482.34258432, 3768175.169561252, -35.54665756225586],
                [13415487.341893302, 3768170.17404885, -35.28263473510742],
                [13415492.341202285, 3768170.17404885, -35.537349700927734],
                [13415497.340511268, 3768165.1785364477, -35.36460876464844],
                [13415502.339820253, 3768160.1830240455, -35.028873443603516],
                [13415507.339129236, 3768160.1830240455, -35.22825622558594],
                [13415512.338438218, 3768155.1875116434, -35.18563461303711],
                [13415517.337747201, 3768155.1875116434, -35.53082275390625],
                [13415522.337056184, 3768150.1919992412, -35.065208435058594],
                [13415527.336365167, 3768145.196486839, -35.01221466064453],
                [13415532.33567415, 3768145.196486839, -35.190242767333984],
                [13415537.334983133, 3768140.200974437, -34.97709274291992],
                [13415542.334292116, 3768140.200974437, -35.1569709777832],
                [13415547.333601099, 3768135.205462035, -34.9959716796875],
                [13415552.332910081, 3768130.2099496326, -34.81216812133789],
                [13415557.332219066, 3768130.2099496326, -34.90977478027344],
                [13415562.331528049, 3768125.2144372305, -34.7636833190918],
                [13415567.330837032, 3768125.2144372305, -34.79432678222656],
                [13415572.330146015, 3768120.2189248283, -34.599056243896484],
                [13415577.329454998, 3768115.223412426, -34.64480209350586],
                [13415582.32876398, 3768115.223412426, -34.77347946166992],
                [13415587.328072963, 3768110.227900024, -34.634620666503906],
                [13415592.327381946, 3768110.227900024, -34.72611618041992],
                [13415597.326690929, 3768105.232387622, -34.706966400146484],
                [13415602.325999912, 3768100.2368752197, -34.72788619995117],
                [13415607.325308895, 3768100.2368752197, -34.787750244140625],
                [13415612.32461788, 3768095.2413628176, -34.810333251953125],
                [13415617.323926862, 3768095.2413628176, -34.88984680175781],
                [13415622.323235845, 3768090.2458504154, -34.732574462890625],
                [13415627.322544828, 3768085.2503380133, -34.53068542480469],
                [13415632.32185381, 3768085.2503380133, -34.56848907470703],
                [13415637.321162794, 3768080.254825611, -34.53269958496094],
                [13415642.320471777, 3768080.254825611, -34.660194396972656],
                [13415647.31978076, 3768075.259313209, -34.55039596557617],
                [13415652.319089742, 3768070.263800807, -34.47502136230469],
                [13415657.318398725, 3768070.263800807, -34.62041091918945],
                [13415662.317707708, 3768065.2682884047, -34.60259246826172],
                [13415667.317016693, 3768065.2682884047, -34.65303421020508],
                [13415672.316325676, 3768060.2727760025, -34.62791061401367],
                [13415677.315634659, 3768055.2772636004, -34.65610885620117],
                [13415682.314943641, 3768055.2772636004, -34.840049743652344],
                [13415687.314252624, 3768050.281751198, -34.825355529785156],
                [13415692.313561607, 3768050.281751198, -34.86396026611328],
                [13415697.31287059, 3768045.286238796, -34.59688949584961],
                [13415702.312179573, 3768040.290726394, -34.311973571777344],
                [13415707.311488556, 3768040.290726394, -34.57579803466797],
                [13415712.310797539, 3768035.295213992, -34.53551483154297],
                [13415717.310106521, 3768035.295213992, -34.68082046508789],
                [13415722.309415506, 3768030.2997015896, -34.88109588623047],
                [13415727.308724489, 3768030.2997015896, -35.002315521240234],
                [13415732.308033472, 3768025.3041891875, -35.15351867675781],
                [13415737.307342455, 3768020.3086767853, -35.02076721191406],
                [13415742.306651438, 3768020.3086767853, -35.107723236083984],
                [13415747.30596042, 3768015.313164383, -35.04171371459961],
                [13415752.305269403, 3768015.313164383, -34.96215057373047],
                [13415757.304578386, 3768010.317651981, -34.74646759033203],
                [13415762.30388737, 3768005.322139579, -34.54818344116211],
                [13415767.303196352, 3768005.322139579, -34.585323333740234],
                [13415772.302505335, 3768000.3266271767, -34.33525466918945],
                [13415777.301814318, 3768000.3266271767, -34.409244537353516],
                [13415782.301123302, 3767995.3311147746, -34.35969161987305],
                [13415787.300432285, 3767990.3356023724, -34.42333984375],
                [13415792.299741268, 3767990.3356023724, -34.462039947509766],
                [13415797.299050251, 3767985.3400899703, -34.503116607666016],
                [13415802.298359234, 3767985.3400899703, -34.53792190551758],
                [13415807.297668217, 3767980.344577568, -34.8355712890625],
                [13415812.2969772, 3767975.349065166, -35.19289779663086],
                [13415817.296286182, 3767975.349065166, -35.18600082397461],
                [13415822.295595165, 3767970.353552764, -35.630943298339844],
                [13415827.294904148, 3767970.353552764, -35.61962127685547],
                [13415832.294213131, 3767965.3580403617, -35.87156677246094],
                [13415837.293522116, 3767960.3625279595, -35.904476165771484],
                [13415842.292831099, 3767960.3625279595, -36.04174041748047],
                [13415847.292140082, 3767955.3670155574, -35.88138198852539],
                [13415852.291449064, 3767955.3670155574, -35.92491149902344],
                [13415857.290758047, 3767950.371503155, -35.89607238769531],
                [13415862.29006703, 3767945.375990753, -35.36025619506836],
                [13415867.289376013, 3767945.375990753, -35.39780044555664],
                [13415872.288684996, 3767940.380478351, -35.18196487426758],
                [13415877.287993979, 3767940.380478351, -35.296775817871094],
                [13415882.287302962, 3767935.3849659488, -35.036216735839844],
                [13415887.286611944, 3767930.3894535466, -34.79193115234375],
                [13415892.28592093, 3767930.3894535466, -34.81982421875],
                [13415897.285229912, 3767925.3939411445, -34.387420654296875],
                [13415902.284538895, 3767925.3939411445, -34.47102737426758],
                [13415907.283847878, 3767920.398428743, -34.41170883178711],
                [13415912.28315686, 3767915.4029163406, -33.87006759643555],
                [13415917.282465843, 3767915.4029163406, -33.95841979980469],
                [13415922.281774826, 3767910.4074039385, -33.62364959716797],
                [13415927.28108381, 3767910.4074039385, -33.71105194091797],
                [13415932.280392792, 3767905.4118915363, -33.43485641479492],
                [13415937.279701775, 3767900.416379134, -33.295387268066406],
                [13415942.279010758, 3767900.416379134, -33.390708923339844],
                [13415947.278319743, 3767895.420866732, -33.243492126464844],
                [13415952.277628725, 3767895.420866732, -33.31637954711914],
                [13415957.276937708, 3767890.42535433, -33.20893096923828],
            ],
            PQ: [[0, 1, 0, 0], '低风险', 0.8],
            KY: [[0, 0, 0, 1], '较高风险', 0.9072254547043183],
            ZD: [[0, 1, 0, 0], '低风险', 0.1213460838489792],
            ZB: [[0, 0, 1, 0], '高风险', 30.221],
            SA: [
                [1, 0, 0, 0],
                '较低风险',
                [
                    0.015255355834960937, 0.009323043823242188,
                    -0.0026703643798828124, 0.0020932769775390625,
                    -0.005063705444335938, 0.010916824340820313,
                    -0.025913772583007814, 0.008979568481445313,
                    0.03116630554199219, 0.011849103655133928,
                ],
            ],
            LN: [[0, 0, 1, 0], '高风险', 5.524692535400391],
            beforeSection: [
                [13415468.69359842, 3768179.371655211, -33.08889389038086],
                [13415473.69359842, 3768174.371655211, -32.604366302490234],
                [13415478.69359842, 3768174.371655211, -32.676109313964844],
                [13415483.69359842, 3768169.371655211, -32.57122802734375],
                [13415488.69359842, 3768169.371655211, -32.65007400512695],
                [13415493.69359842, 3768164.371655211, -32.60939407348633],
                [13415498.69359842, 3768159.371655211, -32.678565979003906],
                [13415503.69359842, 3768159.371655211, -32.698673248291016],
                [13415508.69359842, 3768154.371655211, -32.73828125],
                [13415513.69359842, 3768154.371655211, -32.811187744140625],
                [13415518.69359842, 3768149.371655211, -32.90825271606445],
                [13415523.69359842, 3768144.371655211, -32.92779541015625],
                [13415528.69359842, 3768144.371655211, -32.91175079345703],
                [13415533.69359842, 3768139.371655211, -32.803810119628906],
                [13415538.69359842, 3768139.371655211, -32.794742584228516],
                [13415543.69359842, 3768134.371655211, -32.709716796875],
                [13415548.69359842, 3768134.371655211, -32.679073333740234],
                [13415553.69359842, 3768129.371655211, -32.58740234375],
                [13415558.69359842, 3768124.371655211, -32.476593017578125],
                [13415563.69359842, 3768124.371655211, -32.45947265625],
                [13415568.69359842, 3768119.371655211, -32.35371398925781],
                [13415573.69359842, 3768119.371655211, -32.340389251708984],
                [13415578.69359842, 3768114.371655211, -32.29506301879883],
                [13415583.69359842, 3768109.371655211, -31.89219093322754],
                [13415588.69359842, 3768109.371655211, -31.95894432067871],
                [13415593.69359842, 3768104.371655211, -31.72937774658203],
                [13415598.69359842, 3768104.371655211, -31.858722686767578],
                [13415603.69359842, 3768099.371655211, -31.639785766601562],
                [13415608.69359842, 3768094.371655211, -31.51189422607422],
                [13415613.69359842, 3768094.371655211, -31.58026885986328],
                [13415618.69359842, 3768089.371655211, -31.47567367553711],
                [13415623.69359842, 3768089.371655211, -31.540849685668945],
                [13415628.69359842, 3768084.371655211, -31.384592056274414],
                [13415633.69359842, 3768079.371655211, -31.365854263305664],
                [13415638.69359842, 3768079.371655211, -31.433279037475586],
                [13415643.69359842, 3768074.371655211, -31.4996337890625],
                [13415648.69359842, 3768074.371655211, -31.56291389465332],
                [13415653.69359842, 3768069.371655211, -31.62513542175293],
                [13415658.69359842, 3768069.371655211, -31.678247451782227],
                [13415663.69359842, 3768064.371655211, -31.79671287536621],
                [13415668.69359842, 3768059.371655211, -31.840410232543945],
                [13415673.69359842, 3768059.371655211, -31.874099731445312],
                [13415678.69359842, 3768054.371655211, -31.937271118164062],
                [13415683.69359842, 3768054.371655211, -31.950777053833008],
                [13415688.69359842, 3768049.371655211, -31.958454132080078],
                [13415693.69359842, 3768044.371655211, -31.758544921875],
                [13415698.69359842, 3768044.371655211, -31.700090408325195],
                [13415703.69359842, 3768039.371655211, -31.528200149536133],
                [13415708.69359842, 3768039.371655211, -31.50128936767578],
                [13415713.69359842, 3768034.371655211, -31.28127098083496],
                [13415718.69359842, 3768029.371655211, -30.98933982849121],
                [13415723.69359842, 3768029.371655211, -30.99112892150879],
                [13415728.69359842, 3768024.371655211, -30.746749877929688],
                [13415733.69359842, 3768024.371655211, -30.76004981994629],
                [13415738.69359842, 3768019.371655211, -30.68242645263672],
                [13415743.69359842, 3768014.371655211, -30.768936157226562],
                [13415748.69359842, 3768014.371655211, -30.870380401611328],
                [13415753.69359842, 3768009.371655211, -30.68882942199707],
                [13415758.69359842, 3768009.371655211, -30.82552719116211],
                [13415763.69359842, 3768004.371655211, -30.88509750366211],
                [13415768.69359842, 3767999.371655211, -30.78602409362793],
                [13415773.69359842, 3767999.371655211, -30.90045166015625],
                [13415778.69359842, 3767994.371655211, -30.913515090942383],
                [13415783.69359842, 3767994.371655211, -31.037147521972656],
                [13415788.69359842, 3767989.371655211, -31.038589477539062],
                [13415793.69359842, 3767989.371655211, -31.064090728759766],
                [13415798.69359842, 3767984.371655211, -31.05763816833496],
                [13415803.69359842, 3767979.371655211, -31.041608810424805],
                [13415808.69359842, 3767979.371655211, -31.024490356445312],
                [13415813.69359842, 3767974.371655211, -30.98160171508789],
                [13415818.69359842, 3767974.371655211, -30.95441246032715],
                [13415823.69359842, 3767969.371655211, -30.905109405517578],
                [13415828.69359842, 3767964.371655211, -30.713499069213867],
                [13415833.69359842, 3767964.371655211, -30.707460403442383],
                [13415838.69359842, 3767959.371655211, -30.517047882080078],
                [13415843.69359842, 3767959.371655211, -30.53497886657715],
                [13415848.69359842, 3767954.371655211, -30.439159393310547],
                [13415853.69359842, 3767949.371655211, -30.415225982666016],
                [13415858.69359842, 3767949.371655211, -30.414152145385742],
                [13415863.69359842, 3767944.371655211, -30.380359649658203],
                [13415868.69359842, 3767944.371655211, -30.319616317749023],
                [13415873.69359842, 3767939.371655211, -30.34897804260254],
                [13415878.69359842, 3767934.371655211, -30.39056396484375],
                [13415883.69359842, 3767934.371655211, -30.33907127380371],
                [13415888.69359842, 3767929.371655211, -30.329269409179688],
                [13415893.69359842, 3767929.371655211, -30.333513259887695],
                [13415898.69359842, 3767924.371655211, -30.212635040283203],
                [13415903.69359842, 3767924.371655211, -30.22703742980957],
                [13415908.69359842, 3767919.371655211, -30.20882797241211],
                [13415913.69359842, 3767914.371655211, -29.92478370666504],
                [13415918.69359842, 3767914.371655211, -29.941682815551758],
                [13415923.69359842, 3767909.371655211, -29.779850006103516],
                [13415928.69359842, 3767909.371655211, -29.804288864135742],
                [13415933.69359842, 3767904.371655211, -29.633655548095703],
                [13415938.69359842, 3767899.371655211, -29.516870498657227],
                [13415943.69359842, 3767899.371655211, -29.48837661743164],
                [13415948.69359842, 3767894.371655211, -29.42635154724121],
                [13415953.69359842, 3767894.371655211, -29.433244705200195],
                [13415958.69359842, 3767889.371655211, -29.357677459716797],
            ],
            risk: [[0.33599999999999997, 0.156, 0.364, 0.144], '高风险', 0.508],
        })
        const taskId = ref('662a3e4acff7845d51a7bb63')

        const flowNode = ref(initialNodes)

        const flowEdge = ref(initialEdges)

        function updateSectionStatus(newStatus) {
            flowNode.value[0].data.status = newStatus
            // console.log("update", flowEdge.value[2])
            if (newStatus == 2) {
                flowNode.value[1].data.status = 0
                flowNode.value[2].data.status = 0
                flowNode.value[3].data.status = -1
                flowEdge.value[0].style.stroke = '#10b981'
                flowEdge.value[1].style.stroke = '#10b981'
            }
        }

        function updateVelocityEvolveStatus(id, newStatus) {
            flowNode.value[id].data.status = newStatus
            if(newStatus== 2) {
                flowEdge.value[+(id - 1)].animated = false
                if(id == 1) {
                    flowNode.value[1].data.result = [
                        resJson.value.PQ[1],
                        resJson.value.KY[1],
                        resJson.value.ZD[1],
                    ].join(',')
                    flowEdge.value[2].style.stroke = '#10b981'
                }
                else {
                    flowNode.value[2].data.result = [
                        resJson.value.ZB[1],
                        resJson.value.SA[1],
                        resJson.value.LN[1],
                    ].join(',')
                    flowEdge.value[3].style.stroke = '#10b981'
                }
                console.log(flowEdge.value[+(id - 1)])
                
            }
            if (
                flowNode.value[1].data.status == 2 &&
                flowNode.value[2].data.status == 2
            ) {
                flowNode.value[3].data.status = 0
            }
        }

        function updateMatrixCalcStatus(newStatus) {
            flowNode.value[3].data.status = newStatus
            if (flowNode.value[3].data.status == 2) {
                flowNode.value[3].data.result = [
                    resJson.value.risk[1],
                    resJson.value.risk[2].toFixed(3)
                ].join(': ')
                flowEdge.value[2].animated = false
                flowEdge.value[3].animated = false
            }
        }

        return {
            resJson,
            taskId,
            flowNode,
            flowEdge,
            updateSectionStatus,
            updateVelocityEvolveStatus,
            updateMatrixCalcStatus,
        }
    },
    {
        persist: {
            storage: sessionStorage,
            paths: ['multiIndex'],
        },
    },
)
